{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/base/parts/tree/browser/treeView.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/base/parts/tree/browser/treeView.ts","mtime":1555102316000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar Platform = require(\"vs/base/common/platform\");\nvar Browser = require(\"vs/base/browser/browser\");\nvar Lifecycle = require(\"vs/base/common/lifecycle\");\nvar DOM = require(\"vs/base/browser/dom\");\nvar Diff = require(\"vs/base/common/diff/diff\");\nvar Touch = require(\"vs/base/browser/touch\");\nvar strings = require(\"vs/base/common/strings\");\nvar Mouse = require(\"vs/base/browser/mouseEvent\");\nvar Keyboard = require(\"vs/base/browser/keyboardEvent\");\nvar dnd = require(\"./treeDnd\");\nvar iterator_1 = require(\"vs/base/common/iterator\");\nvar scrollableElement_1 = require(\"vs/base/browser/ui/scrollbar/scrollableElement\");\nvar scrollable_1 = require(\"vs/base/common/scrollable\");\nvar treeViewModel_1 = require(\"vs/base/parts/tree/browser/treeViewModel\");\nvar _ = require(\"vs/base/parts/tree/browser/tree\");\nvar keyCodes_1 = require(\"vs/base/common/keyCodes\");\nvar event_1 = require(\"vs/base/common/event\");\nvar dnd_1 = require(\"vs/base/browser/dnd\");\nvar treeDefaults_1 = require(\"./treeDefaults\");\nvar async_1 = require(\"vs/base/common/async\");\nfunction removeFromParent(element) {\n    try {\n        element.parentElement.removeChild(element);\n    }\n    catch (e) {\n        // this will throw if this happens due to a blur event, nasty business\n    }\n}\nvar RowCache = /** @class */ (function () {\n    function RowCache(context) {\n        this.context = context;\n        this._cache = { '': [] };\n    }\n    RowCache.prototype.alloc = function (templateId) {\n        var result = this.cache(templateId).pop();\n        if (!result) {\n            var content = document.createElement('div');\n            content.className = 'content';\n            var row = document.createElement('div');\n            row.appendChild(content);\n            var templateData = null;\n            try {\n                templateData = this.context.renderer.renderTemplate(this.context.tree, templateId, content);\n            }\n            catch (err) {\n                console.error('Tree usage error: exception while rendering template');\n                console.error(err);\n            }\n            result = {\n                element: row,\n                templateId: templateId,\n                templateData: templateData\n            };\n        }\n        return result;\n    };\n    RowCache.prototype.release = function (templateId, row) {\n        removeFromParent(row.element);\n        this.cache(templateId).push(row);\n    };\n    RowCache.prototype.cache = function (templateId) {\n        return this._cache[templateId] || (this._cache[templateId] = []);\n    };\n    RowCache.prototype.garbageCollect = function () {\n        var _this = this;\n        if (this._cache) {\n            Object.keys(this._cache).forEach(function (templateId) {\n                _this._cache[templateId].forEach(function (cachedRow) {\n                    _this.context.renderer.disposeTemplate(_this.context.tree, templateId, cachedRow.templateData);\n                    cachedRow.element = null;\n                    cachedRow.templateData = null;\n                });\n                delete _this._cache[templateId];\n            });\n        }\n    };\n    RowCache.prototype.dispose = function () {\n        this.garbageCollect();\n        this._cache = null;\n    };\n    return RowCache;\n}());\nexports.RowCache = RowCache;\nvar ViewItem = /** @class */ (function () {\n    function ViewItem(context, model) {\n        var _this = this;\n        this.width = 0;\n        this.unbindDragStart = Lifecycle.Disposable.None;\n        this.context = context;\n        this.model = model;\n        this.id = this.model.id;\n        this.row = null;\n        this.top = 0;\n        this.height = model.getHeight();\n        this._styles = {};\n        model.getAllTraits().forEach(function (t) { return _this._styles[t] = true; });\n        if (model.isExpanded()) {\n            this.addClass('expanded');\n        }\n    }\n    Object.defineProperty(ViewItem.prototype, \"expanded\", {\n        set: function (value) {\n            value ? this.addClass('expanded') : this.removeClass('expanded');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ViewItem.prototype, \"loading\", {\n        set: function (value) {\n            value ? this.addClass('loading') : this.removeClass('loading');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ViewItem.prototype, \"draggable\", {\n        get: function () {\n            return this._draggable;\n        },\n        set: function (value) {\n            this._draggable = value;\n            this.render(true);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ViewItem.prototype, \"dropTarget\", {\n        set: function (value) {\n            value ? this.addClass('drop-target') : this.removeClass('drop-target');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ViewItem.prototype, \"element\", {\n        get: function () {\n            return (this.row && this.row.element);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ViewItem.prototype, \"templateId\", {\n        get: function () {\n            return this._templateId || (this._templateId = (this.context.renderer.getTemplateId && this.context.renderer.getTemplateId(this.context.tree, this.model.getElement())));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ViewItem.prototype.addClass = function (name) {\n        this._styles[name] = true;\n        this.render(true);\n    };\n    ViewItem.prototype.removeClass = function (name) {\n        delete this._styles[name]; // is this slow?\n        this.render(true);\n    };\n    ViewItem.prototype.render = function (skipUserRender) {\n        var _this = this;\n        if (skipUserRender === void 0) { skipUserRender = false; }\n        if (!this.model || !this.element) {\n            return;\n        }\n        var classes = ['monaco-tree-row'];\n        classes.push.apply(classes, Object.keys(this._styles));\n        if (this.model.hasChildren()) {\n            classes.push('has-children');\n        }\n        this.element.className = classes.join(' ');\n        this.element.draggable = this.draggable;\n        this.element.style.height = this.height + 'px';\n        // ARIA\n        this.element.setAttribute('role', 'treeitem');\n        var accessibility = this.context.accessibilityProvider;\n        var ariaLabel = accessibility.getAriaLabel(this.context.tree, this.model.getElement());\n        if (ariaLabel) {\n            this.element.setAttribute('aria-label', ariaLabel);\n        }\n        if (accessibility.getPosInSet && accessibility.getSetSize) {\n            this.element.setAttribute('aria-setsize', accessibility.getSetSize());\n            this.element.setAttribute('aria-posinset', accessibility.getPosInSet(this.context.tree, this.model.getElement()));\n        }\n        if (this.model.hasTrait('focused')) {\n            var base64Id = strings.safeBtoa(this.model.id);\n            this.element.setAttribute('aria-selected', 'true');\n            this.element.setAttribute('id', base64Id);\n        }\n        else {\n            this.element.setAttribute('aria-selected', 'false');\n            this.element.removeAttribute('id');\n        }\n        if (this.model.hasChildren()) {\n            this.element.setAttribute('aria-expanded', String(!!this._styles['expanded']));\n        }\n        else {\n            this.element.removeAttribute('aria-expanded');\n        }\n        this.element.setAttribute('aria-level', String(this.model.getDepth()));\n        if (this.context.options.paddingOnRow) {\n            this.element.style.paddingLeft = this.context.options.twistiePixels + ((this.model.getDepth() - 1) * this.context.options.indentPixels) + 'px';\n        }\n        else {\n            this.element.style.paddingLeft = ((this.model.getDepth() - 1) * this.context.options.indentPixels) + 'px';\n            this.row.element.firstElementChild.style.paddingLeft = this.context.options.twistiePixels + 'px';\n        }\n        var uri = this.context.dnd.getDragURI(this.context.tree, this.model.getElement());\n        if (uri !== this.uri) {\n            if (this.unbindDragStart) {\n                this.unbindDragStart.dispose();\n            }\n            if (uri) {\n                this.uri = uri;\n                this.draggable = true;\n                this.unbindDragStart = DOM.addDisposableListener(this.element, 'dragstart', function (e) {\n                    _this.onDragStart(e);\n                });\n            }\n            else {\n                this.uri = null;\n            }\n        }\n        if (!skipUserRender && this.element) {\n            var paddingLeft = 0;\n            if (this.context.horizontalScrolling) {\n                var style = window.getComputedStyle(this.element);\n                paddingLeft = parseFloat(style.paddingLeft);\n            }\n            if (this.context.horizontalScrolling) {\n                this.element.style.width = 'fit-content';\n            }\n            try {\n                this.context.renderer.renderElement(this.context.tree, this.model.getElement(), this.templateId, this.row.templateData);\n            }\n            catch (err) {\n                console.error('Tree usage error: exception while rendering element');\n                console.error(err);\n            }\n            if (this.context.horizontalScrolling) {\n                this.width = DOM.getContentWidth(this.element) + paddingLeft;\n                this.element.style.width = '';\n            }\n        }\n    };\n    ViewItem.prototype.updateWidth = function () {\n        if (!this.context.horizontalScrolling || !this.element) {\n            return;\n        }\n        var style = window.getComputedStyle(this.element);\n        var paddingLeft = parseFloat(style.paddingLeft);\n        this.element.style.width = 'fit-content';\n        this.width = DOM.getContentWidth(this.element) + paddingLeft;\n        this.element.style.width = '';\n    };\n    ViewItem.prototype.insertInDOM = function (container, afterElement) {\n        if (!this.row) {\n            this.row = this.context.cache.alloc(this.templateId);\n            // used in reverse lookup from HTMLElement to Item\n            this.element[TreeView.BINDING] = this;\n        }\n        if (this.element.parentElement) {\n            return;\n        }\n        if (afterElement === null) {\n            container.appendChild(this.element);\n        }\n        else {\n            try {\n                container.insertBefore(this.element, afterElement);\n            }\n            catch (e) {\n                console.warn('Failed to locate previous tree element');\n                container.appendChild(this.element);\n            }\n        }\n        this.render();\n    };\n    ViewItem.prototype.removeFromDOM = function () {\n        if (!this.row) {\n            return;\n        }\n        this.unbindDragStart.dispose();\n        this.uri = null;\n        this.element[TreeView.BINDING] = null;\n        this.context.cache.release(this.templateId, this.row);\n        this.row = null;\n    };\n    ViewItem.prototype.dispose = function () {\n        this.row = null;\n    };\n    return ViewItem;\n}());\nexports.ViewItem = ViewItem;\nvar RootViewItem = /** @class */ (function (_super) {\n    tslib_1.__extends(RootViewItem, _super);\n    function RootViewItem(context, model, wrapper) {\n        var _this = _super.call(this, context, model) || this;\n        _this.row = {\n            element: wrapper,\n            templateData: null,\n            templateId: null\n        };\n        return _this;\n    }\n    RootViewItem.prototype.render = function () {\n        if (!this.model || !this.element) {\n            return;\n        }\n        var classes = ['monaco-tree-wrapper'];\n        classes.push.apply(classes, Object.keys(this._styles));\n        if (this.model.hasChildren()) {\n            classes.push('has-children');\n        }\n        this.element.className = classes.join(' ');\n    };\n    RootViewItem.prototype.insertInDOM = function (container, afterElement) {\n        // noop\n    };\n    RootViewItem.prototype.removeFromDOM = function () {\n        // noop\n    };\n    return RootViewItem;\n}(ViewItem));\nfunction reactionEquals(one, other) {\n    if (!one && !other) {\n        return true;\n    }\n    else if (!one || !other) {\n        return false;\n    }\n    else if (one.accept !== other.accept) {\n        return false;\n    }\n    else if (one.bubble !== other.bubble) {\n        return false;\n    }\n    else if (one.effect !== other.effect) {\n        return false;\n    }\n    else {\n        return true;\n    }\n}\nvar TreeView = /** @class */ (function (_super) {\n    tslib_1.__extends(TreeView, _super);\n    function TreeView(context, container) {\n        var _this = _super.call(this) || this;\n        _this.model = null;\n        _this.lastClickTimeStamp = 0;\n        _this.contentWidthUpdateDelayer = new async_1.Delayer(50);\n        _this.isRefreshing = false;\n        _this.refreshingPreviousChildrenIds = {};\n        _this.currentDragAndDropData = null;\n        _this.currentDropTarget = null;\n        _this.currentDropTargets = null;\n        _this.currentDropDisposable = Lifecycle.Disposable.None;\n        _this.dragAndDropScrollInterval = null;\n        _this.dragAndDropScrollTimeout = null;\n        _this.dragAndDropMouseY = null;\n        _this.onHiddenScrollTop = null;\n        _this._onDOMFocus = new event_1.Emitter();\n        _this._onDOMBlur = new event_1.Emitter();\n        _this._onDidScroll = new event_1.Emitter();\n        TreeView.counter++;\n        _this.instance = TreeView.counter;\n        var horizontalScrollMode = typeof context.options.horizontalScrollMode === 'undefined' ? scrollable_1.ScrollbarVisibility.Hidden : context.options.horizontalScrollMode;\n        _this.horizontalScrolling = horizontalScrollMode !== scrollable_1.ScrollbarVisibility.Hidden;\n        _this.context = {\n            dataSource: context.dataSource,\n            renderer: context.renderer,\n            controller: context.controller,\n            dnd: context.dnd,\n            filter: context.filter,\n            sorter: context.sorter,\n            tree: context.tree,\n            accessibilityProvider: context.accessibilityProvider,\n            options: context.options,\n            cache: new RowCache(context),\n            horizontalScrolling: _this.horizontalScrolling\n        };\n        _this.modelListeners = [];\n        _this.viewListeners = [];\n        _this.items = {};\n        _this.domNode = document.createElement('div');\n        _this.domNode.className = \"monaco-tree no-focused-item monaco-tree-instance-\" + _this.instance;\n        // to allow direct tabbing into the tree instead of first focusing the tree\n        _this.domNode.tabIndex = context.options.preventRootFocus ? -1 : 0;\n        _this.styleElement = DOM.createStyleSheet(_this.domNode);\n        _this.treeStyler = context.styler || new treeDefaults_1.DefaultTreestyler(_this.styleElement, \"monaco-tree-instance-\" + _this.instance);\n        // ARIA\n        _this.domNode.setAttribute('role', 'tree');\n        if (_this.context.options.ariaLabel) {\n            _this.domNode.setAttribute('aria-label', _this.context.options.ariaLabel);\n        }\n        if (_this.context.options.alwaysFocused) {\n            DOM.addClass(_this.domNode, 'focused');\n        }\n        if (!_this.context.options.paddingOnRow) {\n            DOM.addClass(_this.domNode, 'no-row-padding');\n        }\n        _this.wrapper = document.createElement('div');\n        _this.wrapper.className = 'monaco-tree-wrapper';\n        _this.scrollableElement = new scrollableElement_1.ScrollableElement(_this.wrapper, {\n            alwaysConsumeMouseWheel: true,\n            horizontal: horizontalScrollMode,\n            vertical: (typeof context.options.verticalScrollMode !== 'undefined' ? context.options.verticalScrollMode : scrollable_1.ScrollbarVisibility.Auto),\n            useShadows: context.options.useShadows\n        });\n        _this.scrollableElement.onScroll(function (e) {\n            _this.render(e.scrollTop, e.height, e.scrollLeft, e.width, e.scrollWidth);\n            _this._onDidScroll.fire();\n        });\n        if (Browser.isIE) {\n            _this.wrapper.style.msTouchAction = 'none';\n            _this.wrapper.style.msContentZooming = 'none';\n        }\n        else {\n            Touch.Gesture.addTarget(_this.wrapper);\n        }\n        _this.rowsContainer = document.createElement('div');\n        _this.rowsContainer.className = 'monaco-tree-rows';\n        if (context.options.showTwistie) {\n            _this.rowsContainer.className += ' show-twisties';\n        }\n        var focusTracker = DOM.trackFocus(_this.domNode);\n        _this.viewListeners.push(focusTracker.onDidFocus(function () { return _this.onFocus(); }));\n        _this.viewListeners.push(focusTracker.onDidBlur(function () { return _this.onBlur(); }));\n        _this.viewListeners.push(focusTracker);\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keydown', function (e) { return _this.onKeyDown(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'keyup', function (e) { return _this.onKeyUp(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mousedown', function (e) { return _this.onMouseDown(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'mouseup', function (e) { return _this.onMouseUp(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'auxclick', function (e) {\n            if (e && e.button === 1) {\n                _this.onMouseMiddleClick(e);\n            }\n        }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'click', function (e) { return _this.onClick(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.domNode, 'contextmenu', function (e) { return _this.onContextMenu(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Tap, function (e) { return _this.onTap(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, Touch.EventType.Change, function (e) { return _this.onTouchChange(e); }));\n        if (Browser.isIE) {\n            _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSPointerDown', function (e) { return _this.onMsPointerDown(e); }));\n            _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'MSGestureTap', function (e) { return _this.onMsGestureTap(e); }));\n            // these events come too fast, we throttle them\n            _this.viewListeners.push(DOM.addDisposableThrottledListener(_this.wrapper, 'MSGestureChange', function (e) { return _this.onThrottledMsGestureChange(e); }, function (lastEvent, event) {\n                event.stopPropagation();\n                event.preventDefault();\n                var result = { translationY: event.translationY, translationX: event.translationX };\n                if (lastEvent) {\n                    result.translationY += lastEvent.translationY;\n                    result.translationX += lastEvent.translationX;\n                }\n                return result;\n            }));\n        }\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragover', function (e) { return _this.onDragOver(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(_this.wrapper, 'drop', function (e) { return _this.onDrop(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragend', function (e) { return _this.onDragEnd(e); }));\n        _this.viewListeners.push(DOM.addDisposableListener(window, 'dragleave', function (e) { return _this.onDragOver(e); }));\n        _this.wrapper.appendChild(_this.rowsContainer);\n        _this.domNode.appendChild(_this.scrollableElement.getDomNode());\n        container.appendChild(_this.domNode);\n        _this.lastRenderTop = 0;\n        _this.lastRenderHeight = 0;\n        _this.didJustPressContextMenuKey = false;\n        _this.currentDropTarget = null;\n        _this.currentDropTargets = [];\n        _this.shouldInvalidateDropReaction = false;\n        _this.dragAndDropScrollInterval = null;\n        _this.dragAndDropScrollTimeout = null;\n        _this.onRowsChanged();\n        _this.layout();\n        _this.setupMSGesture();\n        _this.applyStyles(context.options);\n        return _this;\n    }\n    Object.defineProperty(TreeView.prototype, \"onDOMFocus\", {\n        get: function () { return this._onDOMFocus.event; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"onDOMBlur\", {\n        get: function () { return this._onDOMBlur.event; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"onDidScroll\", {\n        get: function () { return this._onDidScroll.event; },\n        enumerable: true,\n        configurable: true\n    });\n    TreeView.prototype.applyStyles = function (styles) {\n        this.treeStyler.style(styles);\n    };\n    TreeView.prototype.createViewItem = function (item) {\n        return new ViewItem(this.context, item);\n    };\n    TreeView.prototype.getHTMLElement = function () {\n        return this.domNode;\n    };\n    TreeView.prototype.focus = function () {\n        this.domNode.focus();\n    };\n    TreeView.prototype.isFocused = function () {\n        return document.activeElement === this.domNode;\n    };\n    TreeView.prototype.blur = function () {\n        this.domNode.blur();\n    };\n    TreeView.prototype.onVisible = function () {\n        this.scrollTop = this.onHiddenScrollTop;\n        this.onHiddenScrollTop = null;\n        this.setupMSGesture();\n    };\n    TreeView.prototype.setupMSGesture = function () {\n        var _this = this;\n        if (window.MSGesture) {\n            this.msGesture = new MSGesture();\n            setTimeout(function () { return _this.msGesture.target = _this.wrapper; }, 100); // TODO@joh, TODO@IETeam\n        }\n    };\n    TreeView.prototype.onHidden = function () {\n        this.onHiddenScrollTop = this.scrollTop;\n    };\n    TreeView.prototype.isTreeVisible = function () {\n        return this.onHiddenScrollTop === null;\n    };\n    TreeView.prototype.layout = function (height, width) {\n        if (!this.isTreeVisible()) {\n            return;\n        }\n        this.viewHeight = height || DOM.getContentHeight(this.wrapper); // render\n        this.scrollHeight = this.getContentHeight();\n        if (this.horizontalScrolling) {\n            this.viewWidth = width || DOM.getContentWidth(this.wrapper);\n        }\n    };\n    TreeView.prototype.getFirstVisibleElement = function () {\n        var firstIndex = this.indexAt(this.lastRenderTop);\n        var item = this.itemAtIndex(firstIndex);\n        if (!item) {\n            return item;\n        }\n        var itemMidpoint = item.top + item.height / 2;\n        if (itemMidpoint < this.scrollTop) {\n            var nextItem = this.itemAtIndex(firstIndex + 1);\n            item = nextItem || item;\n        }\n        return item.model.getElement();\n    };\n    TreeView.prototype.getLastVisibleElement = function () {\n        var item = this.itemAtIndex(this.indexAt(this.lastRenderTop + this.lastRenderHeight - 1));\n        return item && item.model.getElement();\n    };\n    TreeView.prototype.render = function (scrollTop, viewHeight, scrollLeft, viewWidth, scrollWidth) {\n        var i;\n        var stop;\n        var renderTop = scrollTop;\n        var renderBottom = scrollTop + viewHeight;\n        var thisRenderBottom = this.lastRenderTop + this.lastRenderHeight;\n        // when view scrolls down, start rendering from the renderBottom\n        for (i = this.indexAfter(renderBottom) - 1, stop = this.indexAt(Math.max(thisRenderBottom, renderTop)); i >= stop; i--) {\n            this.insertItemInDOM(this.itemAtIndex(i));\n        }\n        // when view scrolls up, start rendering from either this.renderTop or renderBottom\n        for (i = Math.min(this.indexAt(this.lastRenderTop), this.indexAfter(renderBottom)) - 1, stop = this.indexAt(renderTop); i >= stop; i--) {\n            this.insertItemInDOM(this.itemAtIndex(i));\n        }\n        // when view scrolls down, start unrendering from renderTop\n        for (i = this.indexAt(this.lastRenderTop), stop = Math.min(this.indexAt(renderTop), this.indexAfter(thisRenderBottom)); i < stop; i++) {\n            this.removeItemFromDOM(this.itemAtIndex(i));\n        }\n        // when view scrolls up, start unrendering from either renderBottom this.renderTop\n        for (i = Math.max(this.indexAfter(renderBottom), this.indexAt(this.lastRenderTop)), stop = this.indexAfter(thisRenderBottom); i < stop; i++) {\n            this.removeItemFromDOM(this.itemAtIndex(i));\n        }\n        var topItem = this.itemAtIndex(this.indexAt(renderTop));\n        if (topItem) {\n            this.rowsContainer.style.top = (topItem.top - renderTop) + 'px';\n        }\n        if (this.horizontalScrolling) {\n            this.rowsContainer.style.left = -scrollLeft + 'px';\n            this.rowsContainer.style.width = Math.max(scrollWidth, viewWidth) + \"px\";\n        }\n        this.lastRenderTop = renderTop;\n        this.lastRenderHeight = renderBottom - renderTop;\n    };\n    TreeView.prototype.setModel = function (newModel) {\n        this.releaseModel();\n        this.model = newModel;\n        this.model.onRefresh(this.onRefreshing, this, this.modelListeners);\n        this.model.onDidRefresh(this.onRefreshed, this, this.modelListeners);\n        this.model.onSetInput(this.onClearingInput, this, this.modelListeners);\n        this.model.onDidSetInput(this.onSetInput, this, this.modelListeners);\n        this.model.onDidFocus(this.onModelFocusChange, this, this.modelListeners);\n        this.model.onRefreshItemChildren(this.onItemChildrenRefreshing, this, this.modelListeners);\n        this.model.onDidRefreshItemChildren(this.onItemChildrenRefreshed, this, this.modelListeners);\n        this.model.onDidRefreshItem(this.onItemRefresh, this, this.modelListeners);\n        this.model.onExpandItem(this.onItemExpanding, this, this.modelListeners);\n        this.model.onDidExpandItem(this.onItemExpanded, this, this.modelListeners);\n        this.model.onCollapseItem(this.onItemCollapsing, this, this.modelListeners);\n        this.model.onDidRevealItem(this.onItemReveal, this, this.modelListeners);\n        this.model.onDidAddTraitItem(this.onItemAddTrait, this, this.modelListeners);\n        this.model.onDidRemoveTraitItem(this.onItemRemoveTrait, this, this.modelListeners);\n    };\n    TreeView.prototype.onRefreshing = function () {\n        this.isRefreshing = true;\n    };\n    TreeView.prototype.onRefreshed = function () {\n        this.isRefreshing = false;\n        this.onRowsChanged();\n    };\n    TreeView.prototype.onRowsChanged = function (scrollTop) {\n        if (scrollTop === void 0) { scrollTop = this.scrollTop; }\n        if (this.isRefreshing) {\n            return;\n        }\n        this.scrollTop = scrollTop;\n        this.updateScrollWidth();\n    };\n    TreeView.prototype.updateScrollWidth = function () {\n        var _this = this;\n        if (!this.horizontalScrolling) {\n            return;\n        }\n        this.contentWidthUpdateDelayer.trigger(function () {\n            var keys = Object.keys(_this.items);\n            var scrollWidth = 0;\n            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n                var key = keys_1[_i];\n                scrollWidth = Math.max(scrollWidth, _this.items[key].width);\n            }\n            _this.scrollWidth = scrollWidth + 10 /* scrollbar */;\n        });\n    };\n    TreeView.prototype.focusNextPage = function (eventPayload) {\n        var _this = this;\n        var lastPageIndex = this.indexAt(this.scrollTop + this.viewHeight);\n        lastPageIndex = lastPageIndex === 0 ? 0 : lastPageIndex - 1;\n        var lastPageElement = this.itemAtIndex(lastPageIndex).model.getElement();\n        var currentlyFocusedElement = this.model.getFocus();\n        if (currentlyFocusedElement !== lastPageElement) {\n            this.model.setFocus(lastPageElement, eventPayload);\n        }\n        else {\n            var previousScrollTop = this.scrollTop;\n            this.scrollTop += this.viewHeight;\n            if (this.scrollTop !== previousScrollTop) {\n                // Let the scroll event listener run\n                setTimeout(function () {\n                    _this.focusNextPage(eventPayload);\n                }, 0);\n            }\n        }\n    };\n    TreeView.prototype.focusPreviousPage = function (eventPayload) {\n        var _this = this;\n        var firstPageIndex;\n        if (this.scrollTop === 0) {\n            firstPageIndex = this.indexAt(this.scrollTop);\n        }\n        else {\n            firstPageIndex = this.indexAfter(this.scrollTop - 1);\n        }\n        var firstPageElement = this.itemAtIndex(firstPageIndex).model.getElement();\n        var currentlyFocusedElement = this.model.getFocus();\n        if (currentlyFocusedElement !== firstPageElement) {\n            this.model.setFocus(firstPageElement, eventPayload);\n        }\n        else {\n            var previousScrollTop = this.scrollTop;\n            this.scrollTop -= this.viewHeight;\n            if (this.scrollTop !== previousScrollTop) {\n                // Let the scroll event listener run\n                setTimeout(function () {\n                    _this.focusPreviousPage(eventPayload);\n                }, 0);\n            }\n        }\n    };\n    Object.defineProperty(TreeView.prototype, \"viewHeight\", {\n        get: function () {\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\n            return scrollDimensions.height;\n        },\n        set: function (height) {\n            this.scrollableElement.setScrollDimensions({ height: height });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"scrollHeight\", {\n        set: function (scrollHeight) {\n            scrollHeight = scrollHeight + (this.horizontalScrolling ? 10 : 0);\n            this.scrollableElement.setScrollDimensions({ scrollHeight: scrollHeight });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"viewWidth\", {\n        get: function () {\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\n            return scrollDimensions.width;\n        },\n        set: function (viewWidth) {\n            this.scrollableElement.setScrollDimensions({ width: viewWidth });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"scrollWidth\", {\n        set: function (scrollWidth) {\n            this.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(TreeView.prototype, \"scrollTop\", {\n        get: function () {\n            var scrollPosition = this.scrollableElement.getScrollPosition();\n            return scrollPosition.scrollTop;\n        },\n        set: function (scrollTop) {\n            var scrollHeight = this.getContentHeight() + (this.horizontalScrolling ? 10 : 0);\n            this.scrollableElement.setScrollDimensions({ scrollHeight: scrollHeight });\n            this.scrollableElement.setScrollPosition({ scrollTop: scrollTop });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    TreeView.prototype.getScrollPosition = function () {\n        var height = this.getContentHeight() - this.viewHeight;\n        return height <= 0 ? 1 : this.scrollTop / height;\n    };\n    TreeView.prototype.setScrollPosition = function (pos) {\n        var height = this.getContentHeight() - this.viewHeight;\n        this.scrollTop = height * pos;\n    };\n    // Events\n    TreeView.prototype.onClearingInput = function (e) {\n        var item = e.item;\n        if (item) {\n            this.onRemoveItems(new iterator_1.MappedIterator(item.getNavigator(), function (item) { return item && item.id; }));\n            this.onRowsChanged();\n        }\n    };\n    TreeView.prototype.onSetInput = function (e) {\n        this.context.cache.garbageCollect();\n        this.inputItem = new RootViewItem(this.context, e.item, this.wrapper);\n    };\n    TreeView.prototype.onItemChildrenRefreshing = function (e) {\n        var item = e.item;\n        var viewItem = this.items[item.id];\n        if (viewItem && this.context.options.showLoading) {\n            viewItem.loadingTimer = setTimeout(function () {\n                viewItem.loadingTimer = 0;\n                viewItem.loading = true;\n            }, TreeView.LOADING_DECORATION_DELAY);\n        }\n        if (!e.isNested) {\n            var childrenIds = [];\n            var navigator = item.getNavigator();\n            var childItem = void 0;\n            while (childItem = navigator.next()) {\n                childrenIds.push(childItem.id);\n            }\n            this.refreshingPreviousChildrenIds[item.id] = childrenIds;\n        }\n    };\n    TreeView.prototype.onItemChildrenRefreshed = function (e) {\n        var _this = this;\n        var item = e.item;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            if (viewItem.loadingTimer) {\n                clearTimeout(viewItem.loadingTimer);\n                viewItem.loadingTimer = 0;\n            }\n            viewItem.loading = false;\n        }\n        if (!e.isNested) {\n            var previousChildrenIds_1 = this.refreshingPreviousChildrenIds[item.id];\n            var afterModelItems_1 = [];\n            var navigator = item.getNavigator();\n            var childItem = void 0;\n            while (childItem = navigator.next()) {\n                afterModelItems_1.push(childItem);\n            }\n            var skipDiff = Math.abs(previousChildrenIds_1.length - afterModelItems_1.length) > 1000;\n            var diff = [];\n            var doToInsertItemsAlreadyExist = false;\n            if (!skipDiff) {\n                var lcs = new Diff.LcsDiff({\n                    getLength: function () { return previousChildrenIds_1.length; },\n                    getElementAtIndex: function (i) { return previousChildrenIds_1[i]; }\n                }, {\n                    getLength: function () { return afterModelItems_1.length; },\n                    getElementAtIndex: function (i) { return afterModelItems_1[i].id; }\n                }, null);\n                diff = lcs.ComputeDiff(false);\n                // this means that the result of the diff algorithm would result\n                // in inserting items that were already registered. this can only\n                // happen if the data provider returns bad ids OR if the sorting\n                // of the elements has changed\n                doToInsertItemsAlreadyExist = diff.some(function (d) {\n                    if (d.modifiedLength > 0) {\n                        for (var i = d.modifiedStart, len = d.modifiedStart + d.modifiedLength; i < len; i++) {\n                            if (_this.items.hasOwnProperty(afterModelItems_1[i].id)) {\n                                return true;\n                            }\n                        }\n                    }\n                    return false;\n                });\n            }\n            // 50 is an optimization number, at some point we're better off\n            // just replacing everything\n            if (!skipDiff && !doToInsertItemsAlreadyExist && diff.length < 50) {\n                for (var _i = 0, diff_1 = diff; _i < diff_1.length; _i++) {\n                    var diffChange = diff_1[_i];\n                    if (diffChange.originalLength > 0) {\n                        this.onRemoveItems(new iterator_1.ArrayIterator(previousChildrenIds_1, diffChange.originalStart, diffChange.originalStart + diffChange.originalLength));\n                    }\n                    if (diffChange.modifiedLength > 0) {\n                        var beforeItem = afterModelItems_1[diffChange.modifiedStart - 1] || item;\n                        beforeItem = beforeItem.getDepth() > 0 ? beforeItem : null;\n                        this.onInsertItems(new iterator_1.ArrayIterator(afterModelItems_1, diffChange.modifiedStart, diffChange.modifiedStart + diffChange.modifiedLength), beforeItem ? beforeItem.id : null);\n                    }\n                }\n            }\n            else if (skipDiff || diff.length) {\n                this.onRemoveItems(new iterator_1.ArrayIterator(previousChildrenIds_1));\n                this.onInsertItems(new iterator_1.ArrayIterator(afterModelItems_1), item.getDepth() > 0 ? item.id : null);\n            }\n            if (skipDiff || diff.length) {\n                this.onRowsChanged();\n            }\n        }\n    };\n    TreeView.prototype.onItemRefresh = function (item) {\n        this.onItemsRefresh([item]);\n    };\n    TreeView.prototype.onItemsRefresh = function (items) {\n        var _this = this;\n        this.onRefreshItemSet(items.filter(function (item) { return _this.items.hasOwnProperty(item.id); }));\n        this.onRowsChanged();\n    };\n    TreeView.prototype.onItemExpanding = function (e) {\n        var viewItem = this.items[e.item.id];\n        if (viewItem) {\n            viewItem.expanded = true;\n        }\n    };\n    TreeView.prototype.onItemExpanded = function (e) {\n        var item = e.item;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            viewItem.expanded = true;\n            var height = this.onInsertItems(item.getNavigator(), item.id) || 0;\n            var scrollTop = this.scrollTop;\n            if (viewItem.top + viewItem.height <= this.scrollTop) {\n                scrollTop += height;\n            }\n            this.onRowsChanged(scrollTop);\n        }\n    };\n    TreeView.prototype.onItemCollapsing = function (e) {\n        var item = e.item;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            viewItem.expanded = false;\n            this.onRemoveItems(new iterator_1.MappedIterator(item.getNavigator(), function (item) { return item && item.id; }));\n            this.onRowsChanged();\n        }\n    };\n    TreeView.prototype.getRelativeTop = function (item) {\n        if (item && item.isVisible()) {\n            var viewItem = this.items[item.id];\n            if (viewItem) {\n                return (viewItem.top - this.scrollTop) / (this.viewHeight - viewItem.height);\n            }\n        }\n        return -1;\n    };\n    TreeView.prototype.onItemReveal = function (e) {\n        var item = e.item;\n        var relativeTop = e.relativeTop;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            if (relativeTop !== null) {\n                relativeTop = relativeTop < 0 ? 0 : relativeTop;\n                relativeTop = relativeTop > 1 ? 1 : relativeTop;\n                // y = mx + b\n                var m = viewItem.height - this.viewHeight;\n                this.scrollTop = m * relativeTop + viewItem.top;\n            }\n            else {\n                var viewItemBottom = viewItem.top + viewItem.height;\n                var wrapperBottom = this.scrollTop + this.viewHeight;\n                if (viewItem.top < this.scrollTop) {\n                    this.scrollTop = viewItem.top;\n                }\n                else if (viewItemBottom >= wrapperBottom) {\n                    this.scrollTop = viewItemBottom - this.viewHeight;\n                }\n            }\n        }\n    };\n    TreeView.prototype.onItemAddTrait = function (e) {\n        var item = e.item;\n        var trait = e.trait;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            viewItem.addClass(trait);\n        }\n        if (trait === 'highlighted') {\n            DOM.addClass(this.domNode, trait);\n            // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n            if (viewItem) {\n                this.highlightedItemWasDraggable = !!viewItem.draggable;\n                if (viewItem.draggable) {\n                    viewItem.draggable = false;\n                }\n            }\n        }\n    };\n    TreeView.prototype.onItemRemoveTrait = function (e) {\n        var item = e.item;\n        var trait = e.trait;\n        var viewItem = this.items[item.id];\n        if (viewItem) {\n            viewItem.removeClass(trait);\n        }\n        if (trait === 'highlighted') {\n            DOM.removeClass(this.domNode, trait);\n            // Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n            if (this.highlightedItemWasDraggable) {\n                viewItem.draggable = true;\n            }\n            this.highlightedItemWasDraggable = false;\n        }\n    };\n    TreeView.prototype.onModelFocusChange = function () {\n        var focus = this.model && this.model.getFocus();\n        DOM.toggleClass(this.domNode, 'no-focused-item', !focus);\n        // ARIA\n        if (focus) {\n            this.domNode.setAttribute('aria-activedescendant', strings.safeBtoa(this.context.dataSource.getId(this.context.tree, focus)));\n        }\n        else {\n            this.domNode.removeAttribute('aria-activedescendant');\n        }\n    };\n    // HeightMap \"events\"\n    TreeView.prototype.onInsertItem = function (item) {\n        var _this = this;\n        item.onDragStart = function (e) { _this.onDragStart(item, e); };\n        item.needsRender = true;\n        this.refreshViewItem(item);\n        this.items[item.id] = item;\n    };\n    TreeView.prototype.onRefreshItem = function (item, needsRender) {\n        if (needsRender === void 0) { needsRender = false; }\n        item.needsRender = item.needsRender || needsRender;\n        this.refreshViewItem(item);\n    };\n    TreeView.prototype.onRemoveItem = function (item) {\n        this.removeItemFromDOM(item);\n        item.dispose();\n        delete this.items[item.id];\n    };\n    // ViewItem refresh\n    TreeView.prototype.refreshViewItem = function (item) {\n        item.render();\n        if (this.shouldBeRendered(item)) {\n            this.insertItemInDOM(item);\n        }\n        else {\n            this.removeItemFromDOM(item);\n        }\n    };\n    // DOM Events\n    TreeView.prototype.onClick = function (e) {\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n            return;\n        }\n        var event = new Mouse.StandardMouseEvent(e);\n        var item = this.getItemAround(event.target);\n        if (!item) {\n            return;\n        }\n        if (Browser.isIE && Date.now() - this.lastClickTimeStamp < 300) {\n            // IE10+ doesn't set the detail property correctly. While IE10 simply\n            // counts the number of clicks, IE11 reports always 1. To align with\n            // other browser, we set the value to 2 if clicks events come in a 300ms\n            // sequence.\n            event.detail = 2;\n        }\n        this.lastClickTimeStamp = Date.now();\n        this.context.controller.onClick(this.context.tree, item.model.getElement(), event);\n    };\n    TreeView.prototype.onMouseMiddleClick = function (e) {\n        if (!this.context.controller.onMouseMiddleClick) {\n            return;\n        }\n        var event = new Mouse.StandardMouseEvent(e);\n        var item = this.getItemAround(event.target);\n        if (!item) {\n            return;\n        }\n        this.context.controller.onMouseMiddleClick(this.context.tree, item.model.getElement(), event);\n    };\n    TreeView.prototype.onMouseDown = function (e) {\n        this.didJustPressContextMenuKey = false;\n        if (!this.context.controller.onMouseDown) {\n            return;\n        }\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n            return;\n        }\n        var event = new Mouse.StandardMouseEvent(e);\n        if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n            return;\n        }\n        var item = this.getItemAround(event.target);\n        if (!item) {\n            return;\n        }\n        this.context.controller.onMouseDown(this.context.tree, item.model.getElement(), event);\n    };\n    TreeView.prototype.onMouseUp = function (e) {\n        if (!this.context.controller.onMouseUp) {\n            return;\n        }\n        if (this.lastPointerType && this.lastPointerType !== 'mouse') {\n            return;\n        }\n        var event = new Mouse.StandardMouseEvent(e);\n        if (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n            return;\n        }\n        var item = this.getItemAround(event.target);\n        if (!item) {\n            return;\n        }\n        this.context.controller.onMouseUp(this.context.tree, item.model.getElement(), event);\n    };\n    TreeView.prototype.onTap = function (e) {\n        var item = this.getItemAround(e.initialTarget);\n        if (!item) {\n            return;\n        }\n        this.context.controller.onTap(this.context.tree, item.model.getElement(), e);\n    };\n    TreeView.prototype.onTouchChange = function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.scrollTop -= event.translationY;\n    };\n    TreeView.prototype.onContextMenu = function (event) {\n        var resultEvent;\n        var element;\n        if (event instanceof KeyboardEvent || this.didJustPressContextMenuKey) {\n            this.didJustPressContextMenuKey = false;\n            var keyboardEvent = new Keyboard.StandardKeyboardEvent(event);\n            element = this.model.getFocus();\n            var position = void 0;\n            if (!element) {\n                element = this.model.getInput();\n                position = DOM.getDomNodePagePosition(this.inputItem.element);\n            }\n            else {\n                var id = this.context.dataSource.getId(this.context.tree, element);\n                var viewItem = this.items[id];\n                position = DOM.getDomNodePagePosition(viewItem.element);\n            }\n            resultEvent = new _.KeyboardContextMenuEvent(position.left + position.width, position.top, keyboardEvent);\n        }\n        else {\n            var mouseEvent = new Mouse.StandardMouseEvent(event);\n            var item = this.getItemAround(mouseEvent.target);\n            if (!item) {\n                return;\n            }\n            element = item.model.getElement();\n            resultEvent = new _.MouseContextMenuEvent(mouseEvent);\n        }\n        this.context.controller.onContextMenu(this.context.tree, element, resultEvent);\n    };\n    TreeView.prototype.onKeyDown = function (e) {\n        var event = new Keyboard.StandardKeyboardEvent(e);\n        this.didJustPressContextMenuKey = event.keyCode === keyCodes_1.KeyCode.ContextMenu || (event.shiftKey && event.keyCode === keyCodes_1.KeyCode.F10);\n        if (event.target && event.target.tagName && event.target.tagName.toLowerCase() === 'input') {\n            return; // Ignore event if target is a form input field (avoids browser specific issues)\n        }\n        if (this.didJustPressContextMenuKey) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        this.context.controller.onKeyDown(this.context.tree, event);\n    };\n    TreeView.prototype.onKeyUp = function (e) {\n        if (this.didJustPressContextMenuKey) {\n            this.onContextMenu(e);\n        }\n        this.didJustPressContextMenuKey = false;\n        this.context.controller.onKeyUp(this.context.tree, new Keyboard.StandardKeyboardEvent(e));\n    };\n    TreeView.prototype.onDragStart = function (item, e) {\n        if (this.model.getHighlight()) {\n            return;\n        }\n        var element = item.model.getElement();\n        var selection = this.model.getSelection();\n        var elements;\n        if (selection.indexOf(element) > -1) {\n            elements = selection;\n        }\n        else {\n            elements = [element];\n        }\n        e.dataTransfer.effectAllowed = 'copyMove';\n        e.dataTransfer.setData(dnd_1.DataTransfers.RESOURCES, JSON.stringify([item.uri]));\n        if (e.dataTransfer.setDragImage) {\n            var label = void 0;\n            if (this.context.dnd.getDragLabel) {\n                label = this.context.dnd.getDragLabel(this.context.tree, elements);\n            }\n            else {\n                label = String(elements.length);\n            }\n            var dragImage_1 = document.createElement('div');\n            dragImage_1.className = 'monaco-tree-drag-image';\n            dragImage_1.textContent = label;\n            document.body.appendChild(dragImage_1);\n            e.dataTransfer.setDragImage(dragImage_1, -10, -10);\n            setTimeout(function () { return document.body.removeChild(dragImage_1); }, 0);\n        }\n        this.currentDragAndDropData = new dnd.ElementsDragAndDropData(elements);\n        dnd_1.StaticDND.CurrentDragAndDropData = new dnd.ExternalElementsDragAndDropData(elements);\n        this.context.dnd.onDragStart(this.context.tree, this.currentDragAndDropData, new Mouse.DragMouseEvent(e));\n    };\n    TreeView.prototype.setupDragAndDropScrollInterval = function () {\n        var _this = this;\n        var viewTop = DOM.getTopLeftOffset(this.wrapper).top;\n        if (!this.dragAndDropScrollInterval) {\n            this.dragAndDropScrollInterval = window.setInterval(function () {\n                if (_this.dragAndDropMouseY === null) {\n                    return;\n                }\n                var diff = _this.dragAndDropMouseY - viewTop;\n                var scrollDiff = 0;\n                var upperLimit = _this.viewHeight - 35;\n                if (diff < 35) {\n                    scrollDiff = Math.max(-14, 0.2 * (diff - 35));\n                }\n                else if (diff > upperLimit) {\n                    scrollDiff = Math.min(14, 0.2 * (diff - upperLimit));\n                }\n                _this.scrollTop += scrollDiff;\n            }, 10);\n            this.cancelDragAndDropScrollTimeout();\n            this.dragAndDropScrollTimeout = window.setTimeout(function () {\n                _this.cancelDragAndDropScrollInterval();\n                _this.dragAndDropScrollTimeout = null;\n            }, 1000);\n        }\n    };\n    TreeView.prototype.cancelDragAndDropScrollInterval = function () {\n        if (this.dragAndDropScrollInterval) {\n            window.clearInterval(this.dragAndDropScrollInterval);\n            this.dragAndDropScrollInterval = null;\n        }\n        this.cancelDragAndDropScrollTimeout();\n    };\n    TreeView.prototype.cancelDragAndDropScrollTimeout = function () {\n        if (this.dragAndDropScrollTimeout) {\n            window.clearTimeout(this.dragAndDropScrollTimeout);\n            this.dragAndDropScrollTimeout = null;\n        }\n    };\n    TreeView.prototype.onDragOver = function (e) {\n        var _this = this;\n        e.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n        var event = new Mouse.DragMouseEvent(e);\n        var viewItem = this.getItemAround(event.target);\n        if (!viewItem || (event.posx === 0 && event.posy === 0 && event.browserEvent.type === DOM.EventType.DRAG_LEAVE)) {\n            // dragging outside of tree\n            if (this.currentDropTarget) {\n                // clear previously hovered element feedback\n                this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\n                this.currentDropTargets = [];\n                this.currentDropDisposable.dispose();\n            }\n            this.cancelDragAndDropScrollInterval();\n            this.currentDropTarget = null;\n            this.currentDropElement = null;\n            this.dragAndDropMouseY = null;\n            return false;\n        }\n        // dragging inside the tree\n        this.setupDragAndDropScrollInterval();\n        this.dragAndDropMouseY = event.posy;\n        if (!this.currentDragAndDropData) {\n            // just started dragging\n            if (dnd_1.StaticDND.CurrentDragAndDropData) {\n                this.currentDragAndDropData = dnd_1.StaticDND.CurrentDragAndDropData;\n            }\n            else {\n                if (!event.dataTransfer.types) {\n                    return false;\n                }\n                this.currentDragAndDropData = new dnd.DesktopDragAndDropData();\n            }\n        }\n        this.currentDragAndDropData.update(event.browserEvent.dataTransfer);\n        var element;\n        var item = viewItem.model;\n        var reaction;\n        // check the bubble up behavior\n        do {\n            element = item ? item.getElement() : this.model.getInput();\n            reaction = this.context.dnd.onDragOver(this.context.tree, this.currentDragAndDropData, element, event);\n            if (!reaction || reaction.bubble !== _.DragOverBubble.BUBBLE_UP) {\n                break;\n            }\n            item = item && item.parent;\n        } while (item);\n        if (!item) {\n            this.currentDropElement = null;\n            return false;\n        }\n        var canDrop = reaction && reaction.accept;\n        if (canDrop) {\n            this.currentDropElement = item.getElement();\n            event.preventDefault();\n            event.dataTransfer.dropEffect = reaction.effect === _.DragOverEffect.COPY ? 'copy' : 'move';\n        }\n        else {\n            this.currentDropElement = null;\n        }\n        // item is the model item where drop() should be called\n        // can be null\n        var currentDropTarget = item.id === this.inputItem.id ? this.inputItem : this.items[item.id];\n        if (this.shouldInvalidateDropReaction || this.currentDropTarget !== currentDropTarget || !reactionEquals(this.currentDropElementReaction, reaction)) {\n            this.shouldInvalidateDropReaction = false;\n            if (this.currentDropTarget) {\n                this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\n                this.currentDropTargets = [];\n                this.currentDropDisposable.dispose();\n            }\n            this.currentDropTarget = currentDropTarget;\n            this.currentDropElementReaction = reaction;\n            if (canDrop) {\n                // setup hover feedback for drop target\n                if (this.currentDropTarget) {\n                    this.currentDropTarget.dropTarget = true;\n                    this.currentDropTargets.push(this.currentDropTarget);\n                }\n                if (reaction.bubble === _.DragOverBubble.BUBBLE_DOWN) {\n                    var nav = item.getNavigator();\n                    var child = void 0;\n                    while (child = nav.next()) {\n                        viewItem = this.items[child.id];\n                        if (viewItem) {\n                            viewItem.dropTarget = true;\n                            this.currentDropTargets.push(viewItem);\n                        }\n                    }\n                }\n                if (reaction.autoExpand) {\n                    var timeoutPromise_1 = async_1.timeout(500);\n                    this.currentDropDisposable = Lifecycle.toDisposable(function () { return timeoutPromise_1.cancel(); });\n                    timeoutPromise_1\n                        .then(function () { return _this.context.tree.expand(_this.currentDropElement); })\n                        .then(function () { return _this.shouldInvalidateDropReaction = true; });\n                }\n            }\n        }\n        return true;\n    };\n    TreeView.prototype.onDrop = function (e) {\n        if (this.currentDropElement) {\n            var event = new Mouse.DragMouseEvent(e);\n            event.preventDefault();\n            this.currentDragAndDropData.update(event.browserEvent.dataTransfer);\n            this.context.dnd.drop(this.context.tree, this.currentDragAndDropData, this.currentDropElement, event);\n            this.onDragEnd(e);\n        }\n        this.cancelDragAndDropScrollInterval();\n    };\n    TreeView.prototype.onDragEnd = function (e) {\n        if (this.currentDropTarget) {\n            this.currentDropTargets.forEach(function (i) { return i.dropTarget = false; });\n            this.currentDropTargets = [];\n        }\n        this.currentDropDisposable.dispose();\n        this.cancelDragAndDropScrollInterval();\n        this.currentDragAndDropData = null;\n        dnd_1.StaticDND.CurrentDragAndDropData = undefined;\n        this.currentDropElement = null;\n        this.currentDropTarget = null;\n        this.dragAndDropMouseY = null;\n    };\n    TreeView.prototype.onFocus = function () {\n        if (!this.context.options.alwaysFocused) {\n            DOM.addClass(this.domNode, 'focused');\n        }\n        this._onDOMFocus.fire();\n    };\n    TreeView.prototype.onBlur = function () {\n        if (!this.context.options.alwaysFocused) {\n            DOM.removeClass(this.domNode, 'focused');\n        }\n        this.domNode.removeAttribute('aria-activedescendant'); // ARIA\n        this._onDOMBlur.fire();\n    };\n    // MS specific DOM Events\n    TreeView.prototype.onMsPointerDown = function (event) {\n        if (!this.msGesture) {\n            return;\n        }\n        // Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\n        var pointerType = event.pointerType;\n        if (pointerType === (event.MSPOINTER_TYPE_MOUSE || 'mouse')) {\n            this.lastPointerType = 'mouse';\n            return;\n        }\n        else if (pointerType === (event.MSPOINTER_TYPE_TOUCH || 'touch')) {\n            this.lastPointerType = 'touch';\n        }\n        else {\n            return;\n        }\n        event.stopPropagation();\n        event.preventDefault();\n        this.msGesture.addPointer(event.pointerId);\n    };\n    TreeView.prototype.onThrottledMsGestureChange = function (event) {\n        this.scrollTop -= event.translationY;\n    };\n    TreeView.prototype.onMsGestureTap = function (event) {\n        event.initialTarget = document.elementFromPoint(event.clientX, event.clientY);\n        this.onTap(event);\n    };\n    // DOM changes\n    TreeView.prototype.insertItemInDOM = function (item) {\n        var elementAfter = null;\n        var itemAfter = this.itemAfter(item);\n        if (itemAfter && itemAfter.element) {\n            elementAfter = itemAfter.element;\n        }\n        item.insertInDOM(this.rowsContainer, elementAfter);\n    };\n    TreeView.prototype.removeItemFromDOM = function (item) {\n        if (!item) {\n            return;\n        }\n        item.removeFromDOM();\n    };\n    // Helpers\n    TreeView.prototype.shouldBeRendered = function (item) {\n        return item.top < this.lastRenderTop + this.lastRenderHeight && item.top + item.height > this.lastRenderTop;\n    };\n    TreeView.prototype.getItemAround = function (element) {\n        var candidate = this.inputItem;\n        var el = element;\n        do {\n            if (el[TreeView.BINDING]) {\n                candidate = el[TreeView.BINDING];\n            }\n            if (el === this.wrapper || el === this.domNode) {\n                return candidate;\n            }\n            if (el === this.scrollableElement.getDomNode() || el === document.body) {\n                return undefined;\n            }\n        } while (el = el.parentElement);\n        return undefined;\n    };\n    // Cleanup\n    TreeView.prototype.releaseModel = function () {\n        if (this.model) {\n            this.modelListeners = Lifecycle.dispose(this.modelListeners);\n            this.model = null;\n        }\n    };\n    TreeView.prototype.dispose = function () {\n        var _this = this;\n        // TODO@joao: improve\n        this.scrollableElement.dispose();\n        this.releaseModel();\n        this.viewListeners = Lifecycle.dispose(this.viewListeners);\n        this._onDOMFocus.dispose();\n        this._onDOMBlur.dispose();\n        if (this.domNode.parentNode) {\n            this.domNode.parentNode.removeChild(this.domNode);\n        }\n        if (this.items) {\n            Object.keys(this.items).forEach(function (key) { return _this.items[key].removeFromDOM(); });\n        }\n        if (this.context.cache) {\n            this.context.cache.dispose();\n        }\n        _super.prototype.dispose.call(this);\n    };\n    TreeView.BINDING = 'monaco-tree-row';\n    TreeView.LOADING_DECORATION_DELAY = 800;\n    TreeView.counter = 0;\n    return TreeView;\n}(treeViewModel_1.HeightMap));\nexports.TreeView = TreeView;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/base/parts/tree/browser/treeView.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/base/parts/tree/browser/treeView.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as Platform from 'vs/base/common/platform';\nimport * as Browser from 'vs/base/browser/browser';\nimport * as Lifecycle from 'vs/base/common/lifecycle';\nimport * as DOM from 'vs/base/browser/dom';\nimport * as Diff from 'vs/base/common/diff/diff';\nimport * as Touch from 'vs/base/browser/touch';\nimport * as strings from 'vs/base/common/strings';\nimport * as Mouse from 'vs/base/browser/mouseEvent';\nimport * as Keyboard from 'vs/base/browser/keyboardEvent';\nimport * as Model from 'vs/base/parts/tree/browser/treeModel';\nimport * as dnd from './treeDnd';\nimport { ArrayIterator, MappedIterator } from 'vs/base/common/iterator';\nimport { ScrollableElement } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { ScrollbarVisibility } from 'vs/base/common/scrollable';\nimport { HeightMap, IViewItem } from 'vs/base/parts/tree/browser/treeViewModel';\nimport * as _ from 'vs/base/parts/tree/browser/tree';\nimport { KeyCode } from 'vs/base/common/keyCodes';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { DataTransfers, StaticDND, IDragAndDropData } from 'vs/base/browser/dnd';\nimport { DefaultTreestyler } from './treeDefaults';\nimport { Delayer, timeout } from 'vs/base/common/async';\n\nexport interface IRow {\n\telement: HTMLElement | null;\n\ttemplateId: string;\n\ttemplateData: any;\n}\n\nfunction removeFromParent(element: HTMLElement): void {\n\ttry {\n\t\telement.parentElement!.removeChild(element);\n\t} catch (e) {\n\t\t// this will throw if this happens due to a blur event, nasty business\n\t}\n}\n\nexport class RowCache implements Lifecycle.IDisposable {\n\n\tprivate _cache: { [templateId: string]: IRow[]; } | null;\n\n\tconstructor(private context: _.ITreeContext) {\n\t\tthis._cache = { '': [] };\n\t}\n\n\tpublic alloc(templateId: string): IRow {\n\t\tlet result = this.cache(templateId).pop();\n\n\t\tif (!result) {\n\t\t\tlet content = document.createElement('div');\n\t\t\tcontent.className = 'content';\n\n\t\t\tlet row = document.createElement('div');\n\t\t\trow.appendChild(content);\n\n\t\t\tlet templateData: any = null;\n\n\t\t\ttry {\n\t\t\t\ttemplateData = this.context.renderer!.renderTemplate(this.context.tree, templateId, content);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Tree usage error: exception while rendering template');\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\n\t\t\tresult = {\n\t\t\t\telement: row,\n\t\t\t\ttemplateId: templateId,\n\t\t\t\ttemplateData\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic release(templateId: string, row: IRow): void {\n\t\tremoveFromParent(row.element!);\n\t\tthis.cache(templateId).push(row);\n\t}\n\n\tprivate cache(templateId: string): IRow[] {\n\t\treturn this._cache![templateId] || (this._cache![templateId] = []);\n\t}\n\n\tpublic garbageCollect(): void {\n\t\tif (this._cache) {\n\t\t\tObject.keys(this._cache).forEach(templateId => {\n\t\t\t\tthis._cache![templateId].forEach(cachedRow => {\n\t\t\t\t\tthis.context.renderer!.disposeTemplate(this.context.tree, templateId, cachedRow.templateData);\n\t\t\t\t\tcachedRow.element = null;\n\t\t\t\t\tcachedRow.templateData = null;\n\t\t\t\t});\n\n\t\t\t\tdelete this._cache![templateId];\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.garbageCollect();\n\t\tthis._cache = null;\n\t}\n}\n\nexport interface IViewContext extends _.ITreeContext {\n\tcache: RowCache;\n\thorizontalScrolling: boolean;\n}\n\nexport class ViewItem implements IViewItem {\n\n\tprivate context: IViewContext;\n\n\tpublic model: Model.Item;\n\tpublic id: string;\n\tprotected row: IRow | null;\n\n\tpublic top: number;\n\tpublic height: number;\n\tpublic width: number = 0;\n\tpublic onDragStart: (e: DragEvent) => void;\n\n\tpublic needsRender: boolean;\n\tpublic uri: string | null;\n\tpublic unbindDragStart: Lifecycle.IDisposable = Lifecycle.Disposable.None;\n\tpublic loadingTimer: any;\n\n\tpublic _styles: any;\n\tprivate _draggable: boolean;\n\n\tconstructor(context: IViewContext, model: Model.Item) {\n\t\tthis.context = context;\n\t\tthis.model = model;\n\n\t\tthis.id = this.model.id;\n\t\tthis.row = null;\n\n\t\tthis.top = 0;\n\t\tthis.height = model.getHeight();\n\n\t\tthis._styles = {};\n\t\tmodel.getAllTraits().forEach(t => this._styles[t] = true);\n\n\t\tif (model.isExpanded()) {\n\t\t\tthis.addClass('expanded');\n\t\t}\n\t}\n\n\tset expanded(value: boolean) {\n\t\tvalue ? this.addClass('expanded') : this.removeClass('expanded');\n\t}\n\n\tset loading(value: boolean) {\n\t\tvalue ? this.addClass('loading') : this.removeClass('loading');\n\t}\n\n\tset draggable(value: boolean) {\n\t\tthis._draggable = value;\n\t\tthis.render(true);\n\t}\n\n\tget draggable() {\n\t\treturn this._draggable;\n\t}\n\n\tset dropTarget(value: boolean) {\n\t\tvalue ? this.addClass('drop-target') : this.removeClass('drop-target');\n\t}\n\n\tpublic get element(): HTMLElement {\n\t\treturn (this.row && this.row.element)!;\n\t}\n\n\tprivate _templateId: string;\n\tprivate get templateId(): string {\n\t\treturn this._templateId || (this._templateId = (this.context.renderer!.getTemplateId && this.context.renderer!.getTemplateId(this.context.tree, this.model.getElement())));\n\t}\n\n\tpublic addClass(name: string): void {\n\t\tthis._styles[name] = true;\n\t\tthis.render(true);\n\t}\n\n\tpublic removeClass(name: string): void {\n\t\tdelete this._styles[name]; // is this slow?\n\t\tthis.render(true);\n\t}\n\n\tpublic render(skipUserRender = false): void {\n\t\tif (!this.model || !this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet classes = ['monaco-tree-row'];\n\t\tclasses.push.apply(classes, Object.keys(this._styles));\n\n\t\tif (this.model.hasChildren()) {\n\t\t\tclasses.push('has-children');\n\t\t}\n\n\t\tthis.element.className = classes.join(' ');\n\t\tthis.element.draggable = this.draggable;\n\t\tthis.element.style.height = this.height + 'px';\n\n\t\t// ARIA\n\t\tthis.element.setAttribute('role', 'treeitem');\n\t\tconst accessibility = this.context.accessibilityProvider!;\n\t\tconst ariaLabel = accessibility.getAriaLabel(this.context.tree, this.model.getElement());\n\t\tif (ariaLabel) {\n\t\t\tthis.element.setAttribute('aria-label', ariaLabel);\n\t\t}\n\t\tif (accessibility.getPosInSet && accessibility.getSetSize) {\n\t\t\tthis.element.setAttribute('aria-setsize', accessibility.getSetSize());\n\t\t\tthis.element.setAttribute('aria-posinset', accessibility.getPosInSet(this.context.tree, this.model.getElement()));\n\t\t}\n\t\tif (this.model.hasTrait('focused')) {\n\t\t\tconst base64Id = strings.safeBtoa(this.model.id);\n\n\t\t\tthis.element.setAttribute('aria-selected', 'true');\n\t\t\tthis.element.setAttribute('id', base64Id);\n\t\t} else {\n\t\t\tthis.element.setAttribute('aria-selected', 'false');\n\t\t\tthis.element.removeAttribute('id');\n\t\t}\n\t\tif (this.model.hasChildren()) {\n\t\t\tthis.element.setAttribute('aria-expanded', String(!!this._styles['expanded']));\n\t\t} else {\n\t\t\tthis.element.removeAttribute('aria-expanded');\n\t\t}\n\t\tthis.element.setAttribute('aria-level', String(this.model.getDepth()));\n\n\t\tif (this.context.options.paddingOnRow) {\n\t\t\tthis.element.style.paddingLeft = this.context.options.twistiePixels! + ((this.model.getDepth() - 1) * this.context.options.indentPixels!) + 'px';\n\t\t} else {\n\t\t\tthis.element.style.paddingLeft = ((this.model.getDepth() - 1) * this.context.options.indentPixels!) + 'px';\n\t\t\t(<HTMLElement>this.row!.element!.firstElementChild).style.paddingLeft = this.context.options.twistiePixels + 'px';\n\t\t}\n\n\t\tlet uri = this.context.dnd!.getDragURI(this.context.tree, this.model.getElement());\n\n\t\tif (uri !== this.uri) {\n\t\t\tif (this.unbindDragStart) {\n\t\t\t\tthis.unbindDragStart.dispose();\n\t\t\t}\n\n\t\t\tif (uri) {\n\t\t\t\tthis.uri = uri;\n\t\t\t\tthis.draggable = true;\n\t\t\t\tthis.unbindDragStart = DOM.addDisposableListener(this.element, 'dragstart', (e) => {\n\t\t\t\t\tthis.onDragStart(e);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.uri = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!skipUserRender && this.element) {\n\t\t\tlet paddingLeft: number = 0;\n\t\t\tif (this.context.horizontalScrolling) {\n\t\t\t\tconst style = window.getComputedStyle(this.element);\n\t\t\t\tpaddingLeft = parseFloat(style.paddingLeft!);\n\t\t\t}\n\n\t\t\tif (this.context.horizontalScrolling) {\n\t\t\t\tthis.element.style.width = 'fit-content';\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.context.renderer!.renderElement(this.context.tree, this.model.getElement(), this.templateId, this.row!.templateData);\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Tree usage error: exception while rendering element');\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\n\t\t\tif (this.context.horizontalScrolling) {\n\t\t\t\tthis.width = DOM.getContentWidth(this.element) + paddingLeft;\n\t\t\t\tthis.element.style.width = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateWidth(): any {\n\t\tif (!this.context.horizontalScrolling || !this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst style = window.getComputedStyle(this.element);\n\t\tconst paddingLeft = parseFloat(style.paddingLeft!);\n\t\tthis.element.style.width = 'fit-content';\n\t\tthis.width = DOM.getContentWidth(this.element) + paddingLeft;\n\t\tthis.element.style.width = '';\n\t}\n\n\tpublic insertInDOM(container: HTMLElement, afterElement: HTMLElement | null): void {\n\t\tif (!this.row) {\n\t\t\tthis.row = this.context.cache.alloc(this.templateId);\n\n\t\t\t// used in reverse lookup from HTMLElement to Item\n\t\t\t(<any>this.element)[TreeView.BINDING] = this;\n\t\t}\n\n\t\tif (this.element.parentElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (afterElement === null) {\n\t\t\tcontainer.appendChild(this.element);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tcontainer.insertBefore(this.element, afterElement);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.warn('Failed to locate previous tree element');\n\t\t\t\tcontainer.appendChild(this.element);\n\t\t\t}\n\t\t}\n\n\t\tthis.render();\n\t}\n\n\tpublic removeFromDOM(): void {\n\t\tif (!this.row) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unbindDragStart.dispose();\n\n\t\tthis.uri = null;\n\n\t\t(<any>this.element)[TreeView.BINDING] = null;\n\t\tthis.context.cache.release(this.templateId, this.row);\n\t\tthis.row = null;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.row = null;\n\t}\n}\n\nclass RootViewItem extends ViewItem {\n\n\tconstructor(context: IViewContext, model: Model.Item, wrapper: HTMLElement) {\n\t\tsuper(context, model);\n\n\t\tthis.row = {\n\t\t\telement: wrapper,\n\t\t\ttemplateData: null,\n\t\t\ttemplateId: null!\n\t\t};\n\t}\n\n\tpublic render(): void {\n\t\tif (!this.model || !this.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet classes = ['monaco-tree-wrapper'];\n\t\tclasses.push.apply(classes, Object.keys(this._styles));\n\n\t\tif (this.model.hasChildren()) {\n\t\t\tclasses.push('has-children');\n\t\t}\n\n\t\tthis.element.className = classes.join(' ');\n\t}\n\n\tpublic insertInDOM(container: HTMLElement, afterElement: HTMLElement): void {\n\t\t// noop\n\t}\n\n\tpublic removeFromDOM(): void {\n\t\t// noop\n\t}\n}\n\ninterface IThrottledGestureEvent {\n\ttranslationX: number;\n\ttranslationY: number;\n}\n\nfunction reactionEquals(one: _.IDragOverReaction, other: _.IDragOverReaction | null): boolean {\n\tif (!one && !other) {\n\t\treturn true;\n\t} else if (!one || !other) {\n\t\treturn false;\n\t} else if (one.accept !== other.accept) {\n\t\treturn false;\n\t} else if (one.bubble !== other.bubble) {\n\t\treturn false;\n\t} else if (one.effect !== other.effect) {\n\t\treturn false;\n\t} else {\n\t\treturn true;\n\t}\n}\n\nexport class TreeView extends HeightMap {\n\n\tstatic BINDING = 'monaco-tree-row';\n\tstatic LOADING_DECORATION_DELAY = 800;\n\n\tprivate static counter: number = 0;\n\tprivate instance: number;\n\n\tprivate context: IViewContext;\n\tprivate modelListeners: Lifecycle.IDisposable[];\n\tprivate model: Model.TreeModel | null = null;\n\n\tprivate viewListeners: Lifecycle.IDisposable[];\n\tprivate domNode: HTMLElement;\n\tprivate wrapper: HTMLElement;\n\tprivate styleElement: HTMLStyleElement;\n\tprivate treeStyler: _.ITreeStyler;\n\tprivate rowsContainer: HTMLElement;\n\tprivate scrollableElement: ScrollableElement;\n\tprivate msGesture: MSGesture;\n\tprivate lastPointerType: string;\n\tprivate lastClickTimeStamp: number = 0;\n\n\tprivate horizontalScrolling: boolean;\n\tprivate contentWidthUpdateDelayer = new Delayer<void>(50);\n\n\tprivate lastRenderTop: number;\n\tprivate lastRenderHeight: number;\n\n\tprivate inputItem: ViewItem;\n\tprivate items: { [id: string]: ViewItem; };\n\n\tprivate isRefreshing = false;\n\tprivate refreshingPreviousChildrenIds: { [id: string]: string[] } = {};\n\tprivate currentDragAndDropData: IDragAndDropData | null = null;\n\tprivate currentDropElement: any;\n\tprivate currentDropElementReaction: _.IDragOverReaction;\n\tprivate currentDropTarget: ViewItem | null = null;\n\tprivate shouldInvalidateDropReaction: boolean;\n\tprivate currentDropTargets: ViewItem[] | null = null;\n\tprivate currentDropDisposable: Lifecycle.IDisposable = Lifecycle.Disposable.None;\n\tprivate dragAndDropScrollInterval: number | null = null;\n\tprivate dragAndDropScrollTimeout: number | null = null;\n\tprivate dragAndDropMouseY: number | null = null;\n\n\tprivate didJustPressContextMenuKey: boolean;\n\n\tprivate highlightedItemWasDraggable: boolean;\n\tprivate onHiddenScrollTop: number | null = null;\n\n\tprivate readonly _onDOMFocus = new Emitter<void>();\n\tget onDOMFocus(): Event<void> { return this._onDOMFocus.event; }\n\n\tprivate readonly _onDOMBlur = new Emitter<void>();\n\tget onDOMBlur(): Event<void> { return this._onDOMBlur.event; }\n\n\tprivate readonly _onDidScroll = new Emitter<void>();\n\tget onDidScroll(): Event<void> { return this._onDidScroll.event; }\n\n\tconstructor(context: _.ITreeContext, container: HTMLElement) {\n\t\tsuper();\n\n\t\tTreeView.counter++;\n\t\tthis.instance = TreeView.counter;\n\n\t\tconst horizontalScrollMode = typeof context.options.horizontalScrollMode === 'undefined' ? ScrollbarVisibility.Hidden : context.options.horizontalScrollMode;\n\t\tthis.horizontalScrolling = horizontalScrollMode !== ScrollbarVisibility.Hidden;\n\n\t\tthis.context = {\n\t\t\tdataSource: context.dataSource,\n\t\t\trenderer: context.renderer,\n\t\t\tcontroller: context.controller,\n\t\t\tdnd: context.dnd,\n\t\t\tfilter: context.filter,\n\t\t\tsorter: context.sorter,\n\t\t\ttree: context.tree,\n\t\t\taccessibilityProvider: context.accessibilityProvider,\n\t\t\toptions: context.options,\n\t\t\tcache: new RowCache(context),\n\t\t\thorizontalScrolling: this.horizontalScrolling\n\t\t};\n\n\t\tthis.modelListeners = [];\n\t\tthis.viewListeners = [];\n\n\t\tthis.items = {};\n\n\t\tthis.domNode = document.createElement('div');\n\t\tthis.domNode.className = `monaco-tree no-focused-item monaco-tree-instance-${this.instance}`;\n\t\t// to allow direct tabbing into the tree instead of first focusing the tree\n\t\tthis.domNode.tabIndex = context.options.preventRootFocus ? -1 : 0;\n\n\t\tthis.styleElement = DOM.createStyleSheet(this.domNode);\n\n\t\tthis.treeStyler = context.styler || new DefaultTreestyler(this.styleElement, `monaco-tree-instance-${this.instance}`);\n\n\t\t// ARIA\n\t\tthis.domNode.setAttribute('role', 'tree');\n\t\tif (this.context.options.ariaLabel) {\n\t\t\tthis.domNode.setAttribute('aria-label', this.context.options.ariaLabel);\n\t\t}\n\n\t\tif (this.context.options.alwaysFocused) {\n\t\t\tDOM.addClass(this.domNode, 'focused');\n\t\t}\n\n\t\tif (!this.context.options.paddingOnRow) {\n\t\t\tDOM.addClass(this.domNode, 'no-row-padding');\n\t\t}\n\n\t\tthis.wrapper = document.createElement('div');\n\t\tthis.wrapper.className = 'monaco-tree-wrapper';\n\t\tthis.scrollableElement = new ScrollableElement(this.wrapper, {\n\t\t\talwaysConsumeMouseWheel: true,\n\t\t\thorizontal: horizontalScrollMode,\n\t\t\tvertical: (typeof context.options.verticalScrollMode !== 'undefined' ? context.options.verticalScrollMode : ScrollbarVisibility.Auto),\n\t\t\tuseShadows: context.options.useShadows\n\t\t});\n\t\tthis.scrollableElement.onScroll((e) => {\n\t\t\tthis.render(e.scrollTop, e.height, e.scrollLeft, e.width, e.scrollWidth);\n\t\t\tthis._onDidScroll.fire();\n\t\t});\n\n\t\tif (Browser.isIE) {\n\t\t\tthis.wrapper.style.msTouchAction = 'none';\n\t\t\tthis.wrapper.style.msContentZooming = 'none';\n\t\t} else {\n\t\t\tTouch.Gesture.addTarget(this.wrapper);\n\t\t}\n\n\t\tthis.rowsContainer = document.createElement('div');\n\t\tthis.rowsContainer.className = 'monaco-tree-rows';\n\t\tif (context.options.showTwistie) {\n\t\t\tthis.rowsContainer.className += ' show-twisties';\n\t\t}\n\n\t\tlet focusTracker = DOM.trackFocus(this.domNode);\n\t\tthis.viewListeners.push(focusTracker.onDidFocus(() => this.onFocus()));\n\t\tthis.viewListeners.push(focusTracker.onDidBlur(() => this.onBlur()));\n\t\tthis.viewListeners.push(focusTracker);\n\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.domNode, 'keydown', (e) => this.onKeyDown(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.domNode, 'keyup', (e) => this.onKeyUp(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.domNode, 'mousedown', (e) => this.onMouseDown(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.domNode, 'mouseup', (e) => this.onMouseUp(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, 'auxclick', (e: MouseEvent) => {\n\t\t\tif (e && e.button === 1) {\n\t\t\t\tthis.onMouseMiddleClick(e);\n\t\t\t}\n\t\t}));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, 'click', (e) => this.onClick(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.domNode, 'contextmenu', (e) => this.onContextMenu(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, Touch.EventType.Tap, (e) => this.onTap(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, Touch.EventType.Change, (e) => this.onTouchChange(e)));\n\n\t\tif (Browser.isIE) {\n\t\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, 'MSPointerDown', (e) => this.onMsPointerDown(e)));\n\t\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, 'MSGestureTap', (e) => this.onMsGestureTap(e)));\n\n\t\t\t// these events come too fast, we throttle them\n\t\t\tthis.viewListeners.push(DOM.addDisposableThrottledListener<IThrottledGestureEvent>(this.wrapper, 'MSGestureChange', (e) => this.onThrottledMsGestureChange(e), (lastEvent: IThrottledGestureEvent, event: MSGestureEvent): IThrottledGestureEvent => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tlet result = { translationY: event.translationY, translationX: event.translationX };\n\n\t\t\t\tif (lastEvent) {\n\t\t\t\t\tresult.translationY += lastEvent.translationY;\n\t\t\t\t\tresult.translationX += lastEvent.translationX;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}));\n\t\t}\n\n\t\tthis.viewListeners.push(DOM.addDisposableListener(window, 'dragover', (e) => this.onDragOver(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(this.wrapper, 'drop', (e) => this.onDrop(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(window, 'dragend', (e) => this.onDragEnd(e)));\n\t\tthis.viewListeners.push(DOM.addDisposableListener(window, 'dragleave', (e) => this.onDragOver(e)));\n\n\t\tthis.wrapper.appendChild(this.rowsContainer);\n\t\tthis.domNode.appendChild(this.scrollableElement.getDomNode());\n\t\tcontainer.appendChild(this.domNode);\n\n\t\tthis.lastRenderTop = 0;\n\t\tthis.lastRenderHeight = 0;\n\n\t\tthis.didJustPressContextMenuKey = false;\n\n\t\tthis.currentDropTarget = null;\n\t\tthis.currentDropTargets = [];\n\t\tthis.shouldInvalidateDropReaction = false;\n\n\t\tthis.dragAndDropScrollInterval = null;\n\t\tthis.dragAndDropScrollTimeout = null;\n\n\t\tthis.onRowsChanged();\n\t\tthis.layout();\n\n\t\tthis.setupMSGesture();\n\n\t\tthis.applyStyles(context.options);\n\t}\n\n\tpublic applyStyles(styles: _.ITreeStyles): void {\n\t\tthis.treeStyler.style(styles);\n\t}\n\n\tprotected createViewItem(item: Model.Item): IViewItem {\n\t\treturn new ViewItem(this.context, item);\n\t}\n\n\tpublic getHTMLElement(): HTMLElement {\n\t\treturn this.domNode;\n\t}\n\n\tpublic focus(): void {\n\t\tthis.domNode.focus();\n\t}\n\n\tpublic isFocused(): boolean {\n\t\treturn document.activeElement === this.domNode;\n\t}\n\n\tpublic blur(): void {\n\t\tthis.domNode.blur();\n\t}\n\n\tpublic onVisible(): void {\n\t\tthis.scrollTop = this.onHiddenScrollTop!;\n\t\tthis.onHiddenScrollTop = null;\n\t\tthis.setupMSGesture();\n\t}\n\n\tprivate setupMSGesture(): void {\n\t\tif ((<any>window).MSGesture) {\n\t\t\tthis.msGesture = new MSGesture();\n\t\t\tsetTimeout(() => this.msGesture.target = this.wrapper, 100); // TODO@joh, TODO@IETeam\n\t\t}\n\t}\n\n\tpublic onHidden(): void {\n\t\tthis.onHiddenScrollTop = this.scrollTop;\n\t}\n\n\tprivate isTreeVisible(): boolean {\n\t\treturn this.onHiddenScrollTop === null;\n\t}\n\n\tpublic layout(height?: number, width?: number): void {\n\t\tif (!this.isTreeVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.viewHeight = height || DOM.getContentHeight(this.wrapper); // render\n\t\tthis.scrollHeight = this.getContentHeight();\n\n\t\tif (this.horizontalScrolling) {\n\t\t\tthis.viewWidth = width || DOM.getContentWidth(this.wrapper);\n\t\t}\n\t}\n\n\tpublic getFirstVisibleElement(): any {\n\t\tconst firstIndex = this.indexAt(this.lastRenderTop);\n\t\tlet item = this.itemAtIndex(firstIndex);\n\t\tif (!item) {\n\t\t\treturn item;\n\t\t}\n\n\t\tconst itemMidpoint = item.top + item.height / 2;\n\t\tif (itemMidpoint < this.scrollTop) {\n\t\t\tconst nextItem = this.itemAtIndex(firstIndex + 1);\n\t\t\titem = nextItem || item;\n\t\t}\n\n\t\treturn item.model.getElement();\n\t}\n\n\tpublic getLastVisibleElement(): any {\n\t\tconst item = this.itemAtIndex(this.indexAt(this.lastRenderTop + this.lastRenderHeight - 1));\n\t\treturn item && item.model.getElement();\n\t}\n\n\tprivate render(scrollTop: number, viewHeight: number, scrollLeft: number, viewWidth: number, scrollWidth: number): void {\n\t\tlet i: number;\n\t\tlet stop: number;\n\n\t\tlet renderTop = scrollTop;\n\t\tlet renderBottom = scrollTop + viewHeight;\n\t\tlet thisRenderBottom = this.lastRenderTop + this.lastRenderHeight;\n\n\t\t// when view scrolls down, start rendering from the renderBottom\n\t\tfor (i = this.indexAfter(renderBottom) - 1, stop = this.indexAt(Math.max(thisRenderBottom, renderTop)); i >= stop; i--) {\n\t\t\tthis.insertItemInDOM(<ViewItem>this.itemAtIndex(i));\n\t\t}\n\n\t\t// when view scrolls up, start rendering from either this.renderTop or renderBottom\n\t\tfor (i = Math.min(this.indexAt(this.lastRenderTop), this.indexAfter(renderBottom)) - 1, stop = this.indexAt(renderTop); i >= stop; i--) {\n\t\t\tthis.insertItemInDOM(<ViewItem>this.itemAtIndex(i));\n\t\t}\n\n\t\t// when view scrolls down, start unrendering from renderTop\n\t\tfor (i = this.indexAt(this.lastRenderTop), stop = Math.min(this.indexAt(renderTop), this.indexAfter(thisRenderBottom)); i < stop; i++) {\n\t\t\tthis.removeItemFromDOM(<ViewItem>this.itemAtIndex(i));\n\t\t}\n\n\t\t// when view scrolls up, start unrendering from either renderBottom this.renderTop\n\t\tfor (i = Math.max(this.indexAfter(renderBottom), this.indexAt(this.lastRenderTop)), stop = this.indexAfter(thisRenderBottom); i < stop; i++) {\n\t\t\tthis.removeItemFromDOM(<ViewItem>this.itemAtIndex(i));\n\t\t}\n\n\t\tlet topItem = this.itemAtIndex(this.indexAt(renderTop));\n\n\t\tif (topItem) {\n\t\t\tthis.rowsContainer.style.top = (topItem.top - renderTop) + 'px';\n\t\t}\n\n\t\tif (this.horizontalScrolling) {\n\t\t\tthis.rowsContainer.style.left = -scrollLeft + 'px';\n\t\t\tthis.rowsContainer.style.width = `${Math.max(scrollWidth, viewWidth)}px`;\n\t\t}\n\n\t\tthis.lastRenderTop = renderTop;\n\t\tthis.lastRenderHeight = renderBottom - renderTop;\n\t}\n\n\tpublic setModel(newModel: Model.TreeModel): void {\n\t\tthis.releaseModel();\n\t\tthis.model = newModel;\n\n\t\tthis.model.onRefresh(this.onRefreshing, this, this.modelListeners);\n\t\tthis.model.onDidRefresh(this.onRefreshed, this, this.modelListeners);\n\t\tthis.model.onSetInput(this.onClearingInput, this, this.modelListeners);\n\t\tthis.model.onDidSetInput(this.onSetInput, this, this.modelListeners);\n\t\tthis.model.onDidFocus(this.onModelFocusChange, this, this.modelListeners);\n\n\t\tthis.model.onRefreshItemChildren(this.onItemChildrenRefreshing, this, this.modelListeners);\n\t\tthis.model.onDidRefreshItemChildren(this.onItemChildrenRefreshed, this, this.modelListeners);\n\t\tthis.model.onDidRefreshItem(this.onItemRefresh, this, this.modelListeners);\n\t\tthis.model.onExpandItem(this.onItemExpanding, this, this.modelListeners);\n\t\tthis.model.onDidExpandItem(this.onItemExpanded, this, this.modelListeners);\n\t\tthis.model.onCollapseItem(this.onItemCollapsing, this, this.modelListeners);\n\t\tthis.model.onDidRevealItem(this.onItemReveal, this, this.modelListeners);\n\t\tthis.model.onDidAddTraitItem(this.onItemAddTrait, this, this.modelListeners);\n\t\tthis.model.onDidRemoveTraitItem(this.onItemRemoveTrait, this, this.modelListeners);\n\t}\n\n\tprivate onRefreshing(): void {\n\t\tthis.isRefreshing = true;\n\t}\n\n\tprivate onRefreshed(): void {\n\t\tthis.isRefreshing = false;\n\t\tthis.onRowsChanged();\n\t}\n\n\tprivate onRowsChanged(scrollTop: number = this.scrollTop): void {\n\t\tif (this.isRefreshing) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.scrollTop = scrollTop;\n\t\tthis.updateScrollWidth();\n\t}\n\n\tprivate updateScrollWidth(): void {\n\t\tif (!this.horizontalScrolling) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.contentWidthUpdateDelayer.trigger(() => {\n\t\t\tconst keys = Object.keys(this.items);\n\t\t\tlet scrollWidth = 0;\n\n\t\t\tfor (const key of keys) {\n\t\t\t\tscrollWidth = Math.max(scrollWidth, this.items[key].width);\n\t\t\t}\n\n\t\t\tthis.scrollWidth = scrollWidth + 10 /* scrollbar */;\n\t\t});\n\t}\n\n\tpublic focusNextPage(eventPayload?: any): void {\n\t\tlet lastPageIndex = this.indexAt(this.scrollTop + this.viewHeight);\n\t\tlastPageIndex = lastPageIndex === 0 ? 0 : lastPageIndex - 1;\n\t\tlet lastPageElement = this.itemAtIndex(lastPageIndex).model.getElement();\n\t\tlet currentlyFocusedElement = this.model!.getFocus();\n\n\t\tif (currentlyFocusedElement !== lastPageElement) {\n\t\t\tthis.model!.setFocus(lastPageElement, eventPayload);\n\t\t} else {\n\t\t\tlet previousScrollTop = this.scrollTop;\n\t\t\tthis.scrollTop += this.viewHeight;\n\n\t\t\tif (this.scrollTop !== previousScrollTop) {\n\n\t\t\t\t// Let the scroll event listener run\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.focusNextPage(eventPayload);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic focusPreviousPage(eventPayload?: any): void {\n\t\tlet firstPageIndex: number;\n\n\t\tif (this.scrollTop === 0) {\n\t\t\tfirstPageIndex = this.indexAt(this.scrollTop);\n\t\t} else {\n\t\t\tfirstPageIndex = this.indexAfter(this.scrollTop - 1);\n\t\t}\n\n\t\tlet firstPageElement = this.itemAtIndex(firstPageIndex).model.getElement();\n\t\tlet currentlyFocusedElement = this.model!.getFocus();\n\n\t\tif (currentlyFocusedElement !== firstPageElement) {\n\t\t\tthis.model!.setFocus(firstPageElement, eventPayload);\n\t\t} else {\n\t\t\tlet previousScrollTop = this.scrollTop;\n\t\t\tthis.scrollTop -= this.viewHeight;\n\n\t\t\tif (this.scrollTop !== previousScrollTop) {\n\n\t\t\t\t// Let the scroll event listener run\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.focusPreviousPage(eventPayload);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic get viewHeight() {\n\t\tconst scrollDimensions = this.scrollableElement.getScrollDimensions();\n\t\treturn scrollDimensions.height;\n\t}\n\n\tpublic set viewHeight(height: number) {\n\t\tthis.scrollableElement.setScrollDimensions({ height });\n\t}\n\n\tprivate set scrollHeight(scrollHeight: number) {\n\t\tscrollHeight = scrollHeight + (this.horizontalScrolling ? 10 : 0);\n\t\tthis.scrollableElement.setScrollDimensions({ scrollHeight });\n\t}\n\n\tpublic get viewWidth(): number {\n\t\tconst scrollDimensions = this.scrollableElement.getScrollDimensions();\n\t\treturn scrollDimensions.width;\n\t}\n\n\tpublic set viewWidth(viewWidth: number) {\n\t\tthis.scrollableElement.setScrollDimensions({ width: viewWidth });\n\t}\n\n\tprivate set scrollWidth(scrollWidth: number) {\n\t\tthis.scrollableElement.setScrollDimensions({ scrollWidth });\n\t}\n\n\tpublic get scrollTop(): number {\n\t\tconst scrollPosition = this.scrollableElement.getScrollPosition();\n\t\treturn scrollPosition.scrollTop;\n\t}\n\n\tpublic set scrollTop(scrollTop: number) {\n\t\tconst scrollHeight = this.getContentHeight() + (this.horizontalScrolling ? 10 : 0);\n\t\tthis.scrollableElement.setScrollDimensions({ scrollHeight });\n\t\tthis.scrollableElement.setScrollPosition({ scrollTop });\n\t}\n\n\tpublic getScrollPosition(): number {\n\t\tconst height = this.getContentHeight() - this.viewHeight;\n\t\treturn height <= 0 ? 1 : this.scrollTop / height;\n\t}\n\n\tpublic setScrollPosition(pos: number): void {\n\t\tconst height = this.getContentHeight() - this.viewHeight;\n\t\tthis.scrollTop = height * pos;\n\t}\n\n\t// Events\n\n\tprivate onClearingInput(e: Model.IInputEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tif (item) {\n\t\t\tthis.onRemoveItems(new MappedIterator(item.getNavigator(), item => item && item.id));\n\t\t\tthis.onRowsChanged();\n\t\t}\n\t}\n\n\tprivate onSetInput(e: Model.IInputEvent): void {\n\t\tthis.context.cache.garbageCollect();\n\t\tthis.inputItem = new RootViewItem(this.context, <Model.Item>e.item, this.wrapper);\n\t}\n\n\tprivate onItemChildrenRefreshing(e: Model.IItemChildrenRefreshEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet viewItem = this.items[item.id];\n\n\t\tif (viewItem && this.context.options.showLoading) {\n\t\t\tviewItem.loadingTimer = setTimeout(() => {\n\t\t\t\tviewItem.loadingTimer = 0;\n\t\t\t\tviewItem.loading = true;\n\t\t\t}, TreeView.LOADING_DECORATION_DELAY);\n\t\t}\n\n\t\tif (!e.isNested) {\n\t\t\tlet childrenIds: string[] = [];\n\t\t\tlet navigator = item.getNavigator();\n\t\t\tlet childItem: Model.Item | null;\n\n\t\t\twhile (childItem = navigator.next()) {\n\t\t\t\tchildrenIds.push(childItem.id);\n\t\t\t}\n\n\t\t\tthis.refreshingPreviousChildrenIds[item.id] = childrenIds;\n\t\t}\n\t}\n\n\tprivate onItemChildrenRefreshed(e: Model.IItemChildrenRefreshEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet viewItem = this.items[item.id];\n\n\t\tif (viewItem) {\n\t\t\tif (viewItem.loadingTimer) {\n\t\t\t\tclearTimeout(viewItem.loadingTimer);\n\t\t\t\tviewItem.loadingTimer = 0;\n\t\t\t}\n\n\t\t\tviewItem.loading = false;\n\t\t}\n\n\t\tif (!e.isNested) {\n\t\t\tlet previousChildrenIds = this.refreshingPreviousChildrenIds[item.id];\n\t\t\tlet afterModelItems: Model.Item[] = [];\n\t\t\tlet navigator = item.getNavigator();\n\t\t\tlet childItem: Model.Item | null;\n\n\t\t\twhile (childItem = navigator.next()) {\n\t\t\t\tafterModelItems.push(childItem);\n\t\t\t}\n\n\t\t\tlet skipDiff = Math.abs(previousChildrenIds.length - afterModelItems.length) > 1000;\n\t\t\tlet diff: Diff.IDiffChange[] = [];\n\t\t\tlet doToInsertItemsAlreadyExist: boolean = false;\n\n\t\t\tif (!skipDiff) {\n\t\t\t\tconst lcs = new Diff.LcsDiff(\n\t\t\t\t\t{\n\t\t\t\t\t\tgetLength: () => previousChildrenIds.length,\n\t\t\t\t\t\tgetElementAtIndex: (i: number) => previousChildrenIds[i]\n\t\t\t\t\t}, {\n\t\t\t\t\t\tgetLength: () => afterModelItems.length,\n\t\t\t\t\t\tgetElementAtIndex: (i: number) => afterModelItems[i].id\n\t\t\t\t\t},\n\t\t\t\t\tnull\n\t\t\t\t);\n\n\t\t\t\tdiff = lcs.ComputeDiff(false);\n\n\t\t\t\t// this means that the result of the diff algorithm would result\n\t\t\t\t// in inserting items that were already registered. this can only\n\t\t\t\t// happen if the data provider returns bad ids OR if the sorting\n\t\t\t\t// of the elements has changed\n\t\t\t\tdoToInsertItemsAlreadyExist = diff.some(d => {\n\t\t\t\t\tif (d.modifiedLength > 0) {\n\t\t\t\t\t\tfor (let i = d.modifiedStart, len = d.modifiedStart + d.modifiedLength; i < len; i++) {\n\t\t\t\t\t\t\tif (this.items.hasOwnProperty(afterModelItems[i].id)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// 50 is an optimization number, at some point we're better off\n\t\t\t// just replacing everything\n\t\t\tif (!skipDiff && !doToInsertItemsAlreadyExist && diff.length < 50) {\n\t\t\t\tfor (const diffChange of diff) {\n\n\t\t\t\t\tif (diffChange.originalLength > 0) {\n\t\t\t\t\t\tthis.onRemoveItems(new ArrayIterator(previousChildrenIds, diffChange.originalStart, diffChange.originalStart + diffChange.originalLength));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (diffChange.modifiedLength > 0) {\n\t\t\t\t\t\tlet beforeItem: Model.Item | null = afterModelItems[diffChange.modifiedStart - 1] || item;\n\t\t\t\t\t\tbeforeItem = beforeItem.getDepth() > 0 ? beforeItem : null;\n\n\t\t\t\t\t\tthis.onInsertItems(new ArrayIterator(afterModelItems, diffChange.modifiedStart, diffChange.modifiedStart + diffChange.modifiedLength), beforeItem ? beforeItem.id : null);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else if (skipDiff || diff.length) {\n\t\t\t\tthis.onRemoveItems(new ArrayIterator(previousChildrenIds));\n\t\t\t\tthis.onInsertItems(new ArrayIterator(afterModelItems), item.getDepth() > 0 ? item.id : null);\n\t\t\t}\n\n\t\t\tif (skipDiff || diff.length) {\n\t\t\t\tthis.onRowsChanged();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onItemRefresh(item: Model.Item): void {\n\t\tthis.onItemsRefresh([item]);\n\t}\n\n\tprivate onItemsRefresh(items: Model.Item[]): void {\n\t\tthis.onRefreshItemSet(items.filter(item => this.items.hasOwnProperty(item.id)));\n\t\tthis.onRowsChanged();\n\t}\n\n\tprivate onItemExpanding(e: Model.IItemExpandEvent): void {\n\t\tlet viewItem = this.items[e.item.id];\n\t\tif (viewItem) {\n\t\t\tviewItem.expanded = true;\n\t\t}\n\t}\n\n\tprivate onItemExpanded(e: Model.IItemExpandEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet viewItem = this.items[item.id];\n\t\tif (viewItem) {\n\t\t\tviewItem.expanded = true;\n\n\t\t\tlet height = this.onInsertItems(item.getNavigator(), item.id) || 0;\n\t\t\tlet scrollTop = this.scrollTop;\n\n\t\t\tif (viewItem.top + viewItem.height <= this.scrollTop) {\n\t\t\t\tscrollTop += height;\n\t\t\t}\n\n\t\t\tthis.onRowsChanged(scrollTop);\n\t\t}\n\t}\n\n\tprivate onItemCollapsing(e: Model.IItemCollapseEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet viewItem = this.items[item.id];\n\t\tif (viewItem) {\n\t\t\tviewItem.expanded = false;\n\t\t\tthis.onRemoveItems(new MappedIterator(item.getNavigator(), item => item && item.id));\n\t\t\tthis.onRowsChanged();\n\t\t}\n\t}\n\n\tpublic getRelativeTop(item: Model.Item): number {\n\t\tif (item && item.isVisible()) {\n\t\t\tlet viewItem = this.items[item.id];\n\t\t\tif (viewItem) {\n\t\t\t\treturn (viewItem.top - this.scrollTop) / (this.viewHeight - viewItem.height);\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tprivate onItemReveal(e: Model.IItemRevealEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet relativeTop = <number>e.relativeTop;\n\t\tlet viewItem = this.items[item.id];\n\t\tif (viewItem) {\n\t\t\tif (relativeTop !== null) {\n\t\t\t\trelativeTop = relativeTop < 0 ? 0 : relativeTop;\n\t\t\t\trelativeTop = relativeTop > 1 ? 1 : relativeTop;\n\n\t\t\t\t// y = mx + b\n\t\t\t\tlet m = viewItem.height - this.viewHeight;\n\t\t\t\tthis.scrollTop = m * relativeTop + viewItem.top;\n\t\t\t} else {\n\t\t\t\tlet viewItemBottom = viewItem.top + viewItem.height;\n\t\t\t\tlet wrapperBottom = this.scrollTop + this.viewHeight;\n\n\t\t\t\tif (viewItem.top < this.scrollTop) {\n\t\t\t\t\tthis.scrollTop = viewItem.top;\n\t\t\t\t} else if (viewItemBottom >= wrapperBottom) {\n\t\t\t\t\tthis.scrollTop = viewItemBottom - this.viewHeight;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onItemAddTrait(e: Model.IItemTraitEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet trait = <string>e.trait;\n\t\tlet viewItem = this.items[item.id];\n\t\tif (viewItem) {\n\t\t\tviewItem.addClass(trait);\n\t\t}\n\t\tif (trait === 'highlighted') {\n\t\t\tDOM.addClass(this.domNode, trait);\n\n\t\t\t// Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n\t\t\tif (viewItem) {\n\t\t\t\tthis.highlightedItemWasDraggable = !!viewItem.draggable;\n\t\t\t\tif (viewItem.draggable) {\n\t\t\t\t\tviewItem.draggable = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onItemRemoveTrait(e: Model.IItemTraitEvent): void {\n\t\tlet item = <Model.Item>e.item;\n\t\tlet trait = <string>e.trait;\n\t\tlet viewItem = this.items[item.id];\n\t\tif (viewItem) {\n\t\t\tviewItem.removeClass(trait);\n\t\t}\n\t\tif (trait === 'highlighted') {\n\t\t\tDOM.removeClass(this.domNode, trait);\n\n\t\t\t// Ugly Firefox fix: input fields can't be selected if parent nodes are draggable\n\t\t\tif (this.highlightedItemWasDraggable) {\n\t\t\t\tviewItem.draggable = true;\n\t\t\t}\n\t\t\tthis.highlightedItemWasDraggable = false;\n\t\t}\n\t}\n\n\tprivate onModelFocusChange(): void {\n\t\tconst focus = this.model && this.model.getFocus();\n\n\t\tDOM.toggleClass(this.domNode, 'no-focused-item', !focus);\n\n\t\t// ARIA\n\t\tif (focus) {\n\t\t\tthis.domNode.setAttribute('aria-activedescendant', strings.safeBtoa(this.context.dataSource.getId(this.context.tree, focus)));\n\t\t} else {\n\t\t\tthis.domNode.removeAttribute('aria-activedescendant');\n\t\t}\n\t}\n\n\t// HeightMap \"events\"\n\n\tpublic onInsertItem(item: ViewItem): void {\n\t\titem.onDragStart = (e) => { this.onDragStart(item, e); };\n\t\titem.needsRender = true;\n\t\tthis.refreshViewItem(item);\n\t\tthis.items[item.id] = item;\n\t}\n\n\tpublic onRefreshItem(item: ViewItem, needsRender = false): void {\n\t\titem.needsRender = item.needsRender || needsRender;\n\t\tthis.refreshViewItem(item);\n\t}\n\n\tpublic onRemoveItem(item: ViewItem): void {\n\t\tthis.removeItemFromDOM(item);\n\t\titem.dispose();\n\t\tdelete this.items[item.id];\n\t}\n\n\t// ViewItem refresh\n\n\tprivate refreshViewItem(item: ViewItem): void {\n\t\titem.render();\n\n\t\tif (this.shouldBeRendered(item)) {\n\t\t\tthis.insertItemInDOM(item);\n\t\t} else {\n\t\t\tthis.removeItemFromDOM(item);\n\t\t}\n\t}\n\n\t// DOM Events\n\n\tprivate onClick(e: MouseEvent): void {\n\t\tif (this.lastPointerType && this.lastPointerType !== 'mouse') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet event = new Mouse.StandardMouseEvent(e);\n\t\tlet item = this.getItemAround(event.target);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (Browser.isIE && Date.now() - this.lastClickTimeStamp < 300) {\n\t\t\t// IE10+ doesn't set the detail property correctly. While IE10 simply\n\t\t\t// counts the number of clicks, IE11 reports always 1. To align with\n\t\t\t// other browser, we set the value to 2 if clicks events come in a 300ms\n\t\t\t// sequence.\n\t\t\tevent.detail = 2;\n\t\t}\n\t\tthis.lastClickTimeStamp = Date.now();\n\n\t\tthis.context.controller!.onClick(this.context.tree, item.model.getElement(), event);\n\t}\n\n\tprivate onMouseMiddleClick(e: MouseEvent): void {\n\t\tif (!this.context.controller!.onMouseMiddleClick!) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet event = new Mouse.StandardMouseEvent(e);\n\t\tlet item = this.getItemAround(event.target);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\t\tthis.context.controller!.onMouseMiddleClick!(this.context.tree, item.model.getElement(), event);\n\t}\n\n\tprivate onMouseDown(e: MouseEvent): void {\n\t\tthis.didJustPressContextMenuKey = false;\n\n\t\tif (!this.context.controller!.onMouseDown!) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.lastPointerType && this.lastPointerType !== 'mouse') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet event = new Mouse.StandardMouseEvent(e);\n\n\t\tif (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet item = this.getItemAround(event.target);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.context.controller!.onMouseDown!(this.context.tree, item.model.getElement(), event);\n\t}\n\n\tprivate onMouseUp(e: MouseEvent): void {\n\t\tif (!this.context.controller!.onMouseUp!) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.lastPointerType && this.lastPointerType !== 'mouse') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet event = new Mouse.StandardMouseEvent(e);\n\n\t\tif (event.ctrlKey && Platform.isNative && Platform.isMacintosh) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet item = this.getItemAround(event.target);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.context.controller!.onMouseUp!(this.context.tree, item.model.getElement(), event);\n\t}\n\n\tprivate onTap(e: Touch.GestureEvent): void {\n\t\tlet item = this.getItemAround(<HTMLElement>e.initialTarget);\n\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.context.controller!.onTap(this.context.tree, item.model.getElement(), e);\n\t}\n\n\tprivate onTouchChange(event: Touch.GestureEvent): void {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.scrollTop -= event.translationY;\n\t}\n\n\tprivate onContextMenu(keyboardEvent: KeyboardEvent): void;\n\tprivate onContextMenu(mouseEvent: MouseEvent): void;\n\tprivate onContextMenu(event: KeyboardEvent | MouseEvent): void {\n\t\tlet resultEvent: _.ContextMenuEvent;\n\t\tlet element: any;\n\n\t\tif (event instanceof KeyboardEvent || this.didJustPressContextMenuKey) {\n\t\t\tthis.didJustPressContextMenuKey = false;\n\n\t\t\tlet keyboardEvent = new Keyboard.StandardKeyboardEvent(<KeyboardEvent>event);\n\t\t\telement = this.model!.getFocus();\n\n\t\t\tlet position: DOM.IDomNodePagePosition;\n\n\t\t\tif (!element) {\n\t\t\t\telement = this.model!.getInput();\n\t\t\t\tposition = DOM.getDomNodePagePosition(this.inputItem.element);\n\t\t\t} else {\n\t\t\t\tconst id = this.context.dataSource.getId(this.context.tree, element);\n\t\t\t\tconst viewItem = this.items[id!];\n\t\t\t\tposition = DOM.getDomNodePagePosition(viewItem.element);\n\t\t\t}\n\n\t\t\tresultEvent = new _.KeyboardContextMenuEvent(position.left + position.width, position.top, keyboardEvent);\n\n\t\t} else {\n\t\t\tlet mouseEvent = new Mouse.StandardMouseEvent(<MouseEvent>event);\n\t\t\tlet item = this.getItemAround(mouseEvent.target);\n\n\t\t\tif (!item) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\telement = item.model.getElement();\n\t\t\tresultEvent = new _.MouseContextMenuEvent(mouseEvent);\n\t\t}\n\n\t\tthis.context.controller!.onContextMenu(this.context.tree, element, resultEvent);\n\t}\n\n\tprivate onKeyDown(e: KeyboardEvent): void {\n\t\tlet event = new Keyboard.StandardKeyboardEvent(e);\n\n\t\tthis.didJustPressContextMenuKey = event.keyCode === KeyCode.ContextMenu || (event.shiftKey && event.keyCode === KeyCode.F10);\n\n\t\tif (event.target && event.target.tagName && event.target.tagName.toLowerCase() === 'input') {\n\t\t\treturn; // Ignore event if target is a form input field (avoids browser specific issues)\n\t\t}\n\n\t\tif (this.didJustPressContextMenuKey) {\n\t\t\tevent.preventDefault();\n\t\t\tevent.stopPropagation();\n\t\t}\n\n\t\tthis.context.controller!.onKeyDown(this.context.tree, event);\n\t}\n\n\tprivate onKeyUp(e: KeyboardEvent): void {\n\t\tif (this.didJustPressContextMenuKey) {\n\t\t\tthis.onContextMenu(e);\n\t\t}\n\n\t\tthis.didJustPressContextMenuKey = false;\n\t\tthis.context.controller!.onKeyUp(this.context.tree, new Keyboard.StandardKeyboardEvent(e));\n\t}\n\n\tprivate onDragStart(item: ViewItem, e: any): void {\n\t\tif (this.model!.getHighlight()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet element = item.model.getElement();\n\t\tlet selection = this.model!.getSelection();\n\t\tlet elements: any[];\n\n\t\tif (selection.indexOf(element) > -1) {\n\t\t\telements = selection;\n\t\t} else {\n\t\t\telements = [element];\n\t\t}\n\n\t\te.dataTransfer.effectAllowed = 'copyMove';\n\t\te.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([item.uri]));\n\t\tif (e.dataTransfer.setDragImage) {\n\t\t\tlet label: string;\n\n\t\t\tif (this.context.dnd!.getDragLabel) {\n\t\t\t\tlabel = this.context.dnd!.getDragLabel!(this.context.tree, elements);\n\t\t\t} else {\n\t\t\t\tlabel = String(elements.length);\n\t\t\t}\n\n\t\t\tconst dragImage = document.createElement('div');\n\t\t\tdragImage.className = 'monaco-tree-drag-image';\n\t\t\tdragImage.textContent = label;\n\t\t\tdocument.body.appendChild(dragImage);\n\t\t\te.dataTransfer.setDragImage(dragImage, -10, -10);\n\t\t\tsetTimeout(() => document.body.removeChild(dragImage), 0);\n\t\t}\n\n\t\tthis.currentDragAndDropData = new dnd.ElementsDragAndDropData(elements);\n\t\tStaticDND.CurrentDragAndDropData = new dnd.ExternalElementsDragAndDropData(elements);\n\n\t\tthis.context.dnd!.onDragStart(this.context.tree, this.currentDragAndDropData, new Mouse.DragMouseEvent(e));\n\t}\n\n\tprivate setupDragAndDropScrollInterval(): void {\n\t\tlet viewTop = DOM.getTopLeftOffset(this.wrapper).top;\n\n\t\tif (!this.dragAndDropScrollInterval) {\n\t\t\tthis.dragAndDropScrollInterval = window.setInterval(() => {\n\t\t\t\tif (this.dragAndDropMouseY === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet diff = this.dragAndDropMouseY - viewTop;\n\t\t\t\tlet scrollDiff = 0;\n\t\t\t\tlet upperLimit = this.viewHeight - 35;\n\n\t\t\t\tif (diff < 35) {\n\t\t\t\t\tscrollDiff = Math.max(-14, 0.2 * (diff - 35));\n\t\t\t\t} else if (diff > upperLimit) {\n\t\t\t\t\tscrollDiff = Math.min(14, 0.2 * (diff - upperLimit));\n\t\t\t\t}\n\n\t\t\t\tthis.scrollTop += scrollDiff;\n\t\t\t}, 10);\n\n\t\t\tthis.cancelDragAndDropScrollTimeout();\n\n\t\t\tthis.dragAndDropScrollTimeout = window.setTimeout(() => {\n\t\t\t\tthis.cancelDragAndDropScrollInterval();\n\t\t\t\tthis.dragAndDropScrollTimeout = null;\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tprivate cancelDragAndDropScrollInterval(): void {\n\t\tif (this.dragAndDropScrollInterval) {\n\t\t\twindow.clearInterval(this.dragAndDropScrollInterval);\n\t\t\tthis.dragAndDropScrollInterval = null;\n\t\t}\n\n\t\tthis.cancelDragAndDropScrollTimeout();\n\t}\n\n\tprivate cancelDragAndDropScrollTimeout(): void {\n\t\tif (this.dragAndDropScrollTimeout) {\n\t\t\twindow.clearTimeout(this.dragAndDropScrollTimeout);\n\t\t\tthis.dragAndDropScrollTimeout = null;\n\t\t}\n\t}\n\n\tprivate onDragOver(e: DragEvent): boolean {\n\t\te.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n\t\tlet event = new Mouse.DragMouseEvent(e);\n\n\t\tlet viewItem = this.getItemAround(event.target);\n\n\t\tif (!viewItem || (event.posx === 0 && event.posy === 0 && event.browserEvent.type === DOM.EventType.DRAG_LEAVE)) {\n\t\t\t// dragging outside of tree\n\n\t\t\tif (this.currentDropTarget) {\n\t\t\t\t// clear previously hovered element feedback\n\n\t\t\t\tthis.currentDropTargets!.forEach(i => i.dropTarget = false);\n\t\t\t\tthis.currentDropTargets = [];\n\t\t\t\tthis.currentDropDisposable.dispose();\n\t\t\t}\n\n\t\t\tthis.cancelDragAndDropScrollInterval();\n\t\t\tthis.currentDropTarget = null;\n\t\t\tthis.currentDropElement = null;\n\t\t\tthis.dragAndDropMouseY = null;\n\n\t\t\treturn false;\n\t\t}\n\n\t\t// dragging inside the tree\n\t\tthis.setupDragAndDropScrollInterval();\n\t\tthis.dragAndDropMouseY = event.posy;\n\n\t\tif (!this.currentDragAndDropData) {\n\t\t\t// just started dragging\n\n\t\t\tif (StaticDND.CurrentDragAndDropData) {\n\t\t\t\tthis.currentDragAndDropData = StaticDND.CurrentDragAndDropData;\n\t\t\t} else {\n\t\t\t\tif (!event.dataTransfer.types) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDragAndDropData = new dnd.DesktopDragAndDropData();\n\t\t\t}\n\t\t}\n\n\t\tthis.currentDragAndDropData.update((event.browserEvent as DragEvent).dataTransfer!);\n\n\t\tlet element: any;\n\t\tlet item: Model.Item | null = viewItem.model;\n\t\tlet reaction: _.IDragOverReaction | null;\n\n\t\t// check the bubble up behavior\n\t\tdo {\n\t\t\telement = item ? item.getElement() : this.model!.getInput();\n\t\t\treaction = this.context.dnd!.onDragOver(this.context.tree, this.currentDragAndDropData, element, event);\n\n\t\t\tif (!reaction || reaction.bubble !== _.DragOverBubble.BUBBLE_UP) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\titem = item && item.parent;\n\t\t} while (item);\n\n\t\tif (!item) {\n\t\t\tthis.currentDropElement = null;\n\t\t\treturn false;\n\t\t}\n\n\t\tlet canDrop = reaction && reaction.accept;\n\n\t\tif (canDrop) {\n\t\t\tthis.currentDropElement = item.getElement();\n\t\t\tevent.preventDefault();\n\t\t\tevent.dataTransfer.dropEffect = reaction!.effect === _.DragOverEffect.COPY ? 'copy' : 'move';\n\t\t} else {\n\t\t\tthis.currentDropElement = null;\n\t\t}\n\n\t\t// item is the model item where drop() should be called\n\n\t\t// can be null\n\t\tlet currentDropTarget = item.id === this.inputItem.id ? this.inputItem : this.items[item.id];\n\n\t\tif (this.shouldInvalidateDropReaction || this.currentDropTarget !== currentDropTarget || !reactionEquals(this.currentDropElementReaction, reaction)) {\n\t\t\tthis.shouldInvalidateDropReaction = false;\n\n\t\t\tif (this.currentDropTarget) {\n\t\t\t\tthis.currentDropTargets!.forEach(i => i.dropTarget = false);\n\t\t\t\tthis.currentDropTargets = [];\n\t\t\t\tthis.currentDropDisposable.dispose();\n\t\t\t}\n\n\t\t\tthis.currentDropTarget = currentDropTarget;\n\t\t\tthis.currentDropElementReaction = reaction!;\n\n\t\t\tif (canDrop) {\n\t\t\t\t// setup hover feedback for drop target\n\n\t\t\t\tif (this.currentDropTarget) {\n\t\t\t\t\tthis.currentDropTarget.dropTarget = true;\n\t\t\t\t\tthis.currentDropTargets!.push(this.currentDropTarget);\n\t\t\t\t}\n\n\t\t\t\tif (reaction!.bubble === _.DragOverBubble.BUBBLE_DOWN) {\n\t\t\t\t\tlet nav = item.getNavigator();\n\t\t\t\t\tlet child: Model.Item | null;\n\t\t\t\t\twhile (child = nav.next()) {\n\t\t\t\t\t\tviewItem = this.items[child.id];\n\t\t\t\t\t\tif (viewItem) {\n\t\t\t\t\t\t\tviewItem.dropTarget = true;\n\t\t\t\t\t\t\tthis.currentDropTargets!.push(viewItem);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (reaction!.autoExpand) {\n\t\t\t\t\tconst timeoutPromise = timeout(500);\n\t\t\t\t\tthis.currentDropDisposable = Lifecycle.toDisposable(() => timeoutPromise.cancel());\n\n\t\t\t\t\ttimeoutPromise\n\t\t\t\t\t\t.then(() => this.context.tree.expand(this.currentDropElement))\n\t\t\t\t\t\t.then(() => this.shouldInvalidateDropReaction = true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate onDrop(e: DragEvent): void {\n\t\tif (this.currentDropElement) {\n\t\t\tlet event = new Mouse.DragMouseEvent(e);\n\t\t\tevent.preventDefault();\n\t\t\tthis.currentDragAndDropData!.update((event.browserEvent as DragEvent).dataTransfer!);\n\t\t\tthis.context.dnd!.drop(this.context.tree, this.currentDragAndDropData!, this.currentDropElement, event);\n\t\t\tthis.onDragEnd(e);\n\t\t}\n\t\tthis.cancelDragAndDropScrollInterval();\n\t}\n\n\tprivate onDragEnd(e: DragEvent): void {\n\t\tif (this.currentDropTarget) {\n\t\t\tthis.currentDropTargets!.forEach(i => i.dropTarget = false);\n\t\t\tthis.currentDropTargets = [];\n\t\t}\n\n\t\tthis.currentDropDisposable.dispose();\n\n\t\tthis.cancelDragAndDropScrollInterval();\n\t\tthis.currentDragAndDropData = null;\n\t\tStaticDND.CurrentDragAndDropData = undefined;\n\t\tthis.currentDropElement = null;\n\t\tthis.currentDropTarget = null;\n\t\tthis.dragAndDropMouseY = null;\n\t}\n\n\tprivate onFocus(): void {\n\t\tif (!this.context.options.alwaysFocused) {\n\t\t\tDOM.addClass(this.domNode, 'focused');\n\t\t}\n\n\t\tthis._onDOMFocus.fire();\n\t}\n\n\tprivate onBlur(): void {\n\t\tif (!this.context.options.alwaysFocused) {\n\t\t\tDOM.removeClass(this.domNode, 'focused');\n\t\t}\n\n\t\tthis.domNode.removeAttribute('aria-activedescendant'); // ARIA\n\n\t\tthis._onDOMBlur.fire();\n\t}\n\n\t// MS specific DOM Events\n\n\tprivate onMsPointerDown(event: MSPointerEvent): void {\n\t\tif (!this.msGesture) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Circumvent IE11 breaking change in e.pointerType & TypeScript's stale definitions\n\t\tlet pointerType = event.pointerType;\n\t\tif (pointerType === ((<any>event).MSPOINTER_TYPE_MOUSE || 'mouse')) {\n\t\t\tthis.lastPointerType = 'mouse';\n\t\t\treturn;\n\t\t} else if (pointerType === ((<any>event).MSPOINTER_TYPE_TOUCH || 'touch')) {\n\t\t\tthis.lastPointerType = 'touch';\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\n\t\tthis.msGesture.addPointer(event.pointerId);\n\t}\n\n\tprivate onThrottledMsGestureChange(event: IThrottledGestureEvent): void {\n\t\tthis.scrollTop -= event.translationY;\n\t}\n\n\tprivate onMsGestureTap(event: MSGestureEvent): void {\n\t\t(<any>event).initialTarget = document.elementFromPoint(event.clientX, event.clientY);\n\t\tthis.onTap(<any>event);\n\t}\n\n\t// DOM changes\n\n\tprivate insertItemInDOM(item: ViewItem): void {\n\t\tlet elementAfter: HTMLElement | null = null;\n\t\tlet itemAfter = <ViewItem>this.itemAfter(item);\n\n\t\tif (itemAfter && itemAfter.element) {\n\t\t\telementAfter = itemAfter.element;\n\t\t}\n\n\t\titem.insertInDOM(this.rowsContainer, elementAfter);\n\t}\n\n\tprivate removeItemFromDOM(item: ViewItem): void {\n\t\tif (!item) {\n\t\t\treturn;\n\t\t}\n\n\t\titem.removeFromDOM();\n\t}\n\n\t// Helpers\n\n\tprivate shouldBeRendered(item: ViewItem): boolean {\n\t\treturn item.top < this.lastRenderTop + this.lastRenderHeight && item.top + item.height > this.lastRenderTop;\n\t}\n\n\tprivate getItemAround(element: HTMLElement): ViewItem | undefined {\n\t\tlet candidate: ViewItem = this.inputItem;\n\t\tlet el: HTMLElement | null = element;\n\n\t\tdo {\n\t\t\tif ((<any>el)[TreeView.BINDING]) {\n\t\t\t\tcandidate = (<any>el)[TreeView.BINDING];\n\t\t\t}\n\n\t\t\tif (el === this.wrapper || el === this.domNode) {\n\t\t\t\treturn candidate;\n\t\t\t}\n\n\t\t\tif (el === this.scrollableElement.getDomNode() || el === document.body) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} while (el = el.parentElement);\n\n\t\treturn undefined;\n\t}\n\n\t// Cleanup\n\n\tprivate releaseModel(): void {\n\t\tif (this.model) {\n\t\t\tthis.modelListeners = Lifecycle.dispose(this.modelListeners);\n\t\t\tthis.model = null;\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\t// TODO@joao: improve\n\t\tthis.scrollableElement.dispose();\n\n\t\tthis.releaseModel();\n\n\t\tthis.viewListeners = Lifecycle.dispose(this.viewListeners);\n\n\t\tthis._onDOMFocus.dispose();\n\t\tthis._onDOMBlur.dispose();\n\n\t\tif (this.domNode.parentNode) {\n\t\t\tthis.domNode.parentNode.removeChild(this.domNode);\n\t\t}\n\n\t\tif (this.items) {\n\t\t\tObject.keys(this.items).forEach(key => this.items[key].removeFromDOM());\n\t\t}\n\n\t\tif (this.context.cache) {\n\t\t\tthis.context.cache.dispose();\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n"]}]}