{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar arrays_1 = require(\"vs/base/common/arrays\");\nvar async_1 = require(\"vs/base/common/async\");\nvar cancellation_1 = require(\"vs/base/common/cancellation\");\nvar collections_1 = require(\"vs/base/common/collections\");\nvar errors_1 = require(\"vs/base/common/errors\");\nvar event_1 = require(\"vs/base/common/event\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar resources_1 = require(\"vs/base/common/resources\");\nvar modes_1 = require(\"vs/editor/common/modes\");\nvar outlineModel_1 = require(\"vs/editor/contrib/documentSymbols/outlineModel\");\nvar workspace_1 = require(\"vs/platform/workspace/common/workspace\");\nvar network_1 = require(\"vs/base/common/network\");\nvar configuration_1 = require(\"vs/platform/configuration/common/configuration\");\nvar breadcrumbs_1 = require(\"vs/workbench/browser/parts/editor/breadcrumbs\");\nvar files_1 = require(\"vs/platform/files/common/files\");\nvar types_1 = require(\"vs/base/common/types\");\nvar FileElement = /** @class */ (function () {\n    function FileElement(uri, kind) {\n        this.uri = uri;\n        this.kind = kind;\n    }\n    return FileElement;\n}());\nexports.FileElement = FileElement;\nvar EditorBreadcrumbsModel = /** @class */ (function () {\n    function EditorBreadcrumbsModel(_uri, _editor, workspaceService, configurationService) {\n        var _this = this;\n        this._uri = _uri;\n        this._editor = _editor;\n        this._disposables = [];\n        this._outlineElements = [];\n        this._outlineDisposables = [];\n        this._onDidUpdate = new event_1.Emitter();\n        this.onDidUpdate = this._onDidUpdate.event;\n        this._cfgFilePath = breadcrumbs_1.BreadcrumbsConfig.FilePath.bindTo(configurationService);\n        this._cfgSymbolPath = breadcrumbs_1.BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n        this._disposables.push(this._cfgFilePath.onDidChange(function (_) { return _this._onDidUpdate.fire(_this); }));\n        this._disposables.push(this._cfgSymbolPath.onDidChange(function (_) { return _this._onDidUpdate.fire(_this); }));\n        this._fileInfo = EditorBreadcrumbsModel._initFilePathInfo(this._uri, workspaceService);\n        this._bindToEditor();\n        this._onDidUpdate.fire(this);\n    }\n    EditorBreadcrumbsModel.prototype.dispose = function () {\n        this._cfgFilePath.dispose();\n        this._cfgSymbolPath.dispose();\n        lifecycle_1.dispose(this._disposables);\n    };\n    EditorBreadcrumbsModel.prototype.isRelative = function () {\n        return Boolean(this._fileInfo.folder);\n    };\n    EditorBreadcrumbsModel.prototype.getElements = function () {\n        var result = [];\n        // file path elements\n        if (this._cfgFilePath.getValue() === 'on') {\n            result = result.concat(this._fileInfo.path);\n        }\n        else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n            result = result.concat(this._fileInfo.path.slice(-1));\n        }\n        // symbol path elements\n        if (this._cfgSymbolPath.getValue() === 'on') {\n            result = result.concat(this._outlineElements);\n        }\n        else if (this._cfgSymbolPath.getValue() === 'last' && this._outlineElements.length > 0) {\n            result = result.concat(this._outlineElements.slice(-1));\n        }\n        return result;\n    };\n    EditorBreadcrumbsModel._initFilePathInfo = function (uri, workspaceService) {\n        if (uri.scheme === network_1.Schemas.untitled) {\n            return {\n                folder: undefined,\n                path: []\n            };\n        }\n        var info = {\n            folder: types_1.withNullAsUndefined(workspaceService.getWorkspaceFolder(uri)),\n            path: []\n        };\n        var uriPrefix = uri;\n        while (uriPrefix && uriPrefix.path !== '/') {\n            if (info.folder && resources_1.isEqual(info.folder.uri, uriPrefix)) {\n                break;\n            }\n            info.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? files_1.FileKind.FILE : files_1.FileKind.FOLDER));\n            var prevPathLength = uriPrefix.path.length;\n            uriPrefix = resources_1.dirname(uriPrefix);\n            if (uriPrefix.path.length === prevPathLength) {\n                break;\n            }\n        }\n        if (info.folder && workspaceService.getWorkbenchState() === workspace_1.WorkbenchState.WORKSPACE) {\n            info.path.unshift(new FileElement(info.folder.uri, files_1.FileKind.ROOT_FOLDER));\n        }\n        return info;\n    };\n    EditorBreadcrumbsModel.prototype._bindToEditor = function () {\n        var _this = this;\n        if (!this._editor) {\n            return;\n        }\n        // update as model changes\n        this._disposables.push(modes_1.DocumentSymbolProviderRegistry.onDidChange(function (_) { return _this._updateOutline(); }));\n        this._disposables.push(this._editor.onDidChangeModel(function (_) { return _this._updateOutline(); }));\n        this._disposables.push(this._editor.onDidChangeModelLanguage(function (_) { return _this._updateOutline(); }));\n        this._disposables.push(event_1.Event.debounce(this._editor.onDidChangeModelContent, function (_) { return _; }, 350)(function (_) { return _this._updateOutline(true); }));\n        this._updateOutline();\n        // stop when editor dies\n        this._disposables.push(this._editor.onDidDispose(function () { return _this._outlineDisposables = lifecycle_1.dispose(_this._outlineDisposables); }));\n    };\n    EditorBreadcrumbsModel.prototype._updateOutline = function (didChangeContent) {\n        var _this = this;\n        this._outlineDisposables = lifecycle_1.dispose(this._outlineDisposables);\n        if (!didChangeContent) {\n            this._updateOutlineElements([]);\n        }\n        var editor = this._editor;\n        var buffer = editor.getModel();\n        if (!buffer || !modes_1.DocumentSymbolProviderRegistry.has(buffer) || !resources_1.isEqual(buffer.uri, this._uri)) {\n            return;\n        }\n        var source = new cancellation_1.CancellationTokenSource();\n        var versionIdThen = buffer.getVersionId();\n        var timeout = new async_1.TimeoutTimer();\n        this._outlineDisposables.push({\n            dispose: function () {\n                source.cancel();\n                source.dispose();\n                timeout.dispose();\n            }\n        });\n        outlineModel_1.OutlineModel.create(buffer, source.token).then(function (model) {\n            if (outlineModel_1.TreeElement.empty(model)) {\n                // empty -> no outline elements\n                _this._updateOutlineElements([]);\n            }\n            else {\n                // copy the model\n                model = model.adopt();\n                _this._updateOutlineElements(_this._getOutlineElements(model, editor.getPosition()));\n                _this._outlineDisposables.push(editor.onDidChangeCursorPosition(function (_) {\n                    timeout.cancelAndSet(function () {\n                        if (!buffer.isDisposed() && versionIdThen === buffer.getVersionId() && editor.getModel()) {\n                            _this._updateOutlineElements(_this._getOutlineElements(model, editor.getPosition()));\n                        }\n                    }, 150);\n                }));\n            }\n        }).catch(function (err) {\n            _this._updateOutlineElements([]);\n            errors_1.onUnexpectedError(err);\n        });\n    };\n    EditorBreadcrumbsModel.prototype._getOutlineElements = function (model, position) {\n        if (!model || !position) {\n            return [];\n        }\n        var item = model.getItemEnclosingPosition(position);\n        if (!item) {\n            return [model];\n        }\n        var chain = [];\n        while (item) {\n            chain.push(item);\n            var parent = item.parent;\n            if (parent instanceof outlineModel_1.OutlineModel) {\n                break;\n            }\n            if (parent instanceof outlineModel_1.OutlineGroup && parent.parent && collections_1.size(parent.parent.children) === 1) {\n                break;\n            }\n            item = parent;\n        }\n        return chain.reverse();\n    };\n    EditorBreadcrumbsModel.prototype._updateOutlineElements = function (elements) {\n        if (!arrays_1.equals(elements, this._outlineElements, EditorBreadcrumbsModel._outlineElementEquals)) {\n            this._outlineElements = elements;\n            this._onDidUpdate.fire(this);\n        }\n    };\n    EditorBreadcrumbsModel._outlineElementEquals = function (a, b) {\n        if (a === b) {\n            return true;\n        }\n        else if (!a || !b) {\n            return false;\n        }\n        else {\n            return a.id === b.id;\n        }\n    };\n    EditorBreadcrumbsModel = tslib_1.__decorate([\n        tslib_1.__param(2, workspace_1.IWorkspaceContextService),\n        tslib_1.__param(3, configuration_1.IConfigurationService)\n    ], EditorBreadcrumbsModel);\n    return EditorBreadcrumbsModel;\n}());\nexports.EditorBreadcrumbsModel = EditorBreadcrumbsModel;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/breadcrumbsModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from 'vs/base/common/arrays';\nimport { TimeoutTimer } from 'vs/base/common/async';\nimport { CancellationTokenSource } from 'vs/base/common/cancellation';\nimport { size } from 'vs/base/common/collections';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { dispose, IDisposable } from 'vs/base/common/lifecycle';\nimport { isEqual, dirname } from 'vs/base/common/resources';\nimport { URI } from 'vs/base/common/uri';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IPosition } from 'vs/editor/common/core/position';\nimport { DocumentSymbolProviderRegistry } from 'vs/editor/common/modes';\nimport { OutlineElement, OutlineGroup, OutlineModel, TreeElement } from 'vs/editor/contrib/documentSymbols/outlineModel';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from 'vs/platform/workspace/common/workspace';\nimport { Schemas } from 'vs/base/common/network';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { BreadcrumbsConfig } from 'vs/workbench/browser/parts/editor/breadcrumbs';\nimport { FileKind } from 'vs/platform/files/common/files';\nimport { withNullAsUndefined } from 'vs/base/common/types';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\nexport type BreadcrumbElement = FileElement | OutlineModel | OutlineGroup | OutlineElement;\n\ntype FileInfo = { path: FileElement[], folder?: IWorkspaceFolder };\n\nexport class EditorBreadcrumbsModel {\n\n\tprivate readonly _disposables: IDisposable[] = [];\n\tprivate readonly _fileInfo: FileInfo;\n\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate _outlineElements: Array<OutlineModel | OutlineGroup | OutlineElement> = [];\n\tprivate _outlineDisposables: IDisposable[] = [];\n\n\tprivate _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\tprivate readonly _uri: URI,\n\t\tprivate readonly _editor: ICodeEditor | undefined,\n\t\t@IWorkspaceContextService workspaceService: IWorkspaceContextService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t) {\n\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.push(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.push(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\n\t\tthis._fileInfo = EditorBreadcrumbsModel._initFilePathInfo(this._uri, workspaceService);\n\t\tthis._bindToEditor();\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tdispose(this._disposables);\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<BreadcrumbElement> {\n\t\tlet result: BreadcrumbElement[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\t// symbol path elements\n\t\tif (this._cfgSymbolPath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._outlineElements);\n\t\t} else if (this._cfgSymbolPath.getValue() === 'last' && this._outlineElements.length > 0) {\n\t\t\tresult = result.concat(this._outlineElements.slice(-1));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate static _initFilePathInfo(uri: URI, workspaceService: IWorkspaceContextService): FileInfo {\n\n\t\tif (uri.scheme === Schemas.untitled) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tlet info: FileInfo = {\n\t\t\tfolder: withNullAsUndefined(workspaceService.getWorkspaceFolder(uri)),\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tlet prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _bindToEditor(): void {\n\t\tif (!this._editor) {\n\t\t\treturn;\n\t\t}\n\t\t// update as model changes\n\t\tthis._disposables.push(DocumentSymbolProviderRegistry.onDidChange(_ => this._updateOutline()));\n\t\tthis._disposables.push(this._editor.onDidChangeModel(_ => this._updateOutline()));\n\t\tthis._disposables.push(this._editor.onDidChangeModelLanguage(_ => this._updateOutline()));\n\t\tthis._disposables.push(Event.debounce(this._editor.onDidChangeModelContent, _ => _, 350)(_ => this._updateOutline(true)));\n\t\tthis._updateOutline();\n\n\t\t// stop when editor dies\n\t\tthis._disposables.push(this._editor.onDidDispose(() => this._outlineDisposables = dispose(this._outlineDisposables)));\n\t}\n\n\tprivate _updateOutline(didChangeContent?: boolean): void {\n\n\t\tthis._outlineDisposables = dispose(this._outlineDisposables);\n\t\tif (!didChangeContent) {\n\t\t\tthis._updateOutlineElements([]);\n\t\t}\n\n\t\tconst editor = this._editor!;\n\n\t\tconst buffer = editor.getModel();\n\t\tif (!buffer || !DocumentSymbolProviderRegistry.has(buffer) || !isEqual(buffer.uri, this._uri)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst source = new CancellationTokenSource();\n\t\tconst versionIdThen = buffer.getVersionId();\n\t\tconst timeout = new TimeoutTimer();\n\n\t\tthis._outlineDisposables.push({\n\t\t\tdispose: () => {\n\t\t\t\tsource.cancel();\n\t\t\t\tsource.dispose();\n\t\t\t\ttimeout.dispose();\n\t\t\t}\n\t\t});\n\n\t\tOutlineModel.create(buffer, source.token).then(model => {\n\t\t\tif (TreeElement.empty(model)) {\n\t\t\t\t// empty -> no outline elements\n\t\t\t\tthis._updateOutlineElements([]);\n\n\t\t\t} else {\n\t\t\t\t// copy the model\n\t\t\t\tmodel = model.adopt();\n\n\t\t\t\tthis._updateOutlineElements(this._getOutlineElements(model, editor.getPosition()));\n\t\t\t\tthis._outlineDisposables.push(editor.onDidChangeCursorPosition(_ => {\n\t\t\t\t\ttimeout.cancelAndSet(() => {\n\t\t\t\t\t\tif (!buffer.isDisposed() && versionIdThen === buffer.getVersionId() && editor.getModel()) {\n\t\t\t\t\t\t\tthis._updateOutlineElements(this._getOutlineElements(model, editor.getPosition()));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 150);\n\t\t\t\t}));\n\t\t\t}\n\t\t}).catch(err => {\n\t\t\tthis._updateOutlineElements([]);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n\n\tprivate _getOutlineElements(model: OutlineModel, position: IPosition | null): Array<OutlineModel | OutlineGroup | OutlineElement> {\n\t\tif (!model || !position) {\n\t\t\treturn [];\n\t\t}\n\t\tlet item: OutlineGroup | OutlineElement | undefined = model.getItemEnclosingPosition(position);\n\t\tif (!item) {\n\t\t\treturn [model];\n\t\t}\n\t\tlet chain: Array<OutlineGroup | OutlineElement> = [];\n\t\twhile (item) {\n\t\t\tchain.push(item);\n\t\t\tlet parent: any = item.parent;\n\t\t\tif (parent instanceof OutlineModel) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (parent instanceof OutlineGroup && parent.parent && size(parent.parent.children) === 1) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\titem = parent;\n\t\t}\n\t\treturn chain.reverse();\n\t}\n\n\tprivate _updateOutlineElements(elements: Array<OutlineModel | OutlineGroup | OutlineElement>): void {\n\t\tif (!equals(elements, this._outlineElements, EditorBreadcrumbsModel._outlineElementEquals)) {\n\t\t\tthis._outlineElements = elements;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t}\n\t}\n\n\tprivate static _outlineElementEquals(a: OutlineModel | OutlineGroup | OutlineElement, b: OutlineModel | OutlineGroup | OutlineElement): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t} else if (!a || !b) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn a.id === b.id;\n\t\t}\n\t}\n}\n"]}]}