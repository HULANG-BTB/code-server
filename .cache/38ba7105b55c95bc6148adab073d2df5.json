{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/list/listView.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/list/listView.ts","mtime":1555102316000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar objects_1 = require(\"vs/base/common/objects\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar touch_1 = require(\"vs/base/browser/touch\");\nvar DOM = require(\"vs/base/browser/dom\");\nvar event_1 = require(\"vs/base/common/event\");\nvar event_2 = require(\"vs/base/browser/event\");\nvar scrollableElement_1 = require(\"vs/base/browser/ui/scrollbar/scrollableElement\");\nvar scrollable_1 = require(\"vs/base/common/scrollable\");\nvar rangeMap_1 = require(\"./rangeMap\");\nvar list_1 = require(\"./list\");\nvar rowCache_1 = require(\"./rowCache\");\nvar platform_1 = require(\"vs/base/common/platform\");\nvar browser = require(\"vs/base/browser/browser\");\nvar decorators_1 = require(\"vs/base/common/decorators\");\nvar range_1 = require(\"vs/base/common/range\");\nvar arrays_1 = require(\"vs/base/common/arrays\");\nvar dnd_1 = require(\"vs/base/browser/dnd\");\nvar async_1 = require(\"vs/base/common/async\");\nvar DefaultOptions = {\n    useShadows: true,\n    verticalScrollMode: scrollable_1.ScrollbarVisibility.Auto,\n    setRowLineHeight: true,\n    supportDynamicHeights: false,\n    dnd: {\n        getDragElements: function (e) { return [e]; },\n        getDragURI: function () { return null; },\n        onDragStart: function () { },\n        onDragOver: function () { return false; },\n        drop: function () { }\n    },\n    horizontalScrolling: false\n};\nvar ElementsDragAndDropData = /** @class */ (function () {\n    function ElementsDragAndDropData(elements) {\n        this.elements = elements;\n    }\n    ElementsDragAndDropData.prototype.update = function () { };\n    ElementsDragAndDropData.prototype.getData = function () {\n        return this.elements;\n    };\n    return ElementsDragAndDropData;\n}());\nexports.ElementsDragAndDropData = ElementsDragAndDropData;\nvar ExternalElementsDragAndDropData = /** @class */ (function () {\n    function ExternalElementsDragAndDropData(elements) {\n        this.elements = elements;\n    }\n    ExternalElementsDragAndDropData.prototype.update = function () { };\n    ExternalElementsDragAndDropData.prototype.getData = function () {\n        return this.elements;\n    };\n    return ExternalElementsDragAndDropData;\n}());\nexports.ExternalElementsDragAndDropData = ExternalElementsDragAndDropData;\nvar DesktopDragAndDropData = /** @class */ (function () {\n    function DesktopDragAndDropData() {\n        this.types = [];\n        this.files = [];\n    }\n    DesktopDragAndDropData.prototype.update = function (dataTransfer) {\n        var _a;\n        if (dataTransfer.types) {\n            (_a = this.types).splice.apply(_a, [0, this.types.length].concat(dataTransfer.types));\n        }\n        if (dataTransfer.files) {\n            this.files.splice(0, this.files.length);\n            for (var i = 0; i < dataTransfer.files.length; i++) {\n                var file = dataTransfer.files.item(i);\n                if (file && (file.size || file.type)) {\n                    this.files.push(file);\n                }\n            }\n        }\n    };\n    DesktopDragAndDropData.prototype.getData = function () {\n        return {\n            types: this.types,\n            files: this.files\n        };\n    };\n    return DesktopDragAndDropData;\n}());\nexports.DesktopDragAndDropData = DesktopDragAndDropData;\nfunction equalsDragFeedback(f1, f2) {\n    if (Array.isArray(f1) && Array.isArray(f2)) {\n        return arrays_1.equals(f1, f2);\n    }\n    return f1 === f2;\n}\nvar ListView = /** @class */ (function () {\n    function ListView(container, virtualDelegate, renderers, options) {\n        if (options === void 0) { options = DefaultOptions; }\n        var _this = this;\n        this.virtualDelegate = virtualDelegate;\n        this.domId = \"list_id_\" + ++ListView.InstanceCount;\n        this.renderers = new Map();\n        this.renderWidth = 0;\n        this.scrollableElementUpdateDisposable = null;\n        this.scrollableElementWidthDelayer = new async_1.Delayer(50);\n        this.splicing = false;\n        this.dragOverAnimationStopDisposable = lifecycle_1.Disposable.None;\n        this.canUseTranslate3d = undefined;\n        this.canDrop = false;\n        this.currentDragFeedbackDisposable = lifecycle_1.Disposable.None;\n        this.onDragLeaveTimeout = lifecycle_1.Disposable.None;\n        this._onDidChangeContentHeight = new event_1.Emitter();\n        this.onDidChangeContentHeight = event_1.Event.latch(this._onDidChangeContentHeight.event);\n        if (options.horizontalScrolling && options.supportDynamicHeights) {\n            throw new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\n        }\n        this.items = [];\n        this.itemId = 0;\n        this.rangeMap = new rangeMap_1.RangeMap();\n        for (var _i = 0, renderers_1 = renderers; _i < renderers_1.length; _i++) {\n            var renderer = renderers_1[_i];\n            this.renderers.set(renderer.templateId, renderer);\n        }\n        this.cache = new rowCache_1.RowCache(this.renderers);\n        this.lastRenderTop = 0;\n        this.lastRenderHeight = 0;\n        this.domNode = document.createElement('div');\n        this.domNode.className = 'monaco-list';\n        DOM.addClass(this.domNode, this.domId);\n        this.domNode.tabIndex = 0;\n        DOM.toggleClass(this.domNode, 'mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\n        this.horizontalScrolling = objects_1.getOrDefault(options, function (o) { return o.horizontalScrolling; }, DefaultOptions.horizontalScrolling);\n        DOM.toggleClass(this.domNode, 'horizontal-scrolling', this.horizontalScrolling);\n        this.ariaSetProvider = options.ariaSetProvider || { getSetSize: function (e, i, length) { return length; }, getPosInSet: function (_, index) { return index + 1; } };\n        this.rowsContainer = document.createElement('div');\n        this.rowsContainer.className = 'monaco-list-rows';\n        touch_1.Gesture.addTarget(this.rowsContainer);\n        this.scrollableElement = new scrollableElement_1.ScrollableElement(this.rowsContainer, {\n            alwaysConsumeMouseWheel: true,\n            horizontal: this.horizontalScrolling ? scrollable_1.ScrollbarVisibility.Auto : scrollable_1.ScrollbarVisibility.Hidden,\n            vertical: objects_1.getOrDefault(options, function (o) { return o.verticalScrollMode; }, DefaultOptions.verticalScrollMode),\n            useShadows: objects_1.getOrDefault(options, function (o) { return o.useShadows; }, DefaultOptions.useShadows)\n        });\n        this.domNode.appendChild(this.scrollableElement.getDomNode());\n        container.appendChild(this.domNode);\n        this.disposables = [this.rangeMap, this.gesture, this.scrollableElement, this.cache];\n        this.scrollableElement.onScroll(this.onScroll, this, this.disposables);\n        event_2.domEvent(this.rowsContainer, touch_1.EventType.Change)(this.onTouchChange, this, this.disposables);\n        // Prevent the monaco-scrollable-element from scrolling\n        // https://github.com/Microsoft/vscode/issues/44181\n        event_2.domEvent(this.scrollableElement.getDomNode(), 'scroll')(function (e) { return e.target.scrollTop = 0; }, null, this.disposables);\n        event_1.Event.map(event_2.domEvent(this.domNode, 'dragover'), function (e) { return _this.toDragEvent(e); })(this.onDragOver, this, this.disposables);\n        event_1.Event.map(event_2.domEvent(this.domNode, 'drop'), function (e) { return _this.toDragEvent(e); })(this.onDrop, this, this.disposables);\n        event_2.domEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\n        event_2.domEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\n        this.setRowLineHeight = objects_1.getOrDefault(options, function (o) { return o.setRowLineHeight; }, DefaultOptions.setRowLineHeight);\n        this.supportDynamicHeights = objects_1.getOrDefault(options, function (o) { return o.supportDynamicHeights; }, DefaultOptions.supportDynamicHeights);\n        this.dnd = objects_1.getOrDefault(options, function (o) { return o.dnd; }, DefaultOptions.dnd);\n        this.layout();\n    }\n    Object.defineProperty(ListView.prototype, \"contentHeight\", {\n        get: function () { return this.rangeMap.size; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onDidScroll\", {\n        get: function () { return this.scrollableElement.onScroll; },\n        enumerable: true,\n        configurable: true\n    });\n    ListView.prototype.splice = function (start, deleteCount, elements) {\n        if (elements === void 0) { elements = []; }\n        if (this.splicing) {\n            throw new Error('Can\\'t run recursive splices.');\n        }\n        this.splicing = true;\n        try {\n            return this._splice(start, deleteCount, elements);\n        }\n        finally {\n            this.splicing = false;\n            this._onDidChangeContentHeight.fire(this.contentHeight);\n        }\n    };\n    ListView.prototype._splice = function (start, deleteCount, elements) {\n        var _this = this;\n        if (elements === void 0) { elements = []; }\n        var _a;\n        var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n        var deleteRange = { start: start, end: start + deleteCount };\n        var removeRange = range_1.Range.intersect(previousRenderRange, deleteRange);\n        for (var i = removeRange.start; i < removeRange.end; i++) {\n            this.removeItemFromDOM(i);\n        }\n        var previousRestRange = { start: start + deleteCount, end: this.items.length };\n        var previousRenderedRestRange = range_1.Range.intersect(previousRestRange, previousRenderRange);\n        var previousUnrenderedRestRanges = range_1.Range.relativeComplement(previousRestRange, previousRenderRange);\n        var inserted = elements.map(function (element) { return ({\n            id: String(_this.itemId++),\n            element: element,\n            templateId: _this.virtualDelegate.getTemplateId(element),\n            size: _this.virtualDelegate.getHeight(element),\n            width: undefined,\n            hasDynamicHeight: !!_this.virtualDelegate.hasDynamicHeight && _this.virtualDelegate.hasDynamicHeight(element),\n            lastDynamicHeightWidth: undefined,\n            row: null,\n            uri: undefined,\n            dropTarget: false,\n            dragStartDisposable: lifecycle_1.Disposable.None\n        }); });\n        var deleted;\n        // TODO@joao: improve this optimization to catch even more cases\n        if (start === 0 && deleteCount >= this.items.length) {\n            this.rangeMap = new rangeMap_1.RangeMap();\n            this.rangeMap.splice(0, 0, inserted);\n            this.items = inserted;\n            deleted = [];\n        }\n        else {\n            this.rangeMap.splice(start, deleteCount, inserted);\n            deleted = (_a = this.items).splice.apply(_a, [start, deleteCount].concat(inserted));\n        }\n        var delta = elements.length - deleteCount;\n        var renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n        var renderedRestRange = rangeMap_1.shift(previousRenderedRestRange, delta);\n        var updateRange = range_1.Range.intersect(renderRange, renderedRestRange);\n        for (var i = updateRange.start; i < updateRange.end; i++) {\n            this.updateItemInDOM(this.items[i], i);\n        }\n        var removeRanges = range_1.Range.relativeComplement(renderedRestRange, renderRange);\n        for (var _i = 0, removeRanges_1 = removeRanges; _i < removeRanges_1.length; _i++) {\n            var range = removeRanges_1[_i];\n            for (var i = range.start; i < range.end; i++) {\n                this.removeItemFromDOM(i);\n            }\n        }\n        var unrenderedRestRanges = previousUnrenderedRestRanges.map(function (r) { return rangeMap_1.shift(r, delta); });\n        var elementsRange = { start: start, end: start + elements.length };\n        var insertRanges = [elementsRange].concat(unrenderedRestRanges).map(function (r) { return range_1.Range.intersect(renderRange, r); });\n        var beforeElement = this.getNextToLastElement(insertRanges);\n        for (var _b = 0, insertRanges_1 = insertRanges; _b < insertRanges_1.length; _b++) {\n            var range = insertRanges_1[_b];\n            for (var i = range.start; i < range.end; i++) {\n                this.insertItemInDOM(i, beforeElement);\n            }\n        }\n        this.eventuallyUpdateScrollDimensions();\n        if (this.supportDynamicHeights) {\n            this._rerender(this.scrollTop, this.renderHeight);\n        }\n        return deleted.map(function (i) { return i.element; });\n    };\n    ListView.prototype.eventuallyUpdateScrollDimensions = function () {\n        var _this = this;\n        this._scrollHeight = this.contentHeight;\n        this.rowsContainer.style.height = this._scrollHeight + \"px\";\n        if (!this.scrollableElementUpdateDisposable) {\n            this.scrollableElementUpdateDisposable = DOM.scheduleAtNextAnimationFrame(function () {\n                _this.scrollableElement.setScrollDimensions({ scrollHeight: _this.scrollHeight });\n                _this.updateScrollWidth();\n                _this.scrollableElementUpdateDisposable = null;\n            });\n        }\n    };\n    ListView.prototype.eventuallyUpdateScrollWidth = function () {\n        var _this = this;\n        if (!this.horizontalScrolling) {\n            return;\n        }\n        this.scrollableElementWidthDelayer.trigger(function () { return _this.updateScrollWidth(); });\n    };\n    ListView.prototype.updateScrollWidth = function () {\n        if (!this.horizontalScrolling) {\n            return;\n        }\n        if (this.items.length === 0) {\n            this.scrollableElement.setScrollDimensions({ scrollWidth: 0 });\n        }\n        var scrollWidth = 0;\n        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n            var item = _a[_i];\n            if (typeof item.width !== 'undefined') {\n                scrollWidth = Math.max(scrollWidth, item.width);\n            }\n        }\n        this.scrollWidth = scrollWidth;\n        this.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth + 10 });\n    };\n    ListView.prototype.updateWidth = function (index) {\n        if (!this.horizontalScrolling || typeof this.scrollWidth === 'undefined') {\n            return;\n        }\n        var item = this.items[index];\n        this.measureItemWidth(item);\n        if (typeof item.width !== 'undefined' && item.width > this.scrollWidth) {\n            this.scrollWidth = item.width;\n            this.scrollableElement.setScrollDimensions({ scrollWidth: this.scrollWidth + 10 });\n        }\n    };\n    ListView.prototype.rerender = function () {\n        if (!this.supportDynamicHeights) {\n            return;\n        }\n        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n            var item = _a[_i];\n            item.lastDynamicHeightWidth = undefined;\n        }\n        this._rerender(this.lastRenderTop, this.lastRenderHeight);\n    };\n    Object.defineProperty(ListView.prototype, \"length\", {\n        get: function () {\n            return this.items.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"renderHeight\", {\n        get: function () {\n            var scrollDimensions = this.scrollableElement.getScrollDimensions();\n            return scrollDimensions.height;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"firstVisibleIndex\", {\n        get: function () {\n            var range = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n            var firstElTop = this.rangeMap.positionAt(range.start);\n            var nextElTop = this.rangeMap.positionAt(range.start + 1);\n            if (nextElTop !== -1) {\n                var firstElMidpoint = (nextElTop - firstElTop) / 2 + firstElTop;\n                if (firstElMidpoint < this.scrollTop) {\n                    return range.start + 1;\n                }\n            }\n            return range.start;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"lastVisibleIndex\", {\n        get: function () {\n            var range = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n            return range.end - 1;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ListView.prototype.element = function (index) {\n        return this.items[index].element;\n    };\n    ListView.prototype.domElement = function (index) {\n        var row = this.items[index].row;\n        return row && row.domNode;\n    };\n    ListView.prototype.elementHeight = function (index) {\n        return this.items[index].size;\n    };\n    ListView.prototype.elementTop = function (index) {\n        return this.rangeMap.positionAt(index);\n    };\n    ListView.prototype.indexAt = function (position) {\n        return this.rangeMap.indexAt(position);\n    };\n    ListView.prototype.indexAfter = function (position) {\n        return this.rangeMap.indexAfter(position);\n    };\n    ListView.prototype.layout = function (height, width) {\n        var scrollDimensions = {\n            height: typeof height === 'number' ? height : DOM.getContentHeight(this.domNode)\n        };\n        if (this.scrollableElementUpdateDisposable) {\n            this.scrollableElementUpdateDisposable.dispose();\n            this.scrollableElementUpdateDisposable = null;\n            scrollDimensions.scrollHeight = this.scrollHeight;\n        }\n        this.scrollableElement.setScrollDimensions(scrollDimensions);\n        if (typeof width !== 'undefined') {\n            this.renderWidth = width;\n            if (this.supportDynamicHeights) {\n                this._rerender(this.scrollTop, this.renderHeight);\n            }\n            if (this.horizontalScrolling) {\n                this.scrollableElement.setScrollDimensions({\n                    width: typeof width === 'number' ? width : DOM.getContentWidth(this.domNode)\n                });\n            }\n        }\n    };\n    // Render\n    ListView.prototype.render = function (renderTop, renderHeight, renderLeft, scrollWidth) {\n        var previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n        var renderRange = this.getRenderRange(renderTop, renderHeight);\n        var rangesToInsert = range_1.Range.relativeComplement(renderRange, previousRenderRange);\n        var rangesToRemove = range_1.Range.relativeComplement(previousRenderRange, renderRange);\n        var beforeElement = this.getNextToLastElement(rangesToInsert);\n        for (var _i = 0, rangesToInsert_1 = rangesToInsert; _i < rangesToInsert_1.length; _i++) {\n            var range = rangesToInsert_1[_i];\n            for (var i = range.start; i < range.end; i++) {\n                this.insertItemInDOM(i, beforeElement);\n            }\n        }\n        for (var _a = 0, rangesToRemove_1 = rangesToRemove; _a < rangesToRemove_1.length; _a++) {\n            var range = rangesToRemove_1[_a];\n            for (var i = range.start; i < range.end; i++) {\n                this.removeItemFromDOM(i);\n            }\n        }\n        var canUseTranslate3d = !platform_1.isWindows && !browser.isFirefox && browser.getZoomLevel() === 0;\n        if (canUseTranslate3d) {\n            var transform = \"translate3d(-\" + renderLeft + \"px, -\" + renderTop + \"px, 0px)\";\n            this.rowsContainer.style.transform = transform;\n            this.rowsContainer.style.webkitTransform = transform;\n            if (canUseTranslate3d !== this.canUseTranslate3d) {\n                this.rowsContainer.style.left = '0';\n                this.rowsContainer.style.top = '0';\n            }\n        }\n        else {\n            this.rowsContainer.style.left = \"-\" + renderLeft + \"px\";\n            this.rowsContainer.style.top = \"-\" + renderTop + \"px\";\n            if (canUseTranslate3d !== this.canUseTranslate3d) {\n                this.rowsContainer.style.transform = '';\n                this.rowsContainer.style.webkitTransform = '';\n            }\n        }\n        if (this.horizontalScrolling) {\n            this.rowsContainer.style.width = Math.max(scrollWidth, this.renderWidth) + \"px\";\n        }\n        this.canUseTranslate3d = canUseTranslate3d;\n        this.lastRenderTop = renderTop;\n        this.lastRenderHeight = renderHeight;\n    };\n    // DOM operations\n    ListView.prototype.insertItemInDOM = function (index, beforeElement) {\n        var _this = this;\n        var item = this.items[index];\n        if (!item.row) {\n            item.row = this.cache.alloc(item.templateId);\n            item.row.domNode.setAttribute('role', 'treeitem');\n        }\n        if (!item.row.domNode.parentElement) {\n            if (beforeElement) {\n                this.rowsContainer.insertBefore(item.row.domNode, beforeElement);\n            }\n            else {\n                this.rowsContainer.appendChild(item.row.domNode);\n            }\n        }\n        this.updateItemInDOM(item, index);\n        var renderer = this.renderers.get(item.templateId);\n        if (!renderer) {\n            throw new Error(\"No renderer found for template id \" + item.templateId);\n        }\n        if (renderer) {\n            renderer.renderElement(item.element, index, item.row.templateData);\n        }\n        var uri = this.dnd.getDragURI(item.element);\n        item.dragStartDisposable.dispose();\n        item.row.domNode.draggable = !!uri;\n        if (uri) {\n            var onDragStart = event_2.domEvent(item.row.domNode, 'dragstart');\n            item.dragStartDisposable = onDragStart(function (event) { return _this.onDragStart(item.element, uri, event); });\n        }\n        if (this.horizontalScrolling) {\n            this.measureItemWidth(item);\n            this.eventuallyUpdateScrollWidth();\n        }\n    };\n    ListView.prototype.measureItemWidth = function (item) {\n        if (!item.row || !item.row.domNode) {\n            return;\n        }\n        item.row.domNode.style.width = 'fit-content';\n        item.width = DOM.getContentWidth(item.row.domNode);\n        var style = window.getComputedStyle(item.row.domNode);\n        if (style.paddingLeft) {\n            item.width += parseFloat(style.paddingLeft);\n        }\n        if (style.paddingRight) {\n            item.width += parseFloat(style.paddingRight);\n        }\n        item.row.domNode.style.width = '';\n    };\n    ListView.prototype.updateItemInDOM = function (item, index) {\n        item.row.domNode.style.top = this.elementTop(index) + \"px\";\n        item.row.domNode.style.height = item.size + \"px\";\n        if (this.setRowLineHeight) {\n            item.row.domNode.style.lineHeight = item.size + \"px\";\n        }\n        item.row.domNode.setAttribute('data-index', \"\" + index);\n        item.row.domNode.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\n        item.row.domNode.setAttribute('aria-setsize', String(this.ariaSetProvider.getSetSize(item.element, index, this.length)));\n        item.row.domNode.setAttribute('aria-posinset', String(this.ariaSetProvider.getPosInSet(item.element, index)));\n        item.row.domNode.setAttribute('id', this.getElementDomId(index));\n        DOM.toggleClass(item.row.domNode, 'drop-target', item.dropTarget);\n    };\n    ListView.prototype.removeItemFromDOM = function (index) {\n        var item = this.items[index];\n        item.dragStartDisposable.dispose();\n        var renderer = this.renderers.get(item.templateId);\n        if (renderer && renderer.disposeElement) {\n            renderer.disposeElement(item.element, index, item.row.templateData);\n        }\n        this.cache.release(item.row);\n        item.row = null;\n        if (this.horizontalScrolling) {\n            this.eventuallyUpdateScrollWidth();\n        }\n    };\n    ListView.prototype.getScrollTop = function () {\n        var scrollPosition = this.scrollableElement.getScrollPosition();\n        return scrollPosition.scrollTop;\n    };\n    ListView.prototype.setScrollTop = function (scrollTop) {\n        if (this.scrollableElementUpdateDisposable) {\n            this.scrollableElementUpdateDisposable.dispose();\n            this.scrollableElementUpdateDisposable = null;\n            this.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\n        }\n        this.scrollableElement.setScrollPosition({ scrollTop: scrollTop });\n    };\n    Object.defineProperty(ListView.prototype, \"scrollTop\", {\n        get: function () {\n            return this.getScrollTop();\n        },\n        set: function (scrollTop) {\n            this.setScrollTop(scrollTop);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"scrollHeight\", {\n        get: function () {\n            return this._scrollHeight + (this.horizontalScrolling ? 10 : 0);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseClick\", {\n        // Events\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'click'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseDblClick\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'dblclick'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseMiddleClick\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.filter(event_1.Event.map(event_2.domEvent(this.domNode, 'auxclick'), function (e) { return _this.toMouseEvent(e); }), function (e) { return e.browserEvent.button === 1; });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseUp\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'mouseup'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseDown\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'mousedown'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseOver\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'mouseover'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseMove\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'mousemove'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onMouseOut\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'mouseout'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onContextMenu\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'contextmenu'), function (e) { return _this.toMouseEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onTouchStart\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.domNode, 'touchstart'), function (e) { return _this.toTouchEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ListView.prototype, \"onTap\", {\n        get: function () {\n            var _this = this;\n            return event_1.Event.map(event_2.domEvent(this.rowsContainer, touch_1.EventType.Tap), function (e) { return _this.toGestureEvent(e); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ListView.prototype.toMouseEvent = function (browserEvent) {\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\n        var element = item && item.element;\n        return { browserEvent: browserEvent, index: index, element: element };\n    };\n    ListView.prototype.toTouchEvent = function (browserEvent) {\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\n        var element = item && item.element;\n        return { browserEvent: browserEvent, index: index, element: element };\n    };\n    ListView.prototype.toGestureEvent = function (browserEvent) {\n        var index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\n        var element = item && item.element;\n        return { browserEvent: browserEvent, index: index, element: element };\n    };\n    ListView.prototype.toDragEvent = function (browserEvent) {\n        var index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n        var item = typeof index === 'undefined' ? undefined : this.items[index];\n        var element = item && item.element;\n        return { browserEvent: browserEvent, index: index, element: element };\n    };\n    ListView.prototype.onScroll = function (e) {\n        try {\n            this.render(e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\n            if (this.supportDynamicHeights) {\n                this._rerender(e.scrollTop, e.height);\n            }\n        }\n        catch (err) {\n            console.error('Got bad scroll event:', e);\n            throw err;\n        }\n    };\n    ListView.prototype.onTouchChange = function (event) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.scrollTop -= event.translationY;\n    };\n    // DND\n    ListView.prototype.onDragStart = function (element, uri, event) {\n        if (!event.dataTransfer) {\n            return;\n        }\n        var elements = this.dnd.getDragElements(element);\n        event.dataTransfer.effectAllowed = 'copyMove';\n        event.dataTransfer.setData(dnd_1.DataTransfers.RESOURCES, JSON.stringify([uri]));\n        if (event.dataTransfer.setDragImage) {\n            var label = void 0;\n            if (this.dnd.getDragLabel) {\n                label = this.dnd.getDragLabel(elements);\n            }\n            if (typeof label === 'undefined') {\n                label = String(elements.length);\n            }\n            var dragImage_1 = DOM.$('.monaco-drag-image');\n            dragImage_1.textContent = label;\n            document.body.appendChild(dragImage_1);\n            event.dataTransfer.setDragImage(dragImage_1, -10, -10);\n            setTimeout(function () { return document.body.removeChild(dragImage_1); }, 0);\n        }\n        this.currentDragData = new ElementsDragAndDropData(elements);\n        dnd_1.StaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\n        if (this.dnd.onDragStart) {\n            this.dnd.onDragStart(this.currentDragData, event);\n        }\n    };\n    ListView.prototype.onDragOver = function (event) {\n        var _this = this;\n        event.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n        this.onDragLeaveTimeout.dispose();\n        if (dnd_1.StaticDND.CurrentDragAndDropData && dnd_1.StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\n            return false;\n        }\n        this.setupDragAndDropScrollTopAnimation(event.browserEvent);\n        if (!event.browserEvent.dataTransfer) {\n            return false;\n        }\n        // Drag over from outside\n        if (!this.currentDragData) {\n            if (dnd_1.StaticDND.CurrentDragAndDropData) {\n                // Drag over from another list\n                this.currentDragData = dnd_1.StaticDND.CurrentDragAndDropData;\n            }\n            else {\n                // Drag over from the desktop\n                if (!event.browserEvent.dataTransfer.types) {\n                    return false;\n                }\n                this.currentDragData = new DesktopDragAndDropData();\n            }\n        }\n        var result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\n        this.canDrop = typeof result === 'boolean' ? result : result.accept;\n        if (!this.canDrop) {\n            this.currentDragFeedback = undefined;\n            this.currentDragFeedbackDisposable.dispose();\n            return false;\n        }\n        event.browserEvent.dataTransfer.dropEffect = (typeof result !== 'boolean' && result.effect === list_1.ListDragOverEffect.Copy) ? 'copy' : 'move';\n        var feedback;\n        if (typeof result !== 'boolean' && result.feedback) {\n            feedback = result.feedback;\n        }\n        else {\n            if (typeof event.index === 'undefined') {\n                feedback = [-1];\n            }\n            else {\n                feedback = [event.index];\n            }\n        }\n        // sanitize feedback list\n        feedback = arrays_1.distinct(feedback).filter(function (i) { return i >= -1 && i < _this.length; }).sort();\n        feedback = feedback[0] === -1 ? [-1] : feedback;\n        if (feedback.length === 0) {\n            throw new Error('Invalid empty feedback list');\n        }\n        if (equalsDragFeedback(this.currentDragFeedback, feedback)) {\n            return true;\n        }\n        this.currentDragFeedback = feedback;\n        this.currentDragFeedbackDisposable.dispose();\n        if (feedback[0] === -1) { // entire list feedback\n            DOM.addClass(this.domNode, 'drop-target');\n            this.currentDragFeedbackDisposable = lifecycle_1.toDisposable(function () { return DOM.removeClass(_this.domNode, 'drop-target'); });\n        }\n        else {\n            for (var _i = 0, feedback_1 = feedback; _i < feedback_1.length; _i++) {\n                var index = feedback_1[_i];\n                var item = this.items[index];\n                item.dropTarget = true;\n                if (item.row && item.row.domNode) {\n                    DOM.addClass(item.row.domNode, 'drop-target');\n                }\n            }\n            this.currentDragFeedbackDisposable = lifecycle_1.toDisposable(function () {\n                for (var _i = 0, feedback_2 = feedback; _i < feedback_2.length; _i++) {\n                    var index = feedback_2[_i];\n                    var item = _this.items[index];\n                    item.dropTarget = false;\n                    if (item.row && item.row.domNode) {\n                        DOM.removeClass(item.row.domNode, 'drop-target');\n                    }\n                }\n            });\n        }\n        return true;\n    };\n    ListView.prototype.onDragLeave = function () {\n        var _this = this;\n        this.onDragLeaveTimeout.dispose();\n        this.onDragLeaveTimeout = async_1.disposableTimeout(function () { return _this.clearDragOverFeedback(); }, 100);\n    };\n    ListView.prototype.onDrop = function (event) {\n        if (!this.canDrop) {\n            return;\n        }\n        var dragData = this.currentDragData;\n        this.teardownDragAndDropScrollTopAnimation();\n        this.clearDragOverFeedback();\n        this.currentDragData = undefined;\n        dnd_1.StaticDND.CurrentDragAndDropData = undefined;\n        if (!dragData || !event.browserEvent.dataTransfer) {\n            return;\n        }\n        event.browserEvent.preventDefault();\n        dragData.update(event.browserEvent.dataTransfer);\n        this.dnd.drop(dragData, event.element, event.index, event.browserEvent);\n    };\n    ListView.prototype.onDragEnd = function () {\n        this.canDrop = false;\n        this.teardownDragAndDropScrollTopAnimation();\n        this.clearDragOverFeedback();\n        this.currentDragData = undefined;\n        dnd_1.StaticDND.CurrentDragAndDropData = undefined;\n    };\n    ListView.prototype.clearDragOverFeedback = function () {\n        this.currentDragFeedback = undefined;\n        this.currentDragFeedbackDisposable.dispose();\n        this.currentDragFeedbackDisposable = lifecycle_1.Disposable.None;\n    };\n    // DND scroll top animation\n    ListView.prototype.setupDragAndDropScrollTopAnimation = function (event) {\n        var _this = this;\n        if (!this.dragOverAnimationDisposable) {\n            var viewTop = DOM.getTopLeftOffset(this.domNode).top;\n            this.dragOverAnimationDisposable = DOM.animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\n        }\n        this.dragOverAnimationStopDisposable.dispose();\n        this.dragOverAnimationStopDisposable = async_1.disposableTimeout(function () {\n            if (_this.dragOverAnimationDisposable) {\n                _this.dragOverAnimationDisposable.dispose();\n                _this.dragOverAnimationDisposable = undefined;\n            }\n        }, 1000);\n        this.dragOverMouseY = event.pageY;\n    };\n    ListView.prototype.animateDragAndDropScrollTop = function (viewTop) {\n        if (this.dragOverMouseY === undefined) {\n            return;\n        }\n        var diff = this.dragOverMouseY - viewTop;\n        var upperLimit = this.renderHeight - 35;\n        if (diff < 35) {\n            this.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\n        }\n        else if (diff > upperLimit) {\n            this.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\n        }\n    };\n    ListView.prototype.teardownDragAndDropScrollTopAnimation = function () {\n        this.dragOverAnimationStopDisposable.dispose();\n        if (this.dragOverAnimationDisposable) {\n            this.dragOverAnimationDisposable.dispose();\n            this.dragOverAnimationDisposable = undefined;\n        }\n    };\n    // Util\n    ListView.prototype.getItemIndexFromEventTarget = function (target) {\n        var element = target;\n        while (element instanceof HTMLElement && element !== this.rowsContainer) {\n            var rawIndex = element.getAttribute('data-index');\n            if (rawIndex) {\n                var index = Number(rawIndex);\n                if (!isNaN(index)) {\n                    return index;\n                }\n            }\n            element = element.parentElement;\n        }\n        return undefined;\n    };\n    ListView.prototype.getRenderRange = function (renderTop, renderHeight) {\n        return {\n            start: this.rangeMap.indexAt(renderTop),\n            end: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\n        };\n    };\n    /**\n     * Given a stable rendered state, checks every rendered element whether it needs\n     * to be probed for dynamic height. Adjusts scroll height and top if necessary.\n     */\n    ListView.prototype._rerender = function (renderTop, renderHeight) {\n        var previousRenderRange = this.getRenderRange(renderTop, renderHeight);\n        // Let's remember the second element's position, this helps in scrolling up\n        // and preserving a linear upwards scroll movement\n        var anchorElementIndex;\n        var anchorElementTopDelta;\n        if (renderTop === this.elementTop(previousRenderRange.start)) {\n            anchorElementIndex = previousRenderRange.start;\n            anchorElementTopDelta = 0;\n        }\n        else if (previousRenderRange.end - previousRenderRange.start > 1) {\n            anchorElementIndex = previousRenderRange.start + 1;\n            anchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\n        }\n        var heightDiff = 0;\n        while (true) {\n            var renderRange = this.getRenderRange(renderTop, renderHeight);\n            var didChange = false;\n            for (var i = renderRange.start; i < renderRange.end; i++) {\n                var diff = this.probeDynamicHeight(i);\n                if (diff !== 0) {\n                    this.rangeMap.splice(i, 1, [this.items[i]]);\n                }\n                heightDiff += diff;\n                didChange = didChange || diff !== 0;\n            }\n            if (!didChange) {\n                if (heightDiff !== 0) {\n                    this.eventuallyUpdateScrollDimensions();\n                }\n                var unrenderRanges = range_1.Range.relativeComplement(previousRenderRange, renderRange);\n                for (var _i = 0, unrenderRanges_1 = unrenderRanges; _i < unrenderRanges_1.length; _i++) {\n                    var range = unrenderRanges_1[_i];\n                    for (var i = range.start; i < range.end; i++) {\n                        if (this.items[i].row) {\n                            this.removeItemFromDOM(i);\n                        }\n                    }\n                }\n                var renderRanges = range_1.Range.relativeComplement(renderRange, previousRenderRange);\n                for (var _a = 0, renderRanges_1 = renderRanges; _a < renderRanges_1.length; _a++) {\n                    var range = renderRanges_1[_a];\n                    for (var i = range.start; i < range.end; i++) {\n                        var afterIndex = i + 1;\n                        var beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\n                        var beforeElement = beforeRow ? beforeRow.domNode : null;\n                        this.insertItemInDOM(i, beforeElement);\n                    }\n                }\n                for (var i = renderRange.start; i < renderRange.end; i++) {\n                    if (this.items[i].row) {\n                        this.updateItemInDOM(this.items[i], i);\n                    }\n                }\n                if (typeof anchorElementIndex === 'number') {\n                    this.scrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta;\n                }\n                this._onDidChangeContentHeight.fire(this.contentHeight);\n                return;\n            }\n        }\n    };\n    ListView.prototype.probeDynamicHeight = function (index) {\n        var item = this.items[index];\n        if (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\n            return 0;\n        }\n        var size = item.size;\n        var row = this.cache.alloc(item.templateId);\n        row.domNode.style.height = '';\n        this.rowsContainer.appendChild(row.domNode);\n        var renderer = this.renderers.get(item.templateId);\n        if (renderer) {\n            renderer.renderElement(item.element, index, row.templateData, true);\n            if (renderer.disposeElement) {\n                renderer.disposeElement(item.element, index, row.templateData, true);\n            }\n        }\n        item.size = row.domNode.offsetHeight;\n        if (this.virtualDelegate.setDynamicHeight) {\n            this.virtualDelegate.setDynamicHeight(item.element, item.size);\n        }\n        item.lastDynamicHeightWidth = this.renderWidth;\n        this.rowsContainer.removeChild(row.domNode);\n        this.cache.release(row);\n        return item.size - size;\n    };\n    ListView.prototype.getNextToLastElement = function (ranges) {\n        var lastRange = ranges[ranges.length - 1];\n        if (!lastRange) {\n            return null;\n        }\n        var nextToLastItem = this.items[lastRange.end];\n        if (!nextToLastItem) {\n            return null;\n        }\n        if (!nextToLastItem.row) {\n            return null;\n        }\n        return nextToLastItem.row.domNode;\n    };\n    ListView.prototype.getElementDomId = function (index) {\n        return this.domId + \"_\" + index;\n    };\n    // Dispose\n    ListView.prototype.dispose = function () {\n        if (this.items) {\n            for (var _i = 0, _a = this.items; _i < _a.length; _i++) {\n                var item = _a[_i];\n                if (item.row) {\n                    var renderer = this.renderers.get(item.row.templateId);\n                    if (renderer) {\n                        renderer.disposeTemplate(item.row.templateData);\n                    }\n                }\n            }\n            this.items = [];\n        }\n        if (this.domNode && this.domNode.parentNode) {\n            this.domNode.parentNode.removeChild(this.domNode);\n        }\n        this.disposables = lifecycle_1.dispose(this.disposables);\n    };\n    ListView.InstanceCount = 0;\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseClick\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseDblClick\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseMiddleClick\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseUp\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseDown\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseOver\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseMove\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onMouseOut\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onContextMenu\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onTouchStart\", null);\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ListView.prototype, \"onTap\", null);\n    return ListView;\n}());\nexports.ListView = ListView;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/list/listView.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/list/listView.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getOrDefault } from 'vs/base/common/objects';\nimport { IDisposable, dispose, Disposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { Gesture, EventType as TouchEventType, GestureEvent } from 'vs/base/browser/touch';\nimport * as DOM from 'vs/base/browser/dom';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { domEvent } from 'vs/base/browser/event';\nimport { ScrollableElement } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { ScrollEvent, ScrollbarVisibility, INewScrollDimensions } from 'vs/base/common/scrollable';\nimport { RangeMap, shift } from './rangeMap';\nimport { IListVirtualDelegate, IListRenderer, IListMouseEvent, IListTouchEvent, IListGestureEvent, IListDragEvent, IListDragAndDrop, ListDragOverEffect } from './list';\nimport { RowCache, IRow } from './rowCache';\nimport { isWindows } from 'vs/base/common/platform';\nimport * as browser from 'vs/base/browser/browser';\nimport { ISpliceable } from 'vs/base/common/sequence';\nimport { memoize } from 'vs/base/common/decorators';\nimport { Range, IRange } from 'vs/base/common/range';\nimport { equals, distinct } from 'vs/base/common/arrays';\nimport { DataTransfers, StaticDND, IDragAndDropData } from 'vs/base/browser/dnd';\nimport { disposableTimeout, Delayer } from 'vs/base/common/async';\n\ninterface IItem<T> {\n\treadonly id: string;\n\treadonly element: T;\n\treadonly templateId: string;\n\trow: IRow | null;\n\tsize: number;\n\twidth: number | undefined;\n\thasDynamicHeight: boolean;\n\tlastDynamicHeightWidth: number | undefined;\n\turi: string | undefined;\n\tdropTarget: boolean;\n\tdragStartDisposable: IDisposable;\n}\n\nexport interface IListViewDragAndDrop<T> extends IListDragAndDrop<T> {\n\tgetDragElements(element: T): T[];\n}\n\nexport interface IAriaSetProvider<T> {\n\tgetSetSize(element: T, index: number, listLength: number): number;\n\tgetPosInSet(element: T, index: number): number;\n}\n\nexport interface IListViewOptions<T> {\n\treadonly dnd?: IListViewDragAndDrop<T>;\n\treadonly useShadows?: boolean;\n\treadonly verticalScrollMode?: ScrollbarVisibility;\n\treadonly setRowLineHeight?: boolean;\n\treadonly supportDynamicHeights?: boolean;\n\treadonly mouseSupport?: boolean;\n\treadonly horizontalScrolling?: boolean;\n\treadonly ariaSetProvider?: IAriaSetProvider<T>;\n}\n\nconst DefaultOptions = {\n\tuseShadows: true,\n\tverticalScrollMode: ScrollbarVisibility.Auto,\n\tsetRowLineHeight: true,\n\tsupportDynamicHeights: false,\n\tdnd: {\n\t\tgetDragElements<T>(e: T) { return [e]; },\n\t\tgetDragURI() { return null; },\n\t\tonDragStart(): void { },\n\t\tonDragOver() { return false; },\n\t\tdrop() { }\n\t},\n\thorizontalScrolling: false\n};\n\nexport class ElementsDragAndDropData<T> implements IDragAndDropData {\n\n\treadonly elements: T[];\n\n\tconstructor(elements: T[]) {\n\t\tthis.elements = elements;\n\t}\n\n\tupdate(): void { }\n\n\tgetData(): any {\n\t\treturn this.elements;\n\t}\n}\n\nexport class ExternalElementsDragAndDropData<T> implements IDragAndDropData {\n\n\treadonly elements: T[];\n\n\tconstructor(elements: T[]) {\n\t\tthis.elements = elements;\n\t}\n\n\tupdate(): void { }\n\n\tgetData(): any {\n\t\treturn this.elements;\n\t}\n}\n\nexport class DesktopDragAndDropData implements IDragAndDropData {\n\n\treadonly types: any[];\n\treadonly files: any[];\n\n\tconstructor() {\n\t\tthis.types = [];\n\t\tthis.files = [];\n\t}\n\n\tupdate(dataTransfer: DataTransfer): void {\n\t\tif (dataTransfer.types) {\n\t\t\tthis.types.splice(0, this.types.length, ...dataTransfer.types);\n\t\t}\n\n\t\tif (dataTransfer.files) {\n\t\t\tthis.files.splice(0, this.files.length);\n\n\t\t\tfor (let i = 0; i < dataTransfer.files.length; i++) {\n\t\t\t\tconst file = dataTransfer.files.item(i);\n\n\t\t\t\tif (file && (file.size || file.type)) {\n\t\t\t\t\tthis.files.push(file);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetData(): any {\n\t\treturn {\n\t\t\ttypes: this.types,\n\t\t\tfiles: this.files\n\t\t};\n\t}\n}\n\nfunction equalsDragFeedback(f1: number[] | undefined, f2: number[] | undefined): boolean {\n\tif (Array.isArray(f1) && Array.isArray(f2)) {\n\t\treturn equals(f1, f2!);\n\t}\n\n\treturn f1 === f2;\n}\n\nexport class ListView<T> implements ISpliceable<T>, IDisposable {\n\n\tprivate static InstanceCount = 0;\n\treadonly domId = `list_id_${++ListView.InstanceCount}`;\n\n\treadonly domNode: HTMLElement;\n\n\tprivate items: IItem<T>[];\n\tprivate itemId: number;\n\tprivate rangeMap: RangeMap;\n\tprivate cache: RowCache<T>;\n\tprivate renderers = new Map<string, IListRenderer<any /* TODO@joao */, any>>();\n\tprivate lastRenderTop: number;\n\tprivate lastRenderHeight: number;\n\tprivate renderWidth = 0;\n\tprivate gesture: Gesture;\n\tprivate rowsContainer: HTMLElement;\n\tprivate scrollableElement: ScrollableElement;\n\tprivate _scrollHeight: number;\n\tprivate scrollableElementUpdateDisposable: IDisposable | null = null;\n\tprivate scrollableElementWidthDelayer = new Delayer<void>(50);\n\tprivate splicing = false;\n\tprivate dragOverAnimationDisposable: IDisposable | undefined;\n\tprivate dragOverAnimationStopDisposable: IDisposable = Disposable.None;\n\tprivate dragOverMouseY: number;\n\tprivate setRowLineHeight: boolean;\n\tprivate supportDynamicHeights: boolean;\n\tprivate horizontalScrolling: boolean;\n\tprivate ariaSetProvider: IAriaSetProvider<T>;\n\tprivate scrollWidth: number | undefined;\n\tprivate canUseTranslate3d: boolean | undefined = undefined;\n\n\tprivate dnd: IListViewDragAndDrop<T>;\n\tprivate canDrop: boolean = false;\n\tprivate currentDragData: IDragAndDropData | undefined;\n\tprivate currentDragFeedback: number[] | undefined;\n\tprivate currentDragFeedbackDisposable: IDisposable = Disposable.None;\n\tprivate onDragLeaveTimeout: IDisposable = Disposable.None;\n\n\tprivate disposables: IDisposable[];\n\n\tprivate _onDidChangeContentHeight = new Emitter<number>();\n\treadonly onDidChangeContentHeight: Event<number> = Event.latch(this._onDidChangeContentHeight.event);\n\tget contentHeight(): number { return this.rangeMap.size; }\n\n\tget onDidScroll(): Event<ScrollEvent> { return this.scrollableElement.onScroll; }\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\tprivate virtualDelegate: IListVirtualDelegate<T>,\n\t\trenderers: IListRenderer<any /* TODO@joao */, any>[],\n\t\toptions: IListViewOptions<T> = DefaultOptions as IListViewOptions<T>\n\t) {\n\t\tif (options.horizontalScrolling && options.supportDynamicHeights) {\n\t\t\tthrow new Error('Horizontal scrolling and dynamic heights not supported simultaneously');\n\t\t}\n\n\t\tthis.items = [];\n\t\tthis.itemId = 0;\n\t\tthis.rangeMap = new RangeMap();\n\n\t\tfor (const renderer of renderers) {\n\t\t\tthis.renderers.set(renderer.templateId, renderer);\n\t\t}\n\n\t\tthis.cache = new RowCache(this.renderers);\n\n\t\tthis.lastRenderTop = 0;\n\t\tthis.lastRenderHeight = 0;\n\n\t\tthis.domNode = document.createElement('div');\n\t\tthis.domNode.className = 'monaco-list';\n\n\t\tDOM.addClass(this.domNode, this.domId);\n\t\tthis.domNode.tabIndex = 0;\n\n\t\tDOM.toggleClass(this.domNode, 'mouse-support', typeof options.mouseSupport === 'boolean' ? options.mouseSupport : true);\n\n\t\tthis.horizontalScrolling = getOrDefault(options, o => o.horizontalScrolling, DefaultOptions.horizontalScrolling);\n\t\tDOM.toggleClass(this.domNode, 'horizontal-scrolling', this.horizontalScrolling);\n\n\t\tthis.ariaSetProvider = options.ariaSetProvider || { getSetSize: (e, i, length) => length, getPosInSet: (_, index) => index + 1 };\n\n\t\tthis.rowsContainer = document.createElement('div');\n\t\tthis.rowsContainer.className = 'monaco-list-rows';\n\t\tGesture.addTarget(this.rowsContainer);\n\n\t\tthis.scrollableElement = new ScrollableElement(this.rowsContainer, {\n\t\t\talwaysConsumeMouseWheel: true,\n\t\t\thorizontal: this.horizontalScrolling ? ScrollbarVisibility.Auto : ScrollbarVisibility.Hidden,\n\t\t\tvertical: getOrDefault(options, o => o.verticalScrollMode, DefaultOptions.verticalScrollMode),\n\t\t\tuseShadows: getOrDefault(options, o => o.useShadows, DefaultOptions.useShadows)\n\t\t});\n\n\t\tthis.domNode.appendChild(this.scrollableElement.getDomNode());\n\t\tcontainer.appendChild(this.domNode);\n\n\t\tthis.disposables = [this.rangeMap, this.gesture, this.scrollableElement, this.cache];\n\n\t\tthis.scrollableElement.onScroll(this.onScroll, this, this.disposables);\n\t\tdomEvent(this.rowsContainer, TouchEventType.Change)(this.onTouchChange, this, this.disposables);\n\n\t\t// Prevent the monaco-scrollable-element from scrolling\n\t\t// https://github.com/Microsoft/vscode/issues/44181\n\t\tdomEvent(this.scrollableElement.getDomNode(), 'scroll')\n\t\t\t(e => (e.target as HTMLElement).scrollTop = 0, null, this.disposables);\n\n\t\tEvent.map(domEvent(this.domNode, 'dragover'), e => this.toDragEvent(e))(this.onDragOver, this, this.disposables);\n\t\tEvent.map(domEvent(this.domNode, 'drop'), e => this.toDragEvent(e))(this.onDrop, this, this.disposables);\n\t\tdomEvent(this.domNode, 'dragleave')(this.onDragLeave, this, this.disposables);\n\t\tdomEvent(window, 'dragend')(this.onDragEnd, this, this.disposables);\n\n\t\tthis.setRowLineHeight = getOrDefault(options, o => o.setRowLineHeight, DefaultOptions.setRowLineHeight);\n\t\tthis.supportDynamicHeights = getOrDefault(options, o => o.supportDynamicHeights, DefaultOptions.supportDynamicHeights);\n\t\tthis.dnd = getOrDefault<IListViewOptions<T>, IListViewDragAndDrop<T>>(options, o => o.dnd, DefaultOptions.dnd);\n\n\t\tthis.layout();\n\t}\n\n\tsplice(start: number, deleteCount: number, elements: T[] = []): T[] {\n\t\tif (this.splicing) {\n\t\t\tthrow new Error('Can\\'t run recursive splices.');\n\t\t}\n\n\t\tthis.splicing = true;\n\n\t\ttry {\n\t\t\treturn this._splice(start, deleteCount, elements);\n\t\t} finally {\n\t\t\tthis.splicing = false;\n\t\t\tthis._onDidChangeContentHeight.fire(this.contentHeight);\n\t\t}\n\t}\n\n\tprivate _splice(start: number, deleteCount: number, elements: T[] = []): T[] {\n\t\tconst previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n\t\tconst deleteRange = { start, end: start + deleteCount };\n\t\tconst removeRange = Range.intersect(previousRenderRange, deleteRange);\n\n\t\tfor (let i = removeRange.start; i < removeRange.end; i++) {\n\t\t\tthis.removeItemFromDOM(i);\n\t\t}\n\n\t\tconst previousRestRange: IRange = { start: start + deleteCount, end: this.items.length };\n\t\tconst previousRenderedRestRange = Range.intersect(previousRestRange, previousRenderRange);\n\t\tconst previousUnrenderedRestRanges = Range.relativeComplement(previousRestRange, previousRenderRange);\n\n\t\tconst inserted = elements.map<IItem<T>>(element => ({\n\t\t\tid: String(this.itemId++),\n\t\t\telement,\n\t\t\ttemplateId: this.virtualDelegate.getTemplateId(element),\n\t\t\tsize: this.virtualDelegate.getHeight(element),\n\t\t\twidth: undefined,\n\t\t\thasDynamicHeight: !!this.virtualDelegate.hasDynamicHeight && this.virtualDelegate.hasDynamicHeight(element),\n\t\t\tlastDynamicHeightWidth: undefined,\n\t\t\trow: null,\n\t\t\turi: undefined,\n\t\t\tdropTarget: false,\n\t\t\tdragStartDisposable: Disposable.None\n\t\t}));\n\n\t\tlet deleted: IItem<T>[];\n\n\t\t// TODO@joao: improve this optimization to catch even more cases\n\t\tif (start === 0 && deleteCount >= this.items.length) {\n\t\t\tthis.rangeMap = new RangeMap();\n\t\t\tthis.rangeMap.splice(0, 0, inserted);\n\t\t\tthis.items = inserted;\n\t\t\tdeleted = [];\n\t\t} else {\n\t\t\tthis.rangeMap.splice(start, deleteCount, inserted);\n\t\t\tdeleted = this.items.splice(start, deleteCount, ...inserted);\n\t\t}\n\n\t\tconst delta = elements.length - deleteCount;\n\t\tconst renderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n\t\tconst renderedRestRange = shift(previousRenderedRestRange, delta);\n\t\tconst updateRange = Range.intersect(renderRange, renderedRestRange);\n\n\t\tfor (let i = updateRange.start; i < updateRange.end; i++) {\n\t\t\tthis.updateItemInDOM(this.items[i], i);\n\t\t}\n\n\t\tconst removeRanges = Range.relativeComplement(renderedRestRange, renderRange);\n\n\t\tfor (const range of removeRanges) {\n\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\tthis.removeItemFromDOM(i);\n\t\t\t}\n\t\t}\n\n\t\tconst unrenderedRestRanges = previousUnrenderedRestRanges.map(r => shift(r, delta));\n\t\tconst elementsRange = { start, end: start + elements.length };\n\t\tconst insertRanges = [elementsRange, ...unrenderedRestRanges].map(r => Range.intersect(renderRange, r));\n\t\tconst beforeElement = this.getNextToLastElement(insertRanges);\n\n\t\tfor (const range of insertRanges) {\n\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\tthis.insertItemInDOM(i, beforeElement);\n\t\t\t}\n\t\t}\n\n\t\tthis.eventuallyUpdateScrollDimensions();\n\n\t\tif (this.supportDynamicHeights) {\n\t\t\tthis._rerender(this.scrollTop, this.renderHeight);\n\t\t}\n\n\t\treturn deleted.map(i => i.element);\n\t}\n\n\tprivate eventuallyUpdateScrollDimensions(): void {\n\t\tthis._scrollHeight = this.contentHeight;\n\t\tthis.rowsContainer.style.height = `${this._scrollHeight}px`;\n\n\t\tif (!this.scrollableElementUpdateDisposable) {\n\t\t\tthis.scrollableElementUpdateDisposable = DOM.scheduleAtNextAnimationFrame(() => {\n\t\t\t\tthis.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\n\t\t\t\tthis.updateScrollWidth();\n\t\t\t\tthis.scrollableElementUpdateDisposable = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate eventuallyUpdateScrollWidth(): void {\n\t\tif (!this.horizontalScrolling) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.scrollableElementWidthDelayer.trigger(() => this.updateScrollWidth());\n\t}\n\n\tprivate updateScrollWidth(): void {\n\t\tif (!this.horizontalScrolling) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.items.length === 0) {\n\t\t\tthis.scrollableElement.setScrollDimensions({ scrollWidth: 0 });\n\t\t}\n\n\t\tlet scrollWidth = 0;\n\n\t\tfor (const item of this.items) {\n\t\t\tif (typeof item.width !== 'undefined') {\n\t\t\t\tscrollWidth = Math.max(scrollWidth, item.width);\n\t\t\t}\n\t\t}\n\n\t\tthis.scrollWidth = scrollWidth;\n\t\tthis.scrollableElement.setScrollDimensions({ scrollWidth: scrollWidth + 10 });\n\t}\n\n\tupdateWidth(index: number): void {\n\t\tif (!this.horizontalScrolling || typeof this.scrollWidth === 'undefined') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = this.items[index];\n\t\tthis.measureItemWidth(item);\n\n\t\tif (typeof item.width !== 'undefined' && item.width > this.scrollWidth) {\n\t\t\tthis.scrollWidth = item.width;\n\t\t\tthis.scrollableElement.setScrollDimensions({ scrollWidth: this.scrollWidth + 10 });\n\t\t}\n\t}\n\n\trerender(): void {\n\t\tif (!this.supportDynamicHeights) {\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const item of this.items) {\n\t\t\titem.lastDynamicHeightWidth = undefined;\n\t\t}\n\n\t\tthis._rerender(this.lastRenderTop, this.lastRenderHeight);\n\t}\n\n\tget length(): number {\n\t\treturn this.items.length;\n\t}\n\n\tget renderHeight(): number {\n\t\tconst scrollDimensions = this.scrollableElement.getScrollDimensions();\n\t\treturn scrollDimensions.height;\n\t}\n\n\tget firstVisibleIndex(): number {\n\t\tconst range = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n\t\tconst firstElTop = this.rangeMap.positionAt(range.start);\n\t\tconst nextElTop = this.rangeMap.positionAt(range.start + 1);\n\t\tif (nextElTop !== -1) {\n\t\t\tconst firstElMidpoint = (nextElTop - firstElTop) / 2 + firstElTop;\n\t\t\tif (firstElMidpoint < this.scrollTop) {\n\t\t\t\treturn range.start + 1;\n\t\t\t}\n\t\t}\n\n\t\treturn range.start;\n\t}\n\n\tget lastVisibleIndex(): number {\n\t\tconst range = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n\t\treturn range.end - 1;\n\t}\n\n\telement(index: number): T {\n\t\treturn this.items[index].element;\n\t}\n\n\tdomElement(index: number): HTMLElement | null {\n\t\tconst row = this.items[index].row;\n\t\treturn row && row.domNode;\n\t}\n\n\telementHeight(index: number): number {\n\t\treturn this.items[index].size;\n\t}\n\n\telementTop(index: number): number {\n\t\treturn this.rangeMap.positionAt(index);\n\t}\n\n\tindexAt(position: number): number {\n\t\treturn this.rangeMap.indexAt(position);\n\t}\n\n\tindexAfter(position: number): number {\n\t\treturn this.rangeMap.indexAfter(position);\n\t}\n\n\tlayout(height?: number, width?: number): void {\n\t\tlet scrollDimensions: INewScrollDimensions = {\n\t\t\theight: typeof height === 'number' ? height : DOM.getContentHeight(this.domNode)\n\t\t};\n\n\t\tif (this.scrollableElementUpdateDisposable) {\n\t\t\tthis.scrollableElementUpdateDisposable.dispose();\n\t\t\tthis.scrollableElementUpdateDisposable = null;\n\t\t\tscrollDimensions.scrollHeight = this.scrollHeight;\n\t\t}\n\n\t\tthis.scrollableElement.setScrollDimensions(scrollDimensions);\n\n\t\tif (typeof width !== 'undefined') {\n\t\t\tthis.renderWidth = width;\n\n\t\t\tif (this.supportDynamicHeights) {\n\t\t\t\tthis._rerender(this.scrollTop, this.renderHeight);\n\t\t\t}\n\n\t\t\tif (this.horizontalScrolling) {\n\t\t\t\tthis.scrollableElement.setScrollDimensions({\n\t\t\t\t\twidth: typeof width === 'number' ? width : DOM.getContentWidth(this.domNode)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t// Render\n\n\tprivate render(renderTop: number, renderHeight: number, renderLeft: number, scrollWidth: number): void {\n\t\tconst previousRenderRange = this.getRenderRange(this.lastRenderTop, this.lastRenderHeight);\n\t\tconst renderRange = this.getRenderRange(renderTop, renderHeight);\n\n\t\tconst rangesToInsert = Range.relativeComplement(renderRange, previousRenderRange);\n\t\tconst rangesToRemove = Range.relativeComplement(previousRenderRange, renderRange);\n\t\tconst beforeElement = this.getNextToLastElement(rangesToInsert);\n\n\t\tfor (const range of rangesToInsert) {\n\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\tthis.insertItemInDOM(i, beforeElement);\n\t\t\t}\n\t\t}\n\n\t\tfor (const range of rangesToRemove) {\n\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\tthis.removeItemFromDOM(i);\n\t\t\t}\n\t\t}\n\n\t\tconst canUseTranslate3d = !isWindows && !browser.isFirefox && browser.getZoomLevel() === 0;\n\n\t\tif (canUseTranslate3d) {\n\t\t\tconst transform = `translate3d(-${renderLeft}px, -${renderTop}px, 0px)`;\n\t\t\tthis.rowsContainer.style.transform = transform;\n\t\t\tthis.rowsContainer.style.webkitTransform = transform;\n\n\t\t\tif (canUseTranslate3d !== this.canUseTranslate3d) {\n\t\t\t\tthis.rowsContainer.style.left = '0';\n\t\t\t\tthis.rowsContainer.style.top = '0';\n\t\t\t}\n\t\t} else {\n\t\t\tthis.rowsContainer.style.left = `-${renderLeft}px`;\n\t\t\tthis.rowsContainer.style.top = `-${renderTop}px`;\n\n\t\t\tif (canUseTranslate3d !== this.canUseTranslate3d) {\n\t\t\t\tthis.rowsContainer.style.transform = '';\n\t\t\t\tthis.rowsContainer.style.webkitTransform = '';\n\t\t\t}\n\t\t}\n\n\t\tif (this.horizontalScrolling) {\n\t\t\tthis.rowsContainer.style.width = `${Math.max(scrollWidth, this.renderWidth)}px`;\n\t\t}\n\n\t\tthis.canUseTranslate3d = canUseTranslate3d;\n\n\t\tthis.lastRenderTop = renderTop;\n\t\tthis.lastRenderHeight = renderHeight;\n\t}\n\n\t// DOM operations\n\n\tprivate insertItemInDOM(index: number, beforeElement: HTMLElement | null): void {\n\t\tconst item = this.items[index];\n\n\t\tif (!item.row) {\n\t\t\titem.row = this.cache.alloc(item.templateId);\n\t\t\titem.row!.domNode!.setAttribute('role', 'treeitem');\n\t\t}\n\n\t\tif (!item.row.domNode!.parentElement) {\n\t\t\tif (beforeElement) {\n\t\t\t\tthis.rowsContainer.insertBefore(item.row.domNode!, beforeElement);\n\t\t\t} else {\n\t\t\t\tthis.rowsContainer.appendChild(item.row.domNode!);\n\t\t\t}\n\t\t}\n\n\t\tthis.updateItemInDOM(item, index);\n\n\t\tconst renderer = this.renderers.get(item.templateId);\n\n\t\tif (!renderer) {\n\t\t\tthrow new Error(`No renderer found for template id ${item.templateId}`);\n\t\t}\n\n\t\tif (renderer) {\n\t\t\trenderer.renderElement(item.element, index, item.row.templateData);\n\t\t}\n\n\t\tconst uri = this.dnd.getDragURI(item.element);\n\t\titem.dragStartDisposable.dispose();\n\t\titem.row.domNode!.draggable = !!uri;\n\n\t\tif (uri) {\n\t\t\tconst onDragStart = domEvent(item.row.domNode!, 'dragstart');\n\t\t\titem.dragStartDisposable = onDragStart(event => this.onDragStart(item.element, uri, event));\n\t\t}\n\n\t\tif (this.horizontalScrolling) {\n\t\t\tthis.measureItemWidth(item);\n\t\t\tthis.eventuallyUpdateScrollWidth();\n\t\t}\n\t}\n\n\tprivate measureItemWidth(item: IItem<T>): void {\n\t\tif (!item.row || !item.row.domNode) {\n\t\t\treturn;\n\t\t}\n\n\t\titem.row.domNode.style.width = 'fit-content';\n\t\titem.width = DOM.getContentWidth(item.row.domNode);\n\t\tconst style = window.getComputedStyle(item.row.domNode);\n\n\t\tif (style.paddingLeft) {\n\t\t\titem.width += parseFloat(style.paddingLeft);\n\t\t}\n\n\t\tif (style.paddingRight) {\n\t\t\titem.width += parseFloat(style.paddingRight);\n\t\t}\n\n\t\titem.row.domNode.style.width = '';\n\t}\n\n\tprivate updateItemInDOM(item: IItem<T>, index: number): void {\n\t\titem.row!.domNode!.style.top = `${this.elementTop(index)}px`;\n\t\titem.row!.domNode!.style.height = `${item.size}px`;\n\n\t\tif (this.setRowLineHeight) {\n\t\t\titem.row!.domNode!.style.lineHeight = `${item.size}px`;\n\t\t}\n\n\t\titem.row!.domNode!.setAttribute('data-index', `${index}`);\n\t\titem.row!.domNode!.setAttribute('data-last-element', index === this.length - 1 ? 'true' : 'false');\n\t\titem.row!.domNode!.setAttribute('aria-setsize', String(this.ariaSetProvider.getSetSize(item.element, index, this.length)));\n\t\titem.row!.domNode!.setAttribute('aria-posinset', String(this.ariaSetProvider.getPosInSet(item.element, index)));\n\t\titem.row!.domNode!.setAttribute('id', this.getElementDomId(index));\n\n\t\tDOM.toggleClass(item.row!.domNode!, 'drop-target', item.dropTarget);\n\t}\n\n\tprivate removeItemFromDOM(index: number): void {\n\t\tconst item = this.items[index];\n\t\titem.dragStartDisposable.dispose();\n\n\t\tconst renderer = this.renderers.get(item.templateId);\n\t\tif (renderer && renderer.disposeElement) {\n\t\t\trenderer.disposeElement(item.element, index, item.row!.templateData);\n\t\t}\n\n\t\tthis.cache.release(item.row!);\n\t\titem.row = null;\n\n\t\tif (this.horizontalScrolling) {\n\t\t\tthis.eventuallyUpdateScrollWidth();\n\t\t}\n\t}\n\n\tgetScrollTop(): number {\n\t\tconst scrollPosition = this.scrollableElement.getScrollPosition();\n\t\treturn scrollPosition.scrollTop;\n\t}\n\n\tsetScrollTop(scrollTop: number): void {\n\t\tif (this.scrollableElementUpdateDisposable) {\n\t\t\tthis.scrollableElementUpdateDisposable.dispose();\n\t\t\tthis.scrollableElementUpdateDisposable = null;\n\t\t\tthis.scrollableElement.setScrollDimensions({ scrollHeight: this.scrollHeight });\n\t\t}\n\n\t\tthis.scrollableElement.setScrollPosition({ scrollTop });\n\t}\n\n\tget scrollTop(): number {\n\t\treturn this.getScrollTop();\n\t}\n\n\tset scrollTop(scrollTop: number) {\n\t\tthis.setScrollTop(scrollTop);\n\t}\n\n\tget scrollHeight(): number {\n\t\treturn this._scrollHeight + (this.horizontalScrolling ? 10 : 0);\n\t}\n\n\t// Events\n\n\t@memoize get onMouseClick(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'click'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseDblClick(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'dblclick'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseMiddleClick(): Event<IListMouseEvent<T>> { return Event.filter(Event.map(domEvent(this.domNode, 'auxclick'), e => this.toMouseEvent(e as MouseEvent)), e => e.browserEvent.button === 1); }\n\t@memoize get onMouseUp(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'mouseup'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseDown(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'mousedown'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseOver(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'mouseover'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseMove(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'mousemove'), e => this.toMouseEvent(e)); }\n\t@memoize get onMouseOut(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'mouseout'), e => this.toMouseEvent(e)); }\n\t@memoize get onContextMenu(): Event<IListMouseEvent<T>> { return Event.map(domEvent(this.domNode, 'contextmenu'), e => this.toMouseEvent(e)); }\n\t@memoize get onTouchStart(): Event<IListTouchEvent<T>> { return Event.map(domEvent(this.domNode, 'touchstart'), e => this.toTouchEvent(e)); }\n\t@memoize get onTap(): Event<IListGestureEvent<T>> { return Event.map(domEvent(this.rowsContainer, TouchEventType.Tap), e => this.toGestureEvent(e)); }\n\n\tprivate toMouseEvent(browserEvent: MouseEvent): IListMouseEvent<T> {\n\t\tconst index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n\t\tconst item = typeof index === 'undefined' ? undefined : this.items[index];\n\t\tconst element = item && item.element;\n\t\treturn { browserEvent, index, element };\n\t}\n\n\tprivate toTouchEvent(browserEvent: TouchEvent): IListTouchEvent<T> {\n\t\tconst index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n\t\tconst item = typeof index === 'undefined' ? undefined : this.items[index];\n\t\tconst element = item && item.element;\n\t\treturn { browserEvent, index, element };\n\t}\n\n\tprivate toGestureEvent(browserEvent: GestureEvent): IListGestureEvent<T> {\n\t\tconst index = this.getItemIndexFromEventTarget(browserEvent.initialTarget || null);\n\t\tconst item = typeof index === 'undefined' ? undefined : this.items[index];\n\t\tconst element = item && item.element;\n\t\treturn { browserEvent, index, element };\n\t}\n\n\tprivate toDragEvent(browserEvent: DragEvent): IListDragEvent<T> {\n\t\tconst index = this.getItemIndexFromEventTarget(browserEvent.target || null);\n\t\tconst item = typeof index === 'undefined' ? undefined : this.items[index];\n\t\tconst element = item && item.element;\n\t\treturn { browserEvent, index, element };\n\t}\n\n\tprivate onScroll(e: ScrollEvent): void {\n\t\ttry {\n\t\t\tthis.render(e.scrollTop, e.height, e.scrollLeft, e.scrollWidth);\n\n\t\t\tif (this.supportDynamicHeights) {\n\t\t\t\tthis._rerender(e.scrollTop, e.height);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('Got bad scroll event:', e);\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\tprivate onTouchChange(event: GestureEvent): void {\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tthis.scrollTop -= event.translationY;\n\t}\n\n\t// DND\n\n\tprivate onDragStart(element: T, uri: string, event: DragEvent): void {\n\t\tif (!event.dataTransfer) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst elements = this.dnd.getDragElements(element);\n\n\t\tevent.dataTransfer.effectAllowed = 'copyMove';\n\t\tevent.dataTransfer.setData(DataTransfers.RESOURCES, JSON.stringify([uri]));\n\n\t\tif (event.dataTransfer.setDragImage) {\n\t\t\tlet label: string | undefined;\n\n\t\t\tif (this.dnd.getDragLabel) {\n\t\t\t\tlabel = this.dnd.getDragLabel(elements);\n\t\t\t}\n\n\t\t\tif (typeof label === 'undefined') {\n\t\t\t\tlabel = String(elements.length);\n\t\t\t}\n\n\t\t\tconst dragImage = DOM.$('.monaco-drag-image');\n\t\t\tdragImage.textContent = label;\n\t\t\tdocument.body.appendChild(dragImage);\n\t\t\tevent.dataTransfer.setDragImage(dragImage, -10, -10);\n\t\t\tsetTimeout(() => document.body.removeChild(dragImage), 0);\n\t\t}\n\n\t\tthis.currentDragData = new ElementsDragAndDropData(elements);\n\t\tStaticDND.CurrentDragAndDropData = new ExternalElementsDragAndDropData(elements);\n\n\t\tif (this.dnd.onDragStart) {\n\t\t\tthis.dnd.onDragStart(this.currentDragData, event);\n\t\t}\n\t}\n\n\tprivate onDragOver(event: IListDragEvent<T>): boolean {\n\t\tevent.browserEvent.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n\t\tthis.onDragLeaveTimeout.dispose();\n\n\t\tif (StaticDND.CurrentDragAndDropData && StaticDND.CurrentDragAndDropData.getData() === 'vscode-ui') {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.setupDragAndDropScrollTopAnimation(event.browserEvent);\n\n\t\tif (!event.browserEvent.dataTransfer) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Drag over from outside\n\t\tif (!this.currentDragData) {\n\t\t\tif (StaticDND.CurrentDragAndDropData) {\n\t\t\t\t// Drag over from another list\n\t\t\t\tthis.currentDragData = StaticDND.CurrentDragAndDropData;\n\n\t\t\t} else {\n\t\t\t\t// Drag over from the desktop\n\t\t\t\tif (!event.browserEvent.dataTransfer.types) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDragData = new DesktopDragAndDropData();\n\t\t\t}\n\t\t}\n\n\t\tconst result = this.dnd.onDragOver(this.currentDragData, event.element, event.index, event.browserEvent);\n\t\tthis.canDrop = typeof result === 'boolean' ? result : result.accept;\n\n\t\tif (!this.canDrop) {\n\t\t\tthis.currentDragFeedback = undefined;\n\t\t\tthis.currentDragFeedbackDisposable.dispose();\n\t\t\treturn false;\n\t\t}\n\n\t\tevent.browserEvent.dataTransfer.dropEffect = (typeof result !== 'boolean' && result.effect === ListDragOverEffect.Copy) ? 'copy' : 'move';\n\n\t\tlet feedback: number[];\n\n\t\tif (typeof result !== 'boolean' && result.feedback) {\n\t\t\tfeedback = result.feedback;\n\t\t} else {\n\t\t\tif (typeof event.index === 'undefined') {\n\t\t\t\tfeedback = [-1];\n\t\t\t} else {\n\t\t\t\tfeedback = [event.index];\n\t\t\t}\n\t\t}\n\n\t\t// sanitize feedback list\n\t\tfeedback = distinct(feedback).filter(i => i >= -1 && i < this.length).sort();\n\t\tfeedback = feedback[0] === -1 ? [-1] : feedback;\n\n\t\tif (feedback.length === 0) {\n\t\t\tthrow new Error('Invalid empty feedback list');\n\t\t}\n\n\t\tif (equalsDragFeedback(this.currentDragFeedback, feedback)) {\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.currentDragFeedback = feedback;\n\t\tthis.currentDragFeedbackDisposable.dispose();\n\n\t\tif (feedback[0] === -1) { // entire list feedback\n\t\t\tDOM.addClass(this.domNode, 'drop-target');\n\t\t\tthis.currentDragFeedbackDisposable = toDisposable(() => DOM.removeClass(this.domNode, 'drop-target'));\n\t\t} else {\n\t\t\tfor (const index of feedback) {\n\t\t\t\tconst item = this.items[index]!;\n\t\t\t\titem.dropTarget = true;\n\n\t\t\t\tif (item.row && item.row.domNode) {\n\t\t\t\t\tDOM.addClass(item.row.domNode, 'drop-target');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.currentDragFeedbackDisposable = toDisposable(() => {\n\t\t\t\tfor (const index of feedback) {\n\t\t\t\t\tconst item = this.items[index]!;\n\t\t\t\t\titem.dropTarget = false;\n\n\t\t\t\t\tif (item.row && item.row.domNode) {\n\t\t\t\t\t\tDOM.removeClass(item.row.domNode, 'drop-target');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate onDragLeave(): void {\n\t\tthis.onDragLeaveTimeout.dispose();\n\t\tthis.onDragLeaveTimeout = disposableTimeout(() => this.clearDragOverFeedback(), 100);\n\t}\n\n\tprivate onDrop(event: IListDragEvent<T>): void {\n\t\tif (!this.canDrop) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dragData = this.currentDragData;\n\t\tthis.teardownDragAndDropScrollTopAnimation();\n\t\tthis.clearDragOverFeedback();\n\t\tthis.currentDragData = undefined;\n\t\tStaticDND.CurrentDragAndDropData = undefined;\n\n\t\tif (!dragData || !event.browserEvent.dataTransfer) {\n\t\t\treturn;\n\t\t}\n\n\t\tevent.browserEvent.preventDefault();\n\t\tdragData.update(event.browserEvent.dataTransfer);\n\t\tthis.dnd.drop(dragData, event.element, event.index, event.browserEvent);\n\t}\n\n\tprivate onDragEnd(): void {\n\t\tthis.canDrop = false;\n\t\tthis.teardownDragAndDropScrollTopAnimation();\n\t\tthis.clearDragOverFeedback();\n\t\tthis.currentDragData = undefined;\n\t\tStaticDND.CurrentDragAndDropData = undefined;\n\t}\n\n\tprivate clearDragOverFeedback(): void {\n\t\tthis.currentDragFeedback = undefined;\n\t\tthis.currentDragFeedbackDisposable.dispose();\n\t\tthis.currentDragFeedbackDisposable = Disposable.None;\n\t}\n\n\t// DND scroll top animation\n\n\tprivate setupDragAndDropScrollTopAnimation(event: DragEvent): void {\n\t\tif (!this.dragOverAnimationDisposable) {\n\t\t\tconst viewTop = DOM.getTopLeftOffset(this.domNode).top;\n\t\t\tthis.dragOverAnimationDisposable = DOM.animate(this.animateDragAndDropScrollTop.bind(this, viewTop));\n\t\t}\n\n\t\tthis.dragOverAnimationStopDisposable.dispose();\n\t\tthis.dragOverAnimationStopDisposable = disposableTimeout(() => {\n\t\t\tif (this.dragOverAnimationDisposable) {\n\t\t\t\tthis.dragOverAnimationDisposable.dispose();\n\t\t\t\tthis.dragOverAnimationDisposable = undefined;\n\t\t\t}\n\t\t}, 1000);\n\n\t\tthis.dragOverMouseY = event.pageY;\n\t}\n\n\tprivate animateDragAndDropScrollTop(viewTop: number): void {\n\t\tif (this.dragOverMouseY === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst diff = this.dragOverMouseY - viewTop;\n\t\tconst upperLimit = this.renderHeight - 35;\n\n\t\tif (diff < 35) {\n\t\t\tthis.scrollTop += Math.max(-14, Math.floor(0.3 * (diff - 35)));\n\t\t} else if (diff > upperLimit) {\n\t\t\tthis.scrollTop += Math.min(14, Math.floor(0.3 * (diff - upperLimit)));\n\t\t}\n\t}\n\n\tprivate teardownDragAndDropScrollTopAnimation(): void {\n\t\tthis.dragOverAnimationStopDisposable.dispose();\n\n\t\tif (this.dragOverAnimationDisposable) {\n\t\t\tthis.dragOverAnimationDisposable.dispose();\n\t\t\tthis.dragOverAnimationDisposable = undefined;\n\t\t}\n\t}\n\n\t// Util\n\n\tprivate getItemIndexFromEventTarget(target: EventTarget | null): number | undefined {\n\t\tlet element: HTMLElement | null = target as (HTMLElement | null);\n\n\t\twhile (element instanceof HTMLElement && element !== this.rowsContainer) {\n\t\t\tconst rawIndex = element.getAttribute('data-index');\n\n\t\t\tif (rawIndex) {\n\t\t\t\tconst index = Number(rawIndex);\n\n\t\t\t\tif (!isNaN(index)) {\n\t\t\t\t\treturn index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telement = element.parentElement;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate getRenderRange(renderTop: number, renderHeight: number): IRange {\n\t\treturn {\n\t\t\tstart: this.rangeMap.indexAt(renderTop),\n\t\t\tend: this.rangeMap.indexAfter(renderTop + renderHeight - 1)\n\t\t};\n\t}\n\n\t/**\n\t * Given a stable rendered state, checks every rendered element whether it needs\n\t * to be probed for dynamic height. Adjusts scroll height and top if necessary.\n\t */\n\tprivate _rerender(renderTop: number, renderHeight: number): void {\n\t\tconst previousRenderRange = this.getRenderRange(renderTop, renderHeight);\n\n\t\t// Let's remember the second element's position, this helps in scrolling up\n\t\t// and preserving a linear upwards scroll movement\n\t\tlet anchorElementIndex: number | undefined;\n\t\tlet anchorElementTopDelta: number | undefined;\n\n\t\tif (renderTop === this.elementTop(previousRenderRange.start)) {\n\t\t\tanchorElementIndex = previousRenderRange.start;\n\t\t\tanchorElementTopDelta = 0;\n\t\t} else if (previousRenderRange.end - previousRenderRange.start > 1) {\n\t\t\tanchorElementIndex = previousRenderRange.start + 1;\n\t\t\tanchorElementTopDelta = this.elementTop(anchorElementIndex) - renderTop;\n\t\t}\n\n\t\tlet heightDiff = 0;\n\n\t\twhile (true) {\n\t\t\tconst renderRange = this.getRenderRange(renderTop, renderHeight);\n\n\t\t\tlet didChange = false;\n\n\t\t\tfor (let i = renderRange.start; i < renderRange.end; i++) {\n\t\t\t\tconst diff = this.probeDynamicHeight(i);\n\n\t\t\t\tif (diff !== 0) {\n\t\t\t\t\tthis.rangeMap.splice(i, 1, [this.items[i]]);\n\t\t\t\t}\n\n\t\t\t\theightDiff += diff;\n\t\t\t\tdidChange = didChange || diff !== 0;\n\t\t\t}\n\n\t\t\tif (!didChange) {\n\t\t\t\tif (heightDiff !== 0) {\n\t\t\t\t\tthis.eventuallyUpdateScrollDimensions();\n\t\t\t\t}\n\n\t\t\t\tconst unrenderRanges = Range.relativeComplement(previousRenderRange, renderRange);\n\n\t\t\t\tfor (const range of unrenderRanges) {\n\t\t\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\t\t\tif (this.items[i].row) {\n\t\t\t\t\t\t\tthis.removeItemFromDOM(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst renderRanges = Range.relativeComplement(renderRange, previousRenderRange);\n\n\t\t\t\tfor (const range of renderRanges) {\n\t\t\t\t\tfor (let i = range.start; i < range.end; i++) {\n\t\t\t\t\t\tconst afterIndex = i + 1;\n\t\t\t\t\t\tconst beforeRow = afterIndex < this.items.length ? this.items[afterIndex].row : null;\n\t\t\t\t\t\tconst beforeElement = beforeRow ? beforeRow.domNode : null;\n\t\t\t\t\t\tthis.insertItemInDOM(i, beforeElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let i = renderRange.start; i < renderRange.end; i++) {\n\t\t\t\t\tif (this.items[i].row) {\n\t\t\t\t\t\tthis.updateItemInDOM(this.items[i], i);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (typeof anchorElementIndex === 'number') {\n\t\t\t\t\tthis.scrollTop = this.elementTop(anchorElementIndex) - anchorElementTopDelta!;\n\t\t\t\t}\n\n\t\t\t\tthis._onDidChangeContentHeight.fire(this.contentHeight);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate probeDynamicHeight(index: number): number {\n\t\tconst item = this.items[index];\n\n\t\tif (!item.hasDynamicHeight || item.lastDynamicHeightWidth === this.renderWidth) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst size = item.size;\n\t\tconst row = this.cache.alloc(item.templateId);\n\n\t\trow.domNode!.style.height = '';\n\t\tthis.rowsContainer.appendChild(row.domNode!);\n\n\t\tconst renderer = this.renderers.get(item.templateId);\n\t\tif (renderer) {\n\t\t\trenderer.renderElement(item.element, index, row.templateData, true);\n\n\t\t\tif (renderer.disposeElement) {\n\t\t\t\trenderer.disposeElement(item.element, index, row.templateData, true);\n\t\t\t}\n\t\t}\n\n\t\titem.size = row.domNode!.offsetHeight;\n\n\t\tif (this.virtualDelegate.setDynamicHeight) {\n\t\t\tthis.virtualDelegate.setDynamicHeight(item.element, item.size);\n\t\t}\n\n\t\titem.lastDynamicHeightWidth = this.renderWidth;\n\t\tthis.rowsContainer.removeChild(row.domNode!);\n\t\tthis.cache.release(row);\n\n\t\treturn item.size - size;\n\t}\n\n\tprivate getNextToLastElement(ranges: IRange[]): HTMLElement | null {\n\t\tconst lastRange = ranges[ranges.length - 1];\n\n\t\tif (!lastRange) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst nextToLastItem = this.items[lastRange.end];\n\n\t\tif (!nextToLastItem) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!nextToLastItem.row) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn nextToLastItem.row.domNode;\n\t}\n\n\tgetElementDomId(index: number): string {\n\t\treturn `${this.domId}_${index}`;\n\t}\n\n\t// Dispose\n\n\tdispose() {\n\t\tif (this.items) {\n\t\t\tfor (const item of this.items) {\n\t\t\t\tif (item.row) {\n\t\t\t\t\tconst renderer = this.renderers.get(item.row.templateId);\n\t\t\t\t\tif (renderer) {\n\t\t\t\t\t\trenderer.disposeTemplate(item.row.templateData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.items = [];\n\t\t}\n\n\t\tif (this.domNode && this.domNode.parentNode) {\n\t\t\tthis.domNode.parentNode.removeChild(this.domNode);\n\t\t}\n\n\t\tthis.disposables = dispose(this.disposables);\n\t}\n}\n"]}]}