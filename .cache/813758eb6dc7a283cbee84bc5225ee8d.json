{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/contrib/hover/modesContentHover.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/hover/modesContentHover.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar nls = require(\"vs/nls\");\nvar dom = require(\"vs/base/browser/dom\");\nvar cancellation_1 = require(\"vs/base/common/cancellation\");\nvar color_1 = require(\"vs/base/common/color\");\nvar htmlContent_1 = require(\"vs/base/common/htmlContent\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar position_1 = require(\"vs/editor/common/core/position\");\nvar range_1 = require(\"vs/editor/common/core/range\");\nvar textModel_1 = require(\"vs/editor/common/model/textModel\");\nvar modes_1 = require(\"vs/editor/common/modes\");\nvar color_2 = require(\"vs/editor/contrib/colorPicker/color\");\nvar colorDetector_1 = require(\"vs/editor/contrib/colorPicker/colorDetector\");\nvar colorPickerModel_1 = require(\"vs/editor/contrib/colorPicker/colorPickerModel\");\nvar colorPickerWidget_1 = require(\"vs/editor/contrib/colorPicker/colorPickerWidget\");\nvar getHover_1 = require(\"vs/editor/contrib/hover/getHover\");\nvar hoverOperation_1 = require(\"vs/editor/contrib/hover/hoverOperation\");\nvar hoverWidgets_1 = require(\"vs/editor/contrib/hover/hoverWidgets\");\nvar markdownRenderer_1 = require(\"vs/editor/contrib/markdown/markdownRenderer\");\nvar arrays_1 = require(\"vs/base/common/arrays\");\nvar markers_1 = require(\"vs/platform/markers/common/markers\");\nvar resources_1 = require(\"vs/base/common/resources\");\nvar errors_1 = require(\"vs/base/common/errors\");\nvar opener_1 = require(\"vs/platform/opener/common/opener\");\nvar gotoError_1 = require(\"vs/editor/contrib/gotoError/gotoError\");\nvar async_1 = require(\"vs/base/common/async\");\nvar codeAction_1 = require(\"vs/editor/contrib/codeAction/codeAction\");\nvar codeActionCommands_1 = require(\"vs/editor/contrib/codeAction/codeActionCommands\");\nvar actions_1 = require(\"vs/base/common/actions\");\nvar codeActionTrigger_1 = require(\"vs/editor/contrib/codeAction/codeActionTrigger\");\nvar types_1 = require(\"vs/base/common/types\");\nvar $ = dom.$;\nvar ColorHover = /** @class */ (function () {\n    function ColorHover(range, color, provider) {\n        this.range = range;\n        this.color = color;\n        this.provider = provider;\n    }\n    return ColorHover;\n}());\nvar MarkerHover = /** @class */ (function () {\n    function MarkerHover(range, marker) {\n        this.range = range;\n        this.marker = marker;\n    }\n    return MarkerHover;\n}());\nvar ModesContentComputer = /** @class */ (function () {\n    function ModesContentComputer(editor, _markerDecorationsService) {\n        this._markerDecorationsService = _markerDecorationsService;\n        this._editor = editor;\n        this._range = null;\n    }\n    ModesContentComputer.prototype.setRange = function (range) {\n        this._range = range;\n        this._result = [];\n    };\n    ModesContentComputer.prototype.clearResult = function () {\n        this._result = [];\n    };\n    ModesContentComputer.prototype.computeAsync = function (token) {\n        if (!this._editor.hasModel() || !this._range) {\n            return Promise.resolve([]);\n        }\n        var model = this._editor.getModel();\n        if (!modes_1.HoverProviderRegistry.has(model)) {\n            return Promise.resolve([]);\n        }\n        return getHover_1.getHover(model, new position_1.Position(this._range.startLineNumber, this._range.startColumn), token);\n    };\n    ModesContentComputer.prototype.computeSync = function () {\n        var _this = this;\n        if (!this._editor.hasModel() || !this._range) {\n            return [];\n        }\n        var model = this._editor.getModel();\n        var lineNumber = this._range.startLineNumber;\n        if (lineNumber > this._editor.getModel().getLineCount()) {\n            // Illegal line number => no results\n            return [];\n        }\n        var colorDetector = colorDetector_1.ColorDetector.get(this._editor);\n        var maxColumn = model.getLineMaxColumn(lineNumber);\n        var lineDecorations = this._editor.getLineDecorations(lineNumber);\n        var didFindColor = false;\n        var hoverRange = this._range;\n        var result = lineDecorations.map(function (d) {\n            var startColumn = (d.range.startLineNumber === lineNumber) ? d.range.startColumn : 1;\n            var endColumn = (d.range.endLineNumber === lineNumber) ? d.range.endColumn : maxColumn;\n            if (startColumn > hoverRange.startColumn || hoverRange.endColumn > endColumn) {\n                return null;\n            }\n            var range = new range_1.Range(hoverRange.startLineNumber, startColumn, hoverRange.startLineNumber, endColumn);\n            var marker = _this._markerDecorationsService.getMarker(model, d);\n            if (marker) {\n                return new MarkerHover(range, marker);\n            }\n            var colorData = colorDetector.getColorData(d.range.getStartPosition());\n            if (!didFindColor && colorData) {\n                didFindColor = true;\n                var _a = colorData.colorInfo, color = _a.color, range_2 = _a.range;\n                return new ColorHover(range_2, color, colorData.provider);\n            }\n            else {\n                if (htmlContent_1.isEmptyMarkdownString(d.options.hoverMessage)) {\n                    return null;\n                }\n                var contents = d.options.hoverMessage ? arrays_1.asArray(d.options.hoverMessage) : [];\n                return { contents: contents, range: range };\n            }\n        });\n        return arrays_1.coalesce(result);\n    };\n    ModesContentComputer.prototype.onResult = function (result, isFromSynchronousComputation) {\n        // Always put synchronous messages before asynchronous ones\n        if (isFromSynchronousComputation) {\n            this._result = result.concat(this._result.sort(function (a, b) {\n                if (a instanceof ColorHover) { // sort picker messages at to the top\n                    return -1;\n                }\n                else if (b instanceof ColorHover) {\n                    return 1;\n                }\n                return 0;\n            }));\n        }\n        else {\n            this._result = this._result.concat(result);\n        }\n    };\n    ModesContentComputer.prototype.getResult = function () {\n        return this._result.slice(0);\n    };\n    ModesContentComputer.prototype.getResultWithLoadingMessage = function () {\n        return this._result.slice(0).concat([this._getLoadingMessage()]);\n    };\n    ModesContentComputer.prototype._getLoadingMessage = function () {\n        return {\n            range: types_1.withNullAsUndefined(this._range),\n            contents: [new htmlContent_1.MarkdownString().appendText(nls.localize('modesContentHover.loading', \"Loading...\"))]\n        };\n    };\n    return ModesContentComputer;\n}());\nvar ModesContentHoverWidget = /** @class */ (function (_super) {\n    tslib_1.__extends(ModesContentHoverWidget, _super);\n    function ModesContentHoverWidget(editor, markerDecorationsService, _themeService, _keybindingService, _contextMenuService, _bulkEditService, _commandService, _modeService, _openerService) {\n        if (_openerService === void 0) { _openerService = opener_1.NullOpenerService; }\n        var _this = _super.call(this, ModesContentHoverWidget.ID, editor) || this;\n        _this._themeService = _themeService;\n        _this._keybindingService = _keybindingService;\n        _this._contextMenuService = _contextMenuService;\n        _this._bulkEditService = _bulkEditService;\n        _this._commandService = _commandService;\n        _this._modeService = _modeService;\n        _this._openerService = _openerService;\n        _this.renderDisposable = lifecycle_1.Disposable.None;\n        _this._messages = [];\n        _this._lastRange = null;\n        _this._computer = new ModesContentComputer(_this._editor, markerDecorationsService);\n        _this._highlightDecorations = [];\n        _this._isChangingDecorations = false;\n        _this._hoverOperation = new hoverOperation_1.HoverOperation(_this._computer, function (result) { return _this._withResult(result, true); }, null, function (result) { return _this._withResult(result, false); }, _this._editor.getConfiguration().contribInfo.hover.delay);\n        _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.FOCUS, function () {\n            if (_this._colorPicker) {\n                dom.addClass(_this.getDomNode(), 'colorpicker-hover');\n            }\n        }));\n        _this._register(dom.addStandardDisposableListener(_this.getDomNode(), dom.EventType.BLUR, function () {\n            dom.removeClass(_this.getDomNode(), 'colorpicker-hover');\n        }));\n        _this._register(editor.onDidChangeConfiguration(function (e) {\n            _this._hoverOperation.setHoverTime(_this._editor.getConfiguration().contribInfo.hover.delay);\n        }));\n        return _this;\n    }\n    ModesContentHoverWidget.prototype.dispose = function () {\n        this.renderDisposable.dispose();\n        this.renderDisposable = lifecycle_1.Disposable.None;\n        this._hoverOperation.cancel();\n        _super.prototype.dispose.call(this);\n    };\n    ModesContentHoverWidget.prototype.onModelDecorationsChanged = function () {\n        if (this._isChangingDecorations) {\n            return;\n        }\n        if (this.isVisible) {\n            // The decorations have changed and the hover is visible,\n            // we need to recompute the displayed text\n            this._hoverOperation.cancel();\n            this._computer.clearResult();\n            if (!this._colorPicker) { // TODO@Michel ensure that displayed text for other decorations is computed even if color picker is in place\n                this._hoverOperation.start(hoverOperation_1.HoverStartMode.Delayed);\n            }\n        }\n    };\n    ModesContentHoverWidget.prototype.startShowingAt = function (range, mode, focus) {\n        if (this._lastRange && this._lastRange.equalsRange(range)) {\n            // We have to show the widget at the exact same range as before, so no work is needed\n            return;\n        }\n        this._hoverOperation.cancel();\n        if (this.isVisible) {\n            // The range might have changed, but the hover is visible\n            // Instead of hiding it completely, filter out messages that are still in the new range and\n            // kick off a new computation\n            if (!this._showAtPosition || this._showAtPosition.lineNumber !== range.startLineNumber) {\n                this.hide();\n            }\n            else {\n                var filteredMessages = [];\n                for (var i = 0, len = this._messages.length; i < len; i++) {\n                    var msg = this._messages[i];\n                    var rng = msg.range;\n                    if (rng && rng.startColumn <= range.startColumn && rng.endColumn >= range.endColumn) {\n                        filteredMessages.push(msg);\n                    }\n                }\n                if (filteredMessages.length > 0) {\n                    if (hoverContentsEquals(filteredMessages, this._messages)) {\n                        return;\n                    }\n                    this._renderMessages(range, filteredMessages);\n                }\n                else {\n                    this.hide();\n                }\n            }\n        }\n        this._lastRange = range;\n        this._computer.setRange(range);\n        this._shouldFocus = focus;\n        this._hoverOperation.start(mode);\n    };\n    ModesContentHoverWidget.prototype.hide = function () {\n        this._lastRange = null;\n        this._hoverOperation.cancel();\n        _super.prototype.hide.call(this);\n        this._isChangingDecorations = true;\n        this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, []);\n        this._isChangingDecorations = false;\n        this.renderDisposable.dispose();\n        this.renderDisposable = lifecycle_1.Disposable.None;\n        this._colorPicker = null;\n    };\n    ModesContentHoverWidget.prototype.isColorPickerVisible = function () {\n        if (this._colorPicker) {\n            return true;\n        }\n        return false;\n    };\n    ModesContentHoverWidget.prototype._withResult = function (result, complete) {\n        this._messages = result;\n        if (this._lastRange && this._messages.length > 0) {\n            this._renderMessages(this._lastRange, this._messages);\n        }\n        else if (complete) {\n            this.hide();\n        }\n    };\n    ModesContentHoverWidget.prototype._renderMessages = function (renderRange, messages) {\n        var _this = this;\n        this.renderDisposable.dispose();\n        this._colorPicker = null;\n        // update column from which to show\n        var renderColumn = Number.MAX_VALUE;\n        var highlightRange = messages[0].range ? range_1.Range.lift(messages[0].range) : null;\n        var fragment = document.createDocumentFragment();\n        var isEmptyHoverContent = true;\n        var containColorPicker = false;\n        var markdownDisposeables = [];\n        var markerMessages = [];\n        messages.forEach(function (msg) {\n            if (!msg.range) {\n                return;\n            }\n            renderColumn = Math.min(renderColumn, msg.range.startColumn);\n            highlightRange = highlightRange ? range_1.Range.plusRange(highlightRange, msg.range) : range_1.Range.lift(msg.range);\n            if (msg instanceof ColorHover) {\n                containColorPicker = true;\n                var _a = msg.color, red = _a.red, green = _a.green, blue = _a.blue, alpha = _a.alpha;\n                var rgba = new color_1.RGBA(red * 255, green * 255, blue * 255, alpha);\n                var color_3 = new color_1.Color(rgba);\n                if (!_this._editor.hasModel()) {\n                    return;\n                }\n                var editorModel_1 = _this._editor.getModel();\n                var range_3 = new range_1.Range(msg.range.startLineNumber, msg.range.startColumn, msg.range.endLineNumber, msg.range.endColumn);\n                var colorInfo = { range: msg.range, color: msg.color };\n                // create blank olor picker model and widget first to ensure it's positioned correctly.\n                var model_1 = new colorPickerModel_1.ColorPickerModel(color_3, [], 0);\n                var widget_1 = new colorPickerWidget_1.ColorPickerWidget(fragment, model_1, _this._editor.getConfiguration().pixelRatio, _this._themeService);\n                color_2.getColorPresentations(editorModel_1, colorInfo, msg.provider, cancellation_1.CancellationToken.None).then(function (colorPresentations) {\n                    model_1.colorPresentations = colorPresentations || [];\n                    if (!_this._editor.hasModel()) {\n                        // gone...\n                        return;\n                    }\n                    var originalText = _this._editor.getModel().getValueInRange(msg.range);\n                    model_1.guessColorPresentation(color_3, originalText);\n                    var updateEditorModel = function () {\n                        var textEdits;\n                        var newRange;\n                        if (model_1.presentation.textEdit) {\n                            textEdits = [model_1.presentation.textEdit];\n                            newRange = new range_1.Range(model_1.presentation.textEdit.range.startLineNumber, model_1.presentation.textEdit.range.startColumn, model_1.presentation.textEdit.range.endLineNumber, model_1.presentation.textEdit.range.endColumn);\n                            newRange = newRange.setEndPosition(newRange.endLineNumber, newRange.startColumn + model_1.presentation.textEdit.text.length);\n                        }\n                        else {\n                            textEdits = [{ identifier: null, range: range_3, text: model_1.presentation.label, forceMoveMarkers: false }];\n                            newRange = range_3.setEndPosition(range_3.endLineNumber, range_3.startColumn + model_1.presentation.label.length);\n                        }\n                        _this._editor.pushUndoStop();\n                        _this._editor.executeEdits('colorpicker', textEdits);\n                        if (model_1.presentation.additionalTextEdits) {\n                            textEdits = model_1.presentation.additionalTextEdits.slice();\n                            _this._editor.executeEdits('colorpicker', textEdits);\n                            _this.hide();\n                        }\n                        _this._editor.pushUndoStop();\n                        range_3 = newRange;\n                    };\n                    var updateColorPresentations = function (color) {\n                        return color_2.getColorPresentations(editorModel_1, {\n                            range: range_3,\n                            color: {\n                                red: color.rgba.r / 255,\n                                green: color.rgba.g / 255,\n                                blue: color.rgba.b / 255,\n                                alpha: color.rgba.a\n                            }\n                        }, msg.provider, cancellation_1.CancellationToken.None).then(function (colorPresentations) {\n                            model_1.colorPresentations = colorPresentations || [];\n                        });\n                    };\n                    var colorListener = model_1.onColorFlushed(function (color) {\n                        updateColorPresentations(color).then(updateEditorModel);\n                    });\n                    var colorChangeListener = model_1.onDidChangeColor(updateColorPresentations);\n                    _this._colorPicker = widget_1;\n                    _this.showAt(range_3.getStartPosition(), range_3, _this._shouldFocus);\n                    _this.updateContents(fragment);\n                    _this._colorPicker.layout();\n                    _this.renderDisposable = lifecycle_1.combinedDisposable([colorListener, colorChangeListener, widget_1].concat(markdownDisposeables));\n                });\n            }\n            else {\n                if (msg instanceof MarkerHover) {\n                    markerMessages.push(msg);\n                    isEmptyHoverContent = false;\n                }\n                else {\n                    msg.contents\n                        .filter(function (contents) { return !htmlContent_1.isEmptyMarkdownString(contents); })\n                        .forEach(function (contents) {\n                        var markdownHoverElement = $('div.hover-row.markdown-hover');\n                        var hoverContentsElement = dom.append(markdownHoverElement, $('div.hover-contents'));\n                        var renderer = new markdownRenderer_1.MarkdownRenderer(_this._editor, _this._modeService, _this._openerService);\n                        markdownDisposeables.push(renderer.onDidRenderCodeBlock(function () {\n                            hoverContentsElement.className = 'hover-contents code-hover-contents';\n                            _this.onContentsChange();\n                        }));\n                        var renderedContents = renderer.render(contents);\n                        hoverContentsElement.appendChild(renderedContents.element);\n                        fragment.appendChild(markdownHoverElement);\n                        markdownDisposeables.push(renderedContents);\n                        isEmptyHoverContent = false;\n                    });\n                }\n            }\n        });\n        if (markerMessages.length) {\n            markerMessages.forEach(function (msg) { return fragment.appendChild(_this.renderMarkerHover(msg)); });\n            var markerHoverForStatusbar = markerMessages.length === 1 ? markerMessages[0] : markerMessages.sort(function (a, b) { return markers_1.MarkerSeverity.compare(a.marker.severity, b.marker.severity); })[0];\n            fragment.appendChild(this.renderMarkerStatusbar(markerHoverForStatusbar));\n        }\n        // show\n        if (!containColorPicker && !isEmptyHoverContent) {\n            this.showAt(new position_1.Position(renderRange.startLineNumber, renderColumn), highlightRange, this._shouldFocus);\n            this.updateContents(fragment);\n        }\n        this._isChangingDecorations = true;\n        this._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, highlightRange ? [{\n                range: highlightRange,\n                options: ModesContentHoverWidget._DECORATION_OPTIONS\n            }] : []);\n        this._isChangingDecorations = false;\n    };\n    ModesContentHoverWidget.prototype.renderMarkerHover = function (markerHover) {\n        var _this = this;\n        var hoverElement = $('div.hover-row');\n        var markerElement = dom.append(hoverElement, $('div.marker.hover-contents'));\n        var _a = markerHover.marker, source = _a.source, message = _a.message, code = _a.code, relatedInformation = _a.relatedInformation;\n        this._editor.applyFontInfo(markerElement);\n        var messageElement = dom.append(markerElement, $('span'));\n        messageElement.style.whiteSpace = 'pre-wrap';\n        messageElement.innerText = message;\n        if (source || code) {\n            var detailsElement = dom.append(markerElement, $('span'));\n            detailsElement.style.opacity = '0.6';\n            detailsElement.style.paddingLeft = '6px';\n            detailsElement.innerText = source && code ? source + \"(\" + code + \")\" : source ? source : \"(\" + code + \")\";\n        }\n        if (arrays_1.isNonEmptyArray(relatedInformation)) {\n            var _loop_1 = function (message_1, resource, startLineNumber, startColumn) {\n                var relatedInfoContainer = dom.append(markerElement, $('div'));\n                relatedInfoContainer.style.marginTop = '8px';\n                var a = dom.append(relatedInfoContainer, $('a'));\n                a.innerText = resources_1.basename(resource) + \"(\" + startLineNumber + \", \" + startColumn + \"): \";\n                a.style.cursor = 'pointer';\n                a.onclick = function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (_this._openerService) {\n                        _this._openerService.open(resource.with({ fragment: startLineNumber + \",\" + startColumn })).catch(errors_1.onUnexpectedError);\n                    }\n                };\n                var messageElement_1 = dom.append(relatedInfoContainer, $('span'));\n                messageElement_1.innerText = message_1;\n                this_1._editor.applyFontInfo(messageElement_1);\n            };\n            var this_1 = this;\n            for (var _i = 0, relatedInformation_1 = relatedInformation; _i < relatedInformation_1.length; _i++) {\n                var _b = relatedInformation_1[_i], message_1 = _b.message, resource = _b.resource, startLineNumber = _b.startLineNumber, startColumn = _b.startColumn;\n                _loop_1(message_1, resource, startLineNumber, startColumn);\n            }\n        }\n        return hoverElement;\n    };\n    ModesContentHoverWidget.prototype.renderMarkerStatusbar = function (markerHover) {\n        var _this = this;\n        var hoverElement = $('div.hover-row.status-bar');\n        var disposables = [];\n        var actionsElement = dom.append(hoverElement, $('div.actions'));\n        disposables.push(this.renderAction(actionsElement, {\n            label: nls.localize('quick fixes', \"Quick Fix...\"),\n            commandId: codeActionCommands_1.QuickFixAction.Id,\n            run: function (target) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var codeActionsPromise, actions, elementPosition;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            codeActionsPromise = this.getCodeActions(markerHover.marker);\n                            disposables.push(lifecycle_1.toDisposable(function () { return codeActionsPromise.cancel(); }));\n                            return [4 /*yield*/, codeActionsPromise];\n                        case 1:\n                            actions = _a.sent();\n                            elementPosition = dom.getDomNodePagePosition(target);\n                            this._contextMenuService.showContextMenu({\n                                getAnchor: function () { return ({ x: elementPosition.left + 6, y: elementPosition.top + elementPosition.height + 6 }); },\n                                getActions: function () { return actions; }\n                            });\n                            return [2 /*return*/];\n                    }\n                });\n            }); }\n        }));\n        if (markerHover.marker.severity === markers_1.MarkerSeverity.Error || markerHover.marker.severity === markers_1.MarkerSeverity.Warning || markerHover.marker.severity === markers_1.MarkerSeverity.Info) {\n            disposables.push(this.renderAction(actionsElement, {\n                label: nls.localize('peek problem', \"Peek Problem\"),\n                commandId: gotoError_1.NextMarkerAction.ID,\n                run: function () {\n                    _this.hide();\n                    gotoError_1.MarkerController.get(_this._editor).show(markerHover.marker);\n                    _this._editor.focus();\n                }\n            }));\n        }\n        this.renderDisposable = lifecycle_1.combinedDisposable(disposables);\n        return hoverElement;\n    };\n    ModesContentHoverWidget.prototype.getCodeActions = function (marker) {\n        var _this = this;\n        return async_1.createCancelablePromise(function (cancellationToken) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var codeActions;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, codeAction_1.getCodeActions(this._editor.getModel(), new range_1.Range(marker.startLineNumber, marker.startColumn, marker.endLineNumber, marker.endColumn), { type: 'manual', filter: { kind: codeActionTrigger_1.CodeActionKind.QuickFix } }, cancellationToken)];\n                    case 1:\n                        codeActions = _a.sent();\n                        if (codeActions.actions.length) {\n                            return [2 /*return*/, codeActions.actions.map(function (codeAction) { return new actions_1.Action(codeAction.command ? codeAction.command.id : codeAction.title, codeAction.title, undefined, true, function () { return codeActionCommands_1.applyCodeAction(codeAction, _this._bulkEditService, _this._commandService); }); })];\n                        }\n                        return [2 /*return*/, [\n                                new actions_1.Action('', nls.localize('editor.action.quickFix.noneMessage', \"No code actions available\"))\n                            ]];\n                }\n            });\n        }); });\n    };\n    ModesContentHoverWidget.prototype.renderAction = function (parent, actionOptions) {\n        var actionContainer = dom.append(parent, $('div.action-container'));\n        var action = dom.append(actionContainer, $('a.action'));\n        if (actionOptions.iconClass) {\n            dom.append(action, $(\"span.icon.\" + actionOptions.iconClass));\n        }\n        var label = dom.append(action, $('span'));\n        label.textContent = actionOptions.label;\n        var keybinding = this._keybindingService.lookupKeybinding(actionOptions.commandId);\n        if (keybinding) {\n            label.title = actionOptions.label + \" (\" + keybinding.getLabel() + \")\";\n        }\n        return dom.addDisposableListener(actionContainer, dom.EventType.CLICK, function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            actionOptions.run(actionContainer);\n        });\n    };\n    ModesContentHoverWidget.ID = 'editor.contrib.modesContentHoverWidget';\n    ModesContentHoverWidget._DECORATION_OPTIONS = textModel_1.ModelDecorationOptions.register({\n        className: 'hoverHighlight'\n    });\n    return ModesContentHoverWidget;\n}(hoverWidgets_1.ContentHoverWidget));\nexports.ModesContentHoverWidget = ModesContentHoverWidget;\nfunction hoverContentsEquals(first, second) {\n    if ((!first && second) || (first && !second) || first.length !== second.length) {\n        return false;\n    }\n    for (var i = 0; i < first.length; i++) {\n        var firstElement = first[i];\n        var secondElement = second[i];\n        if (firstElement instanceof MarkerHover && secondElement instanceof MarkerHover) {\n            return markers_1.IMarkerData.makeKey(firstElement.marker) === markers_1.IMarkerData.makeKey(secondElement.marker);\n        }\n        if (firstElement instanceof ColorHover || secondElement instanceof ColorHover) {\n            return false;\n        }\n        if (firstElement instanceof MarkerHover || secondElement instanceof MarkerHover) {\n            return false;\n        }\n        if (!htmlContent_1.markedStringsEquals(firstElement.contents, secondElement.contents)) {\n            return false;\n        }\n    }\n    return true;\n}\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/hover/modesContentHover.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/contrib/hover/modesContentHover.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as dom from 'vs/base/browser/dom';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { Color, RGBA } from 'vs/base/common/color';\nimport { IMarkdownString, MarkdownString, isEmptyMarkdownString, markedStringsEquals } from 'vs/base/common/htmlContent';\nimport { Disposable, IDisposable, combinedDisposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { Position } from 'vs/editor/common/core/position';\nimport { IRange, Range } from 'vs/editor/common/core/range';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { DocumentColorProvider, Hover as MarkdownHover, HoverProviderRegistry, IColor } from 'vs/editor/common/modes';\nimport { getColorPresentations } from 'vs/editor/contrib/colorPicker/color';\nimport { ColorDetector } from 'vs/editor/contrib/colorPicker/colorDetector';\nimport { ColorPickerModel } from 'vs/editor/contrib/colorPicker/colorPickerModel';\nimport { ColorPickerWidget } from 'vs/editor/contrib/colorPicker/colorPickerWidget';\nimport { getHover } from 'vs/editor/contrib/hover/getHover';\nimport { HoverOperation, HoverStartMode, IHoverComputer } from 'vs/editor/contrib/hover/hoverOperation';\nimport { ContentHoverWidget } from 'vs/editor/contrib/hover/hoverWidgets';\nimport { MarkdownRenderer } from 'vs/editor/contrib/markdown/markdownRenderer';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { coalesce, isNonEmptyArray, asArray } from 'vs/base/common/arrays';\nimport { IMarker, IMarkerData, MarkerSeverity } from 'vs/platform/markers/common/markers';\nimport { basename } from 'vs/base/common/resources';\nimport { IMarkerDecorationsService } from 'vs/editor/common/services/markersDecorationService';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { IOpenerService, NullOpenerService } from 'vs/platform/opener/common/opener';\nimport { MarkerController, NextMarkerAction } from 'vs/editor/contrib/gotoError/gotoError';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IBulkEditService } from 'vs/editor/browser/services/bulkEditService';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { CancelablePromise, createCancelablePromise } from 'vs/base/common/async';\nimport { getCodeActions } from 'vs/editor/contrib/codeAction/codeAction';\nimport { applyCodeAction, QuickFixAction } from 'vs/editor/contrib/codeAction/codeActionCommands';\nimport { Action } from 'vs/base/common/actions';\nimport { CodeActionKind } from 'vs/editor/contrib/codeAction/codeActionTrigger';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { withNullAsUndefined } from 'vs/base/common/types';\nimport { IIdentifiedSingleEditOperation } from 'vs/editor/common/model';\n\nconst $ = dom.$;\n\nclass ColorHover {\n\n\tconstructor(\n\t\tpublic readonly range: IRange,\n\t\tpublic readonly color: IColor,\n\t\tpublic readonly provider: DocumentColorProvider\n\t) { }\n}\n\nclass MarkerHover {\n\n\tconstructor(\n\t\tpublic readonly range: IRange,\n\t\tpublic readonly marker: IMarker,\n\t) { }\n}\n\ntype HoverPart = MarkdownHover | ColorHover | MarkerHover;\n\nclass ModesContentComputer implements IHoverComputer<HoverPart[]> {\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate _result: HoverPart[];\n\tprivate _range: Range | null;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tprivate readonly _markerDecorationsService: IMarkerDecorationsService\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._range = null;\n\t}\n\n\tsetRange(range: Range): void {\n\t\tthis._range = range;\n\t\tthis._result = [];\n\t}\n\n\tclearResult(): void {\n\t\tthis._result = [];\n\t}\n\n\tcomputeAsync(token: CancellationToken): Promise<HoverPart[]> {\n\t\tif (!this._editor.hasModel() || !this._range) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\tconst model = this._editor.getModel();\n\n\t\tif (!HoverProviderRegistry.has(model)) {\n\t\t\treturn Promise.resolve([]);\n\t\t}\n\n\t\treturn getHover(model, new Position(\n\t\t\tthis._range.startLineNumber,\n\t\t\tthis._range.startColumn\n\t\t), token);\n\t}\n\n\tcomputeSync(): HoverPart[] {\n\t\tif (!this._editor.hasModel() || !this._range) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst model = this._editor.getModel();\n\t\tconst lineNumber = this._range.startLineNumber;\n\n\t\tif (lineNumber > this._editor.getModel().getLineCount()) {\n\t\t\t// Illegal line number => no results\n\t\t\treturn [];\n\t\t}\n\n\t\tconst colorDetector = ColorDetector.get(this._editor);\n\t\tconst maxColumn = model.getLineMaxColumn(lineNumber);\n\t\tconst lineDecorations = this._editor.getLineDecorations(lineNumber);\n\t\tlet didFindColor = false;\n\n\t\tconst hoverRange = this._range;\n\t\tconst result = lineDecorations.map((d): HoverPart | null => {\n\t\t\tconst startColumn = (d.range.startLineNumber === lineNumber) ? d.range.startColumn : 1;\n\t\t\tconst endColumn = (d.range.endLineNumber === lineNumber) ? d.range.endColumn : maxColumn;\n\n\t\t\tif (startColumn > hoverRange.startColumn || hoverRange.endColumn > endColumn) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst range = new Range(hoverRange.startLineNumber, startColumn, hoverRange.startLineNumber, endColumn);\n\t\t\tconst marker = this._markerDecorationsService.getMarker(model, d);\n\t\t\tif (marker) {\n\t\t\t\treturn new MarkerHover(range, marker);\n\t\t\t}\n\n\t\t\tconst colorData = colorDetector.getColorData(d.range.getStartPosition());\n\n\t\t\tif (!didFindColor && colorData) {\n\t\t\t\tdidFindColor = true;\n\n\t\t\t\tconst { color, range } = colorData.colorInfo;\n\t\t\t\treturn new ColorHover(range, color, colorData.provider);\n\t\t\t} else {\n\t\t\t\tif (isEmptyMarkdownString(d.options.hoverMessage)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst contents: IMarkdownString[] = d.options.hoverMessage ? asArray(d.options.hoverMessage) : [];\n\t\t\t\treturn { contents, range };\n\t\t\t}\n\t\t});\n\n\t\treturn coalesce(result);\n\t}\n\n\tonResult(result: HoverPart[], isFromSynchronousComputation: boolean): void {\n\t\t// Always put synchronous messages before asynchronous ones\n\t\tif (isFromSynchronousComputation) {\n\t\t\tthis._result = result.concat(this._result.sort((a, b) => {\n\t\t\t\tif (a instanceof ColorHover) { // sort picker messages at to the top\n\t\t\t\t\treturn -1;\n\t\t\t\t} else if (b instanceof ColorHover) {\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t}));\n\t\t} else {\n\t\t\tthis._result = this._result.concat(result);\n\t\t}\n\t}\n\n\tgetResult(): HoverPart[] {\n\t\treturn this._result.slice(0);\n\t}\n\n\tgetResultWithLoadingMessage(): HoverPart[] {\n\t\treturn this._result.slice(0).concat([this._getLoadingMessage()]);\n\t}\n\n\tprivate _getLoadingMessage(): HoverPart {\n\t\treturn {\n\t\t\trange: withNullAsUndefined(this._range),\n\t\t\tcontents: [new MarkdownString().appendText(nls.localize('modesContentHover.loading', \"Loading...\"))]\n\t\t};\n\t}\n}\n\nexport class ModesContentHoverWidget extends ContentHoverWidget {\n\n\tstatic readonly ID = 'editor.contrib.modesContentHoverWidget';\n\n\tprivate _messages: HoverPart[];\n\tprivate _lastRange: Range | null;\n\tprivate readonly _computer: ModesContentComputer;\n\tprivate readonly _hoverOperation: HoverOperation<HoverPart[]>;\n\tprivate _highlightDecorations: string[];\n\tprivate _isChangingDecorations: boolean;\n\tprivate _shouldFocus: boolean;\n\tprivate _colorPicker: ColorPickerWidget | null;\n\n\tprivate renderDisposable: IDisposable = Disposable.None;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\tmarkerDecorationsService: IMarkerDecorationsService,\n\t\tprivate readonly _themeService: IThemeService,\n\t\tprivate readonly _keybindingService: IKeybindingService,\n\t\tprivate readonly _contextMenuService: IContextMenuService,\n\t\tprivate readonly _bulkEditService: IBulkEditService,\n\t\tprivate readonly _commandService: ICommandService,\n\t\tprivate readonly _modeService: IModeService,\n\t\tprivate readonly _openerService: IOpenerService | null = NullOpenerService,\n\t) {\n\t\tsuper(ModesContentHoverWidget.ID, editor);\n\n\t\tthis._messages = [];\n\t\tthis._lastRange = null;\n\t\tthis._computer = new ModesContentComputer(this._editor, markerDecorationsService);\n\t\tthis._highlightDecorations = [];\n\t\tthis._isChangingDecorations = false;\n\n\t\tthis._hoverOperation = new HoverOperation(\n\t\t\tthis._computer,\n\t\t\tresult => this._withResult(result, true),\n\t\t\tnull,\n\t\t\tresult => this._withResult(result, false),\n\t\t\tthis._editor.getConfiguration().contribInfo.hover.delay\n\t\t);\n\n\t\tthis._register(dom.addStandardDisposableListener(this.getDomNode(), dom.EventType.FOCUS, () => {\n\t\t\tif (this._colorPicker) {\n\t\t\t\tdom.addClass(this.getDomNode(), 'colorpicker-hover');\n\t\t\t}\n\t\t}));\n\t\tthis._register(dom.addStandardDisposableListener(this.getDomNode(), dom.EventType.BLUR, () => {\n\t\t\tdom.removeClass(this.getDomNode(), 'colorpicker-hover');\n\t\t}));\n\t\tthis._register(editor.onDidChangeConfiguration((e) => {\n\t\t\tthis._hoverOperation.setHoverTime(this._editor.getConfiguration().contribInfo.hover.delay);\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis.renderDisposable.dispose();\n\t\tthis.renderDisposable = Disposable.None;\n\t\tthis._hoverOperation.cancel();\n\t\tsuper.dispose();\n\t}\n\n\tonModelDecorationsChanged(): void {\n\t\tif (this._isChangingDecorations) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.isVisible) {\n\t\t\t// The decorations have changed and the hover is visible,\n\t\t\t// we need to recompute the displayed text\n\t\t\tthis._hoverOperation.cancel();\n\t\t\tthis._computer.clearResult();\n\n\t\t\tif (!this._colorPicker) { // TODO@Michel ensure that displayed text for other decorations is computed even if color picker is in place\n\t\t\t\tthis._hoverOperation.start(HoverStartMode.Delayed);\n\t\t\t}\n\t\t}\n\t}\n\n\tstartShowingAt(range: Range, mode: HoverStartMode, focus: boolean): void {\n\t\tif (this._lastRange && this._lastRange.equalsRange(range)) {\n\t\t\t// We have to show the widget at the exact same range as before, so no work is needed\n\t\t\treturn;\n\t\t}\n\n\t\tthis._hoverOperation.cancel();\n\n\t\tif (this.isVisible) {\n\t\t\t// The range might have changed, but the hover is visible\n\t\t\t// Instead of hiding it completely, filter out messages that are still in the new range and\n\t\t\t// kick off a new computation\n\t\t\tif (!this._showAtPosition || this._showAtPosition.lineNumber !== range.startLineNumber) {\n\t\t\t\tthis.hide();\n\t\t\t} else {\n\t\t\t\tlet filteredMessages: HoverPart[] = [];\n\t\t\t\tfor (let i = 0, len = this._messages.length; i < len; i++) {\n\t\t\t\t\tconst msg = this._messages[i];\n\t\t\t\t\tconst rng = msg.range;\n\t\t\t\t\tif (rng && rng.startColumn <= range.startColumn && rng.endColumn >= range.endColumn) {\n\t\t\t\t\t\tfilteredMessages.push(msg);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (filteredMessages.length > 0) {\n\t\t\t\t\tif (hoverContentsEquals(filteredMessages, this._messages)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._renderMessages(range, filteredMessages);\n\t\t\t\t} else {\n\t\t\t\t\tthis.hide();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._lastRange = range;\n\t\tthis._computer.setRange(range);\n\t\tthis._shouldFocus = focus;\n\t\tthis._hoverOperation.start(mode);\n\t}\n\n\thide(): void {\n\t\tthis._lastRange = null;\n\t\tthis._hoverOperation.cancel();\n\t\tsuper.hide();\n\t\tthis._isChangingDecorations = true;\n\t\tthis._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, []);\n\t\tthis._isChangingDecorations = false;\n\t\tthis.renderDisposable.dispose();\n\t\tthis.renderDisposable = Disposable.None;\n\t\tthis._colorPicker = null;\n\t}\n\n\tisColorPickerVisible(): boolean {\n\t\tif (this._colorPicker) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _withResult(result: HoverPart[], complete: boolean): void {\n\t\tthis._messages = result;\n\n\t\tif (this._lastRange && this._messages.length > 0) {\n\t\t\tthis._renderMessages(this._lastRange, this._messages);\n\t\t} else if (complete) {\n\t\t\tthis.hide();\n\t\t}\n\t}\n\n\tprivate _renderMessages(renderRange: Range, messages: HoverPart[]): void {\n\t\tthis.renderDisposable.dispose();\n\t\tthis._colorPicker = null;\n\n\t\t// update column from which to show\n\t\tlet renderColumn = Number.MAX_VALUE;\n\t\tlet highlightRange: Range | null = messages[0].range ? Range.lift(messages[0].range) : null;\n\t\tlet fragment = document.createDocumentFragment();\n\t\tlet isEmptyHoverContent = true;\n\n\t\tlet containColorPicker = false;\n\t\tlet markdownDisposeables: IDisposable[] = [];\n\t\tconst markerMessages: MarkerHover[] = [];\n\t\tmessages.forEach((msg) => {\n\t\t\tif (!msg.range) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\trenderColumn = Math.min(renderColumn, msg.range.startColumn);\n\t\t\thighlightRange = highlightRange ? Range.plusRange(highlightRange, msg.range) : Range.lift(msg.range);\n\n\t\t\tif (msg instanceof ColorHover) {\n\t\t\t\tcontainColorPicker = true;\n\n\t\t\t\tconst { red, green, blue, alpha } = msg.color;\n\t\t\t\tconst rgba = new RGBA(red * 255, green * 255, blue * 255, alpha);\n\t\t\t\tconst color = new Color(rgba);\n\n\t\t\t\tif (!this._editor.hasModel()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst editorModel = this._editor.getModel();\n\t\t\t\tlet range = new Range(msg.range.startLineNumber, msg.range.startColumn, msg.range.endLineNumber, msg.range.endColumn);\n\t\t\t\tlet colorInfo = { range: msg.range, color: msg.color };\n\n\t\t\t\t// create blank olor picker model and widget first to ensure it's positioned correctly.\n\t\t\t\tconst model = new ColorPickerModel(color, [], 0);\n\t\t\t\tconst widget = new ColorPickerWidget(fragment, model, this._editor.getConfiguration().pixelRatio, this._themeService);\n\n\t\t\t\tgetColorPresentations(editorModel, colorInfo, msg.provider, CancellationToken.None).then(colorPresentations => {\n\t\t\t\t\tmodel.colorPresentations = colorPresentations || [];\n\t\t\t\t\tif (!this._editor.hasModel()) {\n\t\t\t\t\t\t// gone...\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst originalText = this._editor.getModel().getValueInRange(msg.range);\n\t\t\t\t\tmodel.guessColorPresentation(color, originalText);\n\n\t\t\t\t\tconst updateEditorModel = () => {\n\t\t\t\t\t\tlet textEdits: IIdentifiedSingleEditOperation[];\n\t\t\t\t\t\tlet newRange: Range;\n\t\t\t\t\t\tif (model.presentation.textEdit) {\n\t\t\t\t\t\t\ttextEdits = [model.presentation.textEdit as IIdentifiedSingleEditOperation];\n\t\t\t\t\t\t\tnewRange = new Range(\n\t\t\t\t\t\t\t\tmodel.presentation.textEdit.range.startLineNumber,\n\t\t\t\t\t\t\t\tmodel.presentation.textEdit.range.startColumn,\n\t\t\t\t\t\t\t\tmodel.presentation.textEdit.range.endLineNumber,\n\t\t\t\t\t\t\t\tmodel.presentation.textEdit.range.endColumn\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tnewRange = newRange.setEndPosition(newRange.endLineNumber, newRange.startColumn + model.presentation.textEdit.text.length);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttextEdits = [{ identifier: null, range, text: model.presentation.label, forceMoveMarkers: false }];\n\t\t\t\t\t\t\tnewRange = range.setEndPosition(range.endLineNumber, range.startColumn + model.presentation.label.length);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._editor.pushUndoStop();\n\t\t\t\t\t\tthis._editor.executeEdits('colorpicker', textEdits);\n\n\t\t\t\t\t\tif (model.presentation.additionalTextEdits) {\n\t\t\t\t\t\t\ttextEdits = [...model.presentation.additionalTextEdits as IIdentifiedSingleEditOperation[]];\n\t\t\t\t\t\t\tthis._editor.executeEdits('colorpicker', textEdits);\n\t\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._editor.pushUndoStop();\n\t\t\t\t\t\trange = newRange;\n\t\t\t\t\t};\n\n\t\t\t\t\tconst updateColorPresentations = (color: Color) => {\n\t\t\t\t\t\treturn getColorPresentations(editorModel, {\n\t\t\t\t\t\t\trange: range,\n\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\tred: color.rgba.r / 255,\n\t\t\t\t\t\t\t\tgreen: color.rgba.g / 255,\n\t\t\t\t\t\t\t\tblue: color.rgba.b / 255,\n\t\t\t\t\t\t\t\talpha: color.rgba.a\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, msg.provider, CancellationToken.None).then((colorPresentations) => {\n\t\t\t\t\t\t\tmodel.colorPresentations = colorPresentations || [];\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\tconst colorListener = model.onColorFlushed((color: Color) => {\n\t\t\t\t\t\tupdateColorPresentations(color).then(updateEditorModel);\n\t\t\t\t\t});\n\t\t\t\t\tconst colorChangeListener = model.onDidChangeColor(updateColorPresentations);\n\n\t\t\t\t\tthis._colorPicker = widget;\n\t\t\t\t\tthis.showAt(range.getStartPosition(), range, this._shouldFocus);\n\t\t\t\t\tthis.updateContents(fragment);\n\t\t\t\t\tthis._colorPicker.layout();\n\n\t\t\t\t\tthis.renderDisposable = combinedDisposable([colorListener, colorChangeListener, widget, ...markdownDisposeables]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (msg instanceof MarkerHover) {\n\t\t\t\t\tmarkerMessages.push(msg);\n\t\t\t\t\tisEmptyHoverContent = false;\n\t\t\t\t} else {\n\t\t\t\t\tmsg.contents\n\t\t\t\t\t\t.filter(contents => !isEmptyMarkdownString(contents))\n\t\t\t\t\t\t.forEach(contents => {\n\t\t\t\t\t\t\tconst markdownHoverElement = $('div.hover-row.markdown-hover');\n\t\t\t\t\t\t\tconst hoverContentsElement = dom.append(markdownHoverElement, $('div.hover-contents'));\n\t\t\t\t\t\t\tconst renderer = new MarkdownRenderer(this._editor, this._modeService, this._openerService);\n\t\t\t\t\t\t\tmarkdownDisposeables.push(renderer.onDidRenderCodeBlock(() => {\n\t\t\t\t\t\t\t\thoverContentsElement.className = 'hover-contents code-hover-contents';\n\t\t\t\t\t\t\t\tthis.onContentsChange();\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\tconst renderedContents = renderer.render(contents);\n\t\t\t\t\t\t\thoverContentsElement.appendChild(renderedContents.element);\n\t\t\t\t\t\t\tfragment.appendChild(markdownHoverElement);\n\t\t\t\t\t\t\tmarkdownDisposeables.push(renderedContents);\n\t\t\t\t\t\t\tisEmptyHoverContent = false;\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (markerMessages.length) {\n\t\t\tmarkerMessages.forEach(msg => fragment.appendChild(this.renderMarkerHover(msg)));\n\t\t\tconst markerHoverForStatusbar = markerMessages.length === 1 ? markerMessages[0] : markerMessages.sort((a, b) => MarkerSeverity.compare(a.marker.severity, b.marker.severity))[0];\n\t\t\tfragment.appendChild(this.renderMarkerStatusbar(markerHoverForStatusbar));\n\t\t}\n\n\t\t// show\n\n\t\tif (!containColorPicker && !isEmptyHoverContent) {\n\t\t\tthis.showAt(new Position(renderRange.startLineNumber, renderColumn), highlightRange, this._shouldFocus);\n\t\t\tthis.updateContents(fragment);\n\t\t}\n\n\t\tthis._isChangingDecorations = true;\n\t\tthis._highlightDecorations = this._editor.deltaDecorations(this._highlightDecorations, highlightRange ? [{\n\t\t\trange: highlightRange,\n\t\t\toptions: ModesContentHoverWidget._DECORATION_OPTIONS\n\t\t}] : []);\n\t\tthis._isChangingDecorations = false;\n\t}\n\n\tprivate renderMarkerHover(markerHover: MarkerHover): HTMLElement {\n\t\tconst hoverElement = $('div.hover-row');\n\t\tconst markerElement = dom.append(hoverElement, $('div.marker.hover-contents'));\n\t\tconst { source, message, code, relatedInformation } = markerHover.marker;\n\n\t\tthis._editor.applyFontInfo(markerElement);\n\t\tconst messageElement = dom.append(markerElement, $('span'));\n\t\tmessageElement.style.whiteSpace = 'pre-wrap';\n\t\tmessageElement.innerText = message;\n\n\t\tif (source || code) {\n\t\t\tconst detailsElement = dom.append(markerElement, $('span'));\n\t\t\tdetailsElement.style.opacity = '0.6';\n\t\t\tdetailsElement.style.paddingLeft = '6px';\n\t\t\tdetailsElement.innerText = source && code ? `${source}(${code})` : source ? source : `(${code})`;\n\t\t}\n\n\t\tif (isNonEmptyArray(relatedInformation)) {\n\t\t\tfor (const { message, resource, startLineNumber, startColumn } of relatedInformation) {\n\t\t\t\tconst relatedInfoContainer = dom.append(markerElement, $('div'));\n\t\t\t\trelatedInfoContainer.style.marginTop = '8px';\n\t\t\t\tconst a = dom.append(relatedInfoContainer, $('a'));\n\t\t\t\ta.innerText = `${basename(resource)}(${startLineNumber}, ${startColumn}): `;\n\t\t\t\ta.style.cursor = 'pointer';\n\t\t\t\ta.onclick = e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tif (this._openerService) {\n\t\t\t\t\t\tthis._openerService.open(resource.with({ fragment: `${startLineNumber},${startColumn}` })).catch(onUnexpectedError);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tconst messageElement = dom.append<HTMLAnchorElement>(relatedInfoContainer, $('span'));\n\t\t\t\tmessageElement.innerText = message;\n\t\t\t\tthis._editor.applyFontInfo(messageElement);\n\t\t\t}\n\t\t}\n\n\t\treturn hoverElement;\n\t}\n\n\tprivate renderMarkerStatusbar(markerHover: MarkerHover): HTMLElement {\n\t\tconst hoverElement = $('div.hover-row.status-bar');\n\t\tconst disposables: IDisposable[] = [];\n\t\tconst actionsElement = dom.append(hoverElement, $('div.actions'));\n\t\tdisposables.push(this.renderAction(actionsElement, {\n\t\t\tlabel: nls.localize('quick fixes', \"Quick Fix...\"),\n\t\t\tcommandId: QuickFixAction.Id,\n\t\t\trun: async (target) => {\n\t\t\t\tconst codeActionsPromise = this.getCodeActions(markerHover.marker);\n\t\t\t\tdisposables.push(toDisposable(() => codeActionsPromise.cancel()));\n\t\t\t\tconst actions = await codeActionsPromise;\n\t\t\t\tconst elementPosition = dom.getDomNodePagePosition(target);\n\t\t\t\tthis._contextMenuService.showContextMenu({\n\t\t\t\t\tgetAnchor: () => ({ x: elementPosition.left + 6, y: elementPosition.top + elementPosition.height + 6 }),\n\t\t\t\t\tgetActions: () => actions\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t\tif (markerHover.marker.severity === MarkerSeverity.Error || markerHover.marker.severity === MarkerSeverity.Warning || markerHover.marker.severity === MarkerSeverity.Info) {\n\t\t\tdisposables.push(this.renderAction(actionsElement, {\n\t\t\t\tlabel: nls.localize('peek problem', \"Peek Problem\"),\n\t\t\t\tcommandId: NextMarkerAction.ID,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis.hide();\n\t\t\t\t\tMarkerController.get(this._editor).show(markerHover.marker);\n\t\t\t\t\tthis._editor.focus();\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t\tthis.renderDisposable = combinedDisposable(disposables);\n\t\treturn hoverElement;\n\t}\n\n\tprivate getCodeActions(marker: IMarker): CancelablePromise<Action[]> {\n\t\treturn createCancelablePromise(async cancellationToken => {\n\t\t\tconst codeActions = await getCodeActions(this._editor.getModel()!, new Range(marker.startLineNumber, marker.startColumn, marker.endLineNumber, marker.endColumn), { type: 'manual', filter: { kind: CodeActionKind.QuickFix } }, cancellationToken);\n\t\t\tif (codeActions.actions.length) {\n\t\t\t\treturn codeActions.actions.map(codeAction => new Action(\n\t\t\t\t\tcodeAction.command ? codeAction.command.id : codeAction.title,\n\t\t\t\t\tcodeAction.title,\n\t\t\t\t\tundefined,\n\t\t\t\t\ttrue,\n\t\t\t\t\t() => applyCodeAction(codeAction, this._bulkEditService, this._commandService)));\n\t\t\t}\n\t\t\treturn [\n\t\t\t\tnew Action('', nls.localize('editor.action.quickFix.noneMessage', \"No code actions available\"))\n\t\t\t];\n\t\t});\n\t}\n\n\tprivate renderAction(parent: HTMLElement, actionOptions: { label: string, iconClass?: string, run: (target: HTMLElement) => void, commandId: string }): IDisposable {\n\t\tconst actionContainer = dom.append(parent, $('div.action-container'));\n\t\tconst action = dom.append(actionContainer, $('a.action'));\n\t\tif (actionOptions.iconClass) {\n\t\t\tdom.append(action, $(`span.icon.${actionOptions.iconClass}`));\n\t\t}\n\t\tconst label = dom.append(action, $('span'));\n\t\tlabel.textContent = actionOptions.label;\n\t\tconst keybinding = this._keybindingService.lookupKeybinding(actionOptions.commandId);\n\t\tif (keybinding) {\n\t\t\tlabel.title = `${actionOptions.label} (${keybinding.getLabel()})`;\n\t\t}\n\t\treturn dom.addDisposableListener(actionContainer, dom.EventType.CLICK, e => {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t\tactionOptions.run(actionContainer);\n\t\t});\n\t}\n\n\tprivate static readonly _DECORATION_OPTIONS = ModelDecorationOptions.register({\n\t\tclassName: 'hoverHighlight'\n\t});\n}\n\nfunction hoverContentsEquals(first: HoverPart[], second: HoverPart[]): boolean {\n\tif ((!first && second) || (first && !second) || first.length !== second.length) {\n\t\treturn false;\n\t}\n\tfor (let i = 0; i < first.length; i++) {\n\t\tconst firstElement = first[i];\n\t\tconst secondElement = second[i];\n\t\tif (firstElement instanceof MarkerHover && secondElement instanceof MarkerHover) {\n\t\t\treturn IMarkerData.makeKey(firstElement.marker) === IMarkerData.makeKey(secondElement.marker);\n\t\t}\n\t\tif (firstElement instanceof ColorHover || secondElement instanceof ColorHover) {\n\t\t\treturn false;\n\t\t}\n\t\tif (firstElement instanceof MarkerHover || secondElement instanceof MarkerHover) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!markedStringsEquals(firstElement.contents, secondElement.contents)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n"]}]}