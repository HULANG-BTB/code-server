{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/resourceViewer.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/resourceViewer.ts","mtime":1555846338036},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nrequire(\"vs/css!./media/resourceviewer\");\nvar nls = require(\"vs/nls\");\nvar mimes = require(\"vs/base/common/mime\");\nvar DOM = require(\"vs/base/browser/dom\");\nvar map_1 = require(\"vs/base/common/map\");\nvar network_1 = require(\"vs/base/common/network\");\nvar numbers_1 = require(\"vs/base/common/numbers\");\nvar theme_1 = require(\"vs/workbench/common/theme\");\nvar contextView_1 = require(\"vs/platform/contextview/browser/contextView\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar actions_1 = require(\"vs/base/common/actions\");\nvar editorService_1 = require(\"vs/workbench/services/editor/common/editorService\");\nvar decorators_1 = require(\"vs/base/common/decorators\");\nvar browser = require(\"vs/base/browser/browser\");\nvar BinarySize = /** @class */ (function () {\n    function BinarySize() {\n    }\n    BinarySize.formatSize = function (size) {\n        if (size < BinarySize.KB) {\n            return nls.localize('sizeB', \"{0}B\", size);\n        }\n        if (size < BinarySize.MB) {\n            return nls.localize('sizeKB', \"{0}KB\", (size / BinarySize.KB).toFixed(2));\n        }\n        if (size < BinarySize.GB) {\n            return nls.localize('sizeMB', \"{0}MB\", (size / BinarySize.MB).toFixed(2));\n        }\n        if (size < BinarySize.TB) {\n            return nls.localize('sizeGB', \"{0}GB\", (size / BinarySize.GB).toFixed(2));\n        }\n        return nls.localize('sizeTB', \"{0}TB\", (size / BinarySize.TB).toFixed(2));\n    };\n    BinarySize.KB = 1024;\n    BinarySize.MB = BinarySize.KB * BinarySize.KB;\n    BinarySize.GB = BinarySize.MB * BinarySize.KB;\n    BinarySize.TB = BinarySize.GB * BinarySize.KB;\n    return BinarySize;\n}());\n/**\n * Helper to actually render the given resource into the provided container. Will adjust scrollbar (if provided) automatically based on loading\n * progress of the binary resource.\n */\nvar ResourceViewer = /** @class */ (function () {\n    function ResourceViewer() {\n    }\n    ResourceViewer.show = function (descriptor, fileService, container, scrollbar, openInternalClb, openExternalClb, metadataClb) {\n        // Ensure CSS class\n        container.className = 'monaco-resource-viewer';\n        // Images\n        if (ResourceViewer.isImageResource(descriptor)) {\n            return ImageView.create(container, descriptor, fileService, scrollbar, openExternalClb, metadataClb);\n        }\n        // Large Files\n        if (descriptor.size > ResourceViewer.MAX_OPEN_INTERNAL_SIZE) {\n            return FileTooLargeFileView.create(container, descriptor, scrollbar, metadataClb);\n        }\n        // Seemingly Binary Files\n        else {\n            return FileSeemsBinaryFileView.create(container, descriptor, scrollbar, openInternalClb, metadataClb);\n        }\n    };\n    ResourceViewer.isImageResource = function (descriptor) {\n        var mime = getMime(descriptor);\n        // Chrome does not support tiffs\n        return mime.indexOf('image/') >= 0 && mime !== 'image/tiff';\n    };\n    ResourceViewer.MAX_OPEN_INTERNAL_SIZE = BinarySize.MB * 200; // max size until we offer an action to open internally\n    return ResourceViewer;\n}());\nexports.ResourceViewer = ResourceViewer;\nvar ImageView = /** @class */ (function () {\n    function ImageView() {\n    }\n    ImageView.create = function (container, descriptor, fileService, scrollbar, openExternalClb, metadataClb) {\n        if (ImageView.shouldShowImageInline(descriptor)) {\n            return InlineImageView.create(container, descriptor, fileService, scrollbar, metadataClb);\n        }\n        return LargeImageView.create(container, descriptor, openExternalClb, metadataClb);\n    };\n    ImageView.shouldShowImageInline = function (descriptor) {\n        var skipInlineImage;\n        // Data URI\n        if (descriptor.resource.scheme === network_1.Schemas.data) {\n            var base64MarkerIndex = descriptor.resource.path.indexOf(ImageView.BASE64_MARKER);\n            var hasData = base64MarkerIndex >= 0 && descriptor.resource.path.substring(base64MarkerIndex + ImageView.BASE64_MARKER.length).length > 0;\n            skipInlineImage = !hasData || descriptor.size > ImageView.MAX_IMAGE_SIZE || descriptor.resource.path.length > ImageView.MAX_IMAGE_SIZE;\n        }\n        // File URI\n        else {\n            skipInlineImage = typeof descriptor.size !== 'number' || descriptor.size > ImageView.MAX_IMAGE_SIZE;\n        }\n        return !skipInlineImage;\n    };\n    ImageView.MAX_IMAGE_SIZE = BinarySize.MB; // showing images inline is memory intense, so we have a limit\n    ImageView.BASE64_MARKER = 'base64,';\n    return ImageView;\n}());\nvar LargeImageView = /** @class */ (function () {\n    function LargeImageView() {\n    }\n    LargeImageView.create = function (container, descriptor, openExternalClb, metadataClb) {\n        var size = BinarySize.formatSize(descriptor.size);\n        metadataClb(size);\n        DOM.clearNode(container);\n        var disposables = [];\n        var label = document.createElement('p');\n        label.textContent = nls.localize('largeImageError', \"The image is not displayed in the editor because it is too large ({0}).\", size);\n        container.appendChild(label);\n        if (descriptor.resource.scheme !== network_1.Schemas.data) {\n            var link = DOM.append(label, DOM.$('a.embedded-link'));\n            link.setAttribute('role', 'button');\n            link.textContent = nls.localize('resourceOpenExternalButton', \"Open image using external program?\");\n            disposables.push(DOM.addDisposableListener(link, DOM.EventType.CLICK, function () { return openExternalClb(descriptor.resource); }));\n        }\n        return lifecycle_1.combinedDisposable(disposables);\n    };\n    return LargeImageView;\n}());\nvar FileTooLargeFileView = /** @class */ (function () {\n    function FileTooLargeFileView() {\n    }\n    FileTooLargeFileView.create = function (container, descriptor, scrollbar, metadataClb) {\n        var size = BinarySize.formatSize(descriptor.size);\n        metadataClb(size);\n        DOM.clearNode(container);\n        var label = document.createElement('span');\n        label.textContent = nls.localize('nativeFileTooLargeError', \"The file is not displayed in the editor because it is too large ({0}).\", size);\n        container.appendChild(label);\n        scrollbar.scanDomNode();\n        return lifecycle_1.Disposable.None;\n    };\n    return FileTooLargeFileView;\n}());\nvar FileSeemsBinaryFileView = /** @class */ (function () {\n    function FileSeemsBinaryFileView() {\n    }\n    FileSeemsBinaryFileView.create = function (container, descriptor, scrollbar, openInternalClb, metadataClb) {\n        metadataClb(typeof descriptor.size === 'number' ? BinarySize.formatSize(descriptor.size) : '');\n        DOM.clearNode(container);\n        var disposables = [];\n        var label = document.createElement('p');\n        label.textContent = nls.localize('nativeBinaryError', \"The file is not displayed in the editor because it is either binary or uses an unsupported text encoding.\");\n        container.appendChild(label);\n        if (descriptor.resource.scheme !== network_1.Schemas.data) {\n            var link = DOM.append(label, DOM.$('a.embedded-link'));\n            link.setAttribute('role', 'button');\n            link.textContent = nls.localize('openAsText', \"Do you want to open it anyway?\");\n            disposables.push(DOM.addDisposableListener(link, DOM.EventType.CLICK, function () { return openInternalClb(descriptor.resource); }));\n        }\n        scrollbar.scanDomNode();\n        return lifecycle_1.combinedDisposable(disposables);\n    };\n    return FileSeemsBinaryFileView;\n}());\nvar ZoomStatusbarItem = /** @class */ (function (_super) {\n    tslib_1.__extends(ZoomStatusbarItem, _super);\n    function ZoomStatusbarItem(contextMenuService, editorService, themeService) {\n        var _this = _super.call(this, themeService) || this;\n        _this.contextMenuService = contextMenuService;\n        ZoomStatusbarItem.instance = _this;\n        _this._register(editorService.onDidActiveEditorChange(function () { return _this.onActiveEditorChanged(); }));\n        return _this;\n    }\n    ZoomStatusbarItem.prototype.onActiveEditorChanged = function () {\n        this.hide();\n        this.onSelectScale = undefined;\n    };\n    ZoomStatusbarItem.prototype.show = function (scale, onSelectScale) {\n        var _this = this;\n        clearTimeout(this.showTimeout);\n        this.showTimeout = setTimeout(function () {\n            _this.onSelectScale = onSelectScale;\n            _this.statusBarItem.style.display = 'block';\n            _this.updateLabel(scale);\n        }, 0);\n    };\n    ZoomStatusbarItem.prototype.hide = function () {\n        this.statusBarItem.style.display = 'none';\n    };\n    ZoomStatusbarItem.prototype.render = function (container) {\n        var _this = this;\n        if (!this.statusBarItem && container) {\n            this.statusBarItem = DOM.append(container, DOM.$('a.zoom-statusbar-item'));\n            this.statusBarItem.setAttribute('role', 'button');\n            this.statusBarItem.style.display = 'none';\n            DOM.addDisposableListener(this.statusBarItem, DOM.EventType.CLICK, function () {\n                _this.contextMenuService.showContextMenu({\n                    getAnchor: function () { return container; },\n                    getActions: function () { return _this.zoomActions; }\n                });\n            });\n        }\n        return this;\n    };\n    ZoomStatusbarItem.prototype.updateLabel = function (scale) {\n        this.statusBarItem.textContent = ZoomStatusbarItem.zoomLabel(scale);\n    };\n    Object.defineProperty(ZoomStatusbarItem.prototype, \"zoomActions\", {\n        get: function () {\n            var _this = this;\n            var scales = [10, 5, 2, 1, 0.5, 0.2, 'fit'];\n            return scales.map(function (scale) {\n                return new actions_1.Action(\"zoom.\" + scale, ZoomStatusbarItem.zoomLabel(scale), undefined, undefined, function () {\n                    if (_this.onSelectScale) {\n                        _this.onSelectScale(scale);\n                    }\n                    return Promise.resolve(undefined);\n                });\n            });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ZoomStatusbarItem.zoomLabel = function (scale) {\n        return scale === 'fit'\n            ? nls.localize('zoom.action.fit.label', 'Whole Image')\n            : Math.round(scale * 100) + \"%\";\n    };\n    tslib_1.__decorate([\n        decorators_1.memoize\n    ], ZoomStatusbarItem.prototype, \"zoomActions\", null);\n    ZoomStatusbarItem = tslib_1.__decorate([\n        tslib_1.__param(0, contextView_1.IContextMenuService),\n        tslib_1.__param(1, editorService_1.IEditorService),\n        tslib_1.__param(2, themeService_1.IThemeService)\n    ], ZoomStatusbarItem);\n    return ZoomStatusbarItem;\n}(theme_1.Themable));\nexports.ZoomStatusbarItem = ZoomStatusbarItem;\nvar InlineImageView = /** @class */ (function () {\n    function InlineImageView() {\n    }\n    InlineImageView.create = function (container, descriptor, fileService, scrollbar, metadataClb) {\n        var disposables = [];\n        var context = {\n            layout: function (dimension) { },\n            dispose: function () { return lifecycle_1.combinedDisposable(disposables).dispose(); }\n        };\n        var cacheKey = descriptor.resource.toString();\n        var ctrlPressed = false;\n        var altPressed = false;\n        var initialState = InlineImageView.imageStateCache.get(cacheKey) || { scale: 'fit', offsetX: 0, offsetY: 0 };\n        var scale = initialState.scale;\n        var image = null;\n        function updateScale(newScale) {\n            if (!image || !image.parentElement) {\n                return;\n            }\n            if (newScale === 'fit') {\n                scale = 'fit';\n                DOM.addClass(image, 'scale-to-fit');\n                DOM.removeClass(image, 'pixelated');\n                image.style.minWidth = 'auto';\n                image.style.width = 'auto';\n                InlineImageView.imageStateCache.delete(cacheKey);\n            }\n            else {\n                var oldWidth = image.width;\n                var oldHeight = image.height;\n                scale = numbers_1.clamp(newScale, InlineImageView.MIN_SCALE, InlineImageView.MAX_SCALE);\n                if (scale >= InlineImageView.PIXELATION_THRESHOLD) {\n                    DOM.addClass(image, 'pixelated');\n                }\n                else {\n                    DOM.removeClass(image, 'pixelated');\n                }\n                var _a = image.parentElement, scrollTop = _a.scrollTop, scrollLeft = _a.scrollLeft;\n                var dx = (scrollLeft + image.parentElement.clientWidth / 2) / image.parentElement.scrollWidth;\n                var dy = (scrollTop + image.parentElement.clientHeight / 2) / image.parentElement.scrollHeight;\n                DOM.removeClass(image, 'scale-to-fit');\n                image.style.minWidth = (image.naturalWidth * scale) + \"px\";\n                image.style.width = (image.naturalWidth * scale) + \"px\";\n                var newWidth = image.width;\n                var scaleFactor = (newWidth - oldWidth) / oldWidth;\n                var newScrollLeft = ((oldWidth * scaleFactor * dx) + scrollLeft);\n                var newScrollTop = ((oldHeight * scaleFactor * dy) + scrollTop);\n                scrollbar.setScrollPosition({\n                    scrollLeft: newScrollLeft,\n                    scrollTop: newScrollTop,\n                });\n                InlineImageView.imageStateCache.set(cacheKey, { scale: scale, offsetX: newScrollLeft, offsetY: newScrollTop });\n            }\n            ZoomStatusbarItem.instance.show(scale, updateScale);\n            scrollbar.scanDomNode();\n        }\n        function firstZoom() {\n            if (!image) {\n                return;\n            }\n            scale = image.clientWidth / image.naturalWidth;\n            updateScale(scale);\n        }\n        disposables.push(DOM.addDisposableListener(window, DOM.EventType.KEY_DOWN, function (e) {\n            if (!image) {\n                return;\n            }\n            ctrlPressed = e.ctrlKey;\n            altPressed = e.altKey;\n            if (browser.isMacintosh ? altPressed : ctrlPressed) {\n                DOM.removeClass(container, 'zoom-in');\n                DOM.addClass(container, 'zoom-out');\n            }\n        }));\n        disposables.push(DOM.addDisposableListener(window, DOM.EventType.KEY_UP, function (e) {\n            if (!image) {\n                return;\n            }\n            ctrlPressed = e.ctrlKey;\n            altPressed = e.altKey;\n            if (!(browser.isMacintosh ? altPressed : ctrlPressed)) {\n                DOM.removeClass(container, 'zoom-out');\n                DOM.addClass(container, 'zoom-in');\n            }\n        }));\n        disposables.push(DOM.addDisposableListener(container, DOM.EventType.CLICK, function (e) {\n            if (!image) {\n                return;\n            }\n            if (e.button !== 0) {\n                return;\n            }\n            // left click\n            if (scale === 'fit') {\n                firstZoom();\n            }\n            if (!(browser.isMacintosh ? altPressed : ctrlPressed)) { // zoom in\n                var i = 0;\n                for (; i < InlineImageView.zoomLevels.length; ++i) {\n                    if (InlineImageView.zoomLevels[i] > scale) {\n                        break;\n                    }\n                }\n                updateScale(InlineImageView.zoomLevels[i] || InlineImageView.MAX_SCALE);\n            }\n            else {\n                var i = InlineImageView.zoomLevels.length - 1;\n                for (; i >= 0; --i) {\n                    if (InlineImageView.zoomLevels[i] < scale) {\n                        break;\n                    }\n                }\n                updateScale(InlineImageView.zoomLevels[i] || InlineImageView.MIN_SCALE);\n            }\n        }));\n        disposables.push(DOM.addDisposableListener(container, DOM.EventType.WHEEL, function (e) {\n            if (!image) {\n                return;\n            }\n            var isScrollWhellKeyPressed = browser.isMacintosh ? altPressed : ctrlPressed;\n            if (!isScrollWhellKeyPressed && !e.ctrlKey) { // pinching is reported as scroll wheel + ctrl\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            if (scale === 'fit') {\n                firstZoom();\n            }\n            var delta = e.deltaY < 0 ? 1 : -1;\n            // Pinching should increase the scale\n            if (e.ctrlKey && !isScrollWhellKeyPressed) {\n                delta *= -1;\n            }\n            updateScale(scale * (1 - delta * InlineImageView.SCALE_PINCH_FACTOR));\n        }));\n        disposables.push(DOM.addDisposableListener(container, DOM.EventType.SCROLL, function () {\n            if (!image || !image.parentElement || scale === 'fit') {\n                return;\n            }\n            var entry = InlineImageView.imageStateCache.get(cacheKey);\n            if (entry) {\n                var _a = image.parentElement, scrollTop = _a.scrollTop, scrollLeft = _a.scrollLeft;\n                InlineImageView.imageStateCache.set(cacheKey, { scale: entry.scale, offsetX: scrollLeft, offsetY: scrollTop });\n            }\n        }));\n        DOM.clearNode(container);\n        DOM.addClasses(container, 'image', 'zoom-in');\n        image = DOM.append(container, DOM.$('img.scale-to-fit'));\n        image.style.visibility = 'hidden';\n        disposables.push(DOM.addDisposableListener(image, DOM.EventType.LOAD, function (e) {\n            if (!image) {\n                return;\n            }\n            if (typeof descriptor.size === 'number') {\n                metadataClb(nls.localize('imgMeta', '{0}x{1} {2}', image.naturalWidth, image.naturalHeight, BinarySize.formatSize(descriptor.size)));\n            }\n            else {\n                metadataClb(nls.localize('imgMetaNoSize', '{0}x{1}', image.naturalWidth, image.naturalHeight));\n            }\n            scrollbar.scanDomNode();\n            image.style.visibility = 'visible';\n            updateScale(scale);\n            if (initialState.scale !== 'fit') {\n                scrollbar.setScrollPosition({\n                    scrollLeft: initialState.offsetX,\n                    scrollTop: initialState.offsetY,\n                });\n            }\n        }));\n        InlineImageView.imageSrc(descriptor, fileService).then(function (dataUri) {\n            var imgs = container.getElementsByTagName('img');\n            if (imgs.length) {\n                imgs[0].src = dataUri;\n            }\n        });\n        return context;\n    };\n    InlineImageView.imageSrc = function (descriptor, fileService) {\n        if (descriptor.resource.scheme === network_1.Schemas.data) {\n            return Promise.resolve(descriptor.resource.toString(true /* skip encoding */));\n        }\n        return fileService.resolveContent(descriptor.resource, { encoding: 'base64' }).then(function (data) {\n            var mime = getMime(descriptor);\n            return \"data:\" + mime + \";base64,\" + data.value;\n        });\n    };\n    InlineImageView.SCALE_PINCH_FACTOR = 0.075;\n    InlineImageView.MAX_SCALE = 20;\n    InlineImageView.MIN_SCALE = 0.1;\n    InlineImageView.zoomLevels = [\n        0.1,\n        0.2,\n        0.3,\n        0.4,\n        0.5,\n        0.6,\n        0.7,\n        0.8,\n        0.9,\n        1,\n        1.5,\n        2,\n        3,\n        5,\n        7,\n        10,\n        15,\n        20\n    ];\n    /**\n     * Enable image-rendering: pixelated for images scaled by more than this.\n     */\n    InlineImageView.PIXELATION_THRESHOLD = 3;\n    /**\n     * Store the scale and position of an image so it can be restored when changing editor tabs\n     */\n    InlineImageView.imageStateCache = new map_1.LRUCache(100);\n    return InlineImageView;\n}());\nfunction getMime(descriptor) {\n    var mime = descriptor.mime;\n    if (!mime && descriptor.resource.scheme !== network_1.Schemas.data) {\n        mime = mimes.getMediaMime(descriptor.resource.path);\n    }\n    return mime || mimes.MIME_BINARY;\n}\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/resourceViewer.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/workbench/browser/parts/editor/resourceViewer.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/resourceviewer';\nimport * as nls from 'vs/nls';\nimport * as mimes from 'vs/base/common/mime';\nimport { URI } from 'vs/base/common/uri';\nimport * as DOM from 'vs/base/browser/dom';\nimport { DomScrollableElement } from 'vs/base/browser/ui/scrollbar/scrollableElement';\nimport { LRUCache } from 'vs/base/common/map';\nimport { Schemas } from 'vs/base/common/network';\nimport { clamp } from 'vs/base/common/numbers';\nimport { Themable } from 'vs/workbench/common/theme';\nimport { IStatusbarItem } from 'vs/workbench/browser/parts/statusbar/statusbar';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { IDisposable, Disposable, combinedDisposable } from 'vs/base/common/lifecycle';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { Action } from 'vs/base/common/actions';\nimport { IEditorService } from 'vs/workbench/services/editor/common/editorService';\nimport { memoize } from 'vs/base/common/decorators';\nimport * as browser from 'vs/base/browser/browser';\nimport { IFileService } from 'vs/platform/files/common/files';\n\nexport interface IResourceDescriptor {\n\treadonly resource: URI;\n\treadonly name: string;\n\treadonly size: number;\n\treadonly etag?: string;\n\treadonly mime: string;\n}\n\nclass BinarySize {\n\tstatic readonly KB = 1024;\n\tstatic readonly MB = BinarySize.KB * BinarySize.KB;\n\tstatic readonly GB = BinarySize.MB * BinarySize.KB;\n\tstatic readonly TB = BinarySize.GB * BinarySize.KB;\n\n\tstatic formatSize(size: number): string {\n\t\tif (size < BinarySize.KB) {\n\t\t\treturn nls.localize('sizeB', \"{0}B\", size);\n\t\t}\n\n\t\tif (size < BinarySize.MB) {\n\t\t\treturn nls.localize('sizeKB', \"{0}KB\", (size / BinarySize.KB).toFixed(2));\n\t\t}\n\n\t\tif (size < BinarySize.GB) {\n\t\t\treturn nls.localize('sizeMB', \"{0}MB\", (size / BinarySize.MB).toFixed(2));\n\t\t}\n\n\t\tif (size < BinarySize.TB) {\n\t\t\treturn nls.localize('sizeGB', \"{0}GB\", (size / BinarySize.GB).toFixed(2));\n\t\t}\n\n\t\treturn nls.localize('sizeTB', \"{0}TB\", (size / BinarySize.TB).toFixed(2));\n\t}\n}\n\nexport interface ResourceViewerContext extends IDisposable {\n\tlayout?(dimension: DOM.Dimension): void;\n}\n\n/**\n * Helper to actually render the given resource into the provided container. Will adjust scrollbar (if provided) automatically based on loading\n * progress of the binary resource.\n */\nexport class ResourceViewer {\n\n\tprivate static readonly MAX_OPEN_INTERNAL_SIZE = BinarySize.MB * 200; // max size until we offer an action to open internally\n\n\tstatic show(\n\t\tdescriptor: IResourceDescriptor,\n\t\tfileService: IFileService,\n\t\tcontainer: HTMLElement,\n\t\tscrollbar: DomScrollableElement,\n\t\topenInternalClb: (uri: URI) => void,\n\t\topenExternalClb: (uri: URI) => void,\n\t\tmetadataClb: (meta: string) => void\n\t): ResourceViewerContext {\n\n\t\t// Ensure CSS class\n\t\tcontainer.className = 'monaco-resource-viewer';\n\n\t\t// Images\n\t\tif (ResourceViewer.isImageResource(descriptor)) {\n\t\t\treturn ImageView.create(container, descriptor, fileService, scrollbar, openExternalClb, metadataClb);\n\t\t}\n\n\t\t// Large Files\n\t\tif (descriptor.size > ResourceViewer.MAX_OPEN_INTERNAL_SIZE) {\n\t\t\treturn FileTooLargeFileView.create(container, descriptor, scrollbar, metadataClb);\n\t\t}\n\n\t\t// Seemingly Binary Files\n\t\telse {\n\t\t\treturn FileSeemsBinaryFileView.create(container, descriptor, scrollbar, openInternalClb, metadataClb);\n\t\t}\n\t}\n\n\tprivate static isImageResource(descriptor: IResourceDescriptor) {\n\t\tconst mime = getMime(descriptor);\n\n\t\t// Chrome does not support tiffs\n\t\treturn mime.indexOf('image/') >= 0 && mime !== 'image/tiff';\n\t}\n}\n\nclass ImageView {\n\tprivate static readonly MAX_IMAGE_SIZE = BinarySize.MB; // showing images inline is memory intense, so we have a limit\n\tprivate static readonly BASE64_MARKER = 'base64,';\n\n\tstatic create(\n\t\tcontainer: HTMLElement,\n\t\tdescriptor: IResourceDescriptor,\n\t\tfileService: IFileService,\n\t\tscrollbar: DomScrollableElement,\n\t\topenExternalClb: (uri: URI) => void,\n\t\tmetadataClb: (meta: string) => void\n\t): ResourceViewerContext {\n\t\tif (ImageView.shouldShowImageInline(descriptor)) {\n\t\t\treturn InlineImageView.create(container, descriptor, fileService, scrollbar, metadataClb);\n\t\t}\n\n\t\treturn LargeImageView.create(container, descriptor, openExternalClb, metadataClb);\n\t}\n\n\tprivate static shouldShowImageInline(descriptor: IResourceDescriptor): boolean {\n\t\tlet skipInlineImage: boolean;\n\n\t\t// Data URI\n\t\tif (descriptor.resource.scheme === Schemas.data) {\n\t\t\tconst base64MarkerIndex = descriptor.resource.path.indexOf(ImageView.BASE64_MARKER);\n\t\t\tconst hasData = base64MarkerIndex >= 0 && descriptor.resource.path.substring(base64MarkerIndex + ImageView.BASE64_MARKER.length).length > 0;\n\n\t\t\tskipInlineImage = !hasData || descriptor.size > ImageView.MAX_IMAGE_SIZE || descriptor.resource.path.length > ImageView.MAX_IMAGE_SIZE;\n\t\t}\n\n\t\t// File URI\n\t\telse {\n\t\t\tskipInlineImage = typeof descriptor.size !== 'number' || descriptor.size > ImageView.MAX_IMAGE_SIZE;\n\t\t}\n\n\t\treturn !skipInlineImage;\n\t}\n}\n\nclass LargeImageView {\n\tstatic create(\n\t\tcontainer: HTMLElement,\n\t\tdescriptor: IResourceDescriptor,\n\t\topenExternalClb: (uri: URI) => void,\n\t\tmetadataClb: (meta: string) => void\n\t) {\n\t\tconst size = BinarySize.formatSize(descriptor.size);\n\t\tmetadataClb(size);\n\n\t\tDOM.clearNode(container);\n\n\t\tconst disposables: IDisposable[] = [];\n\n\t\tconst label = document.createElement('p');\n\t\tlabel.textContent = nls.localize('largeImageError', \"The image is not displayed in the editor because it is too large ({0}).\", size);\n\t\tcontainer.appendChild(label);\n\n\t\tif (descriptor.resource.scheme !== Schemas.data) {\n\t\t\tconst link = DOM.append(label, DOM.$('a.embedded-link'));\n\t\t\tlink.setAttribute('role', 'button');\n\t\t\tlink.textContent = nls.localize('resourceOpenExternalButton', \"Open image using external program?\");\n\n\t\t\tdisposables.push(DOM.addDisposableListener(link, DOM.EventType.CLICK, () => openExternalClb(descriptor.resource)));\n\t\t}\n\n\t\treturn combinedDisposable(disposables);\n\t}\n}\n\nclass FileTooLargeFileView {\n\tstatic create(\n\t\tcontainer: HTMLElement,\n\t\tdescriptor: IResourceDescriptor,\n\t\tscrollbar: DomScrollableElement,\n\t\tmetadataClb: (meta: string) => void\n\t) {\n\t\tconst size = BinarySize.formatSize(descriptor.size);\n\t\tmetadataClb(size);\n\n\t\tDOM.clearNode(container);\n\n\t\tconst label = document.createElement('span');\n\t\tlabel.textContent = nls.localize('nativeFileTooLargeError', \"The file is not displayed in the editor because it is too large ({0}).\", size);\n\t\tcontainer.appendChild(label);\n\n\t\tscrollbar.scanDomNode();\n\n\t\treturn Disposable.None;\n\t}\n}\n\nclass FileSeemsBinaryFileView {\n\tstatic create(\n\t\tcontainer: HTMLElement,\n\t\tdescriptor: IResourceDescriptor,\n\t\tscrollbar: DomScrollableElement,\n\t\topenInternalClb: (uri: URI) => void,\n\t\tmetadataClb: (meta: string) => void\n\t) {\n\t\tmetadataClb(typeof descriptor.size === 'number' ? BinarySize.formatSize(descriptor.size) : '');\n\n\t\tDOM.clearNode(container);\n\n\t\tconst disposables: IDisposable[] = [];\n\n\t\tconst label = document.createElement('p');\n\t\tlabel.textContent = nls.localize('nativeBinaryError', \"The file is not displayed in the editor because it is either binary or uses an unsupported text encoding.\");\n\t\tcontainer.appendChild(label);\n\n\t\tif (descriptor.resource.scheme !== Schemas.data) {\n\t\t\tconst link = DOM.append(label, DOM.$('a.embedded-link'));\n\t\t\tlink.setAttribute('role', 'button');\n\t\t\tlink.textContent = nls.localize('openAsText', \"Do you want to open it anyway?\");\n\n\t\t\tdisposables.push(DOM.addDisposableListener(link, DOM.EventType.CLICK, () => openInternalClb(descriptor.resource)));\n\t\t}\n\n\t\tscrollbar.scanDomNode();\n\n\t\treturn combinedDisposable(disposables);\n\t}\n}\n\ntype Scale = number | 'fit';\n\nexport class ZoomStatusbarItem extends Themable implements IStatusbarItem {\n\n\tstatic instance: ZoomStatusbarItem;\n\n\tprivate showTimeout: any;\n\n\tprivate statusBarItem: HTMLElement;\n\tprivate onSelectScale?: (scale: Scale) => void;\n\n\tconstructor(\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IThemeService themeService: IThemeService\n\t) {\n\t\tsuper(themeService);\n\n\t\tZoomStatusbarItem.instance = this;\n\n\t\tthis._register(editorService.onDidActiveEditorChange(() => this.onActiveEditorChanged()));\n\t}\n\n\tprivate onActiveEditorChanged(): void {\n\t\tthis.hide();\n\t\tthis.onSelectScale = undefined;\n\t}\n\n\tshow(scale: Scale, onSelectScale: (scale: number) => void) {\n\t\tclearTimeout(this.showTimeout);\n\t\tthis.showTimeout = setTimeout(() => {\n\t\t\tthis.onSelectScale = onSelectScale;\n\t\t\tthis.statusBarItem.style.display = 'block';\n\t\t\tthis.updateLabel(scale);\n\t\t}, 0);\n\t}\n\n\thide() {\n\t\tthis.statusBarItem.style.display = 'none';\n\t}\n\n\trender(container: HTMLElement): IDisposable {\n\t\tif (!this.statusBarItem && container) {\n\t\t\tthis.statusBarItem = DOM.append(container, DOM.$('a.zoom-statusbar-item'));\n\t\t\tthis.statusBarItem.setAttribute('role', 'button');\n\t\t\tthis.statusBarItem.style.display = 'none';\n\n\t\t\tDOM.addDisposableListener(this.statusBarItem, DOM.EventType.CLICK, () => {\n\t\t\t\tthis.contextMenuService.showContextMenu({\n\t\t\t\t\tgetAnchor: () => container,\n\t\t\t\t\tgetActions: () => this.zoomActions\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tprivate updateLabel(scale: Scale) {\n\t\tthis.statusBarItem.textContent = ZoomStatusbarItem.zoomLabel(scale);\n\t}\n\n\t@memoize\n\tprivate get zoomActions(): Action[] {\n\t\tconst scales: Scale[] = [10, 5, 2, 1, 0.5, 0.2, 'fit'];\n\t\treturn scales.map(scale =>\n\t\t\tnew Action(`zoom.${scale}`, ZoomStatusbarItem.zoomLabel(scale), undefined, undefined, () => {\n\t\t\t\tif (this.onSelectScale) {\n\t\t\t\t\tthis.onSelectScale(scale);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.resolve(undefined);\n\t\t\t}));\n\t}\n\n\tprivate static zoomLabel(scale: Scale): string {\n\t\treturn scale === 'fit'\n\t\t\t? nls.localize('zoom.action.fit.label', 'Whole Image')\n\t\t\t: `${Math.round(scale * 100)}%`;\n\t}\n}\n\ninterface ImageState {\n\tscale: Scale;\n\toffsetX: number;\n\toffsetY: number;\n}\n\nclass InlineImageView {\n\tprivate static readonly SCALE_PINCH_FACTOR = 0.075;\n\tprivate static readonly MAX_SCALE = 20;\n\tprivate static readonly MIN_SCALE = 0.1;\n\n\tprivate static readonly zoomLevels: Scale[] = [\n\t\t0.1,\n\t\t0.2,\n\t\t0.3,\n\t\t0.4,\n\t\t0.5,\n\t\t0.6,\n\t\t0.7,\n\t\t0.8,\n\t\t0.9,\n\t\t1,\n\t\t1.5,\n\t\t2,\n\t\t3,\n\t\t5,\n\t\t7,\n\t\t10,\n\t\t15,\n\t\t20\n\t];\n\n\t/**\n\t * Enable image-rendering: pixelated for images scaled by more than this.\n\t */\n\tprivate static readonly PIXELATION_THRESHOLD = 3;\n\n\t/**\n\t * Store the scale and position of an image so it can be restored when changing editor tabs\n\t */\n\tprivate static readonly imageStateCache = new LRUCache<string, ImageState>(100);\n\n\tstatic create(\n\t\tcontainer: HTMLElement,\n\t\tdescriptor: IResourceDescriptor,\n\t\tfileService: IFileService,\n\t\tscrollbar: DomScrollableElement,\n\t\tmetadataClb: (meta: string) => void\n\t) {\n\t\tconst disposables: IDisposable[] = [];\n\n\t\tconst context: ResourceViewerContext = {\n\t\t\tlayout(dimension: DOM.Dimension) { },\n\t\t\tdispose: () => combinedDisposable(disposables).dispose()\n\t\t};\n\n\t\tconst cacheKey = descriptor.resource.toString();\n\n\t\tlet ctrlPressed = false;\n\t\tlet altPressed = false;\n\n\t\tconst initialState: ImageState = InlineImageView.imageStateCache.get(cacheKey) || { scale: 'fit', offsetX: 0, offsetY: 0 };\n\t\tlet scale = initialState.scale;\n\t\tlet image: HTMLImageElement | null = null;\n\n\t\tfunction updateScale(newScale: Scale) {\n\t\t\tif (!image || !image.parentElement) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (newScale === 'fit') {\n\t\t\t\tscale = 'fit';\n\t\t\t\tDOM.addClass(image, 'scale-to-fit');\n\t\t\t\tDOM.removeClass(image, 'pixelated');\n\t\t\t\timage.style.minWidth = 'auto';\n\t\t\t\timage.style.width = 'auto';\n\t\t\t\tInlineImageView.imageStateCache.delete(cacheKey);\n\t\t\t} else {\n\t\t\t\tconst oldWidth = image.width;\n\t\t\t\tconst oldHeight = image.height;\n\n\t\t\t\tscale = clamp(newScale, InlineImageView.MIN_SCALE, InlineImageView.MAX_SCALE);\n\t\t\t\tif (scale >= InlineImageView.PIXELATION_THRESHOLD) {\n\t\t\t\t\tDOM.addClass(image, 'pixelated');\n\t\t\t\t} else {\n\t\t\t\t\tDOM.removeClass(image, 'pixelated');\n\t\t\t\t}\n\n\t\t\t\tconst { scrollTop, scrollLeft } = image.parentElement;\n\t\t\t\tconst dx = (scrollLeft + image.parentElement.clientWidth / 2) / image.parentElement.scrollWidth;\n\t\t\t\tconst dy = (scrollTop + image.parentElement.clientHeight / 2) / image.parentElement.scrollHeight;\n\n\t\t\t\tDOM.removeClass(image, 'scale-to-fit');\n\t\t\t\timage.style.minWidth = `${(image.naturalWidth * scale)}px`;\n\t\t\t\timage.style.width = `${(image.naturalWidth * scale)}px`;\n\n\t\t\t\tconst newWidth = image.width;\n\t\t\t\tconst scaleFactor = (newWidth - oldWidth) / oldWidth;\n\n\t\t\t\tconst newScrollLeft = ((oldWidth * scaleFactor * dx) + scrollLeft);\n\t\t\t\tconst newScrollTop = ((oldHeight * scaleFactor * dy) + scrollTop);\n\t\t\t\tscrollbar.setScrollPosition({\n\t\t\t\t\tscrollLeft: newScrollLeft,\n\t\t\t\t\tscrollTop: newScrollTop,\n\t\t\t\t});\n\n\t\t\t\tInlineImageView.imageStateCache.set(cacheKey, { scale: scale, offsetX: newScrollLeft, offsetY: newScrollTop });\n\n\t\t\t}\n\t\t\tZoomStatusbarItem.instance.show(scale, updateScale);\n\t\t\tscrollbar.scanDomNode();\n\t\t}\n\n\t\tfunction firstZoom() {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tscale = image.clientWidth / image.naturalWidth;\n\t\t\tupdateScale(scale);\n\t\t}\n\n\t\tdisposables.push(DOM.addDisposableListener(window, DOM.EventType.KEY_DOWN, (e: KeyboardEvent) => {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tctrlPressed = e.ctrlKey;\n\t\t\taltPressed = e.altKey;\n\n\t\t\tif (browser.isMacintosh ? altPressed : ctrlPressed) {\n\t\t\t\tDOM.removeClass(container, 'zoom-in');\n\t\t\t\tDOM.addClass(container, 'zoom-out');\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.push(DOM.addDisposableListener(window, DOM.EventType.KEY_UP, (e: KeyboardEvent) => {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tctrlPressed = e.ctrlKey;\n\t\t\taltPressed = e.altKey;\n\n\t\t\tif (!(browser.isMacintosh ? altPressed : ctrlPressed)) {\n\t\t\t\tDOM.removeClass(container, 'zoom-out');\n\t\t\t\tDOM.addClass(container, 'zoom-in');\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.push(DOM.addDisposableListener(container, DOM.EventType.CLICK, (e: MouseEvent) => {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.button !== 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// left click\n\t\t\tif (scale === 'fit') {\n\t\t\t\tfirstZoom();\n\t\t\t}\n\n\t\t\tif (!(browser.isMacintosh ? altPressed : ctrlPressed)) { // zoom in\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (; i < InlineImageView.zoomLevels.length; ++i) {\n\t\t\t\t\tif (InlineImageView.zoomLevels[i] > scale) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tupdateScale(InlineImageView.zoomLevels[i] || InlineImageView.MAX_SCALE);\n\t\t\t} else {\n\t\t\t\tlet i = InlineImageView.zoomLevels.length - 1;\n\t\t\t\tfor (; i >= 0; --i) {\n\t\t\t\t\tif (InlineImageView.zoomLevels[i] < scale) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tupdateScale(InlineImageView.zoomLevels[i] || InlineImageView.MIN_SCALE);\n\t\t\t}\n\t\t}));\n\n\t\tdisposables.push(DOM.addDisposableListener(container, DOM.EventType.WHEEL, (e: WheelEvent) => {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isScrollWhellKeyPressed = browser.isMacintosh ? altPressed : ctrlPressed;\n\t\t\tif (!isScrollWhellKeyPressed && !e.ctrlKey) { // pinching is reported as scroll wheel + ctrl\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\n\t\t\tif (scale === 'fit') {\n\t\t\t\tfirstZoom();\n\t\t\t}\n\n\t\t\tlet delta = e.deltaY < 0 ? 1 : -1;\n\n\t\t\t// Pinching should increase the scale\n\t\t\tif (e.ctrlKey && !isScrollWhellKeyPressed) {\n\t\t\t\tdelta *= -1;\n\t\t\t}\n\t\t\tupdateScale(scale as number * (1 - delta * InlineImageView.SCALE_PINCH_FACTOR));\n\t\t}));\n\n\t\tdisposables.push(DOM.addDisposableListener(container, DOM.EventType.SCROLL, () => {\n\t\t\tif (!image || !image.parentElement || scale === 'fit') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst entry = InlineImageView.imageStateCache.get(cacheKey);\n\t\t\tif (entry) {\n\t\t\t\tconst { scrollTop, scrollLeft } = image.parentElement;\n\t\t\t\tInlineImageView.imageStateCache.set(cacheKey, { scale: entry.scale, offsetX: scrollLeft, offsetY: scrollTop });\n\t\t\t}\n\t\t}));\n\n\t\tDOM.clearNode(container);\n\t\tDOM.addClasses(container, 'image', 'zoom-in');\n\n\t\timage = DOM.append(container, DOM.$<HTMLImageElement>('img.scale-to-fit'));\n\t\timage.style.visibility = 'hidden';\n\n\t\tdisposables.push(DOM.addDisposableListener(image, DOM.EventType.LOAD, e => {\n\t\t\tif (!image) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (typeof descriptor.size === 'number') {\n\t\t\t\tmetadataClb(nls.localize('imgMeta', '{0}x{1} {2}', image.naturalWidth, image.naturalHeight, BinarySize.formatSize(descriptor.size)));\n\t\t\t} else {\n\t\t\t\tmetadataClb(nls.localize('imgMetaNoSize', '{0}x{1}', image.naturalWidth, image.naturalHeight));\n\t\t\t}\n\n\t\t\tscrollbar.scanDomNode();\n\t\t\timage.style.visibility = 'visible';\n\t\t\tupdateScale(scale);\n\t\t\tif (initialState.scale !== 'fit') {\n\t\t\t\tscrollbar.setScrollPosition({\n\t\t\t\t\tscrollLeft: initialState.offsetX,\n\t\t\t\t\tscrollTop: initialState.offsetY,\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tInlineImageView.imageSrc(descriptor, fileService).then(dataUri => {\n\t\t\tconst imgs = container.getElementsByTagName('img');\n\t\t\tif (imgs.length) {\n\t\t\t\timgs[0].src = dataUri;\n\t\t\t}\n\t\t});\n\n\t\treturn context;\n\t}\n\n\tprivate static imageSrc(descriptor: IResourceDescriptor, fileService: IFileService): Promise<string> {\n\t\tif (descriptor.resource.scheme === Schemas.data) {\n\t\t\treturn Promise.resolve(descriptor.resource.toString(true /* skip encoding */));\n\t\t}\n\n\t\treturn fileService.resolveContent(descriptor.resource, { encoding: 'base64' }).then(data => {\n\t\t\tconst mime = getMime(descriptor);\n\n\t\t\treturn `data:${mime};base64,${data.value}`;\n\t\t});\n\t}\n}\n\nfunction getMime(descriptor: IResourceDescriptor) {\n\tlet mime: string | undefined = descriptor.mime;\n\tif (!mime && descriptor.resource.scheme !== Schemas.data) {\n\t\tmime = mimes.getMediaMime(descriptor.resource.path);\n\t}\n\n\treturn mime || mimes.MIME_BINARY;\n}\n"]}]}