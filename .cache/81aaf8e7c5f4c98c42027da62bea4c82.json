{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/packages/ide/src/fill/electron.ts","dependencies":[{"path":"/home/coding/workspace/packages/ide/src/fill/electron.ts","mtime":1555841535682},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\n/// <reference path=\"../../../../lib/vscode/src/typings/electron.d.ts\" />\nvar events_1 = require(\"events\");\nvar fs = require(\"fs\");\nvar trash = require(\"trash\");\nvar logger_1 = require(\"@coder/logger\");\nvar dialog_1 = require(\"./dialog\");\nvar clipboard_1 = require(\"./clipboard\");\n// tslint:disable-next-line no-any\nglobal.getOpenUrls = function () {\n    return [];\n};\n// This is required to make the fill load in Node without erroring.\nif (typeof document === \"undefined\") {\n    // tslint:disable-next-line no-any\n    global.document = {};\n}\nvar oldCreateElement = document.createElement;\nvar newCreateElement = function (tagName) {\n    var createElement = function (tagName) {\n        // tslint:disable-next-line:no-any\n        return oldCreateElement.call(document, tagName);\n    };\n    // tslint:disable-next-line:no-any\n    var getPropertyDescriptor = function (object, id) {\n        var op = Object.getPrototypeOf(object);\n        while (!Object.getOwnPropertyDescriptor(op, id)) {\n            op = Object.getPrototypeOf(op);\n        }\n        return Object.getOwnPropertyDescriptor(op, id);\n    };\n    if (tagName === \"img\") {\n        var img_1 = createElement(\"img\");\n        var oldSrc_1 = getPropertyDescriptor(img_1, \"src\");\n        if (!oldSrc_1) {\n            throw new Error(\"Failed to find src property\");\n        }\n        Object.defineProperty(img_1, \"src\", {\n            get: function () {\n                return oldSrc_1.get.call(img_1);\n            },\n            set: function (value) {\n                if (value) {\n                    var resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n                    value = value.replace(/file:\\/\\//g, resourceBaseUrl);\n                }\n                oldSrc_1.set.call(img_1, value);\n            },\n        });\n        return img_1;\n    }\n    if (tagName === \"style\") {\n        var style_1 = createElement(\"style\");\n        var oldInnerHtml_1 = getPropertyDescriptor(style_1, \"innerHTML\");\n        if (!oldInnerHtml_1) {\n            throw new Error(\"Failed to find innerHTML property\");\n        }\n        Object.defineProperty(style_1, \"innerHTML\", {\n            get: function () {\n                return oldInnerHtml_1.get.call(style_1);\n            },\n            set: function (value) {\n                if (value) {\n                    var resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n                    value = value.replace(/file:\\/\\//g, resourceBaseUrl);\n                }\n                oldInnerHtml_1.set.call(style_1, value);\n            },\n        });\n        var overridden_1 = false;\n        var oldSheet_1 = getPropertyDescriptor(style_1, \"sheet\");\n        Object.defineProperty(style_1, \"sheet\", {\n            // tslint:disable-next-line:no-any\n            get: function () {\n                var sheet = oldSheet_1.get.call(style_1);\n                if (sheet && !overridden_1) {\n                    var oldInsertRule_1 = sheet.insertRule;\n                    sheet.insertRule = function (rule, index) {\n                        var resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n                        rule = rule.replace(/file:\\/\\//g, resourceBaseUrl);\n                        oldInsertRule_1.call(sheet, rule, index);\n                    };\n                    overridden_1 = true;\n                }\n                return sheet;\n            },\n        });\n        return style_1;\n    }\n    if (tagName === \"webview\") {\n        var view_1 = createElement(\"iframe\");\n        view_1.style.border = \"0px\";\n        var frameID_1 = Math.random().toString();\n        view_1.addEventListener(\"error\", function (event) {\n            logger_1.logger.error(\"iframe error\", logger_1.field(\"event\", event));\n        });\n        window.addEventListener(\"message\", function (event) {\n            if (!event.data || !event.data.id) {\n                return;\n            }\n            if (event.data.id !== frameID_1) {\n                return;\n            }\n            var e = new CustomEvent(\"ipc-message\");\n            e.channel = event.data.channel; // tslint:disable-line no-any\n            e.args = event.data.data; // tslint:disable-line no-any\n            view_1.dispatchEvent(e);\n        });\n        view_1.sandbox.add(\"allow-same-origin\", \"allow-scripts\", \"allow-popups\", \"allow-forms\");\n        Object.defineProperty(view_1, \"preload\", {\n            set: function (url) {\n                view_1.onload = function () {\n                    if (view_1.contentDocument) {\n                        view_1.contentDocument.body.id = frameID_1;\n                        view_1.contentDocument.body.parentElement.style.overflow = \"hidden\";\n                        var script = createElement(\"script\");\n                        script.src = url;\n                        script.addEventListener(\"load\", function () {\n                            view_1.contentDocument.dispatchEvent(new Event(\"DOMContentLoaded\", {\n                                bubbles: true,\n                                cancelable: true,\n                            }));\n                            // const e = new CustomEvent(\"ipc-message\");\n                            // (e as any).channel = \"webview-ready\"; // tslint:disable-line no-any\n                            // (e as any).args = [frameID]; // tslint:disable-line no-any\n                            // view.dispatchEvent(e);\n                        });\n                        view_1.contentDocument.head.appendChild(script);\n                    }\n                };\n            },\n        });\n        view_1.src = require(\"!!file-loader?name=[path][name].[ext]!./webview.html\");\n        Object.defineProperty(view_1, \"src\", {\n            set: function () { },\n        });\n        view_1.getWebContents = function () { return undefined; }; // tslint:disable-line no-any\n        view_1.send = function (channel) {\n            var args = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                args[_i - 1] = arguments[_i];\n            }\n            if (args[0] && typeof args[0] === \"object\" && args[0].contents) {\n                // TODO\n                var resourceBaseUrl_1 = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n                args[0].contents = args[0].contents.replace(/\"(file:\\/\\/[^\"]*)\"/g, function (m1) { return \"\\\"\" + resourceBaseUrl_1 + m1 + \"\\\"\"; });\n                args[0].contents = args[0].contents.replace(/\"vscode-resource:([^\"]*)\"/g, function (m, m1) { return \"\\\"\" + resourceBaseUrl_1 + m1 + \"\\\"\"; });\n                args[0].contents = args[0].contents.replace(/style-src vscode-core-resource:/g, \"style-src 'self'\");\n            }\n            if (view_1.contentWindow) {\n                view_1.contentWindow.postMessage({\n                    channel: channel,\n                    data: args,\n                    id: frameID_1,\n                }, \"*\");\n            }\n        };\n        return view_1;\n    }\n    return createElement(tagName);\n};\ndocument.createElement = newCreateElement;\nvar Clipboard = /** @class */ (function () {\n    function Clipboard() {\n    }\n    Clipboard.prototype.has = function () {\n        return false;\n    };\n    Clipboard.prototype.readFindText = function () {\n        return \"\";\n    };\n    Clipboard.prototype.writeFindText = function (_text) {\n        // Nothing.\n    };\n    Clipboard.prototype.writeText = function (value) {\n        return clipboard_1.clipboard.writeText(value);\n    };\n    Clipboard.prototype.readText = function () {\n        return clipboard_1.clipboard.readText();\n    };\n    return Clipboard;\n}());\nvar Shell = /** @class */ (function () {\n    function Shell() {\n    }\n    Shell.prototype.moveItemToTrash = function (path) {\n        return tslib_1.__awaiter(this, void 0, Promise, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, trash(path)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return Shell;\n}());\nvar App = /** @class */ (function (_super) {\n    tslib_1.__extends(App, _super);\n    function App() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    App.prototype.isAccessibilitySupportEnabled = function () {\n        return false;\n    };\n    App.prototype.setAsDefaultProtocolClient = function () {\n        throw new Error(\"not implemented\");\n    };\n    return App;\n}(events_1.EventEmitter));\nvar Dialog = /** @class */ (function () {\n    function Dialog() {\n    }\n    Dialog.prototype.showSaveDialog = function (_, options, callback) {\n        var defaultPath = options.defaultPath || \"/untitled\";\n        var fileIndex = defaultPath.lastIndexOf(\"/\");\n        var extensionIndex = defaultPath.lastIndexOf(\".\");\n        var saveDialogOptions = {\n            buttons: [\"Cancel\", \"Save\"],\n            detail: \"Enter a path for this file\",\n            input: {\n                value: defaultPath,\n                selection: {\n                    start: fileIndex === -1 ? 0 : fileIndex + 1,\n                    end: extensionIndex === -1 ? defaultPath.length : extensionIndex,\n                },\n            },\n            message: \"Save file\",\n        };\n        var dialog = new dialog_1.Dialog(saveDialogOptions);\n        dialog.onAction(function (action) {\n            if (action.key !== dialog_1.IKey.Enter && action.buttonIndex !== 1) {\n                dialog.hide();\n                return callback(undefined);\n            }\n            var inputValue = dialog.inputValue || \"\";\n            var filePath = inputValue.replace(/\\/+$/, \"\");\n            var split = filePath.split(\"/\");\n            var fileName = split.pop();\n            var parentName = split.pop() || \"/\";\n            if (fileName === \"\") {\n                dialog.error = \"You must enter a file name.\";\n                return;\n            }\n            fs.stat(filePath, function (error, stats) {\n                if (error && error.code === \"ENOENT\") {\n                    dialog.hide();\n                    callback(filePath);\n                }\n                else if (error) {\n                    dialog.error = error.message;\n                }\n                else if (stats.isDirectory()) {\n                    dialog.error = \"A directory named \\\"\" + fileName + \"\\\" already exists.\";\n                }\n                else {\n                    dialog.error = undefined;\n                    var confirmDialog_1 = new dialog_1.Dialog({\n                        message: \"A file named \\\"\" + fileName + \"\\\" already exists. Do you want to replace it?\",\n                        detail: \"The file already exists in \\\"\" + parentName + \"\\\". Replacing it will overwrite its contents.\",\n                        buttons: [\"Cancel\", \"Replace\"],\n                    });\n                    confirmDialog_1.onAction(function (action) {\n                        if (action.buttonIndex === 1) {\n                            confirmDialog_1.hide();\n                            return callback(filePath);\n                        }\n                        confirmDialog_1.hide();\n                        dialog.show();\n                    });\n                    dialog.hide();\n                    confirmDialog_1.show();\n                }\n            });\n        });\n        dialog.show();\n    };\n    Dialog.prototype.showOpenDialog = function () {\n        throw new Error(\"not implemented\");\n    };\n    Dialog.prototype.showMessageBox = function (_, options, callback) {\n        var dialog = new dialog_1.Dialog(options);\n        dialog.onAction(function (action) {\n            dialog.hide();\n            callback(action.buttonIndex, false);\n        });\n        dialog.show();\n    };\n    return Dialog;\n}());\nvar WebFrame = /** @class */ (function () {\n    function WebFrame() {\n    }\n    WebFrame.prototype.getZoomFactor = function () {\n        return 1;\n    };\n    WebFrame.prototype.getZoomLevel = function () {\n        return 1;\n    };\n    WebFrame.prototype.setZoomLevel = function () {\n        // Nothing.\n    };\n    return WebFrame;\n}());\nvar Screen = /** @class */ (function () {\n    function Screen() {\n    }\n    Screen.prototype.getAllDisplays = function () {\n        return [];\n    };\n    return Screen;\n}());\nvar WebRequest = /** @class */ (function (_super) {\n    tslib_1.__extends(WebRequest, _super);\n    function WebRequest() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    WebRequest.prototype.onBeforeRequest = function () {\n        throw new Error(\"not implemented\");\n    };\n    WebRequest.prototype.onBeforeSendHeaders = function () {\n        throw new Error(\"not implemented\");\n    };\n    WebRequest.prototype.onHeadersReceived = function () {\n        throw new Error(\"not implemented\");\n    };\n    return WebRequest;\n}(events_1.EventEmitter));\nvar Session = /** @class */ (function (_super) {\n    tslib_1.__extends(Session, _super);\n    function Session() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.webRequest = new WebRequest();\n        return _this;\n    }\n    Session.prototype.resolveProxy = function (url, callback) {\n        // TODO: not sure what this actually does.\n        callback(url);\n    };\n    return Session;\n}(events_1.EventEmitter));\nvar WebContents = /** @class */ (function (_super) {\n    tslib_1.__extends(WebContents, _super);\n    function WebContents() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.session = new Session();\n        return _this;\n    }\n    return WebContents;\n}(events_1.EventEmitter));\nvar BrowserWindow = /** @class */ (function (_super) {\n    tslib_1.__extends(BrowserWindow, _super);\n    function BrowserWindow() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.webContents = new WebContents();\n        _this.representedFilename = \"\";\n        return _this;\n    }\n    BrowserWindow.getFocusedWindow = function () {\n        return undefined;\n    };\n    BrowserWindow.prototype.focus = function () {\n        window.focus();\n    };\n    BrowserWindow.prototype.show = function () {\n        window.focus();\n    };\n    BrowserWindow.prototype.reload = function () {\n        location.reload();\n    };\n    BrowserWindow.prototype.isMaximized = function () {\n        return false;\n    };\n    BrowserWindow.prototype.setFullScreen = function (fullscreen) {\n        if (fullscreen) {\n            document.documentElement.requestFullscreen();\n        }\n        else {\n            document.exitFullscreen();\n        }\n    };\n    BrowserWindow.prototype.isFullScreen = function () {\n        return document.fullscreenEnabled;\n    };\n    BrowserWindow.prototype.isFocused = function () {\n        return document.hasFocus();\n    };\n    BrowserWindow.prototype.setMenuBarVisibility = function () {\n        throw new Error(\"not implemented\");\n    };\n    BrowserWindow.prototype.setAutoHideMenuBar = function () {\n        throw new Error(\"not implemented\");\n    };\n    BrowserWindow.prototype.setRepresentedFilename = function (filename) {\n        this.representedFilename = filename;\n    };\n    BrowserWindow.prototype.getRepresentedFilename = function () {\n        return this.representedFilename;\n    };\n    BrowserWindow.prototype.setTitle = function (value) {\n        document.title = value;\n    };\n    return BrowserWindow;\n}(events_1.EventEmitter));\n/**\n * We won't be able to do a 1 to 1 fill because things like moveItemToTrash for\n * example returns a boolean while we need a promise.\n */\nvar ElectronFill = /** @class */ (function () {\n    function ElectronFill() {\n        this.shell = new Shell();\n        this.clipboard = new Clipboard();\n        this.app = new App();\n        this.dialog = new Dialog();\n        this.webFrame = new WebFrame();\n        this.screen = new Screen();\n        this.rendererToMainEmitter = new events_1.EventEmitter();\n        this.mainToRendererEmitter = new events_1.EventEmitter();\n        // tslint:enable no-any\n    }\n    Object.defineProperty(ElectronFill.prototype, \"BrowserWindow\", {\n        get: function () {\n            return BrowserWindow;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ElectronFill.prototype, \"ipcRenderer\", {\n        // tslint:disable no-any\n        get: function () {\n            var _this = this;\n            return {\n                send: function (str) {\n                    var args = [];\n                    for (var _i = 1; _i < arguments.length; _i++) {\n                        args[_i - 1] = arguments[_i];\n                    }\n                    var _a;\n                    (_a = _this.rendererToMainEmitter).emit.apply(_a, [str, {\n                            sender: module.exports.ipcMain,\n                        }].concat(args));\n                },\n                on: function (str, listener) {\n                    _this.mainToRendererEmitter.on(str, listener);\n                },\n                once: function (str, listener) {\n                    _this.mainToRendererEmitter.once(str, listener);\n                },\n                removeListener: function (str, listener) {\n                    _this.mainToRendererEmitter.removeListener(str, listener);\n                },\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ElectronFill.prototype, \"ipcMain\", {\n        get: function () {\n            var _this = this;\n            return {\n                send: function (str) {\n                    var args = [];\n                    for (var _i = 1; _i < arguments.length; _i++) {\n                        args[_i - 1] = arguments[_i];\n                    }\n                    var _a;\n                    (_a = _this.mainToRendererEmitter).emit.apply(_a, [str, {\n                            sender: module.exports.ipcRenderer,\n                        }].concat(args));\n                },\n                on: function (str, listener) {\n                    _this.rendererToMainEmitter.on(str, listener);\n                },\n                once: function (str, listener) {\n                    _this.rendererToMainEmitter.once(str, listener);\n                },\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return ElectronFill;\n}());\nmodule.exports = new ElectronFill();\n",{"version":3,"file":"/home/coding/workspace/packages/ide/src/fill/electron.ts","sourceRoot":"","sources":["/home/coding/workspace/packages/ide/src/fill/electron.ts"],"names":[],"mappings":"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","sourcesContent":["/// <reference path=\"../../../../lib/vscode/src/typings/electron.d.ts\" />\nimport { EventEmitter } from \"events\";\nimport * as fs from \"fs\";\nimport * as trash from \"trash\";\nimport { logger, field } from \"@coder/logger\";\nimport { IKey, Dialog as DialogBox } from \"./dialog\";\nimport { clipboard } from \"./clipboard\";\n\n// tslint:disable-next-line no-any\n(global as any).getOpenUrls = (): string[] => {\n\treturn [];\n};\n\n// This is required to make the fill load in Node without erroring.\nif (typeof document === \"undefined\") {\n\t// tslint:disable-next-line no-any\n\t(global as any).document = {} as any;\n}\n\nconst oldCreateElement = document.createElement;\nconst newCreateElement = <K extends keyof HTMLElementTagNameMap>(tagName: K): HTMLElementTagNameMap[K] => {\n\tconst createElement = <K extends keyof HTMLElementTagNameMap>(tagName: K): HTMLElementTagNameMap[K] => {\n\t\t// tslint:disable-next-line:no-any\n\t\treturn oldCreateElement.call(document, tagName as any);\n\t};\n\t// tslint:disable-next-line:no-any\n\tconst getPropertyDescriptor = (object: any, id: string): PropertyDescriptor | undefined => {\n\t\tlet op = Object.getPrototypeOf(object);\n\t\twhile (!Object.getOwnPropertyDescriptor(op, id)) {\n\t\t\top = Object.getPrototypeOf(op);\n\t\t}\n\n\t\treturn Object.getOwnPropertyDescriptor(op, id);\n\t};\n\n\tif (tagName === \"img\") {\n\t\tconst img = createElement(\"img\");\n\t\tconst oldSrc = getPropertyDescriptor(img, \"src\");\n\t\tif (!oldSrc) {\n\t\t\tthrow new Error(\"Failed to find src property\");\n\t\t}\n\t\tObject.defineProperty(img, \"src\", {\n\t\t\tget: (): string => {\n\t\t\t\treturn oldSrc!.get!.call(img);\n\t\t\t},\n\t\t\tset: (value: string): void => {\n\t\t\t\tif (value) {\n\t\t\t\t\tconst resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n\t\t\t\t\tvalue = value.replace(/file:\\/\\//g, resourceBaseUrl);\n\t\t\t\t}\n\t\t\t\toldSrc!.set!.call(img, value);\n\t\t\t},\n\t\t});\n\n\t\treturn img;\n\t}\n\n\tif (tagName === \"style\") {\n\t\tconst style = createElement(\"style\");\n\t\tconst oldInnerHtml = getPropertyDescriptor(style, \"innerHTML\");\n\t\tif (!oldInnerHtml) {\n\t\t\tthrow new Error(\"Failed to find innerHTML property\");\n\t\t}\n\t\tObject.defineProperty(style, \"innerHTML\", {\n\t\t\tget: (): string => {\n\t\t\t\treturn oldInnerHtml!.get!.call(style);\n\t\t\t},\n\t\t\tset: (value: string): void => {\n\t\t\t\tif (value) {\n\t\t\t\t\tconst resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n\t\t\t\t\tvalue = value.replace(/file:\\/\\//g, resourceBaseUrl);\n\t\t\t\t}\n\t\t\t\toldInnerHtml!.set!.call(style, value);\n\t\t\t},\n\t\t});\n\t\tlet overridden = false;\n\t\tconst oldSheet = getPropertyDescriptor(style, \"sheet\");\n\t\tObject.defineProperty(style, \"sheet\", {\n\t\t\t// tslint:disable-next-line:no-any\n\t\t\tget: (): any => {\n\t\t\t\tconst sheet = oldSheet!.get!.call(style);\n\t\t\t\tif (sheet && !overridden) {\n\t\t\t\t\tconst oldInsertRule = sheet.insertRule;\n\t\t\t\t\tsheet.insertRule = (rule: string, index?: number): void => {\n\t\t\t\t\t\tconst resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n\t\t\t\t\t\trule = rule.replace(/file:\\/\\//g, resourceBaseUrl);\n\t\t\t\t\t\toldInsertRule.call(sheet, rule, index);\n\t\t\t\t\t};\n\t\t\t\t\toverridden = true;\n\t\t\t\t}\n\n\t\t\t\treturn sheet;\n\t\t\t},\n\t\t});\n\n\t\treturn style;\n\t}\n\n\tif (tagName === \"webview\") {\n\t\tconst view = createElement(\"iframe\") as HTMLIFrameElement;\n\t\tview.style.border = \"0px\";\n\t\tconst frameID = Math.random().toString();\n\t\tview.addEventListener(\"error\", (event) => {\n\t\t\tlogger.error(\"iframe error\", field(\"event\", event));\n\t\t});\n\t\twindow.addEventListener(\"message\", (event) => {\n\t\t\tif (!event.data || !event.data.id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (event.data.id !== frameID) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst e = new CustomEvent(\"ipc-message\");\n\t\t\t(e as any).channel = event.data.channel; // tslint:disable-line no-any\n\t\t\t(e as any).args = event.data.data; // tslint:disable-line no-any\n\t\t\tview.dispatchEvent(e);\n\t\t});\n\t\tview.sandbox.add(\"allow-same-origin\", \"allow-scripts\", \"allow-popups\", \"allow-forms\");\n\t\tObject.defineProperty(view, \"preload\", {\n\t\t\tset: (url: string): void => {\n\t\t\t\tview.onload = (): void => {\n\t\t\t\t\tif (view.contentDocument) {\n\t\t\t\t\t\tview.contentDocument.body.id = frameID;\n\t\t\t\t\t\tview.contentDocument.body.parentElement!.style.overflow = \"hidden\";\n\t\t\t\t\t\tconst script = createElement(\"script\");\n\t\t\t\t\t\tscript.src = url;\n\t\t\t\t\t\tscript.addEventListener(\"load\", () => {\n\t\t\t\t\t\t\tview.contentDocument!.dispatchEvent(new Event(\"DOMContentLoaded\", {\n\t\t\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t\t\t\tcancelable: true,\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t// const e = new CustomEvent(\"ipc-message\");\n\t\t\t\t\t\t\t// (e as any).channel = \"webview-ready\"; // tslint:disable-line no-any\n\t\t\t\t\t\t\t// (e as any).args = [frameID]; // tslint:disable-line no-any\n\t\t\t\t\t\t\t// view.dispatchEvent(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tview.contentDocument.head.appendChild(script);\n\t\t\t\t\t}\n\n\t\t\t\t};\n\t\t\t},\n\t\t});\n\t\tview.src = require(\"!!file-loader?name=[path][name].[ext]!./webview.html\");\n\t\tObject.defineProperty(view, \"src\", {\n\t\t\tset: (): void => { /* Nope. */ },\n\t\t});\n\t\t(view as any).getWebContents = (): void => undefined; // tslint:disable-line no-any\n\t\t(view as any).send = (channel: string, ...args: any[]): void => { // tslint:disable-line no-any\n\t\t\tif (args[0] && typeof args[0] === \"object\" && args[0].contents) {\n\t\t\t\t// TODO\n\t\t\t\tconst resourceBaseUrl = location.pathname.replace(/\\/$/, \"\") + \"/resource\";\n\t\t\t\targs[0].contents = (args[0].contents as string).replace(/\"(file:\\/\\/[^\"]*)\"/g, (m1) => `\"${resourceBaseUrl}${m1}\"`);\n\t\t\t\targs[0].contents = (args[0].contents as string).replace(/\"vscode-resource:([^\"]*)\"/g, (m, m1) => `\"${resourceBaseUrl}${m1}\"`);\n\t\t\t\targs[0].contents = (args[0].contents as string).replace(/style-src vscode-core-resource:/g, \"style-src 'self'\");\n\t\t\t}\n\t\t\tif (view.contentWindow) {\n\t\t\t\tview.contentWindow.postMessage({\n\t\t\t\t\tchannel,\n\t\t\t\t\tdata: args,\n\t\t\t\t\tid: frameID,\n\t\t\t\t}, \"*\");\n\t\t\t}\n\t\t};\n\n\t\treturn view;\n\t}\n\n\treturn createElement(tagName);\n};\n\ndocument.createElement = newCreateElement;\n\nclass Clipboard {\n\tpublic has(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic readFindText(): string {\n\t\treturn \"\";\n\t}\n\n\tpublic writeFindText(_text: string): void {\n\t\t// Nothing.\n\t}\n\n\tpublic writeText(value: string): Promise<void> {\n\t\treturn clipboard.writeText(value);\n\t}\n\n\tpublic readText(): Promise<string> {\n\t\treturn clipboard.readText();\n\t}\n}\n\nclass Shell {\n\tpublic async moveItemToTrash(path: string): Promise<void> {\n\t\tawait trash(path);\n\t}\n}\n\nclass App extends EventEmitter {\n\tpublic isAccessibilitySupportEnabled(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic setAsDefaultProtocolClient(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n}\n\nclass Dialog {\n\tpublic showSaveDialog(_: void, options: Electron.SaveDialogOptions, callback: (filename: string | undefined) => void): void {\n\t\tconst defaultPath = options.defaultPath || \"/untitled\";\n\t\tconst fileIndex = defaultPath.lastIndexOf(\"/\");\n\t\tconst extensionIndex = defaultPath.lastIndexOf(\".\");\n\t\tconst saveDialogOptions = {\n\t\t\tbuttons: [\"Cancel\", \"Save\"],\n\t\t\tdetail: \"Enter a path for this file\",\n\t\t\tinput: {\n\t\t\t\tvalue: defaultPath,\n\t\t\t\tselection: {\n\t\t\t\t\tstart: fileIndex === -1 ? 0 : fileIndex + 1,\n\t\t\t\t\tend: extensionIndex === -1 ? defaultPath.length : extensionIndex,\n\t\t\t\t},\n\t\t\t},\n\t\t\tmessage: \"Save file\",\n\t\t};\n\n\t\tconst dialog = new DialogBox(saveDialogOptions);\n\t\tdialog.onAction((action) => {\n\t\t\tif (action.key !== IKey.Enter && action.buttonIndex !== 1) {\n\t\t\t\tdialog.hide();\n\n\t\t\t\treturn callback(undefined);\n\t\t\t}\n\n\t\t\tconst inputValue = dialog.inputValue || \"\";\n\t\t\tconst filePath = inputValue.replace(/\\/+$/, \"\");\n\t\t\tconst split = filePath.split(\"/\");\n\t\t\tconst fileName = split.pop();\n\t\t\tconst parentName = split.pop() || \"/\";\n\t\t\tif (fileName === \"\") {\n\t\t\t\tdialog.error = \"You must enter a file name.\";\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfs.stat(filePath, (error, stats) => {\n\t\t\t\tif (error && error.code === \"ENOENT\") {\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\tcallback(filePath);\n\t\t\t\t} else if (error) {\n\t\t\t\t\tdialog.error = error.message;\n\t\t\t\t} else if (stats.isDirectory()) {\n\t\t\t\t\tdialog.error = `A directory named \"${fileName}\" already exists.`;\n\t\t\t\t} else {\n\t\t\t\t\tdialog.error = undefined;\n\n\t\t\t\t\tconst confirmDialog = new DialogBox({\n\t\t\t\t\t\tmessage: `A file named \"${fileName}\" already exists. Do you want to replace it?`,\n\t\t\t\t\t\tdetail: `The file already exists in \"${parentName}\". Replacing it will overwrite its contents.`,\n\t\t\t\t\t\tbuttons: [\"Cancel\", \"Replace\"],\n\t\t\t\t\t});\n\n\t\t\t\t\tconfirmDialog.onAction((action) => {\n\t\t\t\t\t\tif (action.buttonIndex === 1) {\n\t\t\t\t\t\t\tconfirmDialog.hide();\n\n\t\t\t\t\t\t\treturn callback(filePath);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconfirmDialog.hide();\n\t\t\t\t\t\tdialog.show();\n\t\t\t\t\t});\n\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\tconfirmDialog.show();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tdialog.show();\n\t}\n\n\tpublic showOpenDialog(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n\n\tpublic showMessageBox(_: void, options: Electron.MessageBoxOptions, callback: (button: number | undefined, checked: boolean) => void): void {\n\t\tconst dialog = new DialogBox(options);\n\t\tdialog.onAction((action) => {\n\t\t\tdialog.hide();\n\t\t\tcallback(action.buttonIndex, false);\n\t\t});\n\t\tdialog.show();\n\t}\n}\n\nclass WebFrame {\n\tpublic getZoomFactor(): number {\n\t\treturn 1;\n\t}\n\n\tpublic getZoomLevel(): number {\n\t\treturn 1;\n\t}\n\n\tpublic setZoomLevel(): void {\n\t\t// Nothing.\n\t}\n}\n\nclass Screen {\n\tpublic getAllDisplays(): [] {\n\t\treturn [];\n\t}\n}\n\nclass WebRequest extends EventEmitter {\n\tpublic onBeforeRequest(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n\n\tpublic onBeforeSendHeaders(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n\n\tpublic onHeadersReceived(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n}\n\nclass Session extends EventEmitter {\n\tpublic webRequest = new WebRequest();\n\n\tpublic resolveProxy(url: string, callback: (proxy: string) => void): void {\n\t\t// TODO: not sure what this actually does.\n\t\tcallback(url);\n\t}\n}\n\nclass WebContents extends EventEmitter {\n\tpublic session = new Session();\n}\n\nclass BrowserWindow extends EventEmitter {\n\tpublic webContents = new WebContents();\n\tprivate representedFilename: string = \"\";\n\n\tpublic static getFocusedWindow(): undefined {\n\t\treturn undefined;\n\t}\n\n\tpublic focus(): void {\n\t\twindow.focus();\n\t}\n\n\tpublic show(): void {\n\t\twindow.focus();\n\t}\n\n\tpublic reload(): void {\n\t\tlocation.reload();\n\t}\n\n\tpublic isMaximized(): boolean {\n\t\treturn false;\n\t}\n\n\tpublic setFullScreen(fullscreen: boolean): void {\n\t\tif (fullscreen) {\n\t\t\tdocument.documentElement.requestFullscreen();\n\t\t} else {\n\t\t\tdocument.exitFullscreen();\n\t\t}\n\t}\n\n\tpublic isFullScreen(): boolean {\n\t\treturn document.fullscreenEnabled;\n\t}\n\n\tpublic isFocused(): boolean {\n\t\treturn document.hasFocus();\n\t}\n\n\tpublic setMenuBarVisibility(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n\n\tpublic setAutoHideMenuBar(): void {\n\t\tthrow new Error(\"not implemented\");\n\t}\n\n\tpublic setRepresentedFilename(filename: string): void {\n\t\tthis.representedFilename = filename;\n\t}\n\n\tpublic getRepresentedFilename(): string {\n\t\treturn this.representedFilename;\n\t}\n\n\tpublic setTitle(value: string): void {\n\t\tdocument.title = value;\n\t}\n}\n\n/**\n * We won't be able to do a 1 to 1 fill because things like moveItemToTrash for\n * example returns a boolean while we need a promise.\n */\nclass ElectronFill {\n\tpublic readonly shell = new Shell();\n\tpublic readonly clipboard = new Clipboard();\n\tpublic readonly app = new App();\n\tpublic readonly dialog = new Dialog();\n\tpublic readonly webFrame = new WebFrame();\n\tpublic readonly screen = new Screen();\n\n\tprivate readonly rendererToMainEmitter = new EventEmitter();\n\tprivate readonly mainToRendererEmitter = new EventEmitter();\n\n\tpublic get BrowserWindow(): typeof BrowserWindow {\n\t\treturn BrowserWindow;\n\t}\n\n\t// tslint:disable no-any\n\tpublic get ipcRenderer(): object {\n\t\treturn {\n\t\t\tsend: (str: string, ...args: any[]): void => {\n\t\t\t\tthis.rendererToMainEmitter.emit(str, {\n\t\t\t\t\tsender: module.exports.ipcMain,\n\t\t\t\t}, ...args);\n\t\t\t},\n\t\t\ton: (str: string, listener: (...args: any[]) => void): void => {\n\t\t\t\tthis.mainToRendererEmitter.on(str, listener);\n\t\t\t},\n\t\t\tonce: (str: string, listener: (...args: any[]) => void): void => {\n\t\t\t\tthis.mainToRendererEmitter.once(str, listener);\n\t\t\t},\n\t\t\tremoveListener: (str: string, listener: (...args: any[]) => void): void => {\n\t\t\t\tthis.mainToRendererEmitter.removeListener(str, listener);\n\t\t\t},\n\t\t};\n\t}\n\n\tpublic get ipcMain(): object {\n\t\treturn {\n\t\t\tsend: (str: string, ...args: any[]): void => {\n\t\t\t\tthis.mainToRendererEmitter.emit(str, {\n\t\t\t\t\tsender: module.exports.ipcRenderer,\n\t\t\t\t}, ...args);\n\t\t\t},\n\t\t\ton: (str: string, listener: (...args: any[]) => void): void => {\n\t\t\t\tthis.rendererToMainEmitter.on(str, listener);\n\t\t\t},\n\t\t\tonce: (str: string, listener: (...args: any[]) => void): void => {\n\t\t\t\tthis.rendererToMainEmitter.once(str, listener);\n\t\t\t},\n\t\t};\n\t}\n\t// tslint:enable no-any\n}\n\nmodule.exports = new ElectronFill();\n"]}]}