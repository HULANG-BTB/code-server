{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/contrib/links/links.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/links/links.ts","mtime":1555846338032},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nrequire(\"vs/css!./links\");\nvar nls = require(\"vs/nls\");\nvar async = require(\"vs/base/common/async\");\nvar cancellation_1 = require(\"vs/base/common/cancellation\");\nvar errors_1 = require(\"vs/base/common/errors\");\nvar htmlContent_1 = require(\"vs/base/common/htmlContent\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar browser = require(\"vs/base/browser/browser\");\nvar editorBrowser_1 = require(\"vs/editor/browser/editorBrowser\");\nvar editorExtensions_1 = require(\"vs/editor/browser/editorExtensions\");\nvar model_1 = require(\"vs/editor/common/model\");\nvar textModel_1 = require(\"vs/editor/common/model/textModel\");\nvar modes_1 = require(\"vs/editor/common/modes\");\nvar clickLinkGesture_1 = require(\"vs/editor/contrib/goToDefinition/clickLinkGesture\");\nvar getLinks_1 = require(\"vs/editor/contrib/links/getLinks\");\nvar notification_1 = require(\"vs/platform/notification/common/notification\");\nvar opener_1 = require(\"vs/platform/opener/common/opener\");\nvar colorRegistry_1 = require(\"vs/platform/theme/common/colorRegistry\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar HOVER_MESSAGE_GENERAL_META = new htmlContent_1.MarkdownString().appendText(browser.isMacintosh\n    ? nls.localize('links.navigate.mac', \"Cmd + click to follow link\")\n    : nls.localize('links.navigate', \"Ctrl + click to follow link\"));\nvar HOVER_MESSAGE_COMMAND_META = new htmlContent_1.MarkdownString().appendText(browser.isMacintosh\n    ? nls.localize('links.command.mac', \"Cmd + click to execute command\")\n    : nls.localize('links.command', \"Ctrl + click to execute command\"));\nvar HOVER_MESSAGE_GENERAL_ALT = new htmlContent_1.MarkdownString().appendText(browser.isMacintosh\n    ? nls.localize('links.navigate.al.mac', \"Option + click to follow link\")\n    : nls.localize('links.navigate.al', \"Alt + click to follow link\"));\nvar HOVER_MESSAGE_COMMAND_ALT = new htmlContent_1.MarkdownString().appendText(browser.isMacintosh\n    ? nls.localize('links.command.al.mac', \"Option + click to execute command\")\n    : nls.localize('links.command.al', \"Alt + click to execute command\"));\nvar decoration = {\n    meta: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link',\n        hoverMessage: HOVER_MESSAGE_GENERAL_META\n    }),\n    metaActive: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active',\n        hoverMessage: HOVER_MESSAGE_GENERAL_META\n    }),\n    alt: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link',\n        hoverMessage: HOVER_MESSAGE_GENERAL_ALT\n    }),\n    altActive: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active',\n        hoverMessage: HOVER_MESSAGE_GENERAL_ALT\n    }),\n    altCommand: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link',\n        hoverMessage: HOVER_MESSAGE_COMMAND_ALT\n    }),\n    altCommandActive: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active',\n        hoverMessage: HOVER_MESSAGE_COMMAND_ALT\n    }),\n    metaCommand: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link',\n        hoverMessage: HOVER_MESSAGE_COMMAND_META\n    }),\n    metaCommandActive: textModel_1.ModelDecorationOptions.register({\n        stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n        collapseOnReplaceEdit: true,\n        inlineClassName: 'detected-link-active',\n        hoverMessage: HOVER_MESSAGE_COMMAND_META\n    }),\n};\nvar LinkOccurrence = /** @class */ (function () {\n    function LinkOccurrence(link, decorationId) {\n        this.link = link;\n        this.decorationId = decorationId;\n    }\n    LinkOccurrence.decoration = function (link, useMetaKey) {\n        return {\n            range: link.range,\n            options: LinkOccurrence._getOptions(link, useMetaKey, false)\n        };\n    };\n    LinkOccurrence._getOptions = function (link, useMetaKey, isActive) {\n        if (link.url && /^command:/i.test(link.url.toString())) {\n            if (useMetaKey) {\n                return (isActive ? decoration.metaCommandActive : decoration.metaCommand);\n            }\n            else {\n                return (isActive ? decoration.altCommandActive : decoration.altCommand);\n            }\n        }\n        else {\n            if (useMetaKey) {\n                return (isActive ? decoration.metaActive : decoration.meta);\n            }\n            else {\n                return (isActive ? decoration.altActive : decoration.alt);\n            }\n        }\n    };\n    LinkOccurrence.prototype.activate = function (changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n    };\n    LinkOccurrence.prototype.deactivate = function (changeAccessor, useMetaKey) {\n        changeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n    };\n    return LinkOccurrence;\n}());\nvar LinkDetector = /** @class */ (function () {\n    function LinkDetector(editor, openerService, notificationService) {\n        var _this = this;\n        this.editor = editor;\n        this.openerService = openerService;\n        this.notificationService = notificationService;\n        this.listenersToRemove = [];\n        var clickLinkGesture = new clickLinkGesture_1.ClickLinkGesture(editor);\n        this.listenersToRemove.push(clickLinkGesture);\n        this.listenersToRemove.push(clickLinkGesture.onMouseMoveOrRelevantKeyDown(function (_a) {\n            var mouseEvent = _a[0], keyboardEvent = _a[1];\n            _this._onEditorMouseMove(mouseEvent, keyboardEvent);\n        }));\n        this.listenersToRemove.push(clickLinkGesture.onExecute(function (e) {\n            _this.onEditorMouseUp(e);\n        }));\n        this.listenersToRemove.push(clickLinkGesture.onCancel(function (e) {\n            _this.cleanUpActiveLinkDecoration();\n        }));\n        this.enabled = editor.getConfiguration().contribInfo.links;\n        this.listenersToRemove.push(editor.onDidChangeConfiguration(function (e) {\n            var enabled = editor.getConfiguration().contribInfo.links;\n            if (_this.enabled === enabled) {\n                // No change in our configuration option\n                return;\n            }\n            _this.enabled = enabled;\n            // Remove any links (for the getting disabled case)\n            _this.updateDecorations([]);\n            // Stop any computation (for the getting disabled case)\n            _this.stop();\n            // Start computing (for the getting enabled case)\n            _this.beginCompute();\n        }));\n        this.listenersToRemove.push(editor.onDidChangeModelContent(function (e) { return _this.onChange(); }));\n        this.listenersToRemove.push(editor.onDidChangeModel(function (e) { return _this.onModelChanged(); }));\n        this.listenersToRemove.push(editor.onDidChangeModelLanguage(function (e) { return _this.onModelModeChanged(); }));\n        this.listenersToRemove.push(modes_1.LinkProviderRegistry.onDidChange(function (e) { return _this.onModelModeChanged(); }));\n        this.timeout = new async.TimeoutTimer();\n        this.computePromise = null;\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        this.beginCompute();\n    }\n    LinkDetector.get = function (editor) {\n        return editor.getContribution(LinkDetector.ID);\n    };\n    LinkDetector.prototype.getId = function () {\n        return LinkDetector.ID;\n    };\n    LinkDetector.prototype.onModelChanged = function () {\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        this.stop();\n        this.beginCompute();\n    };\n    LinkDetector.prototype.onModelModeChanged = function () {\n        this.stop();\n        this.beginCompute();\n    };\n    LinkDetector.prototype.onChange = function () {\n        var _this = this;\n        this.timeout.setIfNotSet(function () { return _this.beginCompute(); }, LinkDetector.RECOMPUTE_TIME);\n    };\n    LinkDetector.prototype.beginCompute = function () {\n        return tslib_1.__awaiter(this, void 0, Promise, function () {\n            var model, links, err_1;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.editor.hasModel() || !this.enabled) {\n                            return [2 /*return*/];\n                        }\n                        model = this.editor.getModel();\n                        if (!modes_1.LinkProviderRegistry.has(model)) {\n                            return [2 /*return*/];\n                        }\n                        this.computePromise = async.createCancelablePromise(function (token) { return getLinks_1.getLinks(model, token); });\n                        _a.label = 1;\n                    case 1:\n                        _a.trys.push([1, 3, 4, 5]);\n                        return [4 /*yield*/, this.computePromise];\n                    case 2:\n                        links = _a.sent();\n                        this.updateDecorations(links);\n                        return [3 /*break*/, 5];\n                    case 3:\n                        err_1 = _a.sent();\n                        errors_1.onUnexpectedError(err_1);\n                        return [3 /*break*/, 5];\n                    case 4:\n                        this.computePromise = null;\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LinkDetector.prototype.updateDecorations = function (links) {\n        var useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n        var oldDecorations = [];\n        var keys = Object.keys(this.currentOccurrences);\n        for (var i = 0, len = keys.length; i < len; i++) {\n            var decorationId = keys[i];\n            var occurance = this.currentOccurrences[decorationId];\n            oldDecorations.push(occurance.decorationId);\n        }\n        var newDecorations = [];\n        if (links) {\n            // Not sure why this is sometimes null\n            for (var _i = 0, links_1 = links; _i < links_1.length; _i++) {\n                var link = links_1[_i];\n                newDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n            }\n        }\n        var decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\n        this.currentOccurrences = {};\n        this.activeLinkDecorationId = null;\n        for (var i = 0, len = decorations.length; i < len; i++) {\n            var occurance = new LinkOccurrence(links[i], decorations[i]);\n            this.currentOccurrences[occurance.decorationId] = occurance;\n        }\n    };\n    LinkDetector.prototype._onEditorMouseMove = function (mouseEvent, withKey) {\n        var _this = this;\n        var useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n        if (this.isEnabled(mouseEvent, withKey)) {\n            this.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n            var occurrence_1 = this.getLinkOccurrence(mouseEvent.target.position);\n            if (occurrence_1) {\n                this.editor.changeDecorations(function (changeAccessor) {\n                    occurrence_1.activate(changeAccessor, useMetaKey);\n                    _this.activeLinkDecorationId = occurrence_1.decorationId;\n                });\n            }\n        }\n        else {\n            this.cleanUpActiveLinkDecoration();\n        }\n    };\n    LinkDetector.prototype.cleanUpActiveLinkDecoration = function () {\n        var useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n        if (this.activeLinkDecorationId) {\n            var occurrence_2 = this.currentOccurrences[this.activeLinkDecorationId];\n            if (occurrence_2) {\n                this.editor.changeDecorations(function (changeAccessor) {\n                    occurrence_2.deactivate(changeAccessor, useMetaKey);\n                });\n            }\n            this.activeLinkDecorationId = null;\n        }\n    };\n    LinkDetector.prototype.onEditorMouseUp = function (mouseEvent) {\n        if (!this.isEnabled(mouseEvent)) {\n            return;\n        }\n        var occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n        if (!occurrence) {\n            return;\n        }\n        this.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier);\n    };\n    LinkDetector.prototype.openLinkOccurrence = function (occurrence, openToSide) {\n        var _this = this;\n        if (!this.openerService) {\n            return;\n        }\n        var link = occurrence.link;\n        link.resolve(cancellation_1.CancellationToken.None).then(function (uri) {\n            // open the uri\n            return _this.openerService.open(uri, { openToSide: openToSide });\n        }, function (err) {\n            // different error cases\n            if (err === 'invalid') {\n                _this.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url.toString()));\n            }\n            else if (err === 'missing') {\n                _this.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n            }\n            else {\n                errors_1.onUnexpectedError(err);\n            }\n        });\n    };\n    LinkDetector.prototype.getLinkOccurrence = function (position) {\n        if (!this.editor.hasModel() || !position) {\n            return null;\n        }\n        var decorations = this.editor.getModel().getDecorationsInRange({\n            startLineNumber: position.lineNumber,\n            startColumn: position.column,\n            endLineNumber: position.lineNumber,\n            endColumn: position.column\n        }, 0, true);\n        for (var _i = 0, decorations_1 = decorations; _i < decorations_1.length; _i++) {\n            var decoration_1 = decorations_1[_i];\n            var currentOccurrence = this.currentOccurrences[decoration_1.id];\n            if (currentOccurrence) {\n                return currentOccurrence;\n            }\n        }\n        return null;\n    };\n    LinkDetector.prototype.isEnabled = function (mouseEvent, withKey) {\n        return Boolean((mouseEvent.target.type === editorBrowser_1.MouseTargetType.CONTENT_TEXT)\n            && (mouseEvent.hasTriggerModifier || (withKey && withKey.keyCodeIsTriggerKey)));\n    };\n    LinkDetector.prototype.stop = function () {\n        this.timeout.cancel();\n        if (this.computePromise) {\n            this.computePromise.cancel();\n            this.computePromise = null;\n        }\n    };\n    LinkDetector.prototype.dispose = function () {\n        this.listenersToRemove = lifecycle_1.dispose(this.listenersToRemove);\n        this.stop();\n        this.timeout.dispose();\n    };\n    LinkDetector.ID = 'editor.linkDetector';\n    LinkDetector.RECOMPUTE_TIME = 1000; // ms\n    LinkDetector = tslib_1.__decorate([\n        tslib_1.__param(1, opener_1.IOpenerService),\n        tslib_1.__param(2, notification_1.INotificationService)\n    ], LinkDetector);\n    return LinkDetector;\n}());\nvar OpenLinkAction = /** @class */ (function (_super) {\n    tslib_1.__extends(OpenLinkAction, _super);\n    function OpenLinkAction() {\n        return _super.call(this, {\n            id: 'editor.action.openLink',\n            label: nls.localize('label', \"Open Link\"),\n            alias: 'Open Link',\n            precondition: null\n        }) || this;\n    }\n    OpenLinkAction.prototype.run = function (accessor, editor) {\n        var linkDetector = LinkDetector.get(editor);\n        if (!linkDetector) {\n            return;\n        }\n        if (!editor.hasModel()) {\n            return;\n        }\n        var selections = editor.getSelections();\n        for (var _i = 0, selections_1 = selections; _i < selections_1.length; _i++) {\n            var sel = selections_1[_i];\n            var link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n            if (link) {\n                linkDetector.openLinkOccurrence(link, false);\n            }\n        }\n    };\n    return OpenLinkAction;\n}(editorExtensions_1.EditorAction));\neditorExtensions_1.registerEditorContribution(LinkDetector);\neditorExtensions_1.registerEditorAction(OpenLinkAction);\nthemeService_1.registerThemingParticipant(function (theme, collector) {\n    var activeLinkForeground = theme.getColor(colorRegistry_1.editorActiveLinkForeground);\n    if (activeLinkForeground) {\n        collector.addRule(\".monaco-editor .detected-link-active { color: \" + activeLinkForeground + \" !important; }\");\n    }\n});\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/links/links.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/contrib/links/links.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./links';\nimport * as nls from 'vs/nls';\nimport * as async from 'vs/base/common/async';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { MarkdownString } from 'vs/base/common/htmlContent';\nimport { IDisposable, dispose } from 'vs/base/common/lifecycle';\nimport * as browser from 'vs/base/browser/browser';\nimport { ICodeEditor, MouseTargetType } from 'vs/editor/browser/editorBrowser';\nimport { EditorAction, ServicesAccessor, registerEditorAction, registerEditorContribution } from 'vs/editor/browser/editorExtensions';\nimport { Position } from 'vs/editor/common/core/position';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport { IModelDecorationsChangeAccessor, IModelDeltaDecoration, TrackedRangeStickiness } from 'vs/editor/common/model';\nimport { ModelDecorationOptions } from 'vs/editor/common/model/textModel';\nimport { LinkProviderRegistry } from 'vs/editor/common/modes';\nimport { ClickLinkGesture, ClickLinkKeyboardEvent, ClickLinkMouseEvent } from 'vs/editor/contrib/goToDefinition/clickLinkGesture';\nimport { Link, getLinks } from 'vs/editor/contrib/links/getLinks';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { IOpenerService } from 'vs/platform/opener/common/opener';\nimport { editorActiveLinkForeground } from 'vs/platform/theme/common/colorRegistry';\nimport { registerThemingParticipant } from 'vs/platform/theme/common/themeService';\n\nconst HOVER_MESSAGE_GENERAL_META = new MarkdownString().appendText(\n\tbrowser.isMacintosh\n\t\t? nls.localize('links.navigate.mac', \"Cmd + click to follow link\")\n\t\t: nls.localize('links.navigate', \"Ctrl + click to follow link\")\n);\n\nconst HOVER_MESSAGE_COMMAND_META = new MarkdownString().appendText(\n\tbrowser.isMacintosh\n\t\t? nls.localize('links.command.mac', \"Cmd + click to execute command\")\n\t\t: nls.localize('links.command', \"Ctrl + click to execute command\")\n);\n\nconst HOVER_MESSAGE_GENERAL_ALT = new MarkdownString().appendText(\n\tbrowser.isMacintosh\n\t\t? nls.localize('links.navigate.al.mac', \"Option + click to follow link\")\n\t\t: nls.localize('links.navigate.al', \"Alt + click to follow link\")\n);\n\nconst HOVER_MESSAGE_COMMAND_ALT = new MarkdownString().appendText(\n\tbrowser.isMacintosh\n\t\t? nls.localize('links.command.al.mac', \"Option + click to execute command\")\n\t\t: nls.localize('links.command.al', \"Alt + click to execute command\")\n);\n\nconst decoration = {\n\tmeta: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link',\n\t\thoverMessage: HOVER_MESSAGE_GENERAL_META\n\t}),\n\tmetaActive: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link-active',\n\t\thoverMessage: HOVER_MESSAGE_GENERAL_META\n\t}),\n\talt: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link',\n\t\thoverMessage: HOVER_MESSAGE_GENERAL_ALT\n\t}),\n\taltActive: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link-active',\n\t\thoverMessage: HOVER_MESSAGE_GENERAL_ALT\n\t}),\n\taltCommand: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link',\n\t\thoverMessage: HOVER_MESSAGE_COMMAND_ALT\n\t}),\n\taltCommandActive: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link-active',\n\t\thoverMessage: HOVER_MESSAGE_COMMAND_ALT\n\t}),\n\tmetaCommand: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link',\n\t\thoverMessage: HOVER_MESSAGE_COMMAND_META\n\t}),\n\tmetaCommandActive: ModelDecorationOptions.register({\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tcollapseOnReplaceEdit: true,\n\t\tinlineClassName: 'detected-link-active',\n\t\thoverMessage: HOVER_MESSAGE_COMMAND_META\n\t}),\n};\n\n\nclass LinkOccurrence {\n\n\tpublic static decoration(link: Link, useMetaKey: boolean): IModelDeltaDecoration {\n\t\treturn {\n\t\t\trange: link.range,\n\t\t\toptions: LinkOccurrence._getOptions(link, useMetaKey, false)\n\t\t};\n\t}\n\n\tprivate static _getOptions(link: Link, useMetaKey: boolean, isActive: boolean): ModelDecorationOptions {\n\t\tif (link.url && /^command:/i.test(link.url.toString())) {\n\t\t\tif (useMetaKey) {\n\t\t\t\treturn (isActive ? decoration.metaCommandActive : decoration.metaCommand);\n\t\t\t} else {\n\t\t\t\treturn (isActive ? decoration.altCommandActive : decoration.altCommand);\n\t\t\t}\n\t\t} else {\n\t\t\tif (useMetaKey) {\n\t\t\t\treturn (isActive ? decoration.metaActive : decoration.meta);\n\t\t\t} else {\n\t\t\t\treturn (isActive ? decoration.altActive : decoration.alt);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic decorationId: string;\n\tpublic link: Link;\n\n\tconstructor(link: Link, decorationId: string) {\n\t\tthis.link = link;\n\t\tthis.decorationId = decorationId;\n\t}\n\n\tpublic activate(changeAccessor: IModelDecorationsChangeAccessor, useMetaKey: boolean): void {\n\t\tchangeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, true));\n\t}\n\n\tpublic deactivate(changeAccessor: IModelDecorationsChangeAccessor, useMetaKey: boolean): void {\n\t\tchangeAccessor.changeDecorationOptions(this.decorationId, LinkOccurrence._getOptions(this.link, useMetaKey, false));\n\t}\n}\n\nclass LinkDetector implements editorCommon.IEditorContribution {\n\n\tprivate static readonly ID: string = 'editor.linkDetector';\n\n\tpublic static get(editor: ICodeEditor): LinkDetector {\n\t\treturn editor.getContribution<LinkDetector>(LinkDetector.ID);\n\t}\n\n\tstatic RECOMPUTE_TIME = 1000; // ms\n\n\tprivate readonly editor: ICodeEditor;\n\tprivate enabled: boolean;\n\tprivate listenersToRemove: IDisposable[];\n\tprivate readonly timeout: async.TimeoutTimer;\n\tprivate computePromise: async.CancelablePromise<Link[]> | null;\n\tprivate activeLinkDecorationId: string | null;\n\tprivate readonly openerService: IOpenerService;\n\tprivate readonly notificationService: INotificationService;\n\tprivate currentOccurrences: { [decorationId: string]: LinkOccurrence; };\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@INotificationService notificationService: INotificationService\n\t) {\n\t\tthis.editor = editor;\n\t\tthis.openerService = openerService;\n\t\tthis.notificationService = notificationService;\n\t\tthis.listenersToRemove = [];\n\n\t\tlet clickLinkGesture = new ClickLinkGesture(editor);\n\t\tthis.listenersToRemove.push(clickLinkGesture);\n\t\tthis.listenersToRemove.push(clickLinkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n\t\t\tthis._onEditorMouseMove(mouseEvent, keyboardEvent);\n\t\t}));\n\t\tthis.listenersToRemove.push(clickLinkGesture.onExecute((e) => {\n\t\t\tthis.onEditorMouseUp(e);\n\t\t}));\n\t\tthis.listenersToRemove.push(clickLinkGesture.onCancel((e) => {\n\t\t\tthis.cleanUpActiveLinkDecoration();\n\t\t}));\n\n\t\tthis.enabled = editor.getConfiguration().contribInfo.links;\n\t\tthis.listenersToRemove.push(editor.onDidChangeConfiguration((e) => {\n\t\t\tlet enabled = editor.getConfiguration().contribInfo.links;\n\t\t\tif (this.enabled === enabled) {\n\t\t\t\t// No change in our configuration option\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.enabled = enabled;\n\n\t\t\t// Remove any links (for the getting disabled case)\n\t\t\tthis.updateDecorations([]);\n\n\t\t\t// Stop any computation (for the getting disabled case)\n\t\t\tthis.stop();\n\n\t\t\t// Start computing (for the getting enabled case)\n\t\t\tthis.beginCompute();\n\t\t}));\n\t\tthis.listenersToRemove.push(editor.onDidChangeModelContent((e) => this.onChange()));\n\t\tthis.listenersToRemove.push(editor.onDidChangeModel((e) => this.onModelChanged()));\n\t\tthis.listenersToRemove.push(editor.onDidChangeModelLanguage((e) => this.onModelModeChanged()));\n\t\tthis.listenersToRemove.push(LinkProviderRegistry.onDidChange((e) => this.onModelModeChanged()));\n\n\t\tthis.timeout = new async.TimeoutTimer();\n\t\tthis.computePromise = null;\n\t\tthis.currentOccurrences = {};\n\t\tthis.activeLinkDecorationId = null;\n\t\tthis.beginCompute();\n\t}\n\n\tpublic getId(): string {\n\t\treturn LinkDetector.ID;\n\t}\n\n\tprivate onModelChanged(): void {\n\t\tthis.currentOccurrences = {};\n\t\tthis.activeLinkDecorationId = null;\n\t\tthis.stop();\n\t\tthis.beginCompute();\n\t}\n\n\tprivate onModelModeChanged(): void {\n\t\tthis.stop();\n\t\tthis.beginCompute();\n\t}\n\n\tprivate onChange(): void {\n\t\tthis.timeout.setIfNotSet(() => this.beginCompute(), LinkDetector.RECOMPUTE_TIME);\n\t}\n\n\tprivate async beginCompute(): Promise<void> {\n\t\tif (!this.editor.hasModel() || !this.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this.editor.getModel();\n\n\t\tif (!LinkProviderRegistry.has(model)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.computePromise = async.createCancelablePromise(token => getLinks(model, token));\n\t\ttry {\n\t\t\tconst links = await this.computePromise;\n\t\t\tthis.updateDecorations(links);\n\t\t} catch (err) {\n\t\t\tonUnexpectedError(err);\n\t\t} finally {\n\t\t\tthis.computePromise = null;\n\t\t}\n\t}\n\n\tprivate updateDecorations(links: Link[]): void {\n\t\tconst useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n\t\tlet oldDecorations: string[] = [];\n\t\tlet keys = Object.keys(this.currentOccurrences);\n\t\tfor (let i = 0, len = keys.length; i < len; i++) {\n\t\t\tlet decorationId = keys[i];\n\t\t\tlet occurance = this.currentOccurrences[decorationId];\n\t\t\toldDecorations.push(occurance.decorationId);\n\t\t}\n\n\t\tlet newDecorations: IModelDeltaDecoration[] = [];\n\t\tif (links) {\n\t\t\t// Not sure why this is sometimes null\n\t\t\tfor (const link of links) {\n\t\t\t\tnewDecorations.push(LinkOccurrence.decoration(link, useMetaKey));\n\t\t\t}\n\t\t}\n\n\t\tlet decorations = this.editor.deltaDecorations(oldDecorations, newDecorations);\n\n\t\tthis.currentOccurrences = {};\n\t\tthis.activeLinkDecorationId = null;\n\t\tfor (let i = 0, len = decorations.length; i < len; i++) {\n\t\t\tlet occurance = new LinkOccurrence(links[i], decorations[i]);\n\t\t\tthis.currentOccurrences[occurance.decorationId] = occurance;\n\t\t}\n\t}\n\n\tprivate _onEditorMouseMove(mouseEvent: ClickLinkMouseEvent, withKey: ClickLinkKeyboardEvent | null): void {\n\t\tconst useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n\t\tif (this.isEnabled(mouseEvent, withKey)) {\n\t\t\tthis.cleanUpActiveLinkDecoration(); // always remove previous link decoration as their can only be one\n\t\t\tconst occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n\t\t\tif (occurrence) {\n\t\t\t\tthis.editor.changeDecorations((changeAccessor) => {\n\t\t\t\t\toccurrence.activate(changeAccessor, useMetaKey);\n\t\t\t\t\tthis.activeLinkDecorationId = occurrence.decorationId;\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tthis.cleanUpActiveLinkDecoration();\n\t\t}\n\t}\n\n\tprivate cleanUpActiveLinkDecoration(): void {\n\t\tconst useMetaKey = (this.editor.getConfiguration().multiCursorModifier === 'altKey');\n\t\tif (this.activeLinkDecorationId) {\n\t\t\tconst occurrence = this.currentOccurrences[this.activeLinkDecorationId];\n\t\t\tif (occurrence) {\n\t\t\t\tthis.editor.changeDecorations((changeAccessor) => {\n\t\t\t\t\toccurrence.deactivate(changeAccessor, useMetaKey);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.activeLinkDecorationId = null;\n\t\t}\n\t}\n\n\tprivate onEditorMouseUp(mouseEvent: ClickLinkMouseEvent): void {\n\t\tif (!this.isEnabled(mouseEvent)) {\n\t\t\treturn;\n\t\t}\n\t\tconst occurrence = this.getLinkOccurrence(mouseEvent.target.position);\n\t\tif (!occurrence) {\n\t\t\treturn;\n\t\t}\n\t\tthis.openLinkOccurrence(occurrence, mouseEvent.hasSideBySideModifier);\n\t}\n\n\tpublic openLinkOccurrence(occurrence: LinkOccurrence, openToSide: boolean): void {\n\n\t\tif (!this.openerService) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { link } = occurrence;\n\n\t\tlink.resolve(CancellationToken.None).then(uri => {\n\t\t\t// open the uri\n\t\t\treturn this.openerService.open(uri, { openToSide });\n\n\t\t}, err => {\n\t\t\t// different error cases\n\t\t\tif (err === 'invalid') {\n\t\t\t\tthis.notificationService.warn(nls.localize('invalid.url', 'Failed to open this link because it is not well-formed: {0}', link.url!.toString()));\n\t\t\t} else if (err === 'missing') {\n\t\t\t\tthis.notificationService.warn(nls.localize('missing.url', 'Failed to open this link because its target is missing.'));\n\t\t\t} else {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic getLinkOccurrence(position: Position | null): LinkOccurrence | null {\n\t\tif (!this.editor.hasModel() || !position) {\n\t\t\treturn null;\n\t\t}\n\t\tconst decorations = this.editor.getModel().getDecorationsInRange({\n\t\t\tstartLineNumber: position.lineNumber,\n\t\t\tstartColumn: position.column,\n\t\t\tendLineNumber: position.lineNumber,\n\t\t\tendColumn: position.column\n\t\t}, 0, true);\n\n\t\tfor (const decoration of decorations) {\n\t\t\tconst currentOccurrence = this.currentOccurrences[decoration.id];\n\t\t\tif (currentOccurrence) {\n\t\t\t\treturn currentOccurrence;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate isEnabled(mouseEvent: ClickLinkMouseEvent, withKey?: ClickLinkKeyboardEvent | null): boolean {\n\t\treturn Boolean(\n\t\t\t(mouseEvent.target.type === MouseTargetType.CONTENT_TEXT)\n\t\t\t&& (mouseEvent.hasTriggerModifier || (withKey && withKey.keyCodeIsTriggerKey))\n\t\t);\n\t}\n\n\tprivate stop(): void {\n\t\tthis.timeout.cancel();\n\t\tif (this.computePromise) {\n\t\t\tthis.computePromise.cancel();\n\t\t\tthis.computePromise = null;\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tthis.listenersToRemove = dispose(this.listenersToRemove);\n\t\tthis.stop();\n\t\tthis.timeout.dispose();\n\t}\n}\n\nclass OpenLinkAction extends EditorAction {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'editor.action.openLink',\n\t\t\tlabel: nls.localize('label', \"Open Link\"),\n\t\t\talias: 'Open Link',\n\t\t\tprecondition: null\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tlet linkDetector = LinkDetector.get(editor);\n\t\tif (!linkDetector) {\n\t\t\treturn;\n\t\t}\n\t\tif (!editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet selections = editor.getSelections();\n\n\t\tfor (let sel of selections) {\n\t\t\tlet link = linkDetector.getLinkOccurrence(sel.getEndPosition());\n\n\t\t\tif (link) {\n\t\t\t\tlinkDetector.openLinkOccurrence(link, false);\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterEditorContribution(LinkDetector);\nregisterEditorAction(OpenLinkAction);\n\nregisterThemingParticipant((theme, collector) => {\n\tconst activeLinkForeground = theme.getColor(editorActiveLinkForeground);\n\tif (activeLinkForeground) {\n\t\tcollector.addRule(`.monaco-editor .detected-link-active { color: ${activeLinkForeground} !important; }`);\n\t}\n});\n"]}]}