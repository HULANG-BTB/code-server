{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/contrib/gotoError/gotoError.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/gotoError/gotoError.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar nls = require(\"vs/nls\");\nvar event_1 = require(\"vs/base/common/event\");\nvar keyCodes_1 = require(\"vs/base/common/keyCodes\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar contextkey_1 = require(\"vs/platform/contextkey/common/contextkey\");\nvar markers_1 = require(\"vs/platform/markers/common/markers\");\nvar range_1 = require(\"vs/editor/common/core/range\");\nvar editorExtensions_1 = require(\"vs/editor/browser/editorExtensions\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar editorContextKeys_1 = require(\"vs/editor/common/editorContextKeys\");\nvar keybindingsRegistry_1 = require(\"vs/platform/keybinding/common/keybindingsRegistry\");\nvar gotoErrorWidget_1 = require(\"./gotoErrorWidget\");\nvar strings_1 = require(\"vs/base/common/strings\");\nvar arrays_1 = require(\"vs/base/common/arrays\");\nvar codeEditorService_1 = require(\"vs/editor/browser/services/codeEditorService\");\nvar errors_1 = require(\"vs/base/common/errors\");\nvar actions_1 = require(\"vs/platform/actions/common/actions\");\nvar actions_2 = require(\"vs/base/common/actions\");\nvar keybinding_1 = require(\"vs/platform/keybinding/common/keybinding\");\nvar MarkerModel = /** @class */ (function () {\n    function MarkerModel(editor, markers) {\n        var _this = this;\n        this._editor = editor;\n        this._markers = [];\n        this._nextIdx = -1;\n        this._toUnbind = [];\n        this._ignoreSelectionChange = false;\n        this._onCurrentMarkerChanged = new event_1.Emitter();\n        this._onMarkerSetChanged = new event_1.Emitter();\n        this.setMarkers(markers);\n        // listen on editor\n        this._toUnbind.push(this._editor.onDidDispose(function () { return _this.dispose(); }));\n        this._toUnbind.push(this._editor.onDidChangeCursorPosition(function () {\n            if (_this._ignoreSelectionChange) {\n                return;\n            }\n            if (_this.currentMarker && _this._editor.getPosition() && range_1.Range.containsPosition(_this.currentMarker, _this._editor.getPosition())) {\n                return;\n            }\n            _this._nextIdx = -1;\n        }));\n    }\n    Object.defineProperty(MarkerModel.prototype, \"onCurrentMarkerChanged\", {\n        get: function () {\n            return this._onCurrentMarkerChanged.event;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(MarkerModel.prototype, \"onMarkerSetChanged\", {\n        get: function () {\n            return this._onMarkerSetChanged.event;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    MarkerModel.prototype.setMarkers = function (markers) {\n        var oldMarker = this._nextIdx >= 0 ? this._markers[this._nextIdx] : undefined;\n        this._markers = markers || [];\n        this._markers.sort(MarkerNavigationAction.compareMarker);\n        if (!oldMarker) {\n            this._nextIdx = -1;\n        }\n        else {\n            this._nextIdx = Math.max(-1, arrays_1.binarySearch(this._markers, oldMarker, MarkerNavigationAction.compareMarker));\n        }\n        this._onMarkerSetChanged.fire(this);\n    };\n    MarkerModel.prototype.withoutWatchingEditorPosition = function (callback) {\n        this._ignoreSelectionChange = true;\n        try {\n            callback();\n        }\n        finally {\n            this._ignoreSelectionChange = false;\n        }\n    };\n    MarkerModel.prototype._initIdx = function (fwd) {\n        var found = false;\n        var position = this._editor.getPosition();\n        for (var i = 0; i < this._markers.length; i++) {\n            var range = range_1.Range.lift(this._markers[i]);\n            if (range.isEmpty() && this._editor.getModel()) {\n                var word = this._editor.getModel().getWordAtPosition(range.getStartPosition());\n                if (word) {\n                    range = new range_1.Range(range.startLineNumber, word.startColumn, range.startLineNumber, word.endColumn);\n                }\n            }\n            if (position && (range.containsPosition(position) || position.isBeforeOrEqual(range.getStartPosition()))) {\n                this._nextIdx = i;\n                found = true;\n                break;\n            }\n        }\n        if (!found) {\n            // after the last change\n            this._nextIdx = fwd ? 0 : this._markers.length - 1;\n        }\n        if (this._nextIdx < 0) {\n            this._nextIdx = this._markers.length - 1;\n        }\n    };\n    Object.defineProperty(MarkerModel.prototype, \"currentMarker\", {\n        get: function () {\n            return this.canNavigate() ? this._markers[this._nextIdx] : undefined;\n        },\n        set: function (marker) {\n            var idx = this._nextIdx;\n            this._nextIdx = -1;\n            if (marker) {\n                this._nextIdx = this.indexOf(marker);\n            }\n            if (this._nextIdx !== idx) {\n                this._onCurrentMarkerChanged.fire(marker);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    MarkerModel.prototype.move = function (fwd, inCircles) {\n        if (!this.canNavigate()) {\n            this._onCurrentMarkerChanged.fire(undefined);\n            return !inCircles;\n        }\n        var oldIdx = this._nextIdx;\n        var atEdge = false;\n        if (this._nextIdx === -1) {\n            this._initIdx(fwd);\n        }\n        else if (fwd) {\n            if (inCircles || this._nextIdx + 1 < this._markers.length) {\n                this._nextIdx = (this._nextIdx + 1) % this._markers.length;\n            }\n            else {\n                atEdge = true;\n            }\n        }\n        else if (!fwd) {\n            if (inCircles || this._nextIdx > 0) {\n                this._nextIdx = (this._nextIdx - 1 + this._markers.length) % this._markers.length;\n            }\n            else {\n                atEdge = true;\n            }\n        }\n        if (oldIdx !== this._nextIdx) {\n            var marker = this._markers[this._nextIdx];\n            this._onCurrentMarkerChanged.fire(marker);\n        }\n        return atEdge;\n    };\n    MarkerModel.prototype.canNavigate = function () {\n        return this._markers.length > 0;\n    };\n    MarkerModel.prototype.findMarkerAtPosition = function (pos) {\n        for (var _i = 0, _a = this._markers; _i < _a.length; _i++) {\n            var marker = _a[_i];\n            if (range_1.Range.containsPosition(marker, pos)) {\n                return marker;\n            }\n        }\n        return undefined;\n    };\n    Object.defineProperty(MarkerModel.prototype, \"total\", {\n        get: function () {\n            return this._markers.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    MarkerModel.prototype.indexOf = function (marker) {\n        return 1 + this._markers.indexOf(marker);\n    };\n    MarkerModel.prototype.dispose = function () {\n        this._toUnbind = lifecycle_1.dispose(this._toUnbind);\n    };\n    return MarkerModel;\n}());\nvar MarkerController = /** @class */ (function () {\n    function MarkerController(editor, _markerService, _contextKeyService, _themeService, _editorService, _keybindingService) {\n        this._markerService = _markerService;\n        this._contextKeyService = _contextKeyService;\n        this._themeService = _themeService;\n        this._editorService = _editorService;\n        this._keybindingService = _keybindingService;\n        this._model = null;\n        this._widget = null;\n        this._disposeOnClose = [];\n        this._editor = editor;\n        this._widgetVisible = CONTEXT_MARKERS_NAVIGATION_VISIBLE.bindTo(this._contextKeyService);\n    }\n    MarkerController.get = function (editor) {\n        return editor.getContribution(MarkerController.ID);\n    };\n    MarkerController.prototype.getId = function () {\n        return MarkerController.ID;\n    };\n    MarkerController.prototype.dispose = function () {\n        this._cleanUp();\n    };\n    MarkerController.prototype._cleanUp = function () {\n        this._widgetVisible.reset();\n        this._disposeOnClose = lifecycle_1.dispose(this._disposeOnClose);\n        this._widget = null;\n        this._model = null;\n    };\n    MarkerController.prototype.getOrCreateModel = function () {\n        var _this = this;\n        var _a;\n        if (this._model) {\n            return this._model;\n        }\n        var markers = this._getMarkers();\n        this._model = new MarkerModel(this._editor, markers);\n        this._markerService.onMarkerChanged(this._onMarkerChanged, this, this._disposeOnClose);\n        var prevMarkerKeybinding = this._keybindingService.lookupKeybinding(PrevMarkerAction.ID);\n        var nextMarkerKeybinding = this._keybindingService.lookupKeybinding(NextMarkerAction.ID);\n        var actions = [\n            new actions_2.Action(PrevMarkerAction.ID, PrevMarkerAction.LABEL + (prevMarkerKeybinding ? \" (\" + prevMarkerKeybinding.getLabel() + \")\" : ''), 'show-previous-problem chevron-up', this._model.canNavigate(), function () { return tslib_1.__awaiter(_this, void 0, void 0, function () { return tslib_1.__generator(this, function (_a) {\n                if (this._model) {\n                    this._model.move(false, true);\n                }\n                return [2 /*return*/];\n            }); }); }),\n            new actions_2.Action(NextMarkerAction.ID, NextMarkerAction.LABEL + (nextMarkerKeybinding ? \" (\" + nextMarkerKeybinding.getLabel() + \")\" : ''), 'show-next-problem chevron-down', this._model.canNavigate(), function () { return tslib_1.__awaiter(_this, void 0, void 0, function () { return tslib_1.__generator(this, function (_a) {\n                if (this._model) {\n                    this._model.move(true, true);\n                }\n                return [2 /*return*/];\n            }); }); })\n        ];\n        this._widget = new gotoErrorWidget_1.MarkerNavigationWidget(this._editor, actions, this._themeService);\n        this._widgetVisible.set(true);\n        this._widget.onDidClose(function () { return _this._cleanUp(); }, this, this._disposeOnClose);\n        this._disposeOnClose.push(this._model);\n        this._disposeOnClose.push(this._widget);\n        (_a = this._disposeOnClose).push.apply(_a, actions);\n        this._disposeOnClose.push(this._widget.onDidSelectRelatedInformation(function (related) {\n            _this._editorService.openCodeEditor({\n                resource: related.resource,\n                options: { pinned: true, revealIfOpened: true, selection: range_1.Range.lift(related).collapseToStart() }\n            }, _this._editor).then(undefined, errors_1.onUnexpectedError);\n            _this.closeMarkersNavigation(false);\n        }));\n        this._disposeOnClose.push(this._editor.onDidChangeModel(function () { return _this._cleanUp(); }));\n        this._disposeOnClose.push(this._model.onCurrentMarkerChanged(function (marker) {\n            if (!marker || !_this._model) {\n                _this._cleanUp();\n            }\n            else {\n                _this._model.withoutWatchingEditorPosition(function () {\n                    if (!_this._widget || !_this._model) {\n                        return;\n                    }\n                    _this._widget.showAtMarker(marker, _this._model.indexOf(marker), _this._model.total);\n                });\n            }\n        }));\n        this._disposeOnClose.push(this._model.onMarkerSetChanged(function () {\n            if (!_this._widget || !_this._widget.position || !_this._model) {\n                return;\n            }\n            var marker = _this._model.findMarkerAtPosition(_this._widget.position);\n            if (marker) {\n                _this._widget.updateMarker(marker);\n            }\n            else {\n                _this._widget.showStale();\n            }\n        }));\n        return this._model;\n    };\n    MarkerController.prototype.closeMarkersNavigation = function (focusEditor) {\n        if (focusEditor === void 0) { focusEditor = true; }\n        this._cleanUp();\n        if (focusEditor) {\n            this._editor.focus();\n        }\n    };\n    MarkerController.prototype.show = function (marker) {\n        var model = this.getOrCreateModel();\n        model.currentMarker = marker;\n    };\n    MarkerController.prototype._onMarkerChanged = function (changedResources) {\n        var editorModel = this._editor.getModel();\n        if (!editorModel) {\n            return;\n        }\n        if (!this._model) {\n            return;\n        }\n        if (!changedResources.some(function (r) { return editorModel.uri.toString() === r.toString(); })) {\n            return;\n        }\n        this._model.setMarkers(this._getMarkers());\n    };\n    MarkerController.prototype._getMarkers = function () {\n        var model = this._editor.getModel();\n        if (!model) {\n            return [];\n        }\n        return this._markerService.read({\n            resource: model.uri,\n            severities: markers_1.MarkerSeverity.Error | markers_1.MarkerSeverity.Warning | markers_1.MarkerSeverity.Info\n        });\n    };\n    MarkerController.ID = 'editor.contrib.markerController';\n    MarkerController = tslib_1.__decorate([\n        tslib_1.__param(1, markers_1.IMarkerService),\n        tslib_1.__param(2, contextkey_1.IContextKeyService),\n        tslib_1.__param(3, themeService_1.IThemeService),\n        tslib_1.__param(4, codeEditorService_1.ICodeEditorService),\n        tslib_1.__param(5, keybinding_1.IKeybindingService)\n    ], MarkerController);\n    return MarkerController;\n}());\nexports.MarkerController = MarkerController;\nvar MarkerNavigationAction = /** @class */ (function (_super) {\n    tslib_1.__extends(MarkerNavigationAction, _super);\n    function MarkerNavigationAction(next, multiFile, opts) {\n        var _this = _super.call(this, opts) || this;\n        _this._isNext = next;\n        _this._multiFile = multiFile;\n        return _this;\n    }\n    MarkerNavigationAction.prototype.run = function (accessor, editor) {\n        var _this = this;\n        var markerService = accessor.get(markers_1.IMarkerService);\n        var editorService = accessor.get(codeEditorService_1.ICodeEditorService);\n        var controller = MarkerController.get(editor);\n        if (!controller) {\n            return Promise.resolve(undefined);\n        }\n        var model = controller.getOrCreateModel();\n        var atEdge = model.move(this._isNext, !this._multiFile);\n        if (!atEdge || !this._multiFile) {\n            return Promise.resolve(undefined);\n        }\n        // try with the next/prev file\n        var markers = markerService.read({ severities: markers_1.MarkerSeverity.Error | markers_1.MarkerSeverity.Warning | markers_1.MarkerSeverity.Info }).sort(MarkerNavigationAction.compareMarker);\n        if (markers.length === 0) {\n            return Promise.resolve(undefined);\n        }\n        var editorModel = editor.getModel();\n        if (!editorModel) {\n            return Promise.resolve(undefined);\n        }\n        var oldMarker = model.currentMarker || { resource: editorModel.uri, severity: markers_1.MarkerSeverity.Error, startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 };\n        var idx = arrays_1.binarySearch(markers, oldMarker, MarkerNavigationAction.compareMarker);\n        if (idx < 0) {\n            // find best match...\n            idx = ~idx;\n            idx %= markers.length;\n        }\n        else if (this._isNext) {\n            idx = (idx + 1) % markers.length;\n        }\n        else {\n            idx = (idx + markers.length - 1) % markers.length;\n        }\n        var newMarker = markers[idx];\n        if (newMarker.resource.toString() === editorModel.uri.toString()) {\n            // the next `resource` is this resource which\n            // means we cycle within this file\n            model.move(this._isNext, true);\n            return Promise.resolve(undefined);\n        }\n        // close the widget for this editor-instance, open the resource\n        // for the next marker and re-start marker navigation in there\n        controller.closeMarkersNavigation();\n        return editorService.openCodeEditor({\n            resource: newMarker.resource,\n            options: { pinned: false, revealIfOpened: true, revealInCenterIfOutsideViewport: true, selection: newMarker }\n        }, editor).then(function (editor) {\n            if (!editor) {\n                return undefined;\n            }\n            return editor.getAction(_this.id).run();\n        });\n    };\n    MarkerNavigationAction.compareMarker = function (a, b) {\n        var res = strings_1.compare(a.resource.toString(), b.resource.toString());\n        if (res === 0) {\n            res = markers_1.MarkerSeverity.compare(a.severity, b.severity);\n        }\n        if (res === 0) {\n            res = range_1.Range.compareRangesUsingStarts(a, b);\n        }\n        return res;\n    };\n    return MarkerNavigationAction;\n}(editorExtensions_1.EditorAction));\nvar NextMarkerAction = /** @class */ (function (_super) {\n    tslib_1.__extends(NextMarkerAction, _super);\n    function NextMarkerAction() {\n        return _super.call(this, true, false, {\n            id: NextMarkerAction.ID,\n            label: NextMarkerAction.LABEL,\n            alias: 'Go to Next Error or Warning',\n            precondition: editorContextKeys_1.EditorContextKeys.writable,\n            kbOpts: { kbExpr: editorContextKeys_1.EditorContextKeys.editorTextFocus, primary: keyCodes_1.KeyMod.Alt | keyCodes_1.KeyCode.F8, weight: keybindingsRegistry_1.KeybindingWeight.EditorContrib }\n        }) || this;\n    }\n    NextMarkerAction.ID = 'editor.action.marker.next';\n    NextMarkerAction.LABEL = nls.localize('markerAction.next.label', \"Go to Next Problem (Error, Warning, Info)\");\n    return NextMarkerAction;\n}(MarkerNavigationAction));\nexports.NextMarkerAction = NextMarkerAction;\nvar PrevMarkerAction = /** @class */ (function (_super) {\n    tslib_1.__extends(PrevMarkerAction, _super);\n    function PrevMarkerAction() {\n        return _super.call(this, false, false, {\n            id: PrevMarkerAction.ID,\n            label: PrevMarkerAction.LABEL,\n            alias: 'Go to Previous Error or Warning',\n            precondition: editorContextKeys_1.EditorContextKeys.writable,\n            kbOpts: { kbExpr: editorContextKeys_1.EditorContextKeys.editorTextFocus, primary: keyCodes_1.KeyMod.Shift | keyCodes_1.KeyMod.Alt | keyCodes_1.KeyCode.F8, weight: keybindingsRegistry_1.KeybindingWeight.EditorContrib }\n        }) || this;\n    }\n    PrevMarkerAction.ID = 'editor.action.marker.prev';\n    PrevMarkerAction.LABEL = nls.localize('markerAction.previous.label', \"Go to Previous Problem (Error, Warning, Info)\");\n    return PrevMarkerAction;\n}(MarkerNavigationAction));\nvar NextMarkerInFilesAction = /** @class */ (function (_super) {\n    tslib_1.__extends(NextMarkerInFilesAction, _super);\n    function NextMarkerInFilesAction() {\n        return _super.call(this, true, true, {\n            id: 'editor.action.marker.nextInFiles',\n            label: nls.localize('markerAction.nextInFiles.label', \"Go to Next Problem in Files (Error, Warning, Info)\"),\n            alias: 'Go to Next Error or Warning in Files',\n            precondition: editorContextKeys_1.EditorContextKeys.writable,\n            kbOpts: {\n                kbExpr: editorContextKeys_1.EditorContextKeys.focus,\n                primary: keyCodes_1.KeyCode.F8,\n                weight: keybindingsRegistry_1.KeybindingWeight.EditorContrib\n            }\n        }) || this;\n    }\n    return NextMarkerInFilesAction;\n}(MarkerNavigationAction));\nvar PrevMarkerInFilesAction = /** @class */ (function (_super) {\n    tslib_1.__extends(PrevMarkerInFilesAction, _super);\n    function PrevMarkerInFilesAction() {\n        return _super.call(this, false, true, {\n            id: 'editor.action.marker.prevInFiles',\n            label: nls.localize('markerAction.previousInFiles.label', \"Go to Previous Problem in Files (Error, Warning, Info)\"),\n            alias: 'Go to Previous Error or Warning in Files',\n            precondition: editorContextKeys_1.EditorContextKeys.writable,\n            kbOpts: {\n                kbExpr: editorContextKeys_1.EditorContextKeys.focus,\n                primary: keyCodes_1.KeyMod.Shift | keyCodes_1.KeyCode.F8,\n                weight: keybindingsRegistry_1.KeybindingWeight.EditorContrib\n            }\n        }) || this;\n    }\n    return PrevMarkerInFilesAction;\n}(MarkerNavigationAction));\neditorExtensions_1.registerEditorContribution(MarkerController);\neditorExtensions_1.registerEditorAction(NextMarkerAction);\neditorExtensions_1.registerEditorAction(PrevMarkerAction);\neditorExtensions_1.registerEditorAction(NextMarkerInFilesAction);\neditorExtensions_1.registerEditorAction(PrevMarkerInFilesAction);\nvar CONTEXT_MARKERS_NAVIGATION_VISIBLE = new contextkey_1.RawContextKey('markersNavigationVisible', false);\nvar MarkerCommand = editorExtensions_1.EditorCommand.bindToContribution(MarkerController.get);\neditorExtensions_1.registerEditorCommand(new MarkerCommand({\n    id: 'closeMarkersNavigation',\n    precondition: CONTEXT_MARKERS_NAVIGATION_VISIBLE,\n    handler: function (x) { return x.closeMarkersNavigation(); },\n    kbOpts: {\n        weight: keybindingsRegistry_1.KeybindingWeight.EditorContrib + 50,\n        kbExpr: editorContextKeys_1.EditorContextKeys.focus,\n        primary: keyCodes_1.KeyCode.Escape,\n        secondary: [keyCodes_1.KeyMod.Shift | keyCodes_1.KeyCode.Escape]\n    }\n}));\n// Go to menu\nactions_1.MenuRegistry.appendMenuItem(actions_1.MenuId.MenubarGoMenu, {\n    group: '6_problem_nav',\n    command: {\n        id: 'editor.action.marker.nextInFiles',\n        title: nls.localize({ key: 'miGotoNextProblem', comment: ['&& denotes a mnemonic'] }, \"Next &&Problem\")\n    },\n    order: 1\n});\nactions_1.MenuRegistry.appendMenuItem(actions_1.MenuId.MenubarGoMenu, {\n    group: '6_problem_nav',\n    command: {\n        id: 'editor.action.marker.prevInFiles',\n        title: nls.localize({ key: 'miGotoPreviousProblem', comment: ['&& denotes a mnemonic'] }, \"Previous &&Problem\")\n    },\n    order: 2\n});\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/gotoError/gotoError.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/contrib/gotoError/gotoError.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport { Emitter } from 'vs/base/common/event';\nimport { KeyCode, KeyMod } from 'vs/base/common/keyCodes';\nimport { IDisposable, dispose } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { RawContextKey, IContextKey, IContextKeyService } from 'vs/platform/contextkey/common/contextkey';\nimport { IMarker, IMarkerService, MarkerSeverity } from 'vs/platform/markers/common/markers';\nimport { Position } from 'vs/editor/common/core/position';\nimport { Range } from 'vs/editor/common/core/range';\nimport * as editorCommon from 'vs/editor/common/editorCommon';\nimport { registerEditorAction, registerEditorContribution, ServicesAccessor, IActionOptions, EditorAction, EditorCommand, registerEditorCommand } from 'vs/editor/browser/editorExtensions';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { EditorContextKeys } from 'vs/editor/common/editorContextKeys';\nimport { KeybindingWeight } from 'vs/platform/keybinding/common/keybindingsRegistry';\nimport { MarkerNavigationWidget } from './gotoErrorWidget';\nimport { compare } from 'vs/base/common/strings';\nimport { binarySearch } from 'vs/base/common/arrays';\nimport { ICodeEditorService } from 'vs/editor/browser/services/codeEditorService';\nimport { onUnexpectedError } from 'vs/base/common/errors';\nimport { MenuRegistry, MenuId } from 'vs/platform/actions/common/actions';\nimport { Action } from 'vs/base/common/actions';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\n\nclass MarkerModel {\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate _markers: IMarker[];\n\tprivate _nextIdx: number;\n\tprivate _toUnbind: IDisposable[];\n\tprivate _ignoreSelectionChange: boolean;\n\tprivate readonly _onCurrentMarkerChanged: Emitter<IMarker | undefined>;\n\tprivate readonly _onMarkerSetChanged: Emitter<MarkerModel>;\n\n\tconstructor(editor: ICodeEditor, markers: IMarker[]) {\n\t\tthis._editor = editor;\n\t\tthis._markers = [];\n\t\tthis._nextIdx = -1;\n\t\tthis._toUnbind = [];\n\t\tthis._ignoreSelectionChange = false;\n\t\tthis._onCurrentMarkerChanged = new Emitter<IMarker>();\n\t\tthis._onMarkerSetChanged = new Emitter<MarkerModel>();\n\t\tthis.setMarkers(markers);\n\n\t\t// listen on editor\n\t\tthis._toUnbind.push(this._editor.onDidDispose(() => this.dispose()));\n\t\tthis._toUnbind.push(this._editor.onDidChangeCursorPosition(() => {\n\t\t\tif (this._ignoreSelectionChange) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.currentMarker && this._editor.getPosition() && Range.containsPosition(this.currentMarker, this._editor.getPosition()!)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._nextIdx = -1;\n\t\t}));\n\t}\n\n\tpublic get onCurrentMarkerChanged() {\n\t\treturn this._onCurrentMarkerChanged.event;\n\t}\n\n\tpublic get onMarkerSetChanged() {\n\t\treturn this._onMarkerSetChanged.event;\n\t}\n\n\tpublic setMarkers(markers: IMarker[]): void {\n\n\t\tlet oldMarker = this._nextIdx >= 0 ? this._markers[this._nextIdx] : undefined;\n\t\tthis._markers = markers || [];\n\t\tthis._markers.sort(MarkerNavigationAction.compareMarker);\n\t\tif (!oldMarker) {\n\t\t\tthis._nextIdx = -1;\n\t\t} else {\n\t\t\tthis._nextIdx = Math.max(-1, binarySearch(this._markers, oldMarker, MarkerNavigationAction.compareMarker));\n\t\t}\n\t\tthis._onMarkerSetChanged.fire(this);\n\t}\n\n\tpublic withoutWatchingEditorPosition(callback: () => void): void {\n\t\tthis._ignoreSelectionChange = true;\n\t\ttry {\n\t\t\tcallback();\n\t\t} finally {\n\t\t\tthis._ignoreSelectionChange = false;\n\t\t}\n\t}\n\n\tprivate _initIdx(fwd: boolean): void {\n\t\tlet found = false;\n\t\tconst position = this._editor.getPosition();\n\t\tfor (let i = 0; i < this._markers.length; i++) {\n\t\t\tlet range = Range.lift(this._markers[i]);\n\n\t\t\tif (range.isEmpty() && this._editor.getModel()) {\n\t\t\t\tconst word = this._editor.getModel()!.getWordAtPosition(range.getStartPosition());\n\t\t\t\tif (word) {\n\t\t\t\t\trange = new Range(range.startLineNumber, word.startColumn, range.startLineNumber, word.endColumn);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (position && (range.containsPosition(position) || position.isBeforeOrEqual(range.getStartPosition()))) {\n\t\t\t\tthis._nextIdx = i;\n\t\t\t\tfound = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!found) {\n\t\t\t// after the last change\n\t\t\tthis._nextIdx = fwd ? 0 : this._markers.length - 1;\n\t\t}\n\t\tif (this._nextIdx < 0) {\n\t\t\tthis._nextIdx = this._markers.length - 1;\n\t\t}\n\t}\n\n\tget currentMarker(): IMarker | undefined {\n\t\treturn this.canNavigate() ? this._markers[this._nextIdx] : undefined;\n\t}\n\n\tset currentMarker(marker: IMarker | undefined) {\n\t\tconst idx = this._nextIdx;\n\t\tthis._nextIdx = -1;\n\t\tif (marker) {\n\t\t\tthis._nextIdx = this.indexOf(marker);\n\t\t}\n\t\tif (this._nextIdx !== idx) {\n\t\t\tthis._onCurrentMarkerChanged.fire(marker);\n\t\t}\n\t}\n\n\tpublic move(fwd: boolean, inCircles: boolean): boolean {\n\t\tif (!this.canNavigate()) {\n\t\t\tthis._onCurrentMarkerChanged.fire(undefined);\n\t\t\treturn !inCircles;\n\t\t}\n\n\t\tlet oldIdx = this._nextIdx;\n\t\tlet atEdge = false;\n\n\t\tif (this._nextIdx === -1) {\n\t\t\tthis._initIdx(fwd);\n\n\t\t} else if (fwd) {\n\t\t\tif (inCircles || this._nextIdx + 1 < this._markers.length) {\n\t\t\t\tthis._nextIdx = (this._nextIdx + 1) % this._markers.length;\n\t\t\t} else {\n\t\t\t\tatEdge = true;\n\t\t\t}\n\n\t\t} else if (!fwd) {\n\t\t\tif (inCircles || this._nextIdx > 0) {\n\t\t\t\tthis._nextIdx = (this._nextIdx - 1 + this._markers.length) % this._markers.length;\n\t\t\t} else {\n\t\t\t\tatEdge = true;\n\t\t\t}\n\t\t}\n\n\t\tif (oldIdx !== this._nextIdx) {\n\t\t\tconst marker = this._markers[this._nextIdx];\n\t\t\tthis._onCurrentMarkerChanged.fire(marker);\n\t\t}\n\n\t\treturn atEdge;\n\t}\n\n\tpublic canNavigate(): boolean {\n\t\treturn this._markers.length > 0;\n\t}\n\n\tpublic findMarkerAtPosition(pos: Position): IMarker | undefined {\n\t\tfor (const marker of this._markers) {\n\t\t\tif (Range.containsPosition(marker, pos)) {\n\t\t\t\treturn marker;\n\t\t\t}\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic get total() {\n\t\treturn this._markers.length;\n\t}\n\n\tpublic indexOf(marker: IMarker): number {\n\t\treturn 1 + this._markers.indexOf(marker);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toUnbind = dispose(this._toUnbind);\n\t}\n}\n\nexport class MarkerController implements editorCommon.IEditorContribution {\n\n\tprivate static readonly ID = 'editor.contrib.markerController';\n\n\tpublic static get(editor: ICodeEditor): MarkerController {\n\t\treturn editor.getContribution<MarkerController>(MarkerController.ID);\n\t}\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate _model: MarkerModel | null = null;\n\tprivate _widget: MarkerNavigationWidget | null = null;\n\tprivate readonly _widgetVisible: IContextKey<boolean>;\n\tprivate _disposeOnClose: IDisposable[] = [];\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IMarkerService private readonly _markerService: IMarkerService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@ICodeEditorService private readonly _editorService: ICodeEditorService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._widgetVisible = CONTEXT_MARKERS_NAVIGATION_VISIBLE.bindTo(this._contextKeyService);\n\t}\n\n\tpublic getId(): string {\n\t\treturn MarkerController.ID;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._cleanUp();\n\t}\n\n\tprivate _cleanUp(): void {\n\t\tthis._widgetVisible.reset();\n\t\tthis._disposeOnClose = dispose(this._disposeOnClose);\n\t\tthis._widget = null;\n\t\tthis._model = null;\n\t}\n\n\tpublic getOrCreateModel(): MarkerModel {\n\n\t\tif (this._model) {\n\t\t\treturn this._model;\n\t\t}\n\n\t\tconst markers = this._getMarkers();\n\t\tthis._model = new MarkerModel(this._editor, markers);\n\t\tthis._markerService.onMarkerChanged(this._onMarkerChanged, this, this._disposeOnClose);\n\n\t\tconst prevMarkerKeybinding = this._keybindingService.lookupKeybinding(PrevMarkerAction.ID);\n\t\tconst nextMarkerKeybinding = this._keybindingService.lookupKeybinding(NextMarkerAction.ID);\n\t\tconst actions = [\n\t\t\tnew Action(PrevMarkerAction.ID, PrevMarkerAction.LABEL + (prevMarkerKeybinding ? ` (${prevMarkerKeybinding.getLabel()})` : ''), 'show-previous-problem chevron-up', this._model.canNavigate(), async () => { if (this._model) { this._model.move(false, true); } }),\n\t\t\tnew Action(NextMarkerAction.ID, NextMarkerAction.LABEL + (nextMarkerKeybinding ? ` (${nextMarkerKeybinding.getLabel()})` : ''), 'show-next-problem chevron-down', this._model.canNavigate(), async () => { if (this._model) { this._model.move(true, true); } })\n\t\t];\n\t\tthis._widget = new MarkerNavigationWidget(this._editor, actions, this._themeService);\n\t\tthis._widgetVisible.set(true);\n\t\tthis._widget.onDidClose(() => this._cleanUp(), this, this._disposeOnClose);\n\n\t\tthis._disposeOnClose.push(this._model);\n\t\tthis._disposeOnClose.push(this._widget);\n\t\tthis._disposeOnClose.push(...actions);\n\t\tthis._disposeOnClose.push(this._widget.onDidSelectRelatedInformation(related => {\n\t\t\tthis._editorService.openCodeEditor({\n\t\t\t\tresource: related.resource,\n\t\t\t\toptions: { pinned: true, revealIfOpened: true, selection: Range.lift(related).collapseToStart() }\n\t\t\t}, this._editor).then(undefined, onUnexpectedError);\n\t\t\tthis.closeMarkersNavigation(false);\n\t\t}));\n\t\tthis._disposeOnClose.push(this._editor.onDidChangeModel(() => this._cleanUp()));\n\n\t\tthis._disposeOnClose.push(this._model.onCurrentMarkerChanged(marker => {\n\t\t\tif (!marker || !this._model) {\n\t\t\t\tthis._cleanUp();\n\t\t\t} else {\n\t\t\t\tthis._model.withoutWatchingEditorPosition(() => {\n\t\t\t\t\tif (!this._widget || !this._model) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis._widget.showAtMarker(marker, this._model.indexOf(marker), this._model.total);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t\tthis._disposeOnClose.push(this._model.onMarkerSetChanged(() => {\n\t\t\tif (!this._widget || !this._widget.position || !this._model) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst marker = this._model.findMarkerAtPosition(this._widget.position);\n\t\t\tif (marker) {\n\t\t\t\tthis._widget.updateMarker(marker);\n\t\t\t} else {\n\t\t\t\tthis._widget.showStale();\n\t\t\t}\n\t\t}));\n\n\t\treturn this._model;\n\t}\n\n\tpublic closeMarkersNavigation(focusEditor: boolean = true): void {\n\t\tthis._cleanUp();\n\t\tif (focusEditor) {\n\t\t\tthis._editor.focus();\n\t\t}\n\t}\n\n\tpublic show(marker: IMarker): void {\n\t\tconst model = this.getOrCreateModel();\n\t\tmodel.currentMarker = marker;\n\t}\n\n\tprivate _onMarkerChanged(changedResources: URI[]): void {\n\t\tlet editorModel = this._editor.getModel();\n\t\tif (!editorModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!changedResources.some(r => editorModel!.uri.toString() === r.toString())) {\n\t\t\treturn;\n\t\t}\n\t\tthis._model.setMarkers(this._getMarkers());\n\t}\n\n\tprivate _getMarkers(): IMarker[] {\n\t\tlet model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\n\t\treturn this._markerService.read({\n\t\t\tresource: model.uri,\n\t\t\tseverities: MarkerSeverity.Error | MarkerSeverity.Warning | MarkerSeverity.Info\n\t\t});\n\t}\n}\n\nclass MarkerNavigationAction extends EditorAction {\n\n\tprivate readonly _isNext: boolean;\n\n\tprivate readonly _multiFile: boolean;\n\n\tconstructor(next: boolean, multiFile: boolean, opts: IActionOptions) {\n\t\tsuper(opts);\n\t\tthis._isNext = next;\n\t\tthis._multiFile = multiFile;\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): Promise<void> {\n\n\t\tconst markerService = accessor.get(IMarkerService);\n\t\tconst editorService = accessor.get(ICodeEditorService);\n\t\tconst controller = MarkerController.get(editor);\n\t\tif (!controller) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst model = controller.getOrCreateModel();\n\t\tconst atEdge = model.move(this._isNext, !this._multiFile);\n\t\tif (!atEdge || !this._multiFile) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\t// try with the next/prev file\n\t\tlet markers = markerService.read({ severities: MarkerSeverity.Error | MarkerSeverity.Warning | MarkerSeverity.Info }).sort(MarkerNavigationAction.compareMarker);\n\t\tif (markers.length === 0) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tlet editorModel = editor.getModel();\n\t\tif (!editorModel) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tlet oldMarker = model.currentMarker || <IMarker>{ resource: editorModel!.uri, severity: MarkerSeverity.Error, startLineNumber: 1, startColumn: 1, endLineNumber: 1, endColumn: 1 };\n\t\tlet idx = binarySearch(markers, oldMarker, MarkerNavigationAction.compareMarker);\n\t\tif (idx < 0) {\n\t\t\t// find best match...\n\t\t\tidx = ~idx;\n\t\t\tidx %= markers.length;\n\t\t} else if (this._isNext) {\n\t\t\tidx = (idx + 1) % markers.length;\n\t\t} else {\n\t\t\tidx = (idx + markers.length - 1) % markers.length;\n\t\t}\n\n\t\tlet newMarker = markers[idx];\n\t\tif (newMarker.resource.toString() === editorModel!.uri.toString()) {\n\t\t\t// the next `resource` is this resource which\n\t\t\t// means we cycle within this file\n\t\t\tmodel.move(this._isNext, true);\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\t// close the widget for this editor-instance, open the resource\n\t\t// for the next marker and re-start marker navigation in there\n\t\tcontroller.closeMarkersNavigation();\n\n\t\treturn editorService.openCodeEditor({\n\t\t\tresource: newMarker.resource,\n\t\t\toptions: { pinned: false, revealIfOpened: true, revealInCenterIfOutsideViewport: true, selection: newMarker }\n\t\t}, editor).then(editor => {\n\t\t\tif (!editor) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn editor.getAction(this.id).run();\n\t\t});\n\t}\n\n\tstatic compareMarker(a: IMarker, b: IMarker): number {\n\t\tlet res = compare(a.resource.toString(), b.resource.toString());\n\t\tif (res === 0) {\n\t\t\tres = MarkerSeverity.compare(a.severity, b.severity);\n\t\t}\n\t\tif (res === 0) {\n\t\t\tres = Range.compareRangesUsingStarts(a, b);\n\t\t}\n\t\treturn res;\n\t}\n}\n\nexport class NextMarkerAction extends MarkerNavigationAction {\n\tstatic ID: string = 'editor.action.marker.next';\n\tstatic LABEL: string = nls.localize('markerAction.next.label', \"Go to Next Problem (Error, Warning, Info)\");\n\tconstructor() {\n\t\tsuper(true, false, {\n\t\t\tid: NextMarkerAction.ID,\n\t\t\tlabel: NextMarkerAction.LABEL,\n\t\t\talias: 'Go to Next Error or Warning',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: { kbExpr: EditorContextKeys.editorTextFocus, primary: KeyMod.Alt | KeyCode.F8, weight: KeybindingWeight.EditorContrib }\n\t\t});\n\t}\n}\n\nclass PrevMarkerAction extends MarkerNavigationAction {\n\tstatic ID: string = 'editor.action.marker.prev';\n\tstatic LABEL: string = nls.localize('markerAction.previous.label', \"Go to Previous Problem (Error, Warning, Info)\");\n\tconstructor() {\n\t\tsuper(false, false, {\n\t\t\tid: PrevMarkerAction.ID,\n\t\t\tlabel: PrevMarkerAction.LABEL,\n\t\t\talias: 'Go to Previous Error or Warning',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: { kbExpr: EditorContextKeys.editorTextFocus, primary: KeyMod.Shift | KeyMod.Alt | KeyCode.F8, weight: KeybindingWeight.EditorContrib }\n\t\t});\n\t}\n}\n\nclass NextMarkerInFilesAction extends MarkerNavigationAction {\n\tconstructor() {\n\t\tsuper(true, true, {\n\t\t\tid: 'editor.action.marker.nextInFiles',\n\t\t\tlabel: nls.localize('markerAction.nextInFiles.label', \"Go to Next Problem in Files (Error, Warning, Info)\"),\n\t\t\talias: 'Go to Next Error or Warning in Files',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.focus,\n\t\t\t\tprimary: KeyCode.F8,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n}\n\nclass PrevMarkerInFilesAction extends MarkerNavigationAction {\n\tconstructor() {\n\t\tsuper(false, true, {\n\t\t\tid: 'editor.action.marker.prevInFiles',\n\t\t\tlabel: nls.localize('markerAction.previousInFiles.label', \"Go to Previous Problem in Files (Error, Warning, Info)\"),\n\t\t\talias: 'Go to Previous Error or Warning in Files',\n\t\t\tprecondition: EditorContextKeys.writable,\n\t\t\tkbOpts: {\n\t\t\t\tkbExpr: EditorContextKeys.focus,\n\t\t\t\tprimary: KeyMod.Shift | KeyCode.F8,\n\t\t\t\tweight: KeybindingWeight.EditorContrib\n\t\t\t}\n\t\t});\n\t}\n}\n\nregisterEditorContribution(MarkerController);\nregisterEditorAction(NextMarkerAction);\nregisterEditorAction(PrevMarkerAction);\nregisterEditorAction(NextMarkerInFilesAction);\nregisterEditorAction(PrevMarkerInFilesAction);\n\nconst CONTEXT_MARKERS_NAVIGATION_VISIBLE = new RawContextKey<boolean>('markersNavigationVisible', false);\n\nconst MarkerCommand = EditorCommand.bindToContribution<MarkerController>(MarkerController.get);\n\nregisterEditorCommand(new MarkerCommand({\n\tid: 'closeMarkersNavigation',\n\tprecondition: CONTEXT_MARKERS_NAVIGATION_VISIBLE,\n\thandler: x => x.closeMarkersNavigation(),\n\tkbOpts: {\n\t\tweight: KeybindingWeight.EditorContrib + 50,\n\t\tkbExpr: EditorContextKeys.focus,\n\t\tprimary: KeyCode.Escape,\n\t\tsecondary: [KeyMod.Shift | KeyCode.Escape]\n\t}\n}));\n\n// Go to menu\nMenuRegistry.appendMenuItem(MenuId.MenubarGoMenu, {\n\tgroup: '6_problem_nav',\n\tcommand: {\n\t\tid: 'editor.action.marker.nextInFiles',\n\t\ttitle: nls.localize({ key: 'miGotoNextProblem', comment: ['&& denotes a mnemonic'] }, \"Next &&Problem\")\n\t},\n\torder: 1\n});\n\nMenuRegistry.appendMenuItem(MenuId.MenubarGoMenu, {\n\tgroup: '6_problem_nav',\n\tcommand: {\n\t\tid: 'editor.action.marker.prevInFiles',\n\t\ttitle: nls.localize({ key: 'miGotoPreviousProblem', comment: ['&& denotes a mnemonic'] }, \"Previous &&Problem\")\n\t},\n\torder: 2\n});"]}]}