{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesModel.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesModel.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar nls_1 = require(\"vs/nls\");\nvar event_1 = require(\"vs/base/common/event\");\nvar resources_1 = require(\"vs/base/common/resources\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar strings = require(\"vs/base/common/strings\");\nvar idGenerator_1 = require(\"vs/base/common/idGenerator\");\nvar range_1 = require(\"vs/editor/common/core/range\");\nvar OneReference = /** @class */ (function () {\n    function OneReference(parent, _range, isProviderFirst) {\n        this.parent = parent;\n        this._range = _range;\n        this.isProviderFirst = isProviderFirst;\n        this._onRefChanged = new event_1.Emitter();\n        this.onRefChanged = this._onRefChanged.event;\n        this.id = idGenerator_1.defaultGenerator.nextId();\n    }\n    Object.defineProperty(OneReference.prototype, \"uri\", {\n        get: function () {\n            return this.parent.uri;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(OneReference.prototype, \"range\", {\n        get: function () {\n            return this._range;\n        },\n        set: function (value) {\n            this._range = value;\n            this._onRefChanged.fire(this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    OneReference.prototype.getAriaMessage = function () {\n        return nls_1.localize('aria.oneReference', \"symbol in {0} on line {1} at column {2}\", resources_1.basename(this.uri), this.range.startLineNumber, this.range.startColumn);\n    };\n    return OneReference;\n}());\nexports.OneReference = OneReference;\nvar FilePreview = /** @class */ (function () {\n    function FilePreview(_modelReference) {\n        this._modelReference = _modelReference;\n    }\n    FilePreview.prototype.dispose = function () {\n        lifecycle_1.dispose(this._modelReference);\n    };\n    FilePreview.prototype.preview = function (range, n) {\n        if (n === void 0) { n = 8; }\n        var model = this._modelReference.object.textEditorModel;\n        if (!model) {\n            return undefined;\n        }\n        var startLineNumber = range.startLineNumber, startColumn = range.startColumn, endLineNumber = range.endLineNumber, endColumn = range.endColumn;\n        var word = model.getWordUntilPosition({ lineNumber: startLineNumber, column: startColumn - n });\n        var beforeRange = new range_1.Range(startLineNumber, word.startColumn, startLineNumber, startColumn);\n        var afterRange = new range_1.Range(endLineNumber, endColumn, endLineNumber, Number.MAX_VALUE);\n        var ret = {\n            before: model.getValueInRange(beforeRange).replace(/^\\s+/, strings.empty),\n            inside: model.getValueInRange(range),\n            after: model.getValueInRange(afterRange).replace(/\\s+$/, strings.empty)\n        };\n        return ret;\n    };\n    return FilePreview;\n}());\nexports.FilePreview = FilePreview;\nvar FileReferences = /** @class */ (function () {\n    function FileReferences(_parent, _uri) {\n        this._parent = _parent;\n        this._uri = _uri;\n        this._children = [];\n    }\n    Object.defineProperty(FileReferences.prototype, \"id\", {\n        get: function () {\n            return this._uri.toString();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FileReferences.prototype, \"parent\", {\n        get: function () {\n            return this._parent;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FileReferences.prototype, \"children\", {\n        get: function () {\n            return this._children;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FileReferences.prototype, \"uri\", {\n        get: function () {\n            return this._uri;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FileReferences.prototype, \"preview\", {\n        get: function () {\n            return this._preview;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(FileReferences.prototype, \"failure\", {\n        get: function () {\n            return this._loadFailure;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    FileReferences.prototype.getAriaMessage = function () {\n        var len = this.children.length;\n        if (len === 1) {\n            return nls_1.localize('aria.fileReferences.1', \"1 symbol in {0}, full path {1}\", resources_1.basename(this.uri), this.uri.fsPath);\n        }\n        else {\n            return nls_1.localize('aria.fileReferences.N', \"{0} symbols in {1}, full path {2}\", len, resources_1.basename(this.uri), this.uri.fsPath);\n        }\n    };\n    FileReferences.prototype.resolve = function (textModelResolverService) {\n        var _this = this;\n        if (this._resolved) {\n            return Promise.resolve(this);\n        }\n        return Promise.resolve(textModelResolverService.createModelReference(this._uri).then(function (modelReference) {\n            var model = modelReference.object;\n            if (!model) {\n                modelReference.dispose();\n                throw new Error();\n            }\n            _this._preview = new FilePreview(modelReference);\n            _this._resolved = true;\n            return _this;\n        }, function (err) {\n            // something wrong here\n            _this._children = [];\n            _this._resolved = true;\n            _this._loadFailure = err;\n            return _this;\n        }));\n    };\n    FileReferences.prototype.dispose = function () {\n        if (this._preview) {\n            this._preview.dispose();\n            this._preview = undefined;\n        }\n    };\n    return FileReferences;\n}());\nexports.FileReferences = FileReferences;\nvar ReferencesModel = /** @class */ (function () {\n    function ReferencesModel(references) {\n        var _this = this;\n        this.groups = [];\n        this.references = [];\n        this._onDidChangeReferenceRange = new event_1.Emitter();\n        this.onDidChangeReferenceRange = this._onDidChangeReferenceRange.event;\n        this._disposables = [];\n        // grouping and sorting\n        var providersFirst = references[0];\n        references.sort(ReferencesModel._compareReferences);\n        var current;\n        for (var _i = 0, references_1 = references; _i < references_1.length; _i++) {\n            var ref = references_1[_i];\n            if (!current || current.uri.toString() !== ref.uri.toString()) {\n                // new group\n                current = new FileReferences(this, ref.uri);\n                this.groups.push(current);\n            }\n            // append, check for equality first!\n            if (current.children.length === 0\n                || !range_1.Range.equalsRange(ref.range, current.children[current.children.length - 1].range)) {\n                var oneRef = new OneReference(current, ref.targetSelectionRange || ref.range, providersFirst === ref);\n                this._disposables.push(oneRef.onRefChanged(function (e) { return _this._onDidChangeReferenceRange.fire(e); }));\n                this.references.push(oneRef);\n                current.children.push(oneRef);\n            }\n        }\n    }\n    Object.defineProperty(ReferencesModel.prototype, \"empty\", {\n        get: function () {\n            return this.groups.length === 0;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ReferencesModel.prototype.getAriaMessage = function () {\n        if (this.empty) {\n            return nls_1.localize('aria.result.0', \"No results found\");\n        }\n        else if (this.references.length === 1) {\n            return nls_1.localize('aria.result.1', \"Found 1 symbol in {0}\", this.references[0].uri.fsPath);\n        }\n        else if (this.groups.length === 1) {\n            return nls_1.localize('aria.result.n1', \"Found {0} symbols in {1}\", this.references.length, this.groups[0].uri.fsPath);\n        }\n        else {\n            return nls_1.localize('aria.result.nm', \"Found {0} symbols in {1} files\", this.references.length, this.groups.length);\n        }\n    };\n    ReferencesModel.prototype.nextOrPreviousReference = function (reference, next) {\n        var parent = reference.parent;\n        var idx = parent.children.indexOf(reference);\n        var childCount = parent.children.length;\n        var groupCount = parent.parent.groups.length;\n        if (groupCount === 1 || next && idx + 1 < childCount || !next && idx > 0) {\n            // cycling within one file\n            if (next) {\n                idx = (idx + 1) % childCount;\n            }\n            else {\n                idx = (idx + childCount - 1) % childCount;\n            }\n            return parent.children[idx];\n        }\n        idx = parent.parent.groups.indexOf(parent);\n        if (next) {\n            idx = (idx + 1) % groupCount;\n            return parent.parent.groups[idx].children[0];\n        }\n        else {\n            idx = (idx + groupCount - 1) % groupCount;\n            return parent.parent.groups[idx].children[parent.parent.groups[idx].children.length - 1];\n        }\n    };\n    ReferencesModel.prototype.nearestReference = function (resource, position) {\n        var nearest = this.references.map(function (ref, idx) {\n            return {\n                idx: idx,\n                prefixLen: strings.commonPrefixLength(ref.uri.toString(), resource.toString()),\n                offsetDist: Math.abs(ref.range.startLineNumber - position.lineNumber) * 100 + Math.abs(ref.range.startColumn - position.column)\n            };\n        }).sort(function (a, b) {\n            if (a.prefixLen > b.prefixLen) {\n                return -1;\n            }\n            else if (a.prefixLen < b.prefixLen) {\n                return 1;\n            }\n            else if (a.offsetDist < b.offsetDist) {\n                return -1;\n            }\n            else if (a.offsetDist > b.offsetDist) {\n                return 1;\n            }\n            else {\n                return 0;\n            }\n        })[0];\n        if (nearest) {\n            return this.references[nearest.idx];\n        }\n        return undefined;\n    };\n    ReferencesModel.prototype.firstReference = function () {\n        for (var _i = 0, _a = this.references; _i < _a.length; _i++) {\n            var ref = _a[_i];\n            if (ref.isProviderFirst) {\n                return ref;\n            }\n        }\n        return this.references[0];\n    };\n    ReferencesModel.prototype.dispose = function () {\n        lifecycle_1.dispose(this.groups);\n        lifecycle_1.dispose(this._disposables);\n        this.groups.length = 0;\n        this._disposables.length = 0;\n    };\n    ReferencesModel._compareReferences = function (a, b) {\n        var auri = a.uri.toString();\n        var buri = b.uri.toString();\n        if (auri < buri) {\n            return -1;\n        }\n        else if (auri > buri) {\n            return 1;\n        }\n        else {\n            return range_1.Range.compareRangesUsingStarts(a.range, b.range);\n        }\n    };\n    return ReferencesModel;\n}());\nexports.ReferencesModel = ReferencesModel;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesModel.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from 'vs/nls';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { basename } from 'vs/base/common/resources';\nimport { IDisposable, dispose, IReference } from 'vs/base/common/lifecycle';\nimport * as strings from 'vs/base/common/strings';\nimport { URI } from 'vs/base/common/uri';\nimport { defaultGenerator } from 'vs/base/common/idGenerator';\nimport { Range, IRange } from 'vs/editor/common/core/range';\nimport { Location, LocationLink } from 'vs/editor/common/modes';\nimport { ITextModelService, ITextEditorModel } from 'vs/editor/common/services/resolverService';\nimport { Position } from 'vs/editor/common/core/position';\n\nexport class OneReference {\n\treadonly id: string;\n\n\tprivate readonly _onRefChanged = new Emitter<this>();\n\treadonly onRefChanged: Event<this> = this._onRefChanged.event;\n\n\tconstructor(\n\t\treadonly parent: FileReferences,\n\t\tprivate _range: IRange,\n\t\treadonly isProviderFirst: boolean\n\t) {\n\t\tthis.id = defaultGenerator.nextId();\n\t}\n\n\tget uri(): URI {\n\t\treturn this.parent.uri;\n\t}\n\n\tget range(): IRange {\n\t\treturn this._range;\n\t}\n\n\tset range(value: IRange) {\n\t\tthis._range = value;\n\t\tthis._onRefChanged.fire(this);\n\t}\n\n\tgetAriaMessage(): string {\n\t\treturn localize(\n\t\t\t'aria.oneReference', \"symbol in {0} on line {1} at column {2}\",\n\t\t\tbasename(this.uri), this.range.startLineNumber, this.range.startColumn\n\t\t);\n\t}\n}\n\nexport class FilePreview implements IDisposable {\n\n\tconstructor(\n\t\tprivate readonly _modelReference: IReference<ITextEditorModel>\n\t) {\n\t}\n\n\tdispose(): void {\n\t\tdispose(this._modelReference);\n\t}\n\n\tpreview(range: IRange, n: number = 8): { before: string; inside: string; after: string } | undefined {\n\t\tconst model = this._modelReference.object.textEditorModel;\n\n\t\tif (!model) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst { startLineNumber, startColumn, endLineNumber, endColumn } = range;\n\t\tconst word = model.getWordUntilPosition({ lineNumber: startLineNumber, column: startColumn - n });\n\t\tconst beforeRange = new Range(startLineNumber, word.startColumn, startLineNumber, startColumn);\n\t\tconst afterRange = new Range(endLineNumber, endColumn, endLineNumber, Number.MAX_VALUE);\n\n\t\tconst ret = {\n\t\t\tbefore: model.getValueInRange(beforeRange).replace(/^\\s+/, strings.empty),\n\t\t\tinside: model.getValueInRange(range),\n\t\t\tafter: model.getValueInRange(afterRange).replace(/\\s+$/, strings.empty)\n\t\t};\n\n\t\treturn ret;\n\t}\n}\n\nexport class FileReferences implements IDisposable {\n\n\tprivate _children: OneReference[];\n\tprivate _preview?: FilePreview;\n\tprivate _resolved: boolean;\n\tprivate _loadFailure: any;\n\n\tconstructor(private readonly _parent: ReferencesModel, private readonly _uri: URI) {\n\t\tthis._children = [];\n\t}\n\n\tget id(): string {\n\t\treturn this._uri.toString();\n\t}\n\n\tget parent(): ReferencesModel {\n\t\treturn this._parent;\n\t}\n\n\tget children(): OneReference[] {\n\t\treturn this._children;\n\t}\n\n\tget uri(): URI {\n\t\treturn this._uri;\n\t}\n\n\tget preview(): FilePreview | undefined {\n\t\treturn this._preview;\n\t}\n\n\tget failure(): any {\n\t\treturn this._loadFailure;\n\t}\n\n\tgetAriaMessage(): string {\n\t\tconst len = this.children.length;\n\t\tif (len === 1) {\n\t\t\treturn localize('aria.fileReferences.1', \"1 symbol in {0}, full path {1}\", basename(this.uri), this.uri.fsPath);\n\t\t} else {\n\t\t\treturn localize('aria.fileReferences.N', \"{0} symbols in {1}, full path {2}\", len, basename(this.uri), this.uri.fsPath);\n\t\t}\n\t}\n\n\tresolve(textModelResolverService: ITextModelService): Promise<FileReferences> {\n\n\t\tif (this._resolved) {\n\t\t\treturn Promise.resolve(this);\n\t\t}\n\n\t\treturn Promise.resolve(textModelResolverService.createModelReference(this._uri).then(modelReference => {\n\t\t\tconst model = modelReference.object;\n\n\t\t\tif (!model) {\n\t\t\t\tmodelReference.dispose();\n\t\t\t\tthrow new Error();\n\t\t\t}\n\n\t\t\tthis._preview = new FilePreview(modelReference);\n\t\t\tthis._resolved = true;\n\t\t\treturn this;\n\n\t\t}, err => {\n\t\t\t// something wrong here\n\t\t\tthis._children = [];\n\t\t\tthis._resolved = true;\n\t\t\tthis._loadFailure = err;\n\t\t\treturn this;\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tif (this._preview) {\n\t\t\tthis._preview.dispose();\n\t\t\tthis._preview = undefined;\n\t\t}\n\t}\n}\n\nexport class ReferencesModel implements IDisposable {\n\n\tprivate readonly _disposables: IDisposable[];\n\treadonly groups: FileReferences[] = [];\n\treadonly references: OneReference[] = [];\n\n\treadonly _onDidChangeReferenceRange = new Emitter<OneReference>();\n\treadonly onDidChangeReferenceRange: Event<OneReference> = this._onDidChangeReferenceRange.event;\n\n\tconstructor(references: LocationLink[]) {\n\t\tthis._disposables = [];\n\t\t// grouping and sorting\n\t\tconst [providersFirst] = references;\n\t\treferences.sort(ReferencesModel._compareReferences);\n\n\t\tlet current: FileReferences | undefined;\n\t\tfor (let ref of references) {\n\t\t\tif (!current || current.uri.toString() !== ref.uri.toString()) {\n\t\t\t\t// new group\n\t\t\t\tcurrent = new FileReferences(this, ref.uri);\n\t\t\t\tthis.groups.push(current);\n\t\t\t}\n\n\t\t\t// append, check for equality first!\n\t\t\tif (current.children.length === 0\n\t\t\t\t|| !Range.equalsRange(ref.range, current.children[current.children.length - 1].range)) {\n\n\t\t\t\tlet oneRef = new OneReference(current, ref.targetSelectionRange || ref.range, providersFirst === ref);\n\t\t\t\tthis._disposables.push(oneRef.onRefChanged((e) => this._onDidChangeReferenceRange.fire(e)));\n\t\t\t\tthis.references.push(oneRef);\n\t\t\t\tcurrent.children.push(oneRef);\n\t\t\t}\n\t\t}\n\t}\n\n\tget empty(): boolean {\n\t\treturn this.groups.length === 0;\n\t}\n\n\tgetAriaMessage(): string {\n\t\tif (this.empty) {\n\t\t\treturn localize('aria.result.0', \"No results found\");\n\t\t} else if (this.references.length === 1) {\n\t\t\treturn localize('aria.result.1', \"Found 1 symbol in {0}\", this.references[0].uri.fsPath);\n\t\t} else if (this.groups.length === 1) {\n\t\t\treturn localize('aria.result.n1', \"Found {0} symbols in {1}\", this.references.length, this.groups[0].uri.fsPath);\n\t\t} else {\n\t\t\treturn localize('aria.result.nm', \"Found {0} symbols in {1} files\", this.references.length, this.groups.length);\n\t\t}\n\t}\n\n\tnextOrPreviousReference(reference: OneReference, next: boolean): OneReference {\n\n\t\tlet { parent } = reference;\n\n\t\tlet idx = parent.children.indexOf(reference);\n\t\tlet childCount = parent.children.length;\n\t\tlet groupCount = parent.parent.groups.length;\n\n\t\tif (groupCount === 1 || next && idx + 1 < childCount || !next && idx > 0) {\n\t\t\t// cycling within one file\n\t\t\tif (next) {\n\t\t\t\tidx = (idx + 1) % childCount;\n\t\t\t} else {\n\t\t\t\tidx = (idx + childCount - 1) % childCount;\n\t\t\t}\n\t\t\treturn parent.children[idx];\n\t\t}\n\n\t\tidx = parent.parent.groups.indexOf(parent);\n\t\tif (next) {\n\t\t\tidx = (idx + 1) % groupCount;\n\t\t\treturn parent.parent.groups[idx].children[0];\n\t\t} else {\n\t\t\tidx = (idx + groupCount - 1) % groupCount;\n\t\t\treturn parent.parent.groups[idx].children[parent.parent.groups[idx].children.length - 1];\n\t\t}\n\t}\n\n\tnearestReference(resource: URI, position: Position): OneReference | undefined {\n\n\t\tconst nearest = this.references.map((ref, idx) => {\n\t\t\treturn {\n\t\t\t\tidx,\n\t\t\t\tprefixLen: strings.commonPrefixLength(ref.uri.toString(), resource.toString()),\n\t\t\t\toffsetDist: Math.abs(ref.range.startLineNumber - position.lineNumber) * 100 + Math.abs(ref.range.startColumn - position.column)\n\t\t\t};\n\t\t}).sort((a, b) => {\n\t\t\tif (a.prefixLen > b.prefixLen) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.prefixLen < b.prefixLen) {\n\t\t\t\treturn 1;\n\t\t\t} else if (a.offsetDist < b.offsetDist) {\n\t\t\t\treturn -1;\n\t\t\t} else if (a.offsetDist > b.offsetDist) {\n\t\t\t\treturn 1;\n\t\t\t} else {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t})[0];\n\n\t\tif (nearest) {\n\t\t\treturn this.references[nearest.idx];\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tfirstReference(): OneReference | undefined {\n\t\tfor (const ref of this.references) {\n\t\t\tif (ref.isProviderFirst) {\n\t\t\t\treturn ref;\n\t\t\t}\n\t\t}\n\t\treturn this.references[0];\n\t}\n\n\tdispose(): void {\n\t\tdispose(this.groups);\n\t\tdispose(this._disposables);\n\t\tthis.groups.length = 0;\n\t\tthis._disposables.length = 0;\n\t}\n\n\tprivate static _compareReferences(a: Location, b: Location): number {\n\t\tconst auri = a.uri.toString();\n\t\tconst buri = b.uri.toString();\n\t\tif (auri < buri) {\n\t\t\treturn -1;\n\t\t} else if (auri > buri) {\n\t\t\treturn 1;\n\t\t} else {\n\t\t\treturn Range.compareRangesUsingStarts(a.range, b.range);\n\t\t}\n\t}\n}\n"]}]}