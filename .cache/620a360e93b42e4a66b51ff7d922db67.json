{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/scrollbar/scrollableElement.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/scrollbar/scrollableElement.ts","mtime":1555846338028},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nrequire(\"vs/css!./media/scrollbars\");\nvar dom = require(\"vs/base/browser/dom\");\nvar fastDomNode_1 = require(\"vs/base/browser/fastDomNode\");\nvar mouseEvent_1 = require(\"vs/base/browser/mouseEvent\");\nvar horizontalScrollbar_1 = require(\"vs/base/browser/ui/scrollbar/horizontalScrollbar\");\nvar verticalScrollbar_1 = require(\"vs/base/browser/ui/scrollbar/verticalScrollbar\");\nvar widget_1 = require(\"vs/base/browser/ui/widget\");\nvar async_1 = require(\"vs/base/common/async\");\nvar event_1 = require(\"vs/base/common/event\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar browser = require(\"vs/base/browser/browser\");\nvar scrollable_1 = require(\"vs/base/common/scrollable\");\nvar HIDE_TIMEOUT = 500;\nvar SCROLL_WHEEL_SENSITIVITY = 50;\nvar SCROLL_WHEEL_SMOOTH_SCROLL_ENABLED = true;\nvar MouseWheelClassifierItem = /** @class */ (function () {\n    function MouseWheelClassifierItem(timestamp, deltaX, deltaY) {\n        this.timestamp = timestamp;\n        this.deltaX = deltaX;\n        this.deltaY = deltaY;\n        this.score = 0;\n    }\n    return MouseWheelClassifierItem;\n}());\nvar MouseWheelClassifier = /** @class */ (function () {\n    function MouseWheelClassifier() {\n        this._capacity = 5;\n        this._memory = [];\n        this._front = -1;\n        this._rear = -1;\n    }\n    MouseWheelClassifier.prototype.isPhysicalMouseWheel = function () {\n        if (this._front === -1 && this._rear === -1) {\n            // no elements\n            return false;\n        }\n        // 0.5 * last + 0.25 * before last + 0.125 * before before last + ...\n        var remainingInfluence = 1;\n        var score = 0;\n        var iteration = 1;\n        var index = this._rear;\n        do {\n            var influence = (index === this._front ? remainingInfluence : Math.pow(2, -iteration));\n            remainingInfluence -= influence;\n            score += this._memory[index].score * influence;\n            if (index === this._front) {\n                break;\n            }\n            index = (this._capacity + index - 1) % this._capacity;\n            iteration++;\n        } while (true);\n        return (score <= 0.5);\n    };\n    MouseWheelClassifier.prototype.accept = function (timestamp, deltaX, deltaY) {\n        var item = new MouseWheelClassifierItem(timestamp, deltaX, deltaY);\n        item.score = this._computeScore(item);\n        if (this._front === -1 && this._rear === -1) {\n            this._memory[0] = item;\n            this._front = 0;\n            this._rear = 0;\n        }\n        else {\n            this._rear = (this._rear + 1) % this._capacity;\n            if (this._rear === this._front) {\n                // Drop oldest\n                this._front = (this._front + 1) % this._capacity;\n            }\n            this._memory[this._rear] = item;\n        }\n    };\n    /**\n     * A score between 0 and 1 for `item`.\n     *  - a score towards 0 indicates that the source appears to be a physical mouse wheel\n     *  - a score towards 1 indicates that the source appears to be a touchpad or magic mouse, etc.\n     */\n    MouseWheelClassifier.prototype._computeScore = function (item) {\n        if (Math.abs(item.deltaX) > 0 && Math.abs(item.deltaY) > 0) {\n            // both axes exercised => definitely not a physical mouse wheel\n            return 1;\n        }\n        var score = 0.5;\n        var prev = (this._front === -1 && this._rear === -1 ? null : this._memory[this._rear]);\n        if (prev) {\n            // const deltaT = item.timestamp - prev.timestamp;\n            // if (deltaT < 1000 / 30) {\n            // \t// sooner than X times per second => indicator that this is not a physical mouse wheel\n            // \tscore += 0.25;\n            // }\n            // if (item.deltaX === prev.deltaX && item.deltaY === prev.deltaY) {\n            // \t// equal amplitude => indicator that this is a physical mouse wheel\n            // \tscore -= 0.25;\n            // }\n        }\n        if (Math.abs(item.deltaX - Math.round(item.deltaX)) > 0 || Math.abs(item.deltaY - Math.round(item.deltaY)) > 0) {\n            // non-integer deltas => indicator that this is not a physical mouse wheel\n            score += 0.25;\n        }\n        return Math.min(Math.max(score, 0), 1);\n    };\n    MouseWheelClassifier.INSTANCE = new MouseWheelClassifier();\n    return MouseWheelClassifier;\n}());\nexports.MouseWheelClassifier = MouseWheelClassifier;\nvar AbstractScrollableElement = /** @class */ (function (_super) {\n    tslib_1.__extends(AbstractScrollableElement, _super);\n    function AbstractScrollableElement(element, options, scrollable) {\n        var _this = _super.call(this) || this;\n        _this._onScroll = _this._register(new event_1.Emitter());\n        _this.onScroll = _this._onScroll.event;\n        element.style.overflow = 'hidden';\n        _this._options = resolveOptions(options);\n        _this._scrollable = scrollable;\n        _this._register(_this._scrollable.onScroll(function (e) {\n            _this._onDidScroll(e);\n            _this._onScroll.fire(e);\n        }));\n        var scrollbarHost = {\n            onMouseWheel: function (mouseWheelEvent) { return _this._onMouseWheel(mouseWheelEvent); },\n            onDragStart: function () { return _this._onDragStart(); },\n            onDragEnd: function () { return _this._onDragEnd(); },\n        };\n        _this._verticalScrollbar = _this._register(new verticalScrollbar_1.VerticalScrollbar(_this._scrollable, _this._options, scrollbarHost));\n        _this._horizontalScrollbar = _this._register(new horizontalScrollbar_1.HorizontalScrollbar(_this._scrollable, _this._options, scrollbarHost));\n        _this._domNode = document.createElement('div');\n        _this._domNode.className = 'monaco-scrollable-element ' + _this._options.className;\n        _this._domNode.setAttribute('role', 'presentation');\n        _this._domNode.style.position = 'relative';\n        _this._domNode.style.overflow = 'hidden';\n        _this._domNode.appendChild(element);\n        _this._domNode.appendChild(_this._horizontalScrollbar.domNode.domNode);\n        _this._domNode.appendChild(_this._verticalScrollbar.domNode.domNode);\n        if (_this._options.useShadows) {\n            _this._leftShadowDomNode = fastDomNode_1.createFastDomNode(document.createElement('div'));\n            _this._leftShadowDomNode.setClassName('shadow');\n            _this._domNode.appendChild(_this._leftShadowDomNode.domNode);\n            _this._topShadowDomNode = fastDomNode_1.createFastDomNode(document.createElement('div'));\n            _this._topShadowDomNode.setClassName('shadow');\n            _this._domNode.appendChild(_this._topShadowDomNode.domNode);\n            _this._topLeftShadowDomNode = fastDomNode_1.createFastDomNode(document.createElement('div'));\n            _this._topLeftShadowDomNode.setClassName('shadow top-left-corner');\n            _this._domNode.appendChild(_this._topLeftShadowDomNode.domNode);\n        }\n        _this._listenOnDomNode = _this._options.listenOnDomNode || _this._domNode;\n        _this._mouseWheelToDispose = [];\n        _this._setListeningToMouseWheel(_this._options.handleMouseWheel);\n        _this.onmouseover(_this._listenOnDomNode, function (e) { return _this._onMouseOver(e); });\n        _this.onnonbubblingmouseout(_this._listenOnDomNode, function (e) { return _this._onMouseOut(e); });\n        _this._hideTimeout = _this._register(new async_1.TimeoutTimer());\n        _this._isDragging = false;\n        _this._mouseIsOver = false;\n        _this._shouldRender = true;\n        _this._revealOnScroll = true;\n        return _this;\n    }\n    AbstractScrollableElement.prototype.dispose = function () {\n        this._mouseWheelToDispose = lifecycle_1.dispose(this._mouseWheelToDispose);\n        _super.prototype.dispose.call(this);\n    };\n    /**\n     * Get the generated 'scrollable' dom node\n     */\n    AbstractScrollableElement.prototype.getDomNode = function () {\n        return this._domNode;\n    };\n    AbstractScrollableElement.prototype.getOverviewRulerLayoutInfo = function () {\n        return {\n            parent: this._domNode,\n            insertBefore: this._verticalScrollbar.domNode.domNode,\n        };\n    };\n    /**\n     * Delegate a mouse down event to the vertical scrollbar.\n     * This is to help with clicking somewhere else and having the scrollbar react.\n     */\n    AbstractScrollableElement.prototype.delegateVerticalScrollbarMouseDown = function (browserEvent) {\n        this._verticalScrollbar.delegateMouseDown(browserEvent);\n    };\n    AbstractScrollableElement.prototype.getScrollDimensions = function () {\n        return this._scrollable.getScrollDimensions();\n    };\n    AbstractScrollableElement.prototype.setScrollDimensions = function (dimensions) {\n        this._scrollable.setScrollDimensions(dimensions);\n    };\n    /**\n     * Update the class name of the scrollable element.\n     */\n    AbstractScrollableElement.prototype.updateClassName = function (newClassName) {\n        this._options.className = newClassName;\n        // Defaults are different on Macs\n        if (browser.isMacintosh) {\n            this._options.className += ' mac';\n        }\n        this._domNode.className = 'monaco-scrollable-element ' + this._options.className;\n    };\n    /**\n     * Update configuration options for the scrollbar.\n     * Really this is Editor.IEditorScrollbarOptions, but base shouldn't\n     * depend on Editor.\n     */\n    AbstractScrollableElement.prototype.updateOptions = function (newOptions) {\n        var massagedOptions = resolveOptions(newOptions);\n        this._options.handleMouseWheel = massagedOptions.handleMouseWheel;\n        this._options.mouseWheelScrollSensitivity = massagedOptions.mouseWheelScrollSensitivity;\n        this._options.fastScrollSensitivity = massagedOptions.fastScrollSensitivity;\n        this._setListeningToMouseWheel(this._options.handleMouseWheel);\n        if (!this._options.lazyRender) {\n            this._render();\n        }\n    };\n    AbstractScrollableElement.prototype.setRevealOnScroll = function (value) {\n        this._revealOnScroll = value;\n    };\n    // -------------------- mouse wheel scrolling --------------------\n    AbstractScrollableElement.prototype._setListeningToMouseWheel = function (shouldListen) {\n        var _this = this;\n        var isListening = (this._mouseWheelToDispose.length > 0);\n        if (isListening === shouldListen) {\n            // No change\n            return;\n        }\n        // Stop listening (if necessary)\n        this._mouseWheelToDispose = lifecycle_1.dispose(this._mouseWheelToDispose);\n        // Start listening (if necessary)\n        if (shouldListen) {\n            var onMouseWheel = function (browserEvent) {\n                _this._onMouseWheel(new mouseEvent_1.StandardWheelEvent(browserEvent));\n            };\n            this._mouseWheelToDispose.push(dom.addDisposableListener(this._listenOnDomNode, 'mousewheel', onMouseWheel));\n        }\n    };\n    AbstractScrollableElement.prototype._onMouseWheel = function (e) {\n        var _a;\n        var classifier = MouseWheelClassifier.INSTANCE;\n        if (SCROLL_WHEEL_SMOOTH_SCROLL_ENABLED) {\n            classifier.accept(Date.now(), e.deltaX, e.deltaY);\n        }\n        // console.log(`${Date.now()}, ${e.deltaY}, ${e.deltaX}`);\n        if (e.deltaY || e.deltaX) {\n            var deltaY = e.deltaY * this._options.mouseWheelScrollSensitivity;\n            var deltaX = e.deltaX * this._options.mouseWheelScrollSensitivity;\n            if (this._options.flipAxes) {\n                _a = [deltaX, deltaY], deltaY = _a[0], deltaX = _a[1];\n            }\n            // Convert vertical scrolling to horizontal if shift is held, this\n            // is handled at a higher level on Mac\n            var shiftConvert = !browser.isMacintosh && e.browserEvent && e.browserEvent.shiftKey;\n            if ((this._options.scrollYToX || shiftConvert) && !deltaX) {\n                deltaX = deltaY;\n                deltaY = 0;\n            }\n            if (e.browserEvent && e.browserEvent.altKey) {\n                // fastScrolling\n                deltaX = deltaX * this._options.fastScrollSensitivity;\n                deltaY = deltaY * this._options.fastScrollSensitivity;\n            }\n            var futureScrollPosition = this._scrollable.getFutureScrollPosition();\n            var desiredScrollPosition = {};\n            if (deltaY) {\n                var desiredScrollTop = futureScrollPosition.scrollTop - SCROLL_WHEEL_SENSITIVITY * deltaY;\n                this._verticalScrollbar.writeScrollPosition(desiredScrollPosition, desiredScrollTop);\n            }\n            if (deltaX) {\n                var desiredScrollLeft = futureScrollPosition.scrollLeft - SCROLL_WHEEL_SENSITIVITY * deltaX;\n                this._horizontalScrollbar.writeScrollPosition(desiredScrollPosition, desiredScrollLeft);\n            }\n            // Check that we are scrolling towards a location which is valid\n            desiredScrollPosition = this._scrollable.validateScrollPosition(desiredScrollPosition);\n            if (futureScrollPosition.scrollLeft !== desiredScrollPosition.scrollLeft || futureScrollPosition.scrollTop !== desiredScrollPosition.scrollTop) {\n                var canPerformSmoothScroll = (SCROLL_WHEEL_SMOOTH_SCROLL_ENABLED\n                    && this._options.mouseWheelSmoothScroll\n                    && classifier.isPhysicalMouseWheel());\n                if (canPerformSmoothScroll) {\n                    this._scrollable.setScrollPositionSmooth(desiredScrollPosition);\n                }\n                else {\n                    this._scrollable.setScrollPositionNow(desiredScrollPosition);\n                }\n                this._shouldRender = true;\n            }\n        }\n        if (this._options.alwaysConsumeMouseWheel || this._shouldRender) {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n    };\n    AbstractScrollableElement.prototype._onDidScroll = function (e) {\n        this._shouldRender = this._horizontalScrollbar.onDidScroll(e) || this._shouldRender;\n        this._shouldRender = this._verticalScrollbar.onDidScroll(e) || this._shouldRender;\n        if (this._options.useShadows) {\n            this._shouldRender = true;\n        }\n        if (this._revealOnScroll) {\n            this._reveal();\n        }\n        if (!this._options.lazyRender) {\n            this._render();\n        }\n    };\n    /**\n     * Render / mutate the DOM now.\n     * Should be used together with the ctor option `lazyRender`.\n     */\n    AbstractScrollableElement.prototype.renderNow = function () {\n        if (!this._options.lazyRender) {\n            throw new Error('Please use `lazyRender` together with `renderNow`!');\n        }\n        this._render();\n    };\n    AbstractScrollableElement.prototype._render = function () {\n        if (!this._shouldRender) {\n            return;\n        }\n        this._shouldRender = false;\n        this._horizontalScrollbar.render();\n        this._verticalScrollbar.render();\n        if (this._options.useShadows) {\n            var scrollState = this._scrollable.getCurrentScrollPosition();\n            var enableTop = scrollState.scrollTop > 0;\n            var enableLeft = scrollState.scrollLeft > 0;\n            this._leftShadowDomNode.setClassName('shadow' + (enableLeft ? ' left' : ''));\n            this._topShadowDomNode.setClassName('shadow' + (enableTop ? ' top' : ''));\n            this._topLeftShadowDomNode.setClassName('shadow top-left-corner' + (enableTop ? ' top' : '') + (enableLeft ? ' left' : ''));\n        }\n    };\n    // -------------------- fade in / fade out --------------------\n    AbstractScrollableElement.prototype._onDragStart = function () {\n        this._isDragging = true;\n        this._reveal();\n    };\n    AbstractScrollableElement.prototype._onDragEnd = function () {\n        this._isDragging = false;\n        this._hide();\n    };\n    AbstractScrollableElement.prototype._onMouseOut = function (e) {\n        this._mouseIsOver = false;\n        this._hide();\n    };\n    AbstractScrollableElement.prototype._onMouseOver = function (e) {\n        this._mouseIsOver = true;\n        this._reveal();\n    };\n    AbstractScrollableElement.prototype._reveal = function () {\n        this._verticalScrollbar.beginReveal();\n        this._horizontalScrollbar.beginReveal();\n        this._scheduleHide();\n    };\n    AbstractScrollableElement.prototype._hide = function () {\n        if (!this._mouseIsOver && !this._isDragging) {\n            this._verticalScrollbar.beginHide();\n            this._horizontalScrollbar.beginHide();\n        }\n    };\n    AbstractScrollableElement.prototype._scheduleHide = function () {\n        var _this = this;\n        if (!this._mouseIsOver && !this._isDragging) {\n            this._hideTimeout.cancelAndSet(function () { return _this._hide(); }, HIDE_TIMEOUT);\n        }\n    };\n    return AbstractScrollableElement;\n}(widget_1.Widget));\nexports.AbstractScrollableElement = AbstractScrollableElement;\nvar ScrollableElement = /** @class */ (function (_super) {\n    tslib_1.__extends(ScrollableElement, _super);\n    function ScrollableElement(element, options) {\n        var _this = this;\n        options = options || {};\n        options.mouseWheelSmoothScroll = false;\n        var scrollable = new scrollable_1.Scrollable(0, function (callback) { return dom.scheduleAtNextAnimationFrame(callback); });\n        _this = _super.call(this, element, options, scrollable) || this;\n        _this._register(scrollable);\n        return _this;\n    }\n    ScrollableElement.prototype.setScrollPosition = function (update) {\n        this._scrollable.setScrollPositionNow(update);\n    };\n    ScrollableElement.prototype.getScrollPosition = function () {\n        return this._scrollable.getCurrentScrollPosition();\n    };\n    return ScrollableElement;\n}(AbstractScrollableElement));\nexports.ScrollableElement = ScrollableElement;\nvar SmoothScrollableElement = /** @class */ (function (_super) {\n    tslib_1.__extends(SmoothScrollableElement, _super);\n    function SmoothScrollableElement(element, options, scrollable) {\n        return _super.call(this, element, options, scrollable) || this;\n    }\n    return SmoothScrollableElement;\n}(AbstractScrollableElement));\nexports.SmoothScrollableElement = SmoothScrollableElement;\nvar DomScrollableElement = /** @class */ (function (_super) {\n    tslib_1.__extends(DomScrollableElement, _super);\n    function DomScrollableElement(element, options) {\n        var _this = _super.call(this, element, options) || this;\n        _this._element = element;\n        _this.onScroll(function (e) {\n            if (e.scrollTopChanged) {\n                _this._element.scrollTop = e.scrollTop;\n            }\n            if (e.scrollLeftChanged) {\n                _this._element.scrollLeft = e.scrollLeft;\n            }\n        });\n        _this.scanDomNode();\n        return _this;\n    }\n    DomScrollableElement.prototype.scanDomNode = function () {\n        // widh, scrollLeft, scrollWidth, height, scrollTop, scrollHeight\n        this.setScrollDimensions({\n            width: this._element.clientWidth,\n            scrollWidth: this._element.scrollWidth,\n            height: this._element.clientHeight,\n            scrollHeight: this._element.scrollHeight\n        });\n        this.setScrollPosition({\n            scrollLeft: this._element.scrollLeft,\n            scrollTop: this._element.scrollTop,\n        });\n    };\n    return DomScrollableElement;\n}(ScrollableElement));\nexports.DomScrollableElement = DomScrollableElement;\nfunction resolveOptions(opts) {\n    var result = {\n        lazyRender: (typeof opts.lazyRender !== 'undefined' ? opts.lazyRender : false),\n        className: (typeof opts.className !== 'undefined' ? opts.className : ''),\n        useShadows: (typeof opts.useShadows !== 'undefined' ? opts.useShadows : true),\n        handleMouseWheel: (typeof opts.handleMouseWheel !== 'undefined' ? opts.handleMouseWheel : true),\n        flipAxes: (typeof opts.flipAxes !== 'undefined' ? opts.flipAxes : false),\n        alwaysConsumeMouseWheel: (typeof opts.alwaysConsumeMouseWheel !== 'undefined' ? opts.alwaysConsumeMouseWheel : false),\n        scrollYToX: (typeof opts.scrollYToX !== 'undefined' ? opts.scrollYToX : false),\n        mouseWheelScrollSensitivity: (typeof opts.mouseWheelScrollSensitivity !== 'undefined' ? opts.mouseWheelScrollSensitivity : 1),\n        fastScrollSensitivity: (typeof opts.fastScrollSensitivity !== 'undefined' ? opts.fastScrollSensitivity : 5),\n        mouseWheelSmoothScroll: (typeof opts.mouseWheelSmoothScroll !== 'undefined' ? opts.mouseWheelSmoothScroll : true),\n        arrowSize: (typeof opts.arrowSize !== 'undefined' ? opts.arrowSize : 11),\n        listenOnDomNode: (typeof opts.listenOnDomNode !== 'undefined' ? opts.listenOnDomNode : null),\n        horizontal: (typeof opts.horizontal !== 'undefined' ? opts.horizontal : scrollable_1.ScrollbarVisibility.Auto),\n        horizontalScrollbarSize: (typeof opts.horizontalScrollbarSize !== 'undefined' ? opts.horizontalScrollbarSize : 10),\n        horizontalSliderSize: (typeof opts.horizontalSliderSize !== 'undefined' ? opts.horizontalSliderSize : 0),\n        horizontalHasArrows: (typeof opts.horizontalHasArrows !== 'undefined' ? opts.horizontalHasArrows : false),\n        vertical: (typeof opts.vertical !== 'undefined' ? opts.vertical : scrollable_1.ScrollbarVisibility.Auto),\n        verticalScrollbarSize: (typeof opts.verticalScrollbarSize !== 'undefined' ? opts.verticalScrollbarSize : 10),\n        verticalHasArrows: (typeof opts.verticalHasArrows !== 'undefined' ? opts.verticalHasArrows : false),\n        verticalSliderSize: (typeof opts.verticalSliderSize !== 'undefined' ? opts.verticalSliderSize : 0)\n    };\n    result.horizontalSliderSize = (typeof opts.horizontalSliderSize !== 'undefined' ? opts.horizontalSliderSize : result.horizontalScrollbarSize);\n    result.verticalSliderSize = (typeof opts.verticalSliderSize !== 'undefined' ? opts.verticalSliderSize : result.verticalScrollbarSize);\n    // Defaults are different on Macs\n    if (browser.isMacintosh) {\n        result.className += ' mac';\n    }\n    return result;\n}\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/scrollbar/scrollableElement.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/scrollbar/scrollableElement.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./media/scrollbars';\nimport * as dom from 'vs/base/browser/dom';\nimport { FastDomNode, createFastDomNode } from 'vs/base/browser/fastDomNode';\nimport { IMouseEvent, StandardWheelEvent, IMouseWheelEvent } from 'vs/base/browser/mouseEvent';\nimport { ScrollbarHost } from 'vs/base/browser/ui/scrollbar/abstractScrollbar';\nimport { HorizontalScrollbar } from 'vs/base/browser/ui/scrollbar/horizontalScrollbar';\nimport { ScrollableElementChangeOptions, ScrollableElementCreationOptions, ScrollableElementResolvedOptions } from 'vs/base/browser/ui/scrollbar/scrollableElementOptions';\nimport { VerticalScrollbar } from 'vs/base/browser/ui/scrollbar/verticalScrollbar';\nimport { Widget } from 'vs/base/browser/ui/widget';\nimport { TimeoutTimer } from 'vs/base/common/async';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { IDisposable, dispose } from 'vs/base/common/lifecycle';\nimport * as browser from 'vs/base/browser/browser';\nimport { INewScrollDimensions, INewScrollPosition, IScrollDimensions, IScrollPosition, ScrollEvent, Scrollable, ScrollbarVisibility } from 'vs/base/common/scrollable';\n\nconst HIDE_TIMEOUT = 500;\nconst SCROLL_WHEEL_SENSITIVITY = 50;\nconst SCROLL_WHEEL_SMOOTH_SCROLL_ENABLED = true;\n\nexport interface IOverviewRulerLayoutInfo {\n\tparent: HTMLElement;\n\tinsertBefore: HTMLElement;\n}\n\nclass MouseWheelClassifierItem {\n\tpublic timestamp: number;\n\tpublic deltaX: number;\n\tpublic deltaY: number;\n\tpublic score: number;\n\n\tconstructor(timestamp: number, deltaX: number, deltaY: number) {\n\t\tthis.timestamp = timestamp;\n\t\tthis.deltaX = deltaX;\n\t\tthis.deltaY = deltaY;\n\t\tthis.score = 0;\n\t}\n}\n\nexport class MouseWheelClassifier {\n\n\tpublic static readonly INSTANCE = new MouseWheelClassifier();\n\n\tprivate readonly _capacity: number;\n\tprivate _memory: MouseWheelClassifierItem[];\n\tprivate _front: number;\n\tprivate _rear: number;\n\n\tconstructor() {\n\t\tthis._capacity = 5;\n\t\tthis._memory = [];\n\t\tthis._front = -1;\n\t\tthis._rear = -1;\n\t}\n\n\tpublic isPhysicalMouseWheel(): boolean {\n\t\tif (this._front === -1 && this._rear === -1) {\n\t\t\t// no elements\n\t\t\treturn false;\n\t\t}\n\n\t\t// 0.5 * last + 0.25 * before last + 0.125 * before before last + ...\n\t\tlet remainingInfluence = 1;\n\t\tlet score = 0;\n\t\tlet iteration = 1;\n\n\t\tlet index = this._rear;\n\t\tdo {\n\t\t\tconst influence = (index === this._front ? remainingInfluence : Math.pow(2, -iteration));\n\t\t\tremainingInfluence -= influence;\n\t\t\tscore += this._memory[index].score * influence;\n\n\t\t\tif (index === this._front) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tindex = (this._capacity + index - 1) % this._capacity;\n\t\t\titeration++;\n\t\t} while (true);\n\n\t\treturn (score <= 0.5);\n\t}\n\n\tpublic accept(timestamp: number, deltaX: number, deltaY: number): void {\n\t\tconst item = new MouseWheelClassifierItem(timestamp, deltaX, deltaY);\n\t\titem.score = this._computeScore(item);\n\n\t\tif (this._front === -1 && this._rear === -1) {\n\t\t\tthis._memory[0] = item;\n\t\t\tthis._front = 0;\n\t\t\tthis._rear = 0;\n\t\t} else {\n\t\t\tthis._rear = (this._rear + 1) % this._capacity;\n\t\t\tif (this._rear === this._front) {\n\t\t\t\t// Drop oldest\n\t\t\t\tthis._front = (this._front + 1) % this._capacity;\n\t\t\t}\n\t\t\tthis._memory[this._rear] = item;\n\t\t}\n\t}\n\n\t/**\n\t * A score between 0 and 1 for `item`.\n\t *  - a score towards 0 indicates that the source appears to be a physical mouse wheel\n\t *  - a score towards 1 indicates that the source appears to be a touchpad or magic mouse, etc.\n\t */\n\tprivate _computeScore(item: MouseWheelClassifierItem): number {\n\n\t\tif (Math.abs(item.deltaX) > 0 && Math.abs(item.deltaY) > 0) {\n\t\t\t// both axes exercised => definitely not a physical mouse wheel\n\t\t\treturn 1;\n\t\t}\n\n\t\tlet score: number = 0.5;\n\t\tconst prev = (this._front === -1 && this._rear === -1 ? null : this._memory[this._rear]);\n\t\tif (prev) {\n\t\t\t// const deltaT = item.timestamp - prev.timestamp;\n\t\t\t// if (deltaT < 1000 / 30) {\n\t\t\t// \t// sooner than X times per second => indicator that this is not a physical mouse wheel\n\t\t\t// \tscore += 0.25;\n\t\t\t// }\n\n\t\t\t// if (item.deltaX === prev.deltaX && item.deltaY === prev.deltaY) {\n\t\t\t// \t// equal amplitude => indicator that this is a physical mouse wheel\n\t\t\t// \tscore -= 0.25;\n\t\t\t// }\n\t\t}\n\n\t\tif (Math.abs(item.deltaX - Math.round(item.deltaX)) > 0 || Math.abs(item.deltaY - Math.round(item.deltaY)) > 0) {\n\t\t\t// non-integer deltas => indicator that this is not a physical mouse wheel\n\t\t\tscore += 0.25;\n\t\t}\n\n\t\treturn Math.min(Math.max(score, 0), 1);\n\t}\n}\n\nexport abstract class AbstractScrollableElement extends Widget {\n\n\tprivate readonly _options: ScrollableElementResolvedOptions;\n\tprotected readonly _scrollable: Scrollable;\n\tprivate readonly _verticalScrollbar: VerticalScrollbar;\n\tprivate readonly _horizontalScrollbar: HorizontalScrollbar;\n\tprivate readonly _domNode: HTMLElement;\n\n\tprivate readonly _leftShadowDomNode: FastDomNode<HTMLElement>;\n\tprivate readonly _topShadowDomNode: FastDomNode<HTMLElement>;\n\tprivate readonly _topLeftShadowDomNode: FastDomNode<HTMLElement>;\n\n\tprivate readonly _listenOnDomNode: HTMLElement;\n\n\tprivate _mouseWheelToDispose: IDisposable[];\n\n\tprivate _isDragging: boolean;\n\tprivate _mouseIsOver: boolean;\n\n\tprivate readonly _hideTimeout: TimeoutTimer;\n\tprivate _shouldRender: boolean;\n\n\tprivate _revealOnScroll: boolean;\n\n\tprivate readonly _onScroll = this._register(new Emitter<ScrollEvent>());\n\tpublic readonly onScroll: Event<ScrollEvent> = this._onScroll.event;\n\n\tprotected constructor(element: HTMLElement, options: ScrollableElementCreationOptions, scrollable: Scrollable) {\n\t\tsuper();\n\t\telement.style.overflow = 'hidden';\n\t\tthis._options = resolveOptions(options);\n\t\tthis._scrollable = scrollable;\n\n\t\tthis._register(this._scrollable.onScroll((e) => {\n\t\t\tthis._onDidScroll(e);\n\t\t\tthis._onScroll.fire(e);\n\t\t}));\n\n\t\tlet scrollbarHost: ScrollbarHost = {\n\t\t\tonMouseWheel: (mouseWheelEvent: StandardWheelEvent) => this._onMouseWheel(mouseWheelEvent),\n\t\t\tonDragStart: () => this._onDragStart(),\n\t\t\tonDragEnd: () => this._onDragEnd(),\n\t\t};\n\t\tthis._verticalScrollbar = this._register(new VerticalScrollbar(this._scrollable, this._options, scrollbarHost));\n\t\tthis._horizontalScrollbar = this._register(new HorizontalScrollbar(this._scrollable, this._options, scrollbarHost));\n\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.className = 'monaco-scrollable-element ' + this._options.className;\n\t\tthis._domNode.setAttribute('role', 'presentation');\n\t\tthis._domNode.style.position = 'relative';\n\t\tthis._domNode.style.overflow = 'hidden';\n\t\tthis._domNode.appendChild(element);\n\t\tthis._domNode.appendChild(this._horizontalScrollbar.domNode.domNode);\n\t\tthis._domNode.appendChild(this._verticalScrollbar.domNode.domNode);\n\n\t\tif (this._options.useShadows) {\n\t\t\tthis._leftShadowDomNode = createFastDomNode(document.createElement('div'));\n\t\t\tthis._leftShadowDomNode.setClassName('shadow');\n\t\t\tthis._domNode.appendChild(this._leftShadowDomNode.domNode);\n\n\t\t\tthis._topShadowDomNode = createFastDomNode(document.createElement('div'));\n\t\t\tthis._topShadowDomNode.setClassName('shadow');\n\t\t\tthis._domNode.appendChild(this._topShadowDomNode.domNode);\n\n\t\t\tthis._topLeftShadowDomNode = createFastDomNode(document.createElement('div'));\n\t\t\tthis._topLeftShadowDomNode.setClassName('shadow top-left-corner');\n\t\t\tthis._domNode.appendChild(this._topLeftShadowDomNode.domNode);\n\t\t}\n\n\t\tthis._listenOnDomNode = this._options.listenOnDomNode || this._domNode;\n\n\t\tthis._mouseWheelToDispose = [];\n\t\tthis._setListeningToMouseWheel(this._options.handleMouseWheel);\n\n\t\tthis.onmouseover(this._listenOnDomNode, (e) => this._onMouseOver(e));\n\t\tthis.onnonbubblingmouseout(this._listenOnDomNode, (e) => this._onMouseOut(e));\n\n\t\tthis._hideTimeout = this._register(new TimeoutTimer());\n\t\tthis._isDragging = false;\n\t\tthis._mouseIsOver = false;\n\n\t\tthis._shouldRender = true;\n\n\t\tthis._revealOnScroll = true;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._mouseWheelToDispose = dispose(this._mouseWheelToDispose);\n\t\tsuper.dispose();\n\t}\n\n\t/**\n\t * Get the generated 'scrollable' dom node\n\t */\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tpublic getOverviewRulerLayoutInfo(): IOverviewRulerLayoutInfo {\n\t\treturn {\n\t\t\tparent: this._domNode,\n\t\t\tinsertBefore: this._verticalScrollbar.domNode.domNode,\n\t\t};\n\t}\n\n\t/**\n\t * Delegate a mouse down event to the vertical scrollbar.\n\t * This is to help with clicking somewhere else and having the scrollbar react.\n\t */\n\tpublic delegateVerticalScrollbarMouseDown(browserEvent: IMouseEvent): void {\n\t\tthis._verticalScrollbar.delegateMouseDown(browserEvent);\n\t}\n\n\tpublic getScrollDimensions(): IScrollDimensions {\n\t\treturn this._scrollable.getScrollDimensions();\n\t}\n\n\tpublic setScrollDimensions(dimensions: INewScrollDimensions): void {\n\t\tthis._scrollable.setScrollDimensions(dimensions);\n\t}\n\n\t/**\n\t * Update the class name of the scrollable element.\n\t */\n\tpublic updateClassName(newClassName: string): void {\n\t\tthis._options.className = newClassName;\n\t\t// Defaults are different on Macs\n\t\tif (browser.isMacintosh) {\n\t\t\tthis._options.className += ' mac';\n\t\t}\n\t\tthis._domNode.className = 'monaco-scrollable-element ' + this._options.className;\n\t}\n\n\t/**\n\t * Update configuration options for the scrollbar.\n\t * Really this is Editor.IEditorScrollbarOptions, but base shouldn't\n\t * depend on Editor.\n\t */\n\tpublic updateOptions(newOptions: ScrollableElementChangeOptions): void {\n\t\tlet massagedOptions = resolveOptions(newOptions);\n\t\tthis._options.handleMouseWheel = massagedOptions.handleMouseWheel;\n\t\tthis._options.mouseWheelScrollSensitivity = massagedOptions.mouseWheelScrollSensitivity;\n\t\tthis._options.fastScrollSensitivity = massagedOptions.fastScrollSensitivity;\n\t\tthis._setListeningToMouseWheel(this._options.handleMouseWheel);\n\n\t\tif (!this._options.lazyRender) {\n\t\t\tthis._render();\n\t\t}\n\t}\n\n\tpublic setRevealOnScroll(value: boolean) {\n\t\tthis._revealOnScroll = value;\n\t}\n\n\t// -------------------- mouse wheel scrolling --------------------\n\n\tprivate _setListeningToMouseWheel(shouldListen: boolean): void {\n\t\tlet isListening = (this._mouseWheelToDispose.length > 0);\n\n\t\tif (isListening === shouldListen) {\n\t\t\t// No change\n\t\t\treturn;\n\t\t}\n\n\t\t// Stop listening (if necessary)\n\t\tthis._mouseWheelToDispose = dispose(this._mouseWheelToDispose);\n\n\t\t// Start listening (if necessary)\n\t\tif (shouldListen) {\n\t\t\tlet onMouseWheel = (browserEvent: IMouseWheelEvent) => {\n\t\t\t\tthis._onMouseWheel(new StandardWheelEvent(browserEvent));\n\t\t\t};\n\n\t\t\tthis._mouseWheelToDispose.push(dom.addDisposableListener(this._listenOnDomNode, 'mousewheel', onMouseWheel));\n\t\t}\n\t}\n\n\tprivate _onMouseWheel(e: StandardWheelEvent): void {\n\n\t\tconst classifier = MouseWheelClassifier.INSTANCE;\n\t\tif (SCROLL_WHEEL_SMOOTH_SCROLL_ENABLED) {\n\t\t\tclassifier.accept(Date.now(), e.deltaX, e.deltaY);\n\t\t}\n\n\t\t// console.log(`${Date.now()}, ${e.deltaY}, ${e.deltaX}`);\n\n\t\tif (e.deltaY || e.deltaX) {\n\t\t\tlet deltaY = e.deltaY * this._options.mouseWheelScrollSensitivity;\n\t\t\tlet deltaX = e.deltaX * this._options.mouseWheelScrollSensitivity;\n\n\t\t\tif (this._options.flipAxes) {\n\t\t\t\t[deltaY, deltaX] = [deltaX, deltaY];\n\t\t\t}\n\n\t\t\t// Convert vertical scrolling to horizontal if shift is held, this\n\t\t\t// is handled at a higher level on Mac\n\t\t\tconst shiftConvert = !browser.isMacintosh && e.browserEvent && e.browserEvent.shiftKey;\n\t\t\tif ((this._options.scrollYToX || shiftConvert) && !deltaX) {\n\t\t\t\tdeltaX = deltaY;\n\t\t\t\tdeltaY = 0;\n\t\t\t}\n\n\t\t\tif (e.browserEvent && e.browserEvent.altKey) {\n\t\t\t\t// fastScrolling\n\t\t\t\tdeltaX = deltaX * this._options.fastScrollSensitivity;\n\t\t\t\tdeltaY = deltaY * this._options.fastScrollSensitivity;\n\t\t\t}\n\n\t\t\tconst futureScrollPosition = this._scrollable.getFutureScrollPosition();\n\n\t\t\tlet desiredScrollPosition: INewScrollPosition = {};\n\t\t\tif (deltaY) {\n\t\t\t\tconst desiredScrollTop = futureScrollPosition.scrollTop - SCROLL_WHEEL_SENSITIVITY * deltaY;\n\t\t\t\tthis._verticalScrollbar.writeScrollPosition(desiredScrollPosition, desiredScrollTop);\n\t\t\t}\n\t\t\tif (deltaX) {\n\t\t\t\tconst desiredScrollLeft = futureScrollPosition.scrollLeft - SCROLL_WHEEL_SENSITIVITY * deltaX;\n\t\t\t\tthis._horizontalScrollbar.writeScrollPosition(desiredScrollPosition, desiredScrollLeft);\n\t\t\t}\n\n\t\t\t// Check that we are scrolling towards a location which is valid\n\t\t\tdesiredScrollPosition = this._scrollable.validateScrollPosition(desiredScrollPosition);\n\n\t\t\tif (futureScrollPosition.scrollLeft !== desiredScrollPosition.scrollLeft || futureScrollPosition.scrollTop !== desiredScrollPosition.scrollTop) {\n\n\t\t\t\tconst canPerformSmoothScroll = (\n\t\t\t\t\tSCROLL_WHEEL_SMOOTH_SCROLL_ENABLED\n\t\t\t\t\t&& this._options.mouseWheelSmoothScroll\n\t\t\t\t\t&& classifier.isPhysicalMouseWheel()\n\t\t\t\t);\n\n\t\t\t\tif (canPerformSmoothScroll) {\n\t\t\t\t\tthis._scrollable.setScrollPositionSmooth(desiredScrollPosition);\n\t\t\t\t} else {\n\t\t\t\t\tthis._scrollable.setScrollPositionNow(desiredScrollPosition);\n\t\t\t\t}\n\t\t\t\tthis._shouldRender = true;\n\t\t\t}\n\t\t}\n\n\t\tif (this._options.alwaysConsumeMouseWheel || this._shouldRender) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t}\n\t}\n\n\tprivate _onDidScroll(e: ScrollEvent): void {\n\t\tthis._shouldRender = this._horizontalScrollbar.onDidScroll(e) || this._shouldRender;\n\t\tthis._shouldRender = this._verticalScrollbar.onDidScroll(e) || this._shouldRender;\n\n\t\tif (this._options.useShadows) {\n\t\t\tthis._shouldRender = true;\n\t\t}\n\n\t\tif (this._revealOnScroll) {\n\t\t\tthis._reveal();\n\t\t}\n\n\t\tif (!this._options.lazyRender) {\n\t\t\tthis._render();\n\t\t}\n\t}\n\n\t/**\n\t * Render / mutate the DOM now.\n\t * Should be used together with the ctor option `lazyRender`.\n\t */\n\tpublic renderNow(): void {\n\t\tif (!this._options.lazyRender) {\n\t\t\tthrow new Error('Please use `lazyRender` together with `renderNow`!');\n\t\t}\n\n\t\tthis._render();\n\t}\n\n\tprivate _render(): void {\n\t\tif (!this._shouldRender) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._shouldRender = false;\n\n\t\tthis._horizontalScrollbar.render();\n\t\tthis._verticalScrollbar.render();\n\n\t\tif (this._options.useShadows) {\n\t\t\tconst scrollState = this._scrollable.getCurrentScrollPosition();\n\t\t\tlet enableTop = scrollState.scrollTop > 0;\n\t\t\tlet enableLeft = scrollState.scrollLeft > 0;\n\n\t\t\tthis._leftShadowDomNode.setClassName('shadow' + (enableLeft ? ' left' : ''));\n\t\t\tthis._topShadowDomNode.setClassName('shadow' + (enableTop ? ' top' : ''));\n\t\t\tthis._topLeftShadowDomNode.setClassName('shadow top-left-corner' + (enableTop ? ' top' : '') + (enableLeft ? ' left' : ''));\n\t\t}\n\t}\n\n\t// -------------------- fade in / fade out --------------------\n\n\tprivate _onDragStart(): void {\n\t\tthis._isDragging = true;\n\t\tthis._reveal();\n\t}\n\n\tprivate _onDragEnd(): void {\n\t\tthis._isDragging = false;\n\t\tthis._hide();\n\t}\n\n\tprivate _onMouseOut(e: IMouseEvent): void {\n\t\tthis._mouseIsOver = false;\n\t\tthis._hide();\n\t}\n\n\tprivate _onMouseOver(e: IMouseEvent): void {\n\t\tthis._mouseIsOver = true;\n\t\tthis._reveal();\n\t}\n\n\tprivate _reveal(): void {\n\t\tthis._verticalScrollbar.beginReveal();\n\t\tthis._horizontalScrollbar.beginReveal();\n\t\tthis._scheduleHide();\n\t}\n\n\tprivate _hide(): void {\n\t\tif (!this._mouseIsOver && !this._isDragging) {\n\t\t\tthis._verticalScrollbar.beginHide();\n\t\t\tthis._horizontalScrollbar.beginHide();\n\t\t}\n\t}\n\n\tprivate _scheduleHide(): void {\n\t\tif (!this._mouseIsOver && !this._isDragging) {\n\t\t\tthis._hideTimeout.cancelAndSet(() => this._hide(), HIDE_TIMEOUT);\n\t\t}\n\t}\n}\n\nexport class ScrollableElement extends AbstractScrollableElement {\n\n\tconstructor(element: HTMLElement, options: ScrollableElementCreationOptions) {\n\t\toptions = options || {};\n\t\toptions.mouseWheelSmoothScroll = false;\n\t\tconst scrollable = new Scrollable(0, (callback) => dom.scheduleAtNextAnimationFrame(callback));\n\t\tsuper(element, options, scrollable);\n\t\tthis._register(scrollable);\n\t}\n\n\tpublic setScrollPosition(update: INewScrollPosition): void {\n\t\tthis._scrollable.setScrollPositionNow(update);\n\t}\n\n\tpublic getScrollPosition(): IScrollPosition {\n\t\treturn this._scrollable.getCurrentScrollPosition();\n\t}\n}\n\nexport class SmoothScrollableElement extends AbstractScrollableElement {\n\n\tconstructor(element: HTMLElement, options: ScrollableElementCreationOptions, scrollable: Scrollable) {\n\t\tsuper(element, options, scrollable);\n\t}\n\n}\n\nexport class DomScrollableElement extends ScrollableElement {\n\n\tprivate _element: HTMLElement;\n\n\tconstructor(element: HTMLElement, options: ScrollableElementCreationOptions) {\n\t\tsuper(element, options);\n\t\tthis._element = element;\n\t\tthis.onScroll((e) => {\n\t\t\tif (e.scrollTopChanged) {\n\t\t\t\tthis._element.scrollTop = e.scrollTop;\n\t\t\t}\n\t\t\tif (e.scrollLeftChanged) {\n\t\t\t\tthis._element.scrollLeft = e.scrollLeft;\n\t\t\t}\n\t\t});\n\t\tthis.scanDomNode();\n\t}\n\n\tpublic scanDomNode(): void {\n\t\t// widh, scrollLeft, scrollWidth, height, scrollTop, scrollHeight\n\t\tthis.setScrollDimensions({\n\t\t\twidth: this._element.clientWidth,\n\t\t\tscrollWidth: this._element.scrollWidth,\n\t\t\theight: this._element.clientHeight,\n\t\t\tscrollHeight: this._element.scrollHeight\n\t\t});\n\t\tthis.setScrollPosition({\n\t\t\tscrollLeft: this._element.scrollLeft,\n\t\t\tscrollTop: this._element.scrollTop,\n\t\t});\n\t}\n}\n\nfunction resolveOptions(opts: ScrollableElementCreationOptions): ScrollableElementResolvedOptions {\n\tlet result: ScrollableElementResolvedOptions = {\n\t\tlazyRender: (typeof opts.lazyRender !== 'undefined' ? opts.lazyRender : false),\n\t\tclassName: (typeof opts.className !== 'undefined' ? opts.className : ''),\n\t\tuseShadows: (typeof opts.useShadows !== 'undefined' ? opts.useShadows : true),\n\t\thandleMouseWheel: (typeof opts.handleMouseWheel !== 'undefined' ? opts.handleMouseWheel : true),\n\t\tflipAxes: (typeof opts.flipAxes !== 'undefined' ? opts.flipAxes : false),\n\t\talwaysConsumeMouseWheel: (typeof opts.alwaysConsumeMouseWheel !== 'undefined' ? opts.alwaysConsumeMouseWheel : false),\n\t\tscrollYToX: (typeof opts.scrollYToX !== 'undefined' ? opts.scrollYToX : false),\n\t\tmouseWheelScrollSensitivity: (typeof opts.mouseWheelScrollSensitivity !== 'undefined' ? opts.mouseWheelScrollSensitivity : 1),\n\t\tfastScrollSensitivity: (typeof opts.fastScrollSensitivity !== 'undefined' ? opts.fastScrollSensitivity : 5),\n\t\tmouseWheelSmoothScroll: (typeof opts.mouseWheelSmoothScroll !== 'undefined' ? opts.mouseWheelSmoothScroll : true),\n\t\tarrowSize: (typeof opts.arrowSize !== 'undefined' ? opts.arrowSize : 11),\n\n\t\tlistenOnDomNode: (typeof opts.listenOnDomNode !== 'undefined' ? opts.listenOnDomNode : null),\n\n\t\thorizontal: (typeof opts.horizontal !== 'undefined' ? opts.horizontal : ScrollbarVisibility.Auto),\n\t\thorizontalScrollbarSize: (typeof opts.horizontalScrollbarSize !== 'undefined' ? opts.horizontalScrollbarSize : 10),\n\t\thorizontalSliderSize: (typeof opts.horizontalSliderSize !== 'undefined' ? opts.horizontalSliderSize : 0),\n\t\thorizontalHasArrows: (typeof opts.horizontalHasArrows !== 'undefined' ? opts.horizontalHasArrows : false),\n\n\t\tvertical: (typeof opts.vertical !== 'undefined' ? opts.vertical : ScrollbarVisibility.Auto),\n\t\tverticalScrollbarSize: (typeof opts.verticalScrollbarSize !== 'undefined' ? opts.verticalScrollbarSize : 10),\n\t\tverticalHasArrows: (typeof opts.verticalHasArrows !== 'undefined' ? opts.verticalHasArrows : false),\n\t\tverticalSliderSize: (typeof opts.verticalSliderSize !== 'undefined' ? opts.verticalSliderSize : 0)\n\t};\n\n\tresult.horizontalSliderSize = (typeof opts.horizontalSliderSize !== 'undefined' ? opts.horizontalSliderSize : result.horizontalScrollbarSize);\n\tresult.verticalSliderSize = (typeof opts.verticalSliderSize !== 'undefined' ? opts.verticalSliderSize : result.verticalScrollbarSize);\n\n\t// Defaults are different on Macs\n\tif (browser.isMacintosh) {\n\t\tresult.className += ' mac';\n\t}\n\n\treturn result;\n}\n"]}]}