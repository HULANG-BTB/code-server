{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/comments/browser/commentNode.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/comments/browser/commentNode.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar nls = require(\"vs/nls\");\nvar dom = require(\"vs/base/browser/dom\");\nvar actionbar_1 = require(\"vs/base/browser/ui/actionbar/actionbar\");\nvar button_1 = require(\"vs/base/browser/ui/button/button\");\nvar actions_1 = require(\"vs/base/common/actions\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar uri_1 = require(\"vs/base/common/uri\");\nvar modelService_1 = require(\"vs/editor/common/services/modelService\");\nvar modeService_1 = require(\"vs/editor/common/services/modeService\");\nvar instantiation_1 = require(\"vs/platform/instantiation/common/instantiation\");\nvar colorRegistry_1 = require(\"vs/platform/theme/common/colorRegistry\");\nvar styler_1 = require(\"vs/platform/theme/common/styler\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar commentService_1 = require(\"vs/workbench/contrib/comments/browser/commentService\");\nvar simpleCommentEditor_1 = require(\"vs/workbench/contrib/comments/browser/simpleCommentEditor\");\nvar selection_1 = require(\"vs/editor/common/core/selection\");\nvar dialogs_1 = require(\"vs/platform/dialogs/common/dialogs\");\nvar event_1 = require(\"vs/base/common/event\");\nvar notification_1 = require(\"vs/platform/notification/common/notification\");\nvar objects_1 = require(\"vs/base/common/objects\");\nvar htmlContent_1 = require(\"vs/base/common/htmlContent\");\nvar toolbar_1 = require(\"vs/base/browser/ui/toolbar/toolbar\");\nvar contextView_1 = require(\"vs/platform/contextview/browser/contextView\");\nvar dropdown_1 = require(\"vs/base/browser/ui/dropdown/dropdown\");\nvar contextview_1 = require(\"vs/base/browser/ui/contextview/contextview\");\nvar reactionsAction_1 = require(\"./reactionsAction\");\nvar commands_1 = require(\"vs/platform/commands/common/commands\");\nvar UPDATE_COMMENT_LABEL = nls.localize('label.updateComment', \"Update comment\");\nvar UPDATE_IN_PROGRESS_LABEL = nls.localize('label.updatingComment', \"Updating comment...\");\nvar CommentNode = /** @class */ (function (_super) {\n    tslib_1.__extends(CommentNode, _super);\n    function CommentNode(commentThread, comment, owner, resource, parentEditor, parentThread, markdownRenderer, themeService, instantiationService, commentService, commandService, modelService, modeService, dialogService, notificationService, contextMenuService) {\n        var _this = _super.call(this) || this;\n        _this.commentThread = commentThread;\n        _this.comment = comment;\n        _this.owner = owner;\n        _this.resource = resource;\n        _this.parentEditor = parentEditor;\n        _this.parentThread = parentThread;\n        _this.markdownRenderer = markdownRenderer;\n        _this.themeService = themeService;\n        _this.instantiationService = instantiationService;\n        _this.commentService = commentService;\n        _this.commandService = commandService;\n        _this.modelService = modelService;\n        _this.modeService = modeService;\n        _this.dialogService = dialogService;\n        _this.notificationService = notificationService;\n        _this.contextMenuService = contextMenuService;\n        _this._commentEditorDisposables = [];\n        _this._onDidDelete = new event_1.Emitter();\n        _this._domNode = dom.$('div.review-comment');\n        _this._domNode.tabIndex = 0;\n        var avatar = dom.append(_this._domNode, dom.$('div.avatar-container'));\n        if (comment.userIconPath) {\n            var img_1 = dom.append(avatar, dom.$('img.avatar'));\n            img_1.src = comment.userIconPath.toString();\n            img_1.onerror = function (_) { return img_1.remove(); };\n        }\n        _this._commentDetailsContainer = dom.append(_this._domNode, dom.$('.review-comment-contents'));\n        _this.createHeader(_this._commentDetailsContainer);\n        _this._body = dom.append(_this._commentDetailsContainer, dom.$('div.comment-body'));\n        _this._md = _this.markdownRenderer.render(comment.body).element;\n        _this._body.appendChild(_this._md);\n        if (_this.comment.commentReactions && _this.comment.commentReactions.length) {\n            _this.createReactionsContainer(_this._commentDetailsContainer);\n        }\n        _this._domNode.setAttribute('aria-label', comment.userName + \", \" + comment.body.value);\n        _this._domNode.setAttribute('role', 'treeitem');\n        _this._clearTimeout = null;\n        return _this;\n    }\n    Object.defineProperty(CommentNode.prototype, \"domNode\", {\n        get: function () {\n            return this._domNode;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CommentNode.prototype, \"onDidDelete\", {\n        get: function () {\n            return this._onDidDelete.event;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CommentNode.prototype.createHeader = function (commentDetailsContainer) {\n        var header = dom.append(commentDetailsContainer, dom.$('div.comment-title'));\n        var author = dom.append(header, dom.$('strong.author'));\n        author.innerText = this.comment.userName;\n        this._isPendingLabel = dom.append(header, dom.$('span.isPending'));\n        if (this.comment.label) {\n            this._isPendingLabel.innerText = this.comment.label;\n        }\n        else if (this.comment.isDraft) {\n            this._isPendingLabel.innerText = 'Pending';\n        }\n        else {\n            this._isPendingLabel.innerText = '';\n        }\n        this._actionsToolbarContainer = dom.append(header, dom.$('.comment-actions.hidden'));\n        this.createActionsToolbar();\n    };\n    CommentNode.prototype.createActionsToolbar = function () {\n        var _this = this;\n        var actions = [];\n        var reactionGroup = this.commentService.getReactionGroup(this.owner);\n        if (reactionGroup && reactionGroup.length) {\n            var commentThread = this.commentThread;\n            if (commentThread.commentThreadHandle !== undefined) {\n                var toggleReactionAction = this.createReactionPicker2();\n                actions.push(toggleReactionAction);\n            }\n            else {\n                var toggleReactionAction = this.createReactionPicker();\n                actions.push(toggleReactionAction);\n            }\n        }\n        if (this.comment.canEdit || this.comment.editCommand) {\n            this._editAction = this.createEditAction(this._commentDetailsContainer);\n            actions.push(this._editAction);\n        }\n        if (this.comment.canDelete || this.comment.deleteCommand) {\n            this._deleteAction = this.createDeleteAction();\n            actions.push(this._deleteAction);\n        }\n        if (actions.length) {\n            this.toolbar = new toolbar_1.ToolBar(this._actionsToolbarContainer, this.contextMenuService, {\n                actionItemProvider: function (action) {\n                    if (action.id === reactionsAction_1.ToggleReactionsAction.ID) {\n                        return new dropdown_1.DropdownMenuActionItem(action, action.menuActions, _this.contextMenuService, function (action) {\n                            return _this.actionItemProvider(action);\n                        }, _this.actionRunner, undefined, 'toolbar-toggle-pickReactions', function () { return contextview_1.AnchorAlignment.RIGHT; });\n                    }\n                    return _this.actionItemProvider(action);\n                },\n                orientation: actionbar_1.ActionsOrientation.HORIZONTAL\n            });\n            this.registerActionBarListeners(this._actionsToolbarContainer);\n            this.toolbar.setActions(actions, [])();\n            this._toDispose.push(this.toolbar);\n        }\n    };\n    CommentNode.prototype.actionItemProvider = function (action) {\n        var options = {};\n        if (action.id === 'comment.delete' || action.id === 'comment.edit' || action.id === reactionsAction_1.ToggleReactionsAction.ID) {\n            options = { label: false, icon: true };\n        }\n        else {\n            options = { label: true, icon: true };\n        }\n        if (action.id === reactionsAction_1.ReactionAction.ID) {\n            var item = new reactionsAction_1.ReactionActionItem(action);\n            return item;\n        }\n        else {\n            var item = new actionbar_1.ActionItem({}, action, options);\n            return item;\n        }\n    };\n    CommentNode.prototype.createReactionPicker2 = function () {\n        var _this = this;\n        var toggleReactionActionItem;\n        var toggleReactionAction = this._register(new reactionsAction_1.ToggleReactionsAction(function () {\n            if (toggleReactionActionItem) {\n                toggleReactionActionItem.show();\n            }\n        }, nls.localize('commentToggleReaction', \"Toggle Reaction\")));\n        var reactionMenuActions = [];\n        var reactionGroup = this.commentService.getReactionGroup(this.owner);\n        if (reactionGroup && reactionGroup.length) {\n            reactionMenuActions = reactionGroup.map(function (reaction) {\n                return new actions_1.Action(\"reaction.command.\" + reaction.label, \"\" + reaction.label, '', true, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                    var e_1, error;\n                    return tslib_1.__generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                _a.trys.push([0, 2, , 3]);\n                                return [4 /*yield*/, this.commentService.toggleReaction(this.owner, this.resource, this.commentThread, this.comment, reaction)];\n                            case 1:\n                                _a.sent();\n                                return [3 /*break*/, 3];\n                            case 2:\n                                e_1 = _a.sent();\n                                error = e_1.message\n                                    ? nls.localize('commentToggleReactionError', \"Toggling the comment reaction failed: {0}.\", e_1.message)\n                                    : nls.localize('commentToggleReactionDefaultError', \"Toggling the comment reaction failed\");\n                                this.notificationService.error(error);\n                                return [3 /*break*/, 3];\n                            case 3: return [2 /*return*/];\n                        }\n                    });\n                }); });\n            });\n        }\n        toggleReactionAction.menuActions = reactionMenuActions;\n        toggleReactionActionItem = new dropdown_1.DropdownMenuActionItem(toggleReactionAction, toggleReactionAction.menuActions, this.contextMenuService, function (action) {\n            if (action.id === reactionsAction_1.ToggleReactionsAction.ID) {\n                return toggleReactionActionItem;\n            }\n            return _this.actionItemProvider(action);\n        }, this.actionRunner, undefined, 'toolbar-toggle-pickReactions', function () { return contextview_1.AnchorAlignment.RIGHT; });\n        return toggleReactionAction;\n    };\n    CommentNode.prototype.createReactionPicker = function () {\n        var _this = this;\n        var toggleReactionActionItem;\n        var toggleReactionAction = this._register(new reactionsAction_1.ToggleReactionsAction(function () {\n            if (toggleReactionActionItem) {\n                toggleReactionActionItem.show();\n            }\n        }, nls.localize('commentAddReaction', \"Add Reaction\")));\n        var reactionMenuActions = [];\n        var reactionGroup = this.commentService.getReactionGroup(this.owner);\n        if (reactionGroup && reactionGroup.length) {\n            reactionMenuActions = reactionGroup.map(function (reaction) {\n                return new actions_1.Action(\"reaction.command.\" + reaction.label, \"\" + reaction.label, '', true, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                    var e_2, error;\n                    return tslib_1.__generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                _a.trys.push([0, 2, , 3]);\n                                return [4 /*yield*/, this.commentService.addReaction(this.owner, this.resource, this.comment, reaction)];\n                            case 1:\n                                _a.sent();\n                                return [3 /*break*/, 3];\n                            case 2:\n                                e_2 = _a.sent();\n                                error = e_2.message\n                                    ? nls.localize('commentAddReactionError', \"Deleting the comment reaction failed: {0}.\", e_2.message)\n                                    : nls.localize('commentAddReactionDefaultError', \"Deleting the comment reaction failed\");\n                                this.notificationService.error(error);\n                                return [3 /*break*/, 3];\n                            case 3: return [2 /*return*/];\n                        }\n                    });\n                }); });\n            });\n        }\n        toggleReactionAction.menuActions = reactionMenuActions;\n        toggleReactionActionItem = new dropdown_1.DropdownMenuActionItem(toggleReactionAction, toggleReactionAction.menuActions, this.contextMenuService, function (action) {\n            if (action.id === reactionsAction_1.ToggleReactionsAction.ID) {\n                return toggleReactionActionItem;\n            }\n            return _this.actionItemProvider(action);\n        }, this.actionRunner, undefined, 'toolbar-toggle-pickReactions', function () { return contextview_1.AnchorAlignment.RIGHT; });\n        return toggleReactionAction;\n    };\n    CommentNode.prototype.createReactionsContainer = function (commentDetailsContainer) {\n        var _this = this;\n        this._reactionActionsContainer = dom.append(commentDetailsContainer, dom.$('div.comment-reactions'));\n        this._reactionsActionBar = new actionbar_1.ActionBar(this._reactionActionsContainer, {\n            actionItemProvider: function (action) {\n                if (action.id === reactionsAction_1.ToggleReactionsAction.ID) {\n                    return new dropdown_1.DropdownMenuActionItem(action, action.menuActions, _this.contextMenuService, function (action) {\n                        return _this.actionItemProvider(action);\n                    }, _this.actionRunner, undefined, 'toolbar-toggle-pickReactions', function () { return contextview_1.AnchorAlignment.RIGHT; });\n                }\n                return _this.actionItemProvider(action);\n            }\n        });\n        this._toDispose.push(this._reactionsActionBar);\n        this.comment.commentReactions.map(function (reaction) {\n            var action = new reactionsAction_1.ReactionAction(\"reaction.\" + reaction.label, \"\" + reaction.label, reaction.hasReacted && reaction.canEdit ? 'active' : '', reaction.canEdit, function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var commentThread, e_3, error;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            _a.trys.push([0, 7, , 8]);\n                            commentThread = this.commentThread;\n                            if (!(commentThread.commentThreadHandle !== undefined)) return [3 /*break*/, 2];\n                            return [4 /*yield*/, this.commentService.toggleReaction(this.owner, this.resource, this.commentThread, this.comment, reaction)];\n                        case 1:\n                            _a.sent();\n                            return [3 /*break*/, 6];\n                        case 2:\n                            if (!reaction.hasReacted) return [3 /*break*/, 4];\n                            return [4 /*yield*/, this.commentService.deleteReaction(this.owner, this.resource, this.comment, reaction)];\n                        case 3:\n                            _a.sent();\n                            return [3 /*break*/, 6];\n                        case 4: return [4 /*yield*/, this.commentService.addReaction(this.owner, this.resource, this.comment, reaction)];\n                        case 5:\n                            _a.sent();\n                            _a.label = 6;\n                        case 6: return [3 /*break*/, 8];\n                        case 7:\n                            e_3 = _a.sent();\n                            error = void 0;\n                            if (reaction.hasReacted) {\n                                error = e_3.message\n                                    ? nls.localize('commentDeleteReactionError', \"Deleting the comment reaction failed: {0}.\", e_3.message)\n                                    : nls.localize('commentDeleteReactionDefaultError', \"Deleting the comment reaction failed\");\n                            }\n                            else {\n                                error = e_3.message\n                                    ? nls.localize('commentAddReactionError', \"Deleting the comment reaction failed: {0}.\", e_3.message)\n                                    : nls.localize('commentAddReactionDefaultError', \"Deleting the comment reaction failed\");\n                            }\n                            this.notificationService.error(error);\n                            return [3 /*break*/, 8];\n                        case 8: return [2 /*return*/];\n                    }\n                });\n            }); }, reaction.iconPath, reaction.count);\n            if (_this._reactionsActionBar) {\n                _this._reactionsActionBar.push(action, { label: true, icon: true });\n            }\n        });\n        var reactionGroup = this.commentService.getReactionGroup(this.owner);\n        if (reactionGroup && reactionGroup.length) {\n            var commentThread = this.commentThread;\n            if (commentThread.commentThreadHandle !== undefined) {\n                var toggleReactionAction = this.createReactionPicker2();\n                this._reactionsActionBar.push(toggleReactionAction, { label: false, icon: true });\n            }\n            else {\n                var toggleReactionAction = this.createReactionPicker();\n                this._reactionsActionBar.push(toggleReactionAction, { label: false, icon: true });\n            }\n        }\n    };\n    CommentNode.prototype.createCommentEditor = function () {\n        var _this = this;\n        var container = dom.append(this._commentEditContainer, dom.$('.edit-textarea'));\n        this._commentEditor = this.instantiationService.createInstance(simpleCommentEditor_1.SimpleCommentEditor, container, simpleCommentEditor_1.SimpleCommentEditor.getEditorOptions(), this.parentEditor, this.parentThread);\n        var resource = uri_1.URI.parse(\"comment:commentinput-\" + this.comment.commentId + \"-\" + Date.now() + \".md\");\n        this._commentEditorModel = this.modelService.createModel('', this.modeService.createByFilepathOrFirstLine(resource.path), resource, false);\n        this._commentEditor.setModel(this._commentEditorModel);\n        this._commentEditor.setValue(this.comment.body.value);\n        this._commentEditor.layout({ width: container.clientWidth - 14, height: 90 });\n        this._commentEditor.focus();\n        var lastLine = this._commentEditorModel.getLineCount();\n        var lastColumn = this._commentEditorModel.getLineContent(lastLine).length + 1;\n        this._commentEditor.setSelection(new selection_1.Selection(lastLine, lastColumn, lastLine, lastColumn));\n        var commentThread = this.commentThread;\n        if (commentThread.commentThreadHandle !== undefined) {\n            commentThread.input = {\n                uri: this._commentEditor.getModel().uri,\n                value: this.comment.body.value\n            };\n            this.commentService.setActiveCommentThread(commentThread);\n            this._commentEditorDisposables.push(this._commentEditor.onDidFocusEditorWidget(function () {\n                commentThread.input = {\n                    uri: _this._commentEditor.getModel().uri,\n                    value: _this.comment.body.value\n                };\n                _this.commentService.setActiveCommentThread(commentThread);\n            }));\n            this._commentEditorDisposables.push(this._commentEditor.onDidChangeModelContent(function (e) {\n                if (commentThread.input && _this._commentEditor && _this._commentEditor.getModel().uri === commentThread.input.uri) {\n                    var newVal = _this._commentEditor.getValue();\n                    if (newVal !== commentThread.input.value) {\n                        var input = commentThread.input;\n                        input.value = newVal;\n                        commentThread.input = input;\n                    }\n                }\n            }));\n        }\n        this._toDispose.push(this._commentEditor);\n        this._toDispose.push(this._commentEditorModel);\n    };\n    CommentNode.prototype.removeCommentEditor = function () {\n        this.isEditing = false;\n        this._editAction.enabled = true;\n        this._body.classList.remove('hidden');\n        this._commentEditorModel.dispose();\n        this._commentEditorDisposables.forEach(function (dispose) { return dispose.dispose(); });\n        this._commentEditorDisposables = [];\n        if (this._commentEditor) {\n            this._commentEditor.dispose();\n            this._commentEditor = null;\n        }\n        this._commentEditContainer.remove();\n    };\n    CommentNode.prototype.editComment = function () {\n        return tslib_1.__awaiter(this, void 0, Promise, function () {\n            var _a, newBody, commentThread, commandId, args, editedComment, e_4;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        if (!this._commentEditor) {\n                            throw new Error('No comment editor');\n                        }\n                        this._updateCommentButton.enabled = false;\n                        this._updateCommentButton.label = UPDATE_IN_PROGRESS_LABEL;\n                        _b.label = 1;\n                    case 1:\n                        _b.trys.push([1, 6, , 7]);\n                        newBody = this._commentEditor.getValue();\n                        if (!this.comment.editCommand) return [3 /*break*/, 3];\n                        commentThread = this.commentThread;\n                        commentThread.input = {\n                            uri: this._commentEditor.getModel().uri,\n                            value: newBody\n                        };\n                        this.commentService.setActiveCommentThread(commentThread);\n                        commandId = this.comment.editCommand.id;\n                        args = this.comment.editCommand.arguments || [];\n                        return [4 /*yield*/, (_a = this.commandService).executeCommand.apply(_a, [commandId].concat(args))];\n                    case 2:\n                        _b.sent();\n                        return [3 /*break*/, 5];\n                    case 3: return [4 /*yield*/, this.commentService.editComment(this.owner, this.resource, this.comment, newBody)];\n                    case 4:\n                        _b.sent();\n                        _b.label = 5;\n                    case 5:\n                        this._updateCommentButton.enabled = true;\n                        this._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n                        this._commentEditor.getDomNode().style.outline = '';\n                        this.removeCommentEditor();\n                        editedComment = objects_1.assign({}, this.comment, { body: new htmlContent_1.MarkdownString(newBody) });\n                        this.update(editedComment);\n                        return [3 /*break*/, 7];\n                    case 6:\n                        e_4 = _b.sent();\n                        this._updateCommentButton.enabled = true;\n                        this._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n                        this._commentEditor.getDomNode().style.outline = \"1px solid \" + this.themeService.getTheme().getColor(colorRegistry_1.inputValidationErrorBorder);\n                        this._errorEditingContainer.textContent = e_4.message\n                            ? nls.localize('commentEditError', \"Updating the comment failed: {0}.\", e_4.message)\n                            : nls.localize('commentEditDefaultError', \"Updating the comment failed.\");\n                        this._errorEditingContainer.classList.remove('hidden');\n                        this._commentEditor.focus();\n                        return [3 /*break*/, 7];\n                    case 7: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    CommentNode.prototype.createDeleteAction = function () {\n        var _this = this;\n        return new actions_1.Action('comment.delete', nls.localize('label.delete', \"Delete\"), 'octicon octicon-x', true, function () {\n            return _this.dialogService.confirm({\n                message: nls.localize('confirmDelete', \"Delete comment?\"),\n                type: 'question',\n                primaryButton: nls.localize('label.delete', \"Delete\")\n            }).then(function (result) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var _a, commandId, args, didDelete, e_5, error;\n                return tslib_1.__generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            if (!result.confirmed) return [3 /*break*/, 7];\n                            _b.label = 1;\n                        case 1:\n                            _b.trys.push([1, 6, , 7]);\n                            if (!this.comment.deleteCommand) return [3 /*break*/, 3];\n                            this.commentService.setActiveCommentThread(this.commentThread);\n                            commandId = this.comment.deleteCommand.id;\n                            args = this.comment.deleteCommand.arguments || [];\n                            return [4 /*yield*/, (_a = this.commandService).executeCommand.apply(_a, [commandId].concat(args))];\n                        case 2:\n                            _b.sent();\n                            return [3 /*break*/, 5];\n                        case 3: return [4 /*yield*/, this.commentService.deleteComment(this.owner, this.resource, this.comment)];\n                        case 4:\n                            didDelete = _b.sent();\n                            if (didDelete) {\n                                this._onDidDelete.fire(this);\n                            }\n                            else {\n                                throw Error();\n                            }\n                            _b.label = 5;\n                        case 5: return [3 /*break*/, 7];\n                        case 6:\n                            e_5 = _b.sent();\n                            error = e_5.message\n                                ? nls.localize('commentDeletionError', \"Deleting the comment failed: {0}.\", e_5.message)\n                                : nls.localize('commentDeletionDefaultError', \"Deleting the comment failed\");\n                            this.notificationService.error(error);\n                            return [3 /*break*/, 7];\n                        case 7: return [2 /*return*/];\n                    }\n                });\n            }); });\n        });\n    };\n    CommentNode.prototype.createEditAction = function (commentDetailsContainer) {\n        var _this = this;\n        return new actions_1.Action('comment.edit', nls.localize('label.edit', \"Edit\"), 'octicon octicon-pencil', true, function () {\n            _this.isEditing = true;\n            _this._body.classList.add('hidden');\n            _this._commentEditContainer = dom.append(commentDetailsContainer, dom.$('.edit-container'));\n            _this.createCommentEditor();\n            _this._errorEditingContainer = dom.append(_this._commentEditContainer, dom.$('.validation-error.hidden'));\n            var formActions = dom.append(_this._commentEditContainer, dom.$('.form-actions'));\n            var cancelEditButton = new button_1.Button(formActions);\n            cancelEditButton.label = nls.localize('label.cancel', \"Cancel\");\n            _this._toDispose.push(styler_1.attachButtonStyler(cancelEditButton, _this.themeService));\n            _this._toDispose.push(cancelEditButton.onDidClick(function (_) {\n                _this.removeCommentEditor();\n            }));\n            _this._updateCommentButton = new button_1.Button(formActions);\n            _this._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n            _this._toDispose.push(styler_1.attachButtonStyler(_this._updateCommentButton, _this.themeService));\n            _this._toDispose.push(_this._updateCommentButton.onDidClick(function (_) {\n                _this.editComment();\n            }));\n            _this._commentEditorDisposables.push(_this._commentEditor.onDidChangeModelContent(function (_) {\n                _this._updateCommentButton.enabled = !!_this._commentEditor.getValue();\n            }));\n            _this._editAction.enabled = false;\n            return Promise.resolve();\n        });\n    };\n    CommentNode.prototype.registerActionBarListeners = function (actionsContainer) {\n        var _this = this;\n        this._toDispose.push(dom.addDisposableListener(this._domNode, 'mouseenter', function () {\n            actionsContainer.classList.remove('hidden');\n        }));\n        this._toDispose.push(dom.addDisposableListener(this._domNode, 'focus', function () {\n            actionsContainer.classList.remove('hidden');\n        }));\n        this._toDispose.push(dom.addDisposableListener(this._domNode, 'mouseleave', function () {\n            if (!_this._domNode.contains(document.activeElement)) {\n                actionsContainer.classList.add('hidden');\n            }\n        }));\n        this._toDispose.push(dom.addDisposableListener(this._domNode, 'focusout', function (e) {\n            if (!_this._domNode.contains(e.relatedTarget)) {\n                actionsContainer.classList.add('hidden');\n                if (_this._commentEditor && _this._commentEditor.getValue() === _this.comment.body.value) {\n                    _this.removeCommentEditor();\n                }\n            }\n        }));\n    };\n    CommentNode.prototype.update = function (newComment) {\n        if (newComment.body !== this.comment.body) {\n            this._body.removeChild(this._md);\n            this._md = this.markdownRenderer.render(newComment.body).element;\n            this._body.appendChild(this._md);\n        }\n        var shouldUpdateActions = newComment.editCommand !== this.comment.editCommand || newComment.deleteCommand !== this.comment.deleteCommand;\n        this.comment = newComment;\n        if (shouldUpdateActions) {\n            dom.clearNode(this._actionsToolbarContainer);\n            this.createActionsToolbar();\n        }\n        if (newComment.label) {\n            this._isPendingLabel.innerText = newComment.label;\n        }\n        else if (newComment.isDraft) {\n            this._isPendingLabel.innerText = 'Pending';\n        }\n        else {\n            this._isPendingLabel.innerText = '';\n        }\n        // update comment reactions\n        if (this._reactionActionsContainer) {\n            this._reactionActionsContainer.remove();\n        }\n        if (this._reactionsActionBar) {\n            this._reactionsActionBar.clear();\n        }\n        if (this.comment.commentReactions && this.comment.commentReactions.length) {\n            this.createReactionsContainer(this._commentDetailsContainer);\n        }\n    };\n    CommentNode.prototype.focus = function () {\n        var _this = this;\n        this.domNode.focus();\n        if (!this._clearTimeout) {\n            dom.addClass(this.domNode, 'focus');\n            this._clearTimeout = setTimeout(function () {\n                dom.removeClass(_this.domNode, 'focus');\n            }, 3000);\n        }\n    };\n    CommentNode.prototype.dispose = function () {\n        this._toDispose.forEach(function (disposeable) { return disposeable.dispose(); });\n    };\n    CommentNode = tslib_1.__decorate([\n        tslib_1.__param(7, themeService_1.IThemeService),\n        tslib_1.__param(8, instantiation_1.IInstantiationService),\n        tslib_1.__param(9, commentService_1.ICommentService),\n        tslib_1.__param(10, commands_1.ICommandService),\n        tslib_1.__param(11, modelService_1.IModelService),\n        tslib_1.__param(12, modeService_1.IModeService),\n        tslib_1.__param(13, dialogs_1.IDialogService),\n        tslib_1.__param(14, notification_1.INotificationService),\n        tslib_1.__param(15, contextView_1.IContextMenuService)\n    ], CommentNode);\n    return CommentNode;\n}(lifecycle_1.Disposable));\nexports.CommentNode = CommentNode;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/comments/browser/commentNode.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/comments/browser/commentNode.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as dom from 'vs/base/browser/dom';\nimport * as modes from 'vs/editor/common/modes';\nimport { ActionsOrientation, ActionItem, ActionBar } from 'vs/base/browser/ui/actionbar/actionbar';\nimport { Button } from 'vs/base/browser/ui/button/button';\nimport { Action, IActionRunner } from 'vs/base/common/actions';\nimport { Disposable, IDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { ITextModel } from 'vs/editor/common/model';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { IModeService } from 'vs/editor/common/services/modeService';\nimport { MarkdownRenderer } from 'vs/editor/contrib/markdown/markdownRenderer';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { inputValidationErrorBorder } from 'vs/platform/theme/common/colorRegistry';\nimport { attachButtonStyler } from 'vs/platform/theme/common/styler';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { ICommentService } from 'vs/workbench/contrib/comments/browser/commentService';\nimport { SimpleCommentEditor } from 'vs/workbench/contrib/comments/browser/simpleCommentEditor';\nimport { Selection } from 'vs/editor/common/core/selection';\nimport { IDialogService } from 'vs/platform/dialogs/common/dialogs';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport { assign } from 'vs/base/common/objects';\nimport { MarkdownString } from 'vs/base/common/htmlContent';\nimport { ToolBar } from 'vs/base/browser/ui/toolbar/toolbar';\nimport { IContextMenuService } from 'vs/platform/contextview/browser/contextView';\nimport { DropdownMenuActionItem } from 'vs/base/browser/ui/dropdown/dropdown';\nimport { AnchorAlignment } from 'vs/base/browser/ui/contextview/contextview';\nimport { ToggleReactionsAction, ReactionAction, ReactionActionItem } from './reactionsAction';\nimport { ICommandService } from 'vs/platform/commands/common/commands';\nimport { ICodeEditor } from 'vs/editor/browser/editorBrowser';\nimport { ICommentThreadWidget } from 'vs/workbench/contrib/comments/common/commentThreadWidget';\n\nconst UPDATE_COMMENT_LABEL = nls.localize('label.updateComment', \"Update comment\");\nconst UPDATE_IN_PROGRESS_LABEL = nls.localize('label.updatingComment', \"Updating comment...\");\n\nexport class CommentNode extends Disposable {\n\tprivate _domNode: HTMLElement;\n\tprivate _body: HTMLElement;\n\tprivate _md: HTMLElement;\n\tprivate _clearTimeout: any;\n\n\tprivate _editAction: Action;\n\tprivate _commentEditContainer: HTMLElement;\n\tprivate _commentDetailsContainer: HTMLElement;\n\tprivate _actionsToolbarContainer: HTMLElement;\n\tprivate _reactionsActionBar?: ActionBar;\n\tprivate _reactionActionsContainer?: HTMLElement;\n\tprivate _commentEditor: SimpleCommentEditor | null;\n\tprivate _commentEditorDisposables: IDisposable[] = [];\n\tprivate _commentEditorModel: ITextModel;\n\tprivate _updateCommentButton: Button;\n\tprivate _errorEditingContainer: HTMLElement;\n\tprivate _isPendingLabel: HTMLElement;\n\n\tprivate _deleteAction: Action;\n\tprotected actionRunner?: IActionRunner;\n\tprotected toolbar: ToolBar;\n\n\tprivate _onDidDelete = new Emitter<CommentNode>();\n\n\tpublic get domNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tpublic isEditing: boolean;\n\n\tconstructor(\n\t\tprivate commentThread: modes.CommentThread | modes.CommentThread2,\n\t\tpublic comment: modes.Comment,\n\t\tprivate owner: string,\n\t\tprivate resource: URI,\n\t\tprivate parentEditor: ICodeEditor,\n\t\tprivate parentThread: ICommentThreadWidget,\n\t\tprivate markdownRenderer: MarkdownRenderer,\n\t\t@IThemeService private themeService: IThemeService,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@ICommentService private commentService: ICommentService,\n\t\t@ICommandService private commandService: ICommandService,\n\t\t@IModelService private modelService: IModelService,\n\t\t@IModeService private modeService: IModeService,\n\t\t@IDialogService private dialogService: IDialogService,\n\t\t@INotificationService private notificationService: INotificationService,\n\t\t@IContextMenuService private contextMenuService: IContextMenuService\n\t) {\n\t\tsuper();\n\n\t\tthis._domNode = dom.$('div.review-comment');\n\t\tthis._domNode.tabIndex = 0;\n\t\tconst avatar = dom.append(this._domNode, dom.$('div.avatar-container'));\n\t\tif (comment.userIconPath) {\n\t\t\tconst img = <HTMLImageElement>dom.append(avatar, dom.$('img.avatar'));\n\t\t\timg.src = comment.userIconPath.toString();\n\t\t\timg.onerror = _ => img.remove();\n\t\t}\n\t\tthis._commentDetailsContainer = dom.append(this._domNode, dom.$('.review-comment-contents'));\n\n\t\tthis.createHeader(this._commentDetailsContainer);\n\n\t\tthis._body = dom.append(this._commentDetailsContainer, dom.$('div.comment-body'));\n\t\tthis._md = this.markdownRenderer.render(comment.body).element;\n\t\tthis._body.appendChild(this._md);\n\n\t\tif (this.comment.commentReactions && this.comment.commentReactions.length) {\n\t\t\tthis.createReactionsContainer(this._commentDetailsContainer);\n\t\t}\n\n\t\tthis._domNode.setAttribute('aria-label', `${comment.userName}, ${comment.body.value}`);\n\t\tthis._domNode.setAttribute('role', 'treeitem');\n\t\tthis._clearTimeout = null;\n\t}\n\n\tpublic get onDidDelete(): Event<CommentNode> {\n\t\treturn this._onDidDelete.event;\n\t}\n\n\tprivate createHeader(commentDetailsContainer: HTMLElement): void {\n\t\tconst header = dom.append(commentDetailsContainer, dom.$('div.comment-title'));\n\t\tconst author = dom.append(header, dom.$('strong.author'));\n\t\tauthor.innerText = this.comment.userName;\n\n\t\tthis._isPendingLabel = dom.append(header, dom.$('span.isPending'));\n\n\t\tif (this.comment.label) {\n\t\t\tthis._isPendingLabel.innerText = this.comment.label;\n\t\t} else if (this.comment.isDraft) {\n\t\t\tthis._isPendingLabel.innerText = 'Pending';\n\t\t} else {\n\t\t\tthis._isPendingLabel.innerText = '';\n\t\t}\n\n\t\tthis._actionsToolbarContainer = dom.append(header, dom.$('.comment-actions.hidden'));\n\t\tthis.createActionsToolbar();\n\t}\n\n\tprivate createActionsToolbar() {\n\t\tconst actions: Action[] = [];\n\n\t\tlet reactionGroup = this.commentService.getReactionGroup(this.owner);\n\t\tif (reactionGroup && reactionGroup.length) {\n\t\t\tlet commentThread = this.commentThread as modes.CommentThread2;\n\t\t\tif (commentThread.commentThreadHandle !== undefined) {\n\t\t\t\tlet toggleReactionAction = this.createReactionPicker2();\n\t\t\t\tactions.push(toggleReactionAction);\n\t\t\t} else {\n\t\t\t\tlet toggleReactionAction = this.createReactionPicker();\n\t\t\t\tactions.push(toggleReactionAction);\n\t\t\t}\n\t\t}\n\n\t\tif (this.comment.canEdit || this.comment.editCommand) {\n\t\t\tthis._editAction = this.createEditAction(this._commentDetailsContainer);\n\t\t\tactions.push(this._editAction);\n\t\t}\n\n\t\tif (this.comment.canDelete || this.comment.deleteCommand) {\n\t\t\tthis._deleteAction = this.createDeleteAction();\n\t\t\tactions.push(this._deleteAction);\n\t\t}\n\n\t\tif (actions.length) {\n\t\t\tthis.toolbar = new ToolBar(this._actionsToolbarContainer, this.contextMenuService, {\n\t\t\t\tactionItemProvider: action => {\n\t\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\t\treturn new DropdownMenuActionItem(\n\t\t\t\t\t\t\taction,\n\t\t\t\t\t\t\t(<ToggleReactionsAction>action).menuActions,\n\t\t\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t\t\taction => {\n\t\t\t\t\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tthis.actionRunner!,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t'toolbar-toggle-pickReactions',\n\t\t\t\t\t\t\t() => { return AnchorAlignment.RIGHT; }\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t\t},\n\t\t\t\torientation: ActionsOrientation.HORIZONTAL\n\t\t\t});\n\n\t\t\tthis.registerActionBarListeners(this._actionsToolbarContainer);\n\t\t\tthis.toolbar.setActions(actions, [])();\n\t\t\tthis._toDispose.push(this.toolbar);\n\t\t}\n\t}\n\n\tactionItemProvider(action: Action) {\n\t\tlet options = {};\n\t\tif (action.id === 'comment.delete' || action.id === 'comment.edit' || action.id === ToggleReactionsAction.ID) {\n\t\t\toptions = { label: false, icon: true };\n\t\t} else {\n\t\t\toptions = { label: true, icon: true };\n\t\t}\n\n\t\tif (action.id === ReactionAction.ID) {\n\t\t\tlet item = new ReactionActionItem(action);\n\t\t\treturn item;\n\t\t} else {\n\t\t\tlet item = new ActionItem({}, action, options);\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tprivate createReactionPicker2(): ToggleReactionsAction {\n\t\tlet toggleReactionActionItem: DropdownMenuActionItem;\n\t\tlet toggleReactionAction = this._register(new ToggleReactionsAction(() => {\n\t\t\tif (toggleReactionActionItem) {\n\t\t\t\ttoggleReactionActionItem.show();\n\t\t\t}\n\t\t}, nls.localize('commentToggleReaction', \"Toggle Reaction\")));\n\n\t\tlet reactionMenuActions: Action[] = [];\n\t\tlet reactionGroup = this.commentService.getReactionGroup(this.owner);\n\t\tif (reactionGroup && reactionGroup.length) {\n\t\t\treactionMenuActions = reactionGroup.map((reaction) => {\n\t\t\t\treturn new Action(`reaction.command.${reaction.label}`, `${reaction.label}`, '', true, async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.commentService.toggleReaction(this.owner, this.resource, this.commentThread as modes.CommentThread2, this.comment, reaction);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst error = e.message\n\t\t\t\t\t\t\t? nls.localize('commentToggleReactionError', \"Toggling the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentToggleReactionDefaultError', \"Toggling the comment reaction failed\");\n\t\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\ttoggleReactionAction.menuActions = reactionMenuActions;\n\n\t\ttoggleReactionActionItem = new DropdownMenuActionItem(\n\t\t\ttoggleReactionAction,\n\t\t\t(<ToggleReactionsAction>toggleReactionAction).menuActions,\n\t\t\tthis.contextMenuService,\n\t\t\taction => {\n\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\treturn toggleReactionActionItem;\n\t\t\t\t}\n\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t},\n\t\t\tthis.actionRunner!,\n\t\t\tundefined,\n\t\t\t'toolbar-toggle-pickReactions',\n\t\t\t() => { return AnchorAlignment.RIGHT; }\n\t\t);\n\n\t\treturn toggleReactionAction;\n\t}\n\n\tprivate createReactionPicker(): ToggleReactionsAction {\n\t\tlet toggleReactionActionItem: DropdownMenuActionItem;\n\t\tlet toggleReactionAction = this._register(new ToggleReactionsAction(() => {\n\t\t\tif (toggleReactionActionItem) {\n\t\t\t\ttoggleReactionActionItem.show();\n\t\t\t}\n\t\t}, nls.localize('commentAddReaction', \"Add Reaction\")));\n\n\t\tlet reactionMenuActions: Action[] = [];\n\t\tlet reactionGroup = this.commentService.getReactionGroup(this.owner);\n\t\tif (reactionGroup && reactionGroup.length) {\n\t\t\treactionMenuActions = reactionGroup.map((reaction) => {\n\t\t\t\treturn new Action(`reaction.command.${reaction.label}`, `${reaction.label}`, '', true, async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait this.commentService.addReaction(this.owner, this.resource, this.comment, reaction);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst error = e.message\n\t\t\t\t\t\t\t? nls.localize('commentAddReactionError', \"Deleting the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentAddReactionDefaultError', \"Deleting the comment reaction failed\");\n\t\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\ttoggleReactionAction.menuActions = reactionMenuActions;\n\n\t\ttoggleReactionActionItem = new DropdownMenuActionItem(\n\t\t\ttoggleReactionAction,\n\t\t\t(<ToggleReactionsAction>toggleReactionAction).menuActions,\n\t\t\tthis.contextMenuService,\n\t\t\taction => {\n\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\treturn toggleReactionActionItem;\n\t\t\t\t}\n\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t},\n\t\t\tthis.actionRunner!,\n\t\t\tundefined,\n\t\t\t'toolbar-toggle-pickReactions',\n\t\t\t() => { return AnchorAlignment.RIGHT; }\n\t\t);\n\n\t\treturn toggleReactionAction;\n\t}\n\n\tprivate createReactionsContainer(commentDetailsContainer: HTMLElement): void {\n\t\tthis._reactionActionsContainer = dom.append(commentDetailsContainer, dom.$('div.comment-reactions'));\n\t\tthis._reactionsActionBar = new ActionBar(this._reactionActionsContainer, {\n\t\t\tactionItemProvider: action => {\n\t\t\t\tif (action.id === ToggleReactionsAction.ID) {\n\t\t\t\t\treturn new DropdownMenuActionItem(\n\t\t\t\t\t\taction,\n\t\t\t\t\t\t(<ToggleReactionsAction>action).menuActions,\n\t\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t\taction => {\n\t\t\t\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.actionRunner!,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t'toolbar-toggle-pickReactions',\n\t\t\t\t\t\t() => { return AnchorAlignment.RIGHT; }\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn this.actionItemProvider(action as Action);\n\t\t\t}\n\t\t});\n\t\tthis._toDispose.push(this._reactionsActionBar);\n\n\t\tthis.comment.commentReactions!.map(reaction => {\n\t\t\tlet action = new ReactionAction(`reaction.${reaction.label}`, `${reaction.label}`, reaction.hasReacted && reaction.canEdit ? 'active' : '', reaction.canEdit, async () => {\n\t\t\t\ttry {\n\t\t\t\t\tlet commentThread = this.commentThread as modes.CommentThread2;\n\t\t\t\t\tif (commentThread.commentThreadHandle !== undefined) {\n\t\t\t\t\t\tawait this.commentService.toggleReaction(this.owner, this.resource, this.commentThread as modes.CommentThread2, this.comment, reaction);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (reaction.hasReacted) {\n\t\t\t\t\t\t\tawait this.commentService.deleteReaction(this.owner, this.resource, this.comment, reaction);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tawait this.commentService.addReaction(this.owner, this.resource, this.comment, reaction);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet error: string;\n\n\t\t\t\t\tif (reaction.hasReacted) {\n\t\t\t\t\t\terror = e.message\n\t\t\t\t\t\t\t? nls.localize('commentDeleteReactionError', \"Deleting the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentDeleteReactionDefaultError', \"Deleting the comment reaction failed\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\terror = e.message\n\t\t\t\t\t\t\t? nls.localize('commentAddReactionError', \"Deleting the comment reaction failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentAddReactionDefaultError', \"Deleting the comment reaction failed\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t}\n\t\t\t}, reaction.iconPath, reaction.count);\n\n\t\t\tif (this._reactionsActionBar) {\n\t\t\t\tthis._reactionsActionBar.push(action, { label: true, icon: true });\n\t\t\t}\n\t\t});\n\n\t\tlet reactionGroup = this.commentService.getReactionGroup(this.owner);\n\t\tif (reactionGroup && reactionGroup.length) {\n\t\t\tlet commentThread = this.commentThread as modes.CommentThread2;\n\t\t\tif (commentThread.commentThreadHandle !== undefined) {\n\t\t\t\tlet toggleReactionAction = this.createReactionPicker2();\n\t\t\t\tthis._reactionsActionBar.push(toggleReactionAction, { label: false, icon: true });\n\t\t\t} else {\n\t\t\t\tlet toggleReactionAction = this.createReactionPicker();\n\t\t\t\tthis._reactionsActionBar.push(toggleReactionAction, { label: false, icon: true });\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createCommentEditor(): void {\n\t\tconst container = dom.append(this._commentEditContainer, dom.$('.edit-textarea'));\n\t\tthis._commentEditor = this.instantiationService.createInstance(SimpleCommentEditor, container, SimpleCommentEditor.getEditorOptions(), this.parentEditor, this.parentThread);\n\t\tconst resource = URI.parse(`comment:commentinput-${this.comment.commentId}-${Date.now()}.md`);\n\t\tthis._commentEditorModel = this.modelService.createModel('', this.modeService.createByFilepathOrFirstLine(resource.path), resource, false);\n\n\t\tthis._commentEditor.setModel(this._commentEditorModel);\n\t\tthis._commentEditor.setValue(this.comment.body.value);\n\t\tthis._commentEditor.layout({ width: container.clientWidth - 14, height: 90 });\n\t\tthis._commentEditor.focus();\n\n\t\tconst lastLine = this._commentEditorModel.getLineCount();\n\t\tconst lastColumn = this._commentEditorModel.getLineContent(lastLine).length + 1;\n\t\tthis._commentEditor.setSelection(new Selection(lastLine, lastColumn, lastLine, lastColumn));\n\n\t\tlet commentThread = this.commentThread as modes.CommentThread2;\n\t\tif (commentThread.commentThreadHandle !== undefined) {\n\t\t\tcommentThread.input = {\n\t\t\t\turi: this._commentEditor.getModel()!.uri,\n\t\t\t\tvalue: this.comment.body.value\n\t\t\t};\n\t\t\tthis.commentService.setActiveCommentThread(commentThread);\n\n\t\t\tthis._commentEditorDisposables.push(this._commentEditor.onDidFocusEditorWidget(() => {\n\t\t\t\tcommentThread.input = {\n\t\t\t\t\turi: this._commentEditor!.getModel()!.uri,\n\t\t\t\t\tvalue: this.comment.body.value\n\t\t\t\t};\n\t\t\t\tthis.commentService.setActiveCommentThread(commentThread);\n\t\t\t}));\n\n\t\t\tthis._commentEditorDisposables.push(this._commentEditor.onDidChangeModelContent(e => {\n\t\t\t\tif (commentThread.input && this._commentEditor && this._commentEditor.getModel()!.uri === commentThread.input.uri) {\n\t\t\t\t\tlet newVal = this._commentEditor.getValue();\n\t\t\t\t\tif (newVal !== commentThread.input.value) {\n\t\t\t\t\t\tlet input = commentThread.input;\n\t\t\t\t\t\tinput.value = newVal;\n\t\t\t\t\t\tcommentThread.input = input;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\tthis._toDispose.push(this._commentEditor);\n\t\tthis._toDispose.push(this._commentEditorModel);\n\t}\n\n\tprivate removeCommentEditor() {\n\t\tthis.isEditing = false;\n\t\tthis._editAction.enabled = true;\n\t\tthis._body.classList.remove('hidden');\n\n\t\tthis._commentEditorModel.dispose();\n\t\tthis._commentEditorDisposables.forEach(dispose => dispose.dispose());\n\t\tthis._commentEditorDisposables = [];\n\t\tif (this._commentEditor) {\n\t\t\tthis._commentEditor.dispose();\n\t\t\tthis._commentEditor = null;\n\t\t}\n\n\t\tthis._commentEditContainer.remove();\n\t}\n\n\tasync editComment(): Promise<void> {\n\t\tif (!this._commentEditor) {\n\t\t\tthrow new Error('No comment editor');\n\t\t}\n\n\t\tthis._updateCommentButton.enabled = false;\n\t\tthis._updateCommentButton.label = UPDATE_IN_PROGRESS_LABEL;\n\n\t\ttry {\n\t\t\tconst newBody = this._commentEditor.getValue();\n\n\t\t\tif (this.comment.editCommand) {\n\t\t\t\tlet commentThread = this.commentThread as modes.CommentThread2;\n\t\t\t\tcommentThread.input = {\n\t\t\t\t\turi: this._commentEditor.getModel()!.uri,\n\t\t\t\t\tvalue: newBody\n\t\t\t\t};\n\t\t\t\tthis.commentService.setActiveCommentThread(commentThread);\n\t\t\t\tlet commandId = this.comment.editCommand.id;\n\t\t\t\tlet args = this.comment.editCommand.arguments || [];\n\n\t\t\t\tawait this.commandService.executeCommand(commandId, ...args);\n\t\t\t} else {\n\t\t\t\tawait this.commentService.editComment(this.owner, this.resource, this.comment, newBody);\n\t\t\t}\n\n\t\t\tthis._updateCommentButton.enabled = true;\n\t\t\tthis._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n\t\t\tthis._commentEditor.getDomNode()!.style.outline = '';\n\t\t\tthis.removeCommentEditor();\n\t\t\tconst editedComment = assign({}, this.comment, { body: new MarkdownString(newBody) });\n\t\t\tthis.update(editedComment);\n\t\t} catch (e) {\n\t\t\tthis._updateCommentButton.enabled = true;\n\t\t\tthis._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n\n\t\t\tthis._commentEditor.getDomNode()!.style.outline = `1px solid ${this.themeService.getTheme().getColor(inputValidationErrorBorder)}`;\n\t\t\tthis._errorEditingContainer.textContent = e.message\n\t\t\t\t? nls.localize('commentEditError', \"Updating the comment failed: {0}.\", e.message)\n\t\t\t\t: nls.localize('commentEditDefaultError', \"Updating the comment failed.\");\n\t\t\tthis._errorEditingContainer.classList.remove('hidden');\n\t\t\tthis._commentEditor.focus();\n\t\t}\n\t}\n\n\tprivate createDeleteAction(): Action {\n\t\treturn new Action('comment.delete', nls.localize('label.delete', \"Delete\"), 'octicon octicon-x', true, () => {\n\t\t\treturn this.dialogService.confirm({\n\t\t\t\tmessage: nls.localize('confirmDelete', \"Delete comment?\"),\n\t\t\t\ttype: 'question',\n\t\t\t\tprimaryButton: nls.localize('label.delete', \"Delete\")\n\t\t\t}).then(async result => {\n\t\t\t\tif (result.confirmed) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (this.comment.deleteCommand) {\n\t\t\t\t\t\t\tthis.commentService.setActiveCommentThread(this.commentThread as modes.CommentThread2);\n\t\t\t\t\t\t\tlet commandId = this.comment.deleteCommand.id;\n\t\t\t\t\t\t\tlet args = this.comment.deleteCommand.arguments || [];\n\n\t\t\t\t\t\t\tawait this.commandService.executeCommand(commandId, ...args);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst didDelete = await this.commentService.deleteComment(this.owner, this.resource, this.comment);\n\t\t\t\t\t\t\tif (didDelete) {\n\t\t\t\t\t\t\t\tthis._onDidDelete.fire(this);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow Error();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst error = e.message\n\t\t\t\t\t\t\t? nls.localize('commentDeletionError', \"Deleting the comment failed: {0}.\", e.message)\n\t\t\t\t\t\t\t: nls.localize('commentDeletionDefaultError', \"Deleting the comment failed\");\n\t\t\t\t\t\tthis.notificationService.error(error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate createEditAction(commentDetailsContainer: HTMLElement): Action {\n\t\treturn new Action('comment.edit', nls.localize('label.edit', \"Edit\"), 'octicon octicon-pencil', true, () => {\n\t\t\tthis.isEditing = true;\n\t\t\tthis._body.classList.add('hidden');\n\t\t\tthis._commentEditContainer = dom.append(commentDetailsContainer, dom.$('.edit-container'));\n\t\t\tthis.createCommentEditor();\n\n\t\t\tthis._errorEditingContainer = dom.append(this._commentEditContainer, dom.$('.validation-error.hidden'));\n\t\t\tconst formActions = dom.append(this._commentEditContainer, dom.$('.form-actions'));\n\n\t\t\tconst cancelEditButton = new Button(formActions);\n\t\t\tcancelEditButton.label = nls.localize('label.cancel', \"Cancel\");\n\t\t\tthis._toDispose.push(attachButtonStyler(cancelEditButton, this.themeService));\n\n\t\t\tthis._toDispose.push(cancelEditButton.onDidClick(_ => {\n\t\t\t\tthis.removeCommentEditor();\n\t\t\t}));\n\n\t\t\tthis._updateCommentButton = new Button(formActions);\n\t\t\tthis._updateCommentButton.label = UPDATE_COMMENT_LABEL;\n\t\t\tthis._toDispose.push(attachButtonStyler(this._updateCommentButton, this.themeService));\n\n\t\t\tthis._toDispose.push(this._updateCommentButton.onDidClick(_ => {\n\t\t\t\tthis.editComment();\n\t\t\t}));\n\n\t\t\tthis._commentEditorDisposables.push(this._commentEditor!.onDidChangeModelContent(_ => {\n\t\t\t\tthis._updateCommentButton.enabled = !!this._commentEditor!.getValue();\n\t\t\t}));\n\n\t\t\tthis._editAction.enabled = false;\n\t\t\treturn Promise.resolve();\n\t\t});\n\t}\n\n\tprivate registerActionBarListeners(actionsContainer: HTMLElement): void {\n\t\tthis._toDispose.push(dom.addDisposableListener(this._domNode, 'mouseenter', () => {\n\t\t\tactionsContainer.classList.remove('hidden');\n\t\t}));\n\n\t\tthis._toDispose.push(dom.addDisposableListener(this._domNode, 'focus', () => {\n\t\t\tactionsContainer.classList.remove('hidden');\n\t\t}));\n\n\t\tthis._toDispose.push(dom.addDisposableListener(this._domNode, 'mouseleave', () => {\n\t\t\tif (!this._domNode.contains(document.activeElement)) {\n\t\t\t\tactionsContainer.classList.add('hidden');\n\t\t\t}\n\t\t}));\n\n\t\tthis._toDispose.push(dom.addDisposableListener(this._domNode, 'focusout', (e: FocusEvent) => {\n\t\t\tif (!this._domNode.contains((<HTMLElement>e.relatedTarget))) {\n\t\t\t\tactionsContainer.classList.add('hidden');\n\n\t\t\t\tif (this._commentEditor && this._commentEditor.getValue() === this.comment.body.value) {\n\t\t\t\t\tthis.removeCommentEditor();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tupdate(newComment: modes.Comment) {\n\n\t\tif (newComment.body !== this.comment.body) {\n\t\t\tthis._body.removeChild(this._md);\n\t\t\tthis._md = this.markdownRenderer.render(newComment.body).element;\n\t\t\tthis._body.appendChild(this._md);\n\t\t}\n\n\t\tconst shouldUpdateActions = newComment.editCommand !== this.comment.editCommand || newComment.deleteCommand !== this.comment.deleteCommand;\n\t\tthis.comment = newComment;\n\n\t\tif (shouldUpdateActions) {\n\t\t\tdom.clearNode(this._actionsToolbarContainer);\n\t\t\tthis.createActionsToolbar();\n\t\t}\n\n\n\t\tif (newComment.label) {\n\t\t\tthis._isPendingLabel.innerText = newComment.label;\n\t\t} else if (newComment.isDraft) {\n\t\t\tthis._isPendingLabel.innerText = 'Pending';\n\t\t} else {\n\t\t\tthis._isPendingLabel.innerText = '';\n\t\t}\n\n\t\t// update comment reactions\n\t\tif (this._reactionActionsContainer) {\n\t\t\tthis._reactionActionsContainer.remove();\n\t\t}\n\n\t\tif (this._reactionsActionBar) {\n\t\t\tthis._reactionsActionBar.clear();\n\t\t}\n\n\t\tif (this.comment.commentReactions && this.comment.commentReactions.length) {\n\t\t\tthis.createReactionsContainer(this._commentDetailsContainer);\n\t\t}\n\t}\n\n\tfocus() {\n\t\tthis.domNode.focus();\n\t\tif (!this._clearTimeout) {\n\t\t\tdom.addClass(this.domNode, 'focus');\n\t\t\tthis._clearTimeout = setTimeout(() => {\n\t\t\t\tdom.removeClass(this.domNode, 'focus');\n\t\t\t}, 3000);\n\t\t}\n\t}\n\n\tdispose() {\n\t\tthis._toDispose.forEach(disposeable => disposeable.dispose());\n\t}\n}"]}]}