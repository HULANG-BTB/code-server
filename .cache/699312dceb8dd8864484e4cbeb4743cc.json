{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/common/services/markerDecorationsServiceImpl.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/common/services/markerDecorationsServiceImpl.ts","mtime":1555102316000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar markers_1 = require(\"vs/platform/markers/common/markers\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar model_1 = require(\"vs/editor/common/model\");\nvar intervalTree_1 = require(\"vs/editor/common/model/intervalTree\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar editorColorRegistry_1 = require(\"vs/editor/common/view/editorColorRegistry\");\nvar modelService_1 = require(\"vs/editor/common/services/modelService\");\nvar range_1 = require(\"vs/editor/common/core/range\");\nvar map_1 = require(\"vs/base/common/map\");\nvar network_1 = require(\"vs/base/common/network\");\nvar event_1 = require(\"vs/base/common/event\");\nvar types_1 = require(\"vs/base/common/types\");\nfunction MODEL_ID(resource) {\n    return resource.toString();\n}\nvar MarkerDecorations = /** @class */ (function (_super) {\n    tslib_1.__extends(MarkerDecorations, _super);\n    function MarkerDecorations(model) {\n        var _this = _super.call(this) || this;\n        _this.model = model;\n        _this._markersData = new Map();\n        _this._register(lifecycle_1.toDisposable(function () {\n            _this.model.deltaDecorations(map_1.keys(_this._markersData), []);\n            _this._markersData.clear();\n        }));\n        return _this;\n    }\n    MarkerDecorations.prototype.update = function (markers, newDecorations) {\n        var ids = this.model.deltaDecorations(map_1.keys(this._markersData), newDecorations);\n        for (var index = 0; index < ids.length; index++) {\n            this._markersData.set(ids[index], markers[index]);\n        }\n    };\n    MarkerDecorations.prototype.getMarker = function (decoration) {\n        return this._markersData.get(decoration.id);\n    };\n    MarkerDecorations.prototype.getMarkers = function () {\n        var _this = this;\n        var res = [];\n        this._markersData.forEach(function (marker, id) {\n            var range = _this.model.getDecorationRange(id);\n            if (range) {\n                res.push([range, marker]);\n            }\n        });\n        return res;\n    };\n    return MarkerDecorations;\n}(lifecycle_1.Disposable));\nvar MarkerDecorationsService = /** @class */ (function (_super) {\n    tslib_1.__extends(MarkerDecorationsService, _super);\n    function MarkerDecorationsService(modelService, _markerService) {\n        var _this = _super.call(this) || this;\n        _this._markerService = _markerService;\n        _this._onDidChangeMarker = new event_1.Emitter();\n        _this.onDidChangeMarker = _this._onDidChangeMarker.event;\n        _this._markerDecorations = new Map();\n        modelService.getModels().forEach(function (model) { return _this._onModelAdded(model); });\n        _this._register(modelService.onModelAdded(_this._onModelAdded, _this));\n        _this._register(modelService.onModelRemoved(_this._onModelRemoved, _this));\n        _this._register(_this._markerService.onMarkerChanged(_this._handleMarkerChange, _this));\n        return _this;\n    }\n    MarkerDecorationsService.prototype.getMarker = function (model, decoration) {\n        var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n        return markerDecorations ? types_1.withUndefinedAsNull(markerDecorations.getMarker(decoration)) : null;\n    };\n    MarkerDecorationsService.prototype.getLiveMarkers = function (model) {\n        var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n        return markerDecorations ? markerDecorations.getMarkers() : [];\n    };\n    MarkerDecorationsService.prototype._handleMarkerChange = function (changedResources) {\n        var _this = this;\n        changedResources.forEach(function (resource) {\n            var markerDecorations = _this._markerDecorations.get(MODEL_ID(resource));\n            if (markerDecorations) {\n                _this._updateDecorations(markerDecorations);\n            }\n        });\n    };\n    MarkerDecorationsService.prototype._onModelAdded = function (model) {\n        var markerDecorations = new MarkerDecorations(model);\n        this._markerDecorations.set(MODEL_ID(model.uri), markerDecorations);\n        this._updateDecorations(markerDecorations);\n    };\n    MarkerDecorationsService.prototype._onModelRemoved = function (model) {\n        var _this = this;\n        var markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n        if (markerDecorations) {\n            markerDecorations.dispose();\n            this._markerDecorations.delete(MODEL_ID(model.uri));\n        }\n        // clean up markers for internal, transient models\n        if (model.uri.scheme === network_1.Schemas.inMemory\n            || model.uri.scheme === network_1.Schemas.internal\n            || model.uri.scheme === network_1.Schemas.vscode) {\n            if (this._markerService) {\n                this._markerService.read({ resource: model.uri }).map(function (marker) { return marker.owner; }).forEach(function (owner) { return _this._markerService.remove(owner, [model.uri]); });\n            }\n        }\n    };\n    MarkerDecorationsService.prototype._updateDecorations = function (markerDecorations) {\n        var _this = this;\n        // Limit to the first 500 errors/warnings\n        var markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\n        var newModelDecorations = markers.map(function (marker) {\n            return {\n                range: _this._createDecorationRange(markerDecorations.model, marker),\n                options: _this._createDecorationOption(marker)\n            };\n        });\n        markerDecorations.update(markers, newModelDecorations);\n        this._onDidChangeMarker.fire(markerDecorations.model);\n    };\n    MarkerDecorationsService.prototype._createDecorationRange = function (model, rawMarker) {\n        var ret = range_1.Range.lift(rawMarker);\n        if (rawMarker.severity === markers_1.MarkerSeverity.Hint) {\n            if (!rawMarker.tags || rawMarker.tags.indexOf(markers_1.MarkerTag.Unnecessary) === -1) {\n                // * never render hints on multiple lines\n                // * make enough space for three dots\n                ret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n            }\n        }\n        ret = model.validateRange(ret);\n        if (ret.isEmpty()) {\n            var word = model.getWordAtPosition(ret.getStartPosition());\n            if (word) {\n                ret = new range_1.Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n            }\n            else {\n                var maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\n                    model.getLineMaxColumn(ret.startLineNumber);\n                if (maxColumn === 1) {\n                    // empty line\n                    // console.warn('marker on empty line:', marker);\n                }\n                else if (ret.endColumn >= maxColumn) {\n                    // behind eol\n                    ret = new range_1.Range(ret.startLineNumber, maxColumn - 1, ret.endLineNumber, maxColumn);\n                }\n                else {\n                    // extend marker to width = 1\n                    ret = new range_1.Range(ret.startLineNumber, ret.startColumn, ret.endLineNumber, ret.endColumn + 1);\n                }\n            }\n        }\n        else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n            var minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n            if (minColumn < ret.endColumn) {\n                ret = new range_1.Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n                rawMarker.startColumn = minColumn;\n            }\n        }\n        return ret;\n    };\n    MarkerDecorationsService.prototype._createDecorationOption = function (marker) {\n        var className;\n        var color = undefined;\n        var zIndex;\n        var inlineClassName = undefined;\n        switch (marker.severity) {\n            case markers_1.MarkerSeverity.Hint:\n                if (marker.tags && marker.tags.indexOf(markers_1.MarkerTag.Unnecessary) >= 0) {\n                    className = intervalTree_1.ClassName.EditorUnnecessaryDecoration;\n                }\n                else {\n                    className = intervalTree_1.ClassName.EditorHintDecoration;\n                }\n                zIndex = 0;\n                break;\n            case markers_1.MarkerSeverity.Warning:\n                className = intervalTree_1.ClassName.EditorWarningDecoration;\n                color = themeService_1.themeColorFromId(editorColorRegistry_1.overviewRulerWarning);\n                zIndex = 20;\n                break;\n            case markers_1.MarkerSeverity.Info:\n                className = intervalTree_1.ClassName.EditorInfoDecoration;\n                color = themeService_1.themeColorFromId(editorColorRegistry_1.overviewRulerInfo);\n                zIndex = 10;\n                break;\n            case markers_1.MarkerSeverity.Error:\n            default:\n                className = intervalTree_1.ClassName.EditorErrorDecoration;\n                color = themeService_1.themeColorFromId(editorColorRegistry_1.overviewRulerError);\n                zIndex = 30;\n                break;\n        }\n        if (marker.tags) {\n            if (marker.tags.indexOf(markers_1.MarkerTag.Unnecessary) !== -1) {\n                inlineClassName = intervalTree_1.ClassName.EditorUnnecessaryInlineDecoration;\n            }\n        }\n        return {\n            stickiness: model_1.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n            className: className,\n            showIfCollapsed: true,\n            overviewRuler: {\n                color: color,\n                position: model_1.OverviewRulerLane.Right\n            },\n            zIndex: zIndex,\n            inlineClassName: inlineClassName,\n        };\n    };\n    MarkerDecorationsService = tslib_1.__decorate([\n        tslib_1.__param(0, modelService_1.IModelService),\n        tslib_1.__param(1, markers_1.IMarkerService)\n    ], MarkerDecorationsService);\n    return MarkerDecorationsService;\n}(lifecycle_1.Disposable));\nexports.MarkerDecorationsService = MarkerDecorationsService;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/common/services/markerDecorationsServiceImpl.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/common/services/markerDecorationsServiceImpl.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IMarkerService, IMarker, MarkerSeverity, MarkerTag } from 'vs/platform/markers/common/markers';\nimport { Disposable, toDisposable } from 'vs/base/common/lifecycle';\nimport { URI } from 'vs/base/common/uri';\nimport { IModelDeltaDecoration, ITextModel, IModelDecorationOptions, TrackedRangeStickiness, OverviewRulerLane, IModelDecoration } from 'vs/editor/common/model';\nimport { ClassName } from 'vs/editor/common/model/intervalTree';\nimport { themeColorFromId, ThemeColor } from 'vs/platform/theme/common/themeService';\nimport { overviewRulerWarning, overviewRulerInfo, overviewRulerError } from 'vs/editor/common/view/editorColorRegistry';\nimport { IModelService } from 'vs/editor/common/services/modelService';\nimport { Range } from 'vs/editor/common/core/range';\nimport { keys } from 'vs/base/common/map';\nimport { IMarkerDecorationsService } from 'vs/editor/common/services/markersDecorationService';\nimport { Schemas } from 'vs/base/common/network';\nimport { Emitter, Event } from 'vs/base/common/event';\nimport { withUndefinedAsNull } from 'vs/base/common/types';\n\nfunction MODEL_ID(resource: URI): string {\n\treturn resource.toString();\n}\n\nclass MarkerDecorations extends Disposable {\n\n\tprivate readonly _markersData: Map<string, IMarker> = new Map<string, IMarker>();\n\n\tconstructor(\n\t\treadonly model: ITextModel\n\t) {\n\t\tsuper();\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.model.deltaDecorations(keys(this._markersData), []);\n\t\t\tthis._markersData.clear();\n\t\t}));\n\t}\n\n\tpublic update(markers: IMarker[], newDecorations: IModelDeltaDecoration[]): void {\n\t\tconst ids = this.model.deltaDecorations(keys(this._markersData), newDecorations);\n\t\tfor (let index = 0; index < ids.length; index++) {\n\t\t\tthis._markersData.set(ids[index], markers[index]);\n\t\t}\n\t}\n\n\tgetMarker(decoration: IModelDecoration): IMarker | undefined {\n\t\treturn this._markersData.get(decoration.id);\n\t}\n\n\tgetMarkers(): [Range, IMarker][] {\n\t\tconst res: [Range, IMarker][] = [];\n\t\tthis._markersData.forEach((marker, id) => {\n\t\t\tlet range = this.model.getDecorationRange(id);\n\t\t\tif (range) {\n\t\t\t\tres.push([range, marker]);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t}\n}\n\nexport class MarkerDecorationsService extends Disposable implements IMarkerDecorationsService {\n\n\t_serviceBrand: any;\n\n\tprivate readonly _onDidChangeMarker = new Emitter<ITextModel>();\n\treadonly onDidChangeMarker: Event<ITextModel> = this._onDidChangeMarker.event;\n\n\tprivate readonly _markerDecorations: Map<string, MarkerDecorations> = new Map<string, MarkerDecorations>();\n\n\tconstructor(\n\t\t@IModelService modelService: IModelService,\n\t\t@IMarkerService private readonly _markerService: IMarkerService\n\t) {\n\t\tsuper();\n\t\tmodelService.getModels().forEach(model => this._onModelAdded(model));\n\t\tthis._register(modelService.onModelAdded(this._onModelAdded, this));\n\t\tthis._register(modelService.onModelRemoved(this._onModelRemoved, this));\n\t\tthis._register(this._markerService.onMarkerChanged(this._handleMarkerChange, this));\n\t}\n\n\tgetMarker(model: ITextModel, decoration: IModelDecoration): IMarker | null {\n\t\tconst markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n\t\treturn markerDecorations ? withUndefinedAsNull(markerDecorations.getMarker(decoration)) : null;\n\t}\n\n\tgetLiveMarkers(model: ITextModel): [Range, IMarker][] {\n\t\tconst markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n\t\treturn markerDecorations ? markerDecorations.getMarkers() : [];\n\t}\n\n\tprivate _handleMarkerChange(changedResources: URI[]): void {\n\t\tchangedResources.forEach((resource) => {\n\t\t\tconst markerDecorations = this._markerDecorations.get(MODEL_ID(resource));\n\t\t\tif (markerDecorations) {\n\t\t\t\tthis._updateDecorations(markerDecorations);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _onModelAdded(model: ITextModel): void {\n\t\tconst markerDecorations = new MarkerDecorations(model);\n\t\tthis._markerDecorations.set(MODEL_ID(model.uri), markerDecorations);\n\t\tthis._updateDecorations(markerDecorations);\n\t}\n\n\tprivate _onModelRemoved(model: ITextModel): void {\n\t\tconst markerDecorations = this._markerDecorations.get(MODEL_ID(model.uri));\n\t\tif (markerDecorations) {\n\t\t\tmarkerDecorations.dispose();\n\t\t\tthis._markerDecorations.delete(MODEL_ID(model.uri));\n\t\t}\n\n\t\t// clean up markers for internal, transient models\n\t\tif (model.uri.scheme === Schemas.inMemory\n\t\t\t|| model.uri.scheme === Schemas.internal\n\t\t\t|| model.uri.scheme === Schemas.vscode) {\n\t\t\tif (this._markerService) {\n\t\t\t\tthis._markerService.read({ resource: model.uri }).map(marker => marker.owner).forEach(owner => this._markerService.remove(owner, [model.uri]));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateDecorations(markerDecorations: MarkerDecorations): void {\n\t\t// Limit to the first 500 errors/warnings\n\t\tconst markers = this._markerService.read({ resource: markerDecorations.model.uri, take: 500 });\n\t\tlet newModelDecorations: IModelDeltaDecoration[] = markers.map((marker) => {\n\t\t\treturn {\n\t\t\t\trange: this._createDecorationRange(markerDecorations.model, marker),\n\t\t\t\toptions: this._createDecorationOption(marker)\n\t\t\t};\n\t\t});\n\t\tmarkerDecorations.update(markers, newModelDecorations);\n\t\tthis._onDidChangeMarker.fire(markerDecorations.model);\n\t}\n\n\tprivate _createDecorationRange(model: ITextModel, rawMarker: IMarker): Range {\n\n\t\tlet ret = Range.lift(rawMarker);\n\n\t\tif (rawMarker.severity === MarkerSeverity.Hint) {\n\t\t\tif (!rawMarker.tags || rawMarker.tags.indexOf(MarkerTag.Unnecessary) === -1) {\n\t\t\t\t// * never render hints on multiple lines\n\t\t\t\t// * make enough space for three dots\n\t\t\t\tret = ret.setEndPosition(ret.startLineNumber, ret.startColumn + 2);\n\t\t\t}\n\t\t}\n\n\t\tret = model.validateRange(ret);\n\n\t\tif (ret.isEmpty()) {\n\t\t\tlet word = model.getWordAtPosition(ret.getStartPosition());\n\t\t\tif (word) {\n\t\t\t\tret = new Range(ret.startLineNumber, word.startColumn, ret.endLineNumber, word.endColumn);\n\t\t\t} else {\n\t\t\t\tlet maxColumn = model.getLineLastNonWhitespaceColumn(ret.startLineNumber) ||\n\t\t\t\t\tmodel.getLineMaxColumn(ret.startLineNumber);\n\n\t\t\t\tif (maxColumn === 1) {\n\t\t\t\t\t// empty line\n\t\t\t\t\t// console.warn('marker on empty line:', marker);\n\t\t\t\t} else if (ret.endColumn >= maxColumn) {\n\t\t\t\t\t// behind eol\n\t\t\t\t\tret = new Range(ret.startLineNumber, maxColumn - 1, ret.endLineNumber, maxColumn);\n\t\t\t\t} else {\n\t\t\t\t\t// extend marker to width = 1\n\t\t\t\t\tret = new Range(ret.startLineNumber, ret.startColumn, ret.endLineNumber, ret.endColumn + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (rawMarker.endColumn === Number.MAX_VALUE && rawMarker.startColumn === 1 && ret.startLineNumber === ret.endLineNumber) {\n\t\t\tlet minColumn = model.getLineFirstNonWhitespaceColumn(rawMarker.startLineNumber);\n\t\t\tif (minColumn < ret.endColumn) {\n\t\t\t\tret = new Range(ret.startLineNumber, minColumn, ret.endLineNumber, ret.endColumn);\n\t\t\t\trawMarker.startColumn = minColumn;\n\t\t\t}\n\t\t}\n\t\treturn ret;\n\t}\n\n\tprivate _createDecorationOption(marker: IMarker): IModelDecorationOptions {\n\n\t\tlet className: string;\n\t\tlet color: ThemeColor | undefined = undefined;\n\t\tlet zIndex: number;\n\t\tlet inlineClassName: string | undefined = undefined;\n\n\t\tswitch (marker.severity) {\n\t\t\tcase MarkerSeverity.Hint:\n\t\t\t\tif (marker.tags && marker.tags.indexOf(MarkerTag.Unnecessary) >= 0) {\n\t\t\t\t\tclassName = ClassName.EditorUnnecessaryDecoration;\n\t\t\t\t} else {\n\t\t\t\t\tclassName = ClassName.EditorHintDecoration;\n\t\t\t\t}\n\t\t\t\tzIndex = 0;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Warning:\n\t\t\t\tclassName = ClassName.EditorWarningDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerWarning);\n\t\t\t\tzIndex = 20;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Info:\n\t\t\t\tclassName = ClassName.EditorInfoDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerInfo);\n\t\t\t\tzIndex = 10;\n\t\t\t\tbreak;\n\t\t\tcase MarkerSeverity.Error:\n\t\t\tdefault:\n\t\t\t\tclassName = ClassName.EditorErrorDecoration;\n\t\t\t\tcolor = themeColorFromId(overviewRulerError);\n\t\t\t\tzIndex = 30;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (marker.tags) {\n\t\t\tif (marker.tags.indexOf(MarkerTag.Unnecessary) !== -1) {\n\t\t\t\tinlineClassName = ClassName.EditorUnnecessaryInlineDecoration;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\t\tclassName,\n\t\t\tshowIfCollapsed: true,\n\t\t\toverviewRuler: {\n\t\t\t\tcolor,\n\t\t\t\tposition: OverviewRulerLane.Right\n\t\t\t},\n\t\t\tzIndex,\n\t\t\tinlineClassName,\n\t\t};\n\t}\n}\n"]}]}