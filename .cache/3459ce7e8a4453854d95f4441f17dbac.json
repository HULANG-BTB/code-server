{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesTree.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesTree.ts","mtime":1555102317000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar referencesModel_1 = require(\"./referencesModel\");\nvar resolverService_1 = require(\"vs/editor/common/services/resolverService\");\nvar iconLabel_1 = require(\"vs/base/browser/ui/iconLabel/iconLabel\");\nvar countBadge_1 = require(\"vs/base/browser/ui/countBadge/countBadge\");\nvar label_1 = require(\"vs/platform/label/common/label\");\nvar themeService_1 = require(\"vs/platform/theme/common/themeService\");\nvar styler_1 = require(\"vs/platform/theme/common/styler\");\nvar dom = require(\"vs/base/browser/dom\");\nvar nls_1 = require(\"vs/nls\");\nvar labels_1 = require(\"vs/base/common/labels\");\nvar resources_1 = require(\"vs/base/common/resources\");\nvar strings_1 = require(\"vs/base/common/strings\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar instantiation_1 = require(\"vs/platform/instantiation/common/instantiation\");\nvar keybinding_1 = require(\"vs/platform/keybinding/common/keybinding\");\nvar filters_1 = require(\"vs/base/common/filters\");\nvar DataSource = /** @class */ (function () {\n    function DataSource(_resolverService) {\n        this._resolverService = _resolverService;\n    }\n    DataSource.prototype.hasChildren = function (element) {\n        if (element instanceof referencesModel_1.ReferencesModel) {\n            return true;\n        }\n        if (element instanceof referencesModel_1.FileReferences && !element.failure) {\n            return true;\n        }\n        return false;\n    };\n    DataSource.prototype.getChildren = function (element) {\n        if (element instanceof referencesModel_1.ReferencesModel) {\n            return element.groups;\n        }\n        if (element instanceof referencesModel_1.FileReferences) {\n            return element.resolve(this._resolverService).then(function (val) {\n                // if (element.failure) {\n                // \t// refresh the element on failure so that\n                // \t// we can update its rendering\n                // \treturn tree.refresh(element).then(() => val.children);\n                // }\n                return val.children;\n            });\n        }\n        throw new Error('bad tree');\n    };\n    DataSource = tslib_1.__decorate([\n        tslib_1.__param(0, resolverService_1.ITextModelService)\n    ], DataSource);\n    return DataSource;\n}());\nexports.DataSource = DataSource;\n//#endregion\nvar Delegate = /** @class */ (function () {\n    function Delegate() {\n    }\n    Delegate.prototype.getHeight = function () {\n        return 23;\n    };\n    Delegate.prototype.getTemplateId = function (element) {\n        if (element instanceof referencesModel_1.FileReferences) {\n            return FileReferencesRenderer.id;\n        }\n        else {\n            return OneReferenceRenderer.id;\n        }\n    };\n    return Delegate;\n}());\nexports.Delegate = Delegate;\nvar StringRepresentationProvider = /** @class */ (function () {\n    function StringRepresentationProvider(_keybindingService) {\n        this._keybindingService = _keybindingService;\n    }\n    StringRepresentationProvider.prototype.getKeyboardNavigationLabel = function (element) {\n        // todo@joao `OneReference` elements are lazy and their \"real\" label\n        // isn't known yet\n        return resources_1.basename(element.uri);\n    };\n    StringRepresentationProvider.prototype.mightProducePrintableCharacter = function (event) {\n        return this._keybindingService.mightProducePrintableCharacter(event);\n    };\n    StringRepresentationProvider = tslib_1.__decorate([\n        tslib_1.__param(0, keybinding_1.IKeybindingService)\n    ], StringRepresentationProvider);\n    return StringRepresentationProvider;\n}());\nexports.StringRepresentationProvider = StringRepresentationProvider;\nvar IdentityProvider = /** @class */ (function () {\n    function IdentityProvider() {\n    }\n    IdentityProvider.prototype.getId = function (element) {\n        return element.id;\n    };\n    return IdentityProvider;\n}());\nexports.IdentityProvider = IdentityProvider;\n//#region render: File\nvar FileReferencesTemplate = /** @class */ (function (_super) {\n    tslib_1.__extends(FileReferencesTemplate, _super);\n    function FileReferencesTemplate(container, _uriLabel, themeService) {\n        var _this = _super.call(this) || this;\n        _this._uriLabel = _uriLabel;\n        var parent = document.createElement('div');\n        dom.addClass(parent, 'reference-file');\n        _this.file = _this._register(new iconLabel_1.IconLabel(parent, { supportHighlights: true }));\n        _this.badge = new countBadge_1.CountBadge(dom.append(parent, dom.$('.count')));\n        _this._register(styler_1.attachBadgeStyler(_this.badge, themeService));\n        container.appendChild(parent);\n        return _this;\n    }\n    FileReferencesTemplate.prototype.set = function (element, matches) {\n        var parent = resources_1.dirname(element.uri);\n        this.file.setLabel(labels_1.getBaseLabel(element.uri), this._uriLabel.getUriLabel(parent, { relative: true }), { title: this._uriLabel.getUriLabel(element.uri), matches: matches });\n        var len = element.children.length;\n        this.badge.setCount(len);\n        if (element.failure) {\n            this.badge.setTitleFormat(nls_1.localize('referencesFailre', \"Failed to resolve file.\"));\n        }\n        else if (len > 1) {\n            this.badge.setTitleFormat(nls_1.localize('referencesCount', \"{0} references\", len));\n        }\n        else {\n            this.badge.setTitleFormat(nls_1.localize('referenceCount', \"{0} reference\", len));\n        }\n    };\n    FileReferencesTemplate = tslib_1.__decorate([\n        tslib_1.__param(1, label_1.ILabelService),\n        tslib_1.__param(2, themeService_1.IThemeService)\n    ], FileReferencesTemplate);\n    return FileReferencesTemplate;\n}(lifecycle_1.Disposable));\nvar FileReferencesRenderer = /** @class */ (function () {\n    function FileReferencesRenderer(_instantiationService) {\n        this._instantiationService = _instantiationService;\n        this.templateId = FileReferencesRenderer.id;\n    }\n    FileReferencesRenderer.prototype.renderTemplate = function (container) {\n        return this._instantiationService.createInstance(FileReferencesTemplate, container);\n    };\n    FileReferencesRenderer.prototype.renderElement = function (node, index, template) {\n        template.set(node.element, filters_1.createMatches(node.filterData));\n    };\n    FileReferencesRenderer.prototype.disposeTemplate = function (templateData) {\n        templateData.dispose();\n    };\n    FileReferencesRenderer.id = 'FileReferencesRenderer';\n    FileReferencesRenderer = tslib_1.__decorate([\n        tslib_1.__param(0, instantiation_1.IInstantiationService)\n    ], FileReferencesRenderer);\n    return FileReferencesRenderer;\n}());\nexports.FileReferencesRenderer = FileReferencesRenderer;\n//#endregion\n//#region render: Reference\nvar OneReferenceTemplate = /** @class */ (function () {\n    function OneReferenceTemplate(container) {\n        var parent = document.createElement('div');\n        this.before = document.createElement('span');\n        this.inside = document.createElement('span');\n        this.after = document.createElement('span');\n        dom.addClass(this.inside, 'referenceMatch');\n        dom.addClass(parent, 'reference');\n        parent.appendChild(this.before);\n        parent.appendChild(this.inside);\n        parent.appendChild(this.after);\n        container.appendChild(parent);\n    }\n    OneReferenceTemplate.prototype.set = function (element) {\n        var filePreview = element.parent.preview;\n        var preview = filePreview && filePreview.preview(element.range);\n        if (preview) {\n            var before = preview.before, inside = preview.inside, after = preview.after;\n            this.before.innerHTML = strings_1.escape(before);\n            this.inside.innerHTML = strings_1.escape(inside);\n            this.after.innerHTML = strings_1.escape(after);\n        }\n    };\n    return OneReferenceTemplate;\n}());\nvar OneReferenceRenderer = /** @class */ (function () {\n    function OneReferenceRenderer() {\n        this.templateId = OneReferenceRenderer.id;\n    }\n    OneReferenceRenderer.prototype.renderTemplate = function (container) {\n        return new OneReferenceTemplate(container);\n    };\n    OneReferenceRenderer.prototype.renderElement = function (element, index, templateData) {\n        templateData.set(element.element);\n    };\n    OneReferenceRenderer.prototype.disposeTemplate = function () {\n        //\n    };\n    OneReferenceRenderer.id = 'OneReferenceRenderer';\n    return OneReferenceRenderer;\n}());\nexports.OneReferenceRenderer = OneReferenceRenderer;\n//#endregion\nvar AriaProvider = /** @class */ (function () {\n    function AriaProvider() {\n    }\n    AriaProvider.prototype.getAriaLabel = function (element) {\n        if (element instanceof referencesModel_1.FileReferences) {\n            return element.getAriaMessage();\n        }\n        else if (element instanceof referencesModel_1.OneReference) {\n            return element.getAriaMessage();\n        }\n        else {\n            return null;\n        }\n    };\n    return AriaProvider;\n}());\nexports.AriaProvider = AriaProvider;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesTree.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/editor/contrib/referenceSearch/referencesTree.ts"],"names":[],"mappings":";AAAA;;;gGAGgG;;;AAEhG,qDAAkF;AAClF,6EAA8E;AAE9E,oEAAmE;AACnE,uEAAsE;AACtE,wDAA+D;AAC/D,sEAAsE;AACtE,0DAAoE;AACpE,yCAA2C;AAC3C,8BAAkC;AAClC,gDAAqD;AACrD,sDAA6D;AAC7D,kDAAgD;AAChD,sDAAsD;AACtD,gFAAuF;AAIvF,uEAA8E;AAC9E,kDAA2E;AAM3E;IAEC,oBAAgD,gBAAmC;QAAnC,qBAAgB,GAAhB,gBAAgB,CAAmB;IAAI,CAAC;IAExF,gCAAW,GAAX,UAAY,OAAuD;QAClE,IAAI,OAAO,YAAY,iCAAe,EAAE;YACvC,OAAO,IAAI,CAAC;SACZ;QACD,IAAI,OAAO,YAAY,gCAAc,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;YAC1D,OAAO,IAAI,CAAC;SACZ;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAED,gCAAW,GAAX,UAAY,OAAuD;QAClE,IAAI,OAAO,YAAY,iCAAe,EAAE;YACvC,OAAO,OAAO,CAAC,MAAM,CAAC;SACtB;QAED,IAAI,OAAO,YAAY,gCAAc,EAAE;YACtC,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,UAAA,GAAG;gBACrD,yBAAyB;gBACzB,6CAA6C;gBAC7C,kCAAkC;gBAClC,0DAA0D;gBAC1D,IAAI;gBACJ,OAAO,GAAG,CAAC,QAAQ,CAAC;YACrB,CAAC,CAAC,CAAC;SACH;QAED,MAAM,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC;IAC7B,CAAC;IA/BW,UAAU;QAET,mBAAA,mCAAiB,CAAA;OAFlB,UAAU,CAgCtB;IAAD,iBAAC;CAAA,AAhCD,IAgCC;AAhCY,gCAAU;AAkCvB,YAAY;AAEZ;IAAA;IAWA,CAAC;IAVA,4BAAS,GAAT;QACC,OAAO,EAAE,CAAC;IACX,CAAC;IACD,gCAAa,GAAb,UAAc,OAAsC;QACnD,IAAI,OAAO,YAAY,gCAAc,EAAE;YACtC,OAAO,sBAAsB,CAAC,EAAE,CAAC;SACjC;aAAM;YACN,OAAO,oBAAoB,CAAC,EAAE,CAAC;SAC/B;IACF,CAAC;IACF,eAAC;AAAD,CAAC,AAXD,IAWC;AAXY,4BAAQ;AAarB;IAEC,sCAAiD,kBAAsC;QAAtC,uBAAkB,GAAlB,kBAAkB,CAAoB;IAAI,CAAC;IAE5F,iEAA0B,GAA1B,UAA2B,OAAoB;QAC9C,oEAAoE;QACpE,kBAAkB;QAClB,OAAO,oBAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC9B,CAAC;IAED,qEAA8B,GAA9B,UAA+B,KAAqB;QACnD,OAAO,IAAI,CAAC,kBAAkB,CAAC,8BAA8B,CAAC,KAAK,CAAC,CAAC;IACtE,CAAC;IAZW,4BAA4B;QAE3B,mBAAA,+BAAkB,CAAA;OAFnB,4BAA4B,CAaxC;IAAD,mCAAC;CAAA,AAbD,IAaC;AAbY,oEAA4B;AAezC;IAAA;IAKA,CAAC;IAHA,gCAAK,GAAL,UAAM,OAAoB;QACzB,OAAO,OAAO,CAAC,EAAE,CAAC;IACnB,CAAC;IACF,uBAAC;AAAD,CAAC,AALD,IAKC;AALY,4CAAgB;AAO7B,sBAAsB;AAEtB;IAAqC,kDAAU;IAK9C,gCACC,SAAsB,EACU,SAAwB,EACzC,YAA2B;QAH3C,YAKC,iBAAO,SASP;QAZgC,eAAS,GAAT,SAAS,CAAe;QAIxD,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;QACvC,KAAI,CAAC,IAAI,GAAG,KAAI,CAAC,SAAS,CAAC,IAAI,qBAAS,CAAC,MAAM,EAAE,EAAE,iBAAiB,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAE/E,KAAI,CAAC,KAAK,GAAG,IAAI,uBAAU,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QACjE,KAAI,CAAC,SAAS,CAAC,0BAAiB,CAAC,KAAI,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC,CAAC;QAE5D,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;;IAC/B,CAAC;IAED,oCAAG,GAAH,UAAI,OAAuB,EAAE,OAAiB;QAC7C,IAAI,MAAM,GAAG,mBAAO,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,qBAAY,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,OAAO,SAAA,EAAE,CAAC,CAAC;QACnK,IAAM,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC;QACpC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;QACzB,IAAI,OAAO,CAAC,OAAO,EAAE;YACpB,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,cAAQ,CAAC,kBAAkB,EAAE,yBAAyB,CAAC,CAAC,CAAC;SACnF;aAAM,IAAI,GAAG,GAAG,CAAC,EAAE;YACnB,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,cAAQ,CAAC,iBAAiB,EAAE,gBAAgB,EAAE,GAAG,CAAC,CAAC,CAAC;SAC9E;aAAM;YACN,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,cAAQ,CAAC,gBAAgB,EAAE,eAAe,EAAE,GAAG,CAAC,CAAC,CAAC;SAC5E;IACF,CAAC;IAjCI,sBAAsB;QAOzB,mBAAA,qBAAa,CAAA;QACb,mBAAA,4BAAa,CAAA;OARV,sBAAsB,CAkC3B;IAAD,6BAAC;CAAA,AAlCD,CAAqC,sBAAU,GAkC9C;AAED;IAMC,gCAAoD,qBAA4C;QAA5C,0BAAqB,GAArB,qBAAqB,CAAuB;QAFvF,eAAU,GAAW,sBAAsB,CAAC,EAAE,CAAC;IAE4C,CAAC;IAErG,+CAAc,GAAd,UAAe,SAAsB;QACpC,OAAO,IAAI,CAAC,qBAAqB,CAAC,cAAc,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;IACrF,CAAC;IACD,8CAAa,GAAb,UAAc,IAA2C,EAAE,KAAa,EAAE,QAAgC;QACzG,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,EAAE,uBAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;IAC5D,CAAC;IACD,gDAAe,GAAf,UAAgB,YAAoC;QACnD,YAAY,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;IAde,yBAAE,GAAG,wBAAwB,CAAC;IAFlC,sBAAsB;QAMrB,mBAAA,qCAAqB,CAAA;OANtB,sBAAsB,CAiBlC;IAAD,6BAAC;CAAA,AAjBD,IAiBC;AAjBY,wDAAsB;AAmBnC,YAAY;AAEZ,2BAA2B;AAC3B;IAMC,8BAAY,SAAsB;QACjC,IAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC5C,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,gBAAgB,CAAC,CAAC;QAC5C,GAAG,CAAC,QAAQ,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;QAClC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC/B,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAED,kCAAG,GAAH,UAAI,OAAqB;QACxB,IAAM,WAAW,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC;QAC3C,IAAM,OAAO,GAAG,WAAW,IAAI,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAClE,IAAI,OAAO,EAAE;YACJ,IAAA,uBAAM,EAAE,uBAAM,EAAE,qBAAK,CAAa;YAC1C,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,gBAAM,CAAC,MAAM,CAAC,CAAC;YACvC,IAAI,CAAC,MAAM,CAAC,SAAS,GAAG,gBAAM,CAAC,MAAM,CAAC,CAAC;YACvC,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,gBAAM,CAAC,KAAK,CAAC,CAAC;SACrC;IACF,CAAC;IACF,2BAAC;AAAD,CAAC,AA7BD,IA6BC;AAED;IAAA;QAIU,eAAU,GAAW,oBAAoB,CAAC,EAAE,CAAC;IAWvD,CAAC;IATA,6CAAc,GAAd,UAAe,SAAsB;QACpC,OAAO,IAAI,oBAAoB,CAAC,SAAS,CAAC,CAAC;IAC5C,CAAC;IACD,4CAAa,GAAb,UAAc,OAA4C,EAAE,KAAa,EAAE,YAAkC;QAC5G,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACnC,CAAC;IACD,8CAAe,GAAf;QACC,EAAE;IACH,CAAC;IAZe,uBAAE,GAAG,sBAAsB,CAAC;IAa7C,2BAAC;CAAA,AAfD,IAeC;AAfY,oDAAoB;AAiBjC,YAAY;AAGZ;IAAA;IAWA,CAAC;IATA,mCAAY,GAAZ,UAAa,OAAsC;QAClD,IAAI,OAAO,YAAY,gCAAc,EAAE;YACtC,OAAO,OAAO,CAAC,cAAc,EAAE,CAAC;SAChC;aAAM,IAAI,OAAO,YAAY,8BAAY,EAAE;YAC3C,OAAO,OAAO,CAAC,cAAc,EAAE,CAAC;SAChC;aAAM;YACN,OAAO,IAAI,CAAC;SACZ;IACF,CAAC;IACF,mBAAC;AAAD,CAAC,AAXD,IAWC;AAXY,oCAAY","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ReferencesModel, FileReferences, OneReference } from './referencesModel';\nimport { ITextModelService } from 'vs/editor/common/services/resolverService';\nimport { ITreeRenderer, ITreeNode, IAsyncDataSource } from 'vs/base/browser/ui/tree/tree';\nimport { IconLabel } from 'vs/base/browser/ui/iconLabel/iconLabel';\nimport { CountBadge } from 'vs/base/browser/ui/countBadge/countBadge';\nimport { ILabelService } from 'vs/platform/label/common/label';\nimport { IThemeService } from 'vs/platform/theme/common/themeService';\nimport { attachBadgeStyler } from 'vs/platform/theme/common/styler';\nimport * as dom from 'vs/base/browser/dom';\nimport { localize } from 'vs/nls';\nimport { getBaseLabel } from 'vs/base/common/labels';\nimport { dirname, basename } from 'vs/base/common/resources';\nimport { escape } from 'vs/base/common/strings';\nimport { Disposable } from 'vs/base/common/lifecycle';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IAccessibilityProvider } from 'vs/base/browser/ui/list/listWidget';\nimport { IListVirtualDelegate, IKeyboardNavigationLabelProvider, IIdentityProvider } from 'vs/base/browser/ui/list/list';\nimport { IKeyboardEvent } from 'vs/base/browser/keyboardEvent';\nimport { IKeybindingService } from 'vs/platform/keybinding/common/keybinding';\nimport { FuzzyScore, createMatches, IMatch } from 'vs/base/common/filters';\n\n//#region data source\n\nexport type TreeElement = FileReferences | OneReference;\n\nexport class DataSource implements IAsyncDataSource<ReferencesModel | FileReferences, TreeElement> {\n\n\tconstructor(@ITextModelService private readonly _resolverService: ITextModelService) { }\n\n\thasChildren(element: ReferencesModel | FileReferences | TreeElement): boolean {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn true;\n\t\t}\n\t\tif (element instanceof FileReferences && !element.failure) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetChildren(element: ReferencesModel | FileReferences | TreeElement): TreeElement[] | Promise<TreeElement[]> {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn element.groups;\n\t\t}\n\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn element.resolve(this._resolverService).then(val => {\n\t\t\t\t// if (element.failure) {\n\t\t\t\t// \t// refresh the element on failure so that\n\t\t\t\t// \t// we can update its rendering\n\t\t\t\t// \treturn tree.refresh(element).then(() => val.children);\n\t\t\t\t// }\n\t\t\t\treturn val.children;\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error('bad tree');\n\t}\n}\n\n//#endregion\n\nexport class Delegate implements IListVirtualDelegate<TreeElement> {\n\tgetHeight(): number {\n\t\treturn 23;\n\t}\n\tgetTemplateId(element: FileReferences | OneReference): string {\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn FileReferencesRenderer.id;\n\t\t} else {\n\t\t\treturn OneReferenceRenderer.id;\n\t\t}\n\t}\n}\n\nexport class StringRepresentationProvider implements IKeyboardNavigationLabelProvider<TreeElement> {\n\n\tconstructor(@IKeybindingService private readonly _keybindingService: IKeybindingService) { }\n\n\tgetKeyboardNavigationLabel(element: TreeElement): { toString(): string; } {\n\t\t// todo@joao `OneReference` elements are lazy and their \"real\" label\n\t\t// isn't known yet\n\t\treturn basename(element.uri);\n\t}\n\n\tmightProducePrintableCharacter(event: IKeyboardEvent): boolean {\n\t\treturn this._keybindingService.mightProducePrintableCharacter(event);\n\t}\n}\n\nexport class IdentityProvider implements IIdentityProvider<TreeElement> {\n\n\tgetId(element: TreeElement): { toString(): string; } {\n\t\treturn element.id;\n\t}\n}\n\n//#region render: File\n\nclass FileReferencesTemplate extends Disposable {\n\n\treadonly file: IconLabel;\n\treadonly badge: CountBadge;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\t@ILabelService private readonly _uriLabel: ILabelService,\n\t\t@IThemeService themeService: IThemeService,\n\t) {\n\t\tsuper();\n\t\tconst parent = document.createElement('div');\n\t\tdom.addClass(parent, 'reference-file');\n\t\tthis.file = this._register(new IconLabel(parent, { supportHighlights: true }));\n\n\t\tthis.badge = new CountBadge(dom.append(parent, dom.$('.count')));\n\t\tthis._register(attachBadgeStyler(this.badge, themeService));\n\n\t\tcontainer.appendChild(parent);\n\t}\n\n\tset(element: FileReferences, matches: IMatch[]) {\n\t\tlet parent = dirname(element.uri);\n\t\tthis.file.setLabel(getBaseLabel(element.uri), this._uriLabel.getUriLabel(parent, { relative: true }), { title: this._uriLabel.getUriLabel(element.uri), matches });\n\t\tconst len = element.children.length;\n\t\tthis.badge.setCount(len);\n\t\tif (element.failure) {\n\t\t\tthis.badge.setTitleFormat(localize('referencesFailre', \"Failed to resolve file.\"));\n\t\t} else if (len > 1) {\n\t\t\tthis.badge.setTitleFormat(localize('referencesCount', \"{0} references\", len));\n\t\t} else {\n\t\t\tthis.badge.setTitleFormat(localize('referenceCount', \"{0} reference\", len));\n\t\t}\n\t}\n}\n\nexport class FileReferencesRenderer implements ITreeRenderer<FileReferences, FuzzyScore, FileReferencesTemplate> {\n\n\tstatic readonly id = 'FileReferencesRenderer';\n\n\treadonly templateId: string = FileReferencesRenderer.id;\n\n\tconstructor(@IInstantiationService private readonly _instantiationService: IInstantiationService) { }\n\n\trenderTemplate(container: HTMLElement): FileReferencesTemplate {\n\t\treturn this._instantiationService.createInstance(FileReferencesTemplate, container);\n\t}\n\trenderElement(node: ITreeNode<FileReferences, FuzzyScore>, index: number, template: FileReferencesTemplate): void {\n\t\ttemplate.set(node.element, createMatches(node.filterData));\n\t}\n\tdisposeTemplate(templateData: FileReferencesTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\n//#region render: Reference\nclass OneReferenceTemplate {\n\n\treadonly before: HTMLSpanElement;\n\treadonly inside: HTMLSpanElement;\n\treadonly after: HTMLSpanElement;\n\n\tconstructor(container: HTMLElement) {\n\t\tconst parent = document.createElement('div');\n\t\tthis.before = document.createElement('span');\n\t\tthis.inside = document.createElement('span');\n\t\tthis.after = document.createElement('span');\n\t\tdom.addClass(this.inside, 'referenceMatch');\n\t\tdom.addClass(parent, 'reference');\n\t\tparent.appendChild(this.before);\n\t\tparent.appendChild(this.inside);\n\t\tparent.appendChild(this.after);\n\t\tcontainer.appendChild(parent);\n\t}\n\n\tset(element: OneReference): void {\n\t\tconst filePreview = element.parent.preview;\n\t\tconst preview = filePreview && filePreview.preview(element.range);\n\t\tif (preview) {\n\t\t\tconst { before, inside, after } = preview;\n\t\t\tthis.before.innerHTML = escape(before);\n\t\t\tthis.inside.innerHTML = escape(inside);\n\t\t\tthis.after.innerHTML = escape(after);\n\t\t}\n\t}\n}\n\nexport class OneReferenceRenderer implements ITreeRenderer<OneReference, FuzzyScore, OneReferenceTemplate> {\n\n\tstatic readonly id = 'OneReferenceRenderer';\n\n\treadonly templateId: string = OneReferenceRenderer.id;\n\n\trenderTemplate(container: HTMLElement): OneReferenceTemplate {\n\t\treturn new OneReferenceTemplate(container);\n\t}\n\trenderElement(element: ITreeNode<OneReference, FuzzyScore>, index: number, templateData: OneReferenceTemplate): void {\n\t\ttemplateData.set(element.element);\n\t}\n\tdisposeTemplate(): void {\n\t\t//\n\t}\n}\n\n//#endregion\n\n\nexport class AriaProvider implements IAccessibilityProvider<FileReferences | OneReference> {\n\n\tgetAriaLabel(element: FileReferences | OneReference): string | null {\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn element.getAriaMessage();\n\t\t} else if (element instanceof OneReference) {\n\t\t\treturn element.getAriaMessage();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n"]}]}