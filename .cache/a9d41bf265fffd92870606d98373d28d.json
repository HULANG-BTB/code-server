{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/contextview/contextview.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/contextview/contextview.ts","mtime":1555102316000},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nrequire(\"vs/css!./contextview\");\nvar DOM = require(\"vs/base/browser/dom\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar range_1 = require(\"vs/base/common/range\");\nvar AnchorAlignment;\n(function (AnchorAlignment) {\n    AnchorAlignment[AnchorAlignment[\"LEFT\"] = 0] = \"LEFT\";\n    AnchorAlignment[AnchorAlignment[\"RIGHT\"] = 1] = \"RIGHT\";\n})(AnchorAlignment = exports.AnchorAlignment || (exports.AnchorAlignment = {}));\nvar AnchorPosition;\n(function (AnchorPosition) {\n    AnchorPosition[AnchorPosition[\"BELOW\"] = 0] = \"BELOW\";\n    AnchorPosition[AnchorPosition[\"ABOVE\"] = 1] = \"ABOVE\";\n})(AnchorPosition = exports.AnchorPosition || (exports.AnchorPosition = {}));\nvar LayoutAnchorPosition;\n(function (LayoutAnchorPosition) {\n    LayoutAnchorPosition[LayoutAnchorPosition[\"Before\"] = 0] = \"Before\";\n    LayoutAnchorPosition[LayoutAnchorPosition[\"After\"] = 1] = \"After\";\n})(LayoutAnchorPosition = exports.LayoutAnchorPosition || (exports.LayoutAnchorPosition = {}));\n/**\n * Lays out a one dimensional view next to an anchor in a viewport.\n *\n * @returns The view offset within the viewport.\n */\nfunction layout(viewportSize, viewSize, anchor) {\n    var anchorEnd = anchor.offset + anchor.size;\n    if (anchor.position === LayoutAnchorPosition.Before) {\n        if (viewSize <= viewportSize - anchorEnd) {\n            return anchorEnd; // happy case, lay it out after the anchor\n        }\n        if (viewSize <= anchor.offset) {\n            return anchor.offset - viewSize; // ok case, lay it out before the anchor\n        }\n        return Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\n    }\n    else {\n        if (viewSize <= anchor.offset) {\n            return anchor.offset - viewSize; // happy case, lay it out before the anchor\n        }\n        if (viewSize <= viewportSize - anchorEnd) {\n            return anchorEnd; // ok case, lay it out after the anchor\n        }\n        return 0; // sad case, lay it over the anchor\n    }\n}\nexports.layout = layout;\nvar ContextView = /** @class */ (function (_super) {\n    tslib_1.__extends(ContextView, _super);\n    function ContextView(container) {\n        var _this = _super.call(this) || this;\n        _this.view = DOM.$('.context-view');\n        DOM.hide(_this.view);\n        _this.setContainer(container);\n        _this._register(lifecycle_1.toDisposable(function () { return _this.setContainer(null); }));\n        return _this;\n    }\n    ContextView.prototype.setContainer = function (container) {\n        var _this = this;\n        if (this.container) {\n            this.toDisposeOnSetContainer = lifecycle_1.dispose(this.toDisposeOnSetContainer);\n            this.container.removeChild(this.view);\n            this.container = null;\n        }\n        if (container) {\n            this.container = container;\n            this.container.appendChild(this.view);\n            var toDisposeOnSetContainer_1 = [];\n            ContextView.BUBBLE_UP_EVENTS.forEach(function (event) {\n                toDisposeOnSetContainer_1.push(DOM.addStandardDisposableListener(_this.container, event, function (e) {\n                    _this.onDOMEvent(e, document.activeElement, false);\n                }));\n            });\n            ContextView.BUBBLE_DOWN_EVENTS.forEach(function (event) {\n                toDisposeOnSetContainer_1.push(DOM.addStandardDisposableListener(_this.container, event, function (e) {\n                    _this.onDOMEvent(e, document.activeElement, true);\n                }, true));\n            });\n            this.toDisposeOnSetContainer = lifecycle_1.combinedDisposable(toDisposeOnSetContainer_1);\n        }\n    };\n    ContextView.prototype.show = function (delegate) {\n        if (this.isVisible()) {\n            this.hide();\n        }\n        // Show static box\n        DOM.clearNode(this.view);\n        this.view.className = 'context-view';\n        this.view.style.top = '0px';\n        this.view.style.left = '0px';\n        DOM.show(this.view);\n        // Render content\n        this.toDisposeOnClean = delegate.render(this.view);\n        // Set active delegate\n        this.delegate = delegate;\n        // Layout\n        this.doLayout();\n        // Focus\n        if (this.delegate.focus) {\n            this.delegate.focus();\n        }\n    };\n    ContextView.prototype.layout = function () {\n        if (!this.isVisible()) {\n            return;\n        }\n        if (this.delegate.canRelayout === false) {\n            this.hide();\n            return;\n        }\n        if (this.delegate.layout) {\n            this.delegate.layout();\n        }\n        this.doLayout();\n    };\n    ContextView.prototype.doLayout = function () {\n        // Check that we still have a delegate - this.delegate.layout may have hidden\n        if (!this.isVisible()) {\n            return;\n        }\n        // Get anchor\n        var anchor = this.delegate.getAnchor();\n        // Compute around\n        var around;\n        // Get the element's position and size (to anchor the view)\n        if (DOM.isHTMLElement(anchor)) {\n            var elementPosition = DOM.getDomNodePagePosition(anchor);\n            around = {\n                top: elementPosition.top,\n                left: elementPosition.left,\n                width: elementPosition.width,\n                height: elementPosition.height\n            };\n        }\n        else {\n            var realAnchor = anchor;\n            around = {\n                top: realAnchor.y,\n                left: realAnchor.x,\n                width: realAnchor.width || 1,\n                height: realAnchor.height || 2\n            };\n        }\n        var viewSizeWidth = DOM.getTotalWidth(this.view);\n        var viewSizeHeight = DOM.getTotalHeight(this.view);\n        var anchorPosition = this.delegate.anchorPosition || AnchorPosition.BELOW;\n        var anchorAlignment = this.delegate.anchorAlignment || AnchorAlignment.LEFT;\n        var verticalAnchor = { offset: around.top - window.pageYOffset, size: around.height, position: anchorPosition === AnchorPosition.BELOW ? LayoutAnchorPosition.Before : LayoutAnchorPosition.After };\n        var horizontalAnchor;\n        if (anchorAlignment === AnchorAlignment.LEFT) {\n            horizontalAnchor = { offset: around.left, size: 0, position: LayoutAnchorPosition.Before };\n        }\n        else {\n            horizontalAnchor = { offset: around.left + around.width, size: 0, position: LayoutAnchorPosition.After };\n        }\n        var top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset;\n        // if view intersects vertically with anchor, shift it horizontally\n        if (range_1.Range.intersects({ start: top, end: top + viewSizeHeight }, { start: verticalAnchor.offset, end: verticalAnchor.offset + verticalAnchor.size })) {\n            horizontalAnchor.size = around.width;\n        }\n        var left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\n        DOM.removeClasses(this.view, 'top', 'bottom', 'left', 'right');\n        DOM.addClass(this.view, anchorPosition === AnchorPosition.BELOW ? 'bottom' : 'top');\n        DOM.addClass(this.view, anchorAlignment === AnchorAlignment.LEFT ? 'left' : 'right');\n        var containerPosition = DOM.getDomNodePagePosition(this.container);\n        this.view.style.top = top - containerPosition.top + \"px\";\n        this.view.style.left = left - containerPosition.left + \"px\";\n        this.view.style.width = 'initial';\n    };\n    ContextView.prototype.hide = function (data) {\n        if (this.delegate && this.delegate.onHide) {\n            this.delegate.onHide(data);\n        }\n        this.delegate = null;\n        if (this.toDisposeOnClean) {\n            this.toDisposeOnClean.dispose();\n            this.toDisposeOnClean = null;\n        }\n        DOM.hide(this.view);\n    };\n    ContextView.prototype.isVisible = function () {\n        return !!this.delegate;\n    };\n    ContextView.prototype.onDOMEvent = function (e, element, onCapture) {\n        if (this.delegate) {\n            if (this.delegate.onDOMEvent) {\n                this.delegate.onDOMEvent(e, document.activeElement);\n            }\n            else if (onCapture && !DOM.isAncestor(e.target, this.container)) {\n                this.hide();\n            }\n        }\n    };\n    ContextView.prototype.dispose = function () {\n        this.hide();\n        _super.prototype.dispose.call(this);\n    };\n    ContextView.BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\n    ContextView.BUBBLE_DOWN_EVENTS = ['click'];\n    return ContextView;\n}(lifecycle_1.Disposable));\nexports.ContextView = ContextView;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/contextview/contextview.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/base/browser/ui/contextview/contextview.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport 'vs/css!./contextview';\nimport * as DOM from 'vs/base/browser/dom';\nimport { IDisposable, dispose, toDisposable, combinedDisposable, Disposable } from 'vs/base/common/lifecycle';\nimport { Range } from 'vs/base/common/range';\n\nexport interface IAnchor {\n\tx: number;\n\ty: number;\n\twidth?: number;\n\theight?: number;\n}\n\nexport const enum AnchorAlignment {\n\tLEFT, RIGHT\n}\n\nexport const enum AnchorPosition {\n\tBELOW, ABOVE\n}\n\nexport interface IDelegate {\n\tgetAnchor(): HTMLElement | IAnchor;\n\trender(container: HTMLElement): IDisposable | null;\n\tfocus?(): void;\n\tlayout?(): void;\n\tanchorAlignment?: AnchorAlignment; // default: left\n\tanchorPosition?: AnchorPosition; // default: below\n\tcanRelayout?: boolean; // default: true\n\tonDOMEvent?(e: Event, activeElement: HTMLElement): void;\n\tonHide?(data?: any): void;\n}\n\nexport interface IContextViewProvider {\n\tshowContextView(delegate: IDelegate): void;\n\thideContextView(): void;\n\tlayout(): void;\n}\n\nexport interface IPosition {\n\ttop: number;\n\tleft: number;\n}\n\nexport interface ISize {\n\twidth: number;\n\theight: number;\n}\n\nexport interface IView extends IPosition, ISize { }\n\nexport const enum LayoutAnchorPosition {\n\tBefore,\n\tAfter\n}\n\nexport interface ILayoutAnchor {\n\toffset: number;\n\tsize: number;\n\tposition: LayoutAnchorPosition;\n}\n\n/**\n * Lays out a one dimensional view next to an anchor in a viewport.\n *\n * @returns The view offset within the viewport.\n */\nexport function layout(viewportSize: number, viewSize: number, anchor: ILayoutAnchor): number {\n\tconst anchorEnd = anchor.offset + anchor.size;\n\n\tif (anchor.position === LayoutAnchorPosition.Before) {\n\t\tif (viewSize <= viewportSize - anchorEnd) {\n\t\t\treturn anchorEnd; // happy case, lay it out after the anchor\n\t\t}\n\n\t\tif (viewSize <= anchor.offset) {\n\t\t\treturn anchor.offset - viewSize; // ok case, lay it out before the anchor\n\t\t}\n\n\t\treturn Math.max(viewportSize - viewSize, 0); // sad case, lay it over the anchor\n\t} else {\n\t\tif (viewSize <= anchor.offset) {\n\t\t\treturn anchor.offset - viewSize; // happy case, lay it out before the anchor\n\t\t}\n\n\t\tif (viewSize <= viewportSize - anchorEnd) {\n\t\t\treturn anchorEnd; // ok case, lay it out after the anchor\n\t\t}\n\n\t\treturn 0; // sad case, lay it over the anchor\n\t}\n}\n\nexport class ContextView extends Disposable {\n\n\tprivate static readonly BUBBLE_UP_EVENTS = ['click', 'keydown', 'focus', 'blur'];\n\tprivate static readonly BUBBLE_DOWN_EVENTS = ['click'];\n\n\tprivate container: HTMLElement | null;\n\tprivate view: HTMLElement;\n\tprivate delegate: IDelegate | null;\n\tprivate toDisposeOnClean: IDisposable | null;\n\tprivate toDisposeOnSetContainer: IDisposable;\n\n\tconstructor(container: HTMLElement) {\n\t\tsuper();\n\n\t\tthis.view = DOM.$('.context-view');\n\n\t\tDOM.hide(this.view);\n\n\t\tthis.setContainer(container);\n\n\t\tthis._register(toDisposable(() => this.setContainer(null)));\n\t}\n\n\tsetContainer(container: HTMLElement | null): void {\n\t\tif (this.container) {\n\t\t\tthis.toDisposeOnSetContainer = dispose(this.toDisposeOnSetContainer);\n\t\t\tthis.container.removeChild(this.view);\n\t\t\tthis.container = null;\n\t\t}\n\t\tif (container) {\n\t\t\tthis.container = container;\n\t\t\tthis.container.appendChild(this.view);\n\n\t\t\tconst toDisposeOnSetContainer: IDisposable[] = [];\n\n\t\t\tContextView.BUBBLE_UP_EVENTS.forEach(event => {\n\t\t\t\ttoDisposeOnSetContainer.push(DOM.addStandardDisposableListener(this.container!, event, (e: Event) => {\n\t\t\t\t\tthis.onDOMEvent(e, <HTMLElement>document.activeElement, false);\n\t\t\t\t}));\n\t\t\t});\n\n\t\t\tContextView.BUBBLE_DOWN_EVENTS.forEach(event => {\n\t\t\t\ttoDisposeOnSetContainer.push(DOM.addStandardDisposableListener(this.container!, event, (e: Event) => {\n\t\t\t\t\tthis.onDOMEvent(e, <HTMLElement>document.activeElement, true);\n\t\t\t\t}, true));\n\t\t\t});\n\n\t\t\tthis.toDisposeOnSetContainer = combinedDisposable(toDisposeOnSetContainer);\n\t\t}\n\t}\n\n\tshow(delegate: IDelegate): void {\n\t\tif (this.isVisible()) {\n\t\t\tthis.hide();\n\t\t}\n\n\t\t// Show static box\n\t\tDOM.clearNode(this.view);\n\t\tthis.view.className = 'context-view';\n\t\tthis.view.style.top = '0px';\n\t\tthis.view.style.left = '0px';\n\t\tDOM.show(this.view);\n\n\t\t// Render content\n\t\tthis.toDisposeOnClean = delegate.render(this.view);\n\n\t\t// Set active delegate\n\t\tthis.delegate = delegate;\n\n\t\t// Layout\n\t\tthis.doLayout();\n\n\t\t// Focus\n\t\tif (this.delegate.focus) {\n\t\t\tthis.delegate.focus();\n\t\t}\n\t}\n\n\tlayout(): void {\n\t\tif (!this.isVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.delegate!.canRelayout === false) {\n\t\t\tthis.hide();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.delegate!.layout) {\n\t\t\tthis.delegate!.layout!();\n\t\t}\n\n\t\tthis.doLayout();\n\t}\n\n\tprivate doLayout(): void {\n\t\t// Check that we still have a delegate - this.delegate.layout may have hidden\n\t\tif (!this.isVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Get anchor\n\t\tlet anchor = this.delegate!.getAnchor();\n\n\t\t// Compute around\n\t\tlet around: IView;\n\n\t\t// Get the element's position and size (to anchor the view)\n\t\tif (DOM.isHTMLElement(anchor)) {\n\t\t\tlet elementPosition = DOM.getDomNodePagePosition(anchor);\n\n\t\t\taround = {\n\t\t\t\ttop: elementPosition.top,\n\t\t\t\tleft: elementPosition.left,\n\t\t\t\twidth: elementPosition.width,\n\t\t\t\theight: elementPosition.height\n\t\t\t};\n\t\t} else {\n\t\t\tlet realAnchor = <IAnchor>anchor;\n\n\t\t\taround = {\n\t\t\t\ttop: realAnchor.y,\n\t\t\t\tleft: realAnchor.x,\n\t\t\t\twidth: realAnchor.width || 1,\n\t\t\t\theight: realAnchor.height || 2\n\t\t\t};\n\t\t}\n\n\t\tconst viewSizeWidth = DOM.getTotalWidth(this.view);\n\t\tconst viewSizeHeight = DOM.getTotalHeight(this.view);\n\n\t\tconst anchorPosition = this.delegate!.anchorPosition || AnchorPosition.BELOW;\n\t\tconst anchorAlignment = this.delegate!.anchorAlignment || AnchorAlignment.LEFT;\n\n\t\tconst verticalAnchor: ILayoutAnchor = { offset: around.top - window.pageYOffset, size: around.height, position: anchorPosition === AnchorPosition.BELOW ? LayoutAnchorPosition.Before : LayoutAnchorPosition.After };\n\n\t\tlet horizontalAnchor: ILayoutAnchor;\n\n\t\tif (anchorAlignment === AnchorAlignment.LEFT) {\n\t\t\thorizontalAnchor = { offset: around.left, size: 0, position: LayoutAnchorPosition.Before };\n\t\t} else {\n\t\t\thorizontalAnchor = { offset: around.left + around.width, size: 0, position: LayoutAnchorPosition.After };\n\t\t}\n\n\t\tconst top = layout(window.innerHeight, viewSizeHeight, verticalAnchor) + window.pageYOffset;\n\n\t\t// if view intersects vertically with anchor, shift it horizontally\n\t\tif (Range.intersects({ start: top, end: top + viewSizeHeight }, { start: verticalAnchor.offset, end: verticalAnchor.offset + verticalAnchor.size })) {\n\t\t\thorizontalAnchor.size = around.width;\n\t\t}\n\n\t\tconst left = layout(window.innerWidth, viewSizeWidth, horizontalAnchor);\n\n\t\tDOM.removeClasses(this.view, 'top', 'bottom', 'left', 'right');\n\t\tDOM.addClass(this.view, anchorPosition === AnchorPosition.BELOW ? 'bottom' : 'top');\n\t\tDOM.addClass(this.view, anchorAlignment === AnchorAlignment.LEFT ? 'left' : 'right');\n\n\t\tconst containerPosition = DOM.getDomNodePagePosition(this.container!);\n\t\tthis.view.style.top = `${top - containerPosition.top}px`;\n\t\tthis.view.style.left = `${left - containerPosition.left}px`;\n\t\tthis.view.style.width = 'initial';\n\t}\n\n\thide(data?: any): void {\n\t\tif (this.delegate && this.delegate.onHide) {\n\t\t\tthis.delegate.onHide(data);\n\t\t}\n\n\t\tthis.delegate = null;\n\n\t\tif (this.toDisposeOnClean) {\n\t\t\tthis.toDisposeOnClean.dispose();\n\t\t\tthis.toDisposeOnClean = null;\n\t\t}\n\n\t\tDOM.hide(this.view);\n\t}\n\n\tprivate isVisible(): boolean {\n\t\treturn !!this.delegate;\n\t}\n\n\tprivate onDOMEvent(e: Event, element: HTMLElement, onCapture: boolean): void {\n\t\tif (this.delegate) {\n\t\t\tif (this.delegate.onDOMEvent) {\n\t\t\t\tthis.delegate.onDOMEvent(e, <HTMLElement>document.activeElement);\n\t\t\t} else if (onCapture && !DOM.isAncestor(<HTMLElement>e.target, this.container)) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis.hide();\n\n\t\tsuper.dispose();\n\t}\n}"]}]}