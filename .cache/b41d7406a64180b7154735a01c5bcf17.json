{"remainingRequest":"/home/coding/workspace/node_modules/ts-loader/index.js?{\"happyPackMode\":true,\"compilerOptions\":{\"target\":\"es5\",\"lib\":[\"dom\",\"esnext\"]}}!/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/extensions/node/extensionsWorkbenchService.ts","dependencies":[{"path":"/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/extensions/node/extensionsWorkbenchService.ts","mtime":1555846338040},{"path":"/home/coding/workspace/node_modules/cache-loader/dist/cjs.js","mtime":1555844183884},{"path":"/home/coding/workspace/node_modules/ts-loader/index.js","mtime":1555844217316}],"contextDependencies":[],"result":["\"use strict\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar nls = require(\"vs/nls\");\nvar semver = require(\"semver\");\nvar event_1 = require(\"vs/base/common/event\");\nvar arrays_1 = require(\"vs/base/common/arrays\");\nvar async_1 = require(\"vs/base/common/async\");\nvar errors_1 = require(\"vs/base/common/errors\");\nvar lifecycle_1 = require(\"vs/base/common/lifecycle\");\nvar paging_1 = require(\"vs/base/common/paging\");\nvar telemetry_1 = require(\"vs/platform/telemetry/common/telemetry\");\nvar extensionManagement_1 = require(\"vs/platform/extensionManagement/common/extensionManagement\");\nvar extensionManagementUtil_1 = require(\"vs/platform/extensionManagement/common/extensionManagementUtil\");\nvar instantiation_1 = require(\"vs/platform/instantiation/common/instantiation\");\nvar configuration_1 = require(\"vs/platform/configuration/common/configuration\");\nvar windows_1 = require(\"vs/platform/windows/common/windows\");\nvar severity_1 = require(\"vs/base/common/severity\");\nvar uri_1 = require(\"vs/base/common/uri\");\nvar extensions_1 = require(\"vs/workbench/contrib/extensions/common/extensions\");\nvar editorService_1 = require(\"vs/workbench/services/editor/common/editorService\");\nvar url_1 = require(\"vs/platform/url/common/url\");\nvar extensionsInput_1 = require(\"vs/workbench/contrib/extensions/common/extensionsInput\");\nvar product_1 = require(\"vs/platform/product/node/product\");\nvar log_1 = require(\"vs/platform/log/common/log\");\nvar progress_1 = require(\"vs/platform/progress/common/progress\");\nvar notification_1 = require(\"vs/platform/notification/common/notification\");\nvar resources = require(\"vs/base/common/resources\");\nvar cancellation_1 = require(\"vs/base/common/cancellation\");\nvar storage_1 = require(\"vs/platform/storage/common/storage\");\nvar files_1 = require(\"vs/platform/files/common/files\");\nvar extensions_2 = require(\"vs/platform/extensions/common/extensions\");\nvar extensionsUtil_1 = require(\"vs/workbench/services/extensions/node/extensionsUtil\");\nvar Extension = /** @class */ (function () {\n    function Extension(galleryService, stateProvider, local, gallery, telemetryService, logService, fileService) {\n        this.galleryService = galleryService;\n        this.stateProvider = stateProvider;\n        this.local = local;\n        this.gallery = gallery;\n        this.telemetryService = telemetryService;\n        this.logService = logService;\n        this.fileService = fileService;\n        this.enablementState = extensionManagement_1.EnablementState.Enabled;\n        this.isMalicious = false;\n    }\n    Object.defineProperty(Extension.prototype, \"type\", {\n        get: function () {\n            return this.local ? this.local.type : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"name\", {\n        get: function () {\n            return this.gallery ? this.gallery.name : this.local.manifest.name;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"displayName\", {\n        get: function () {\n            if (this.gallery) {\n                return this.gallery.displayName || this.gallery.name;\n            }\n            return this.local.manifest.displayName || this.local.manifest.name;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"identifier\", {\n        get: function () {\n            if (this.gallery) {\n                return this.gallery.identifier;\n            }\n            return this.local.identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"uuid\", {\n        get: function () {\n            return this.gallery ? this.gallery.identifier.uuid : this.local.identifier.uuid;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"publisher\", {\n        get: function () {\n            return this.gallery ? this.gallery.publisher : this.local.manifest.publisher;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"publisherDisplayName\", {\n        get: function () {\n            if (this.gallery) {\n                return this.gallery.publisherDisplayName || this.gallery.publisher;\n            }\n            if (this.local.metadata && this.local.metadata.publisherDisplayName) {\n                return this.local.metadata.publisherDisplayName;\n            }\n            return this.local.manifest.publisher;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"version\", {\n        get: function () {\n            return this.local ? this.local.manifest.version : this.latestVersion;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"latestVersion\", {\n        get: function () {\n            return this.gallery ? this.gallery.version : this.local.manifest.version;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"description\", {\n        get: function () {\n            return this.gallery ? this.gallery.description : this.local.manifest.description || '';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"url\", {\n        get: function () {\n            if (!product_1.default.extensionsGallery || !this.gallery) {\n                return undefined;\n            }\n            return undefined; // `${product.extensionsGallery.itemUrl}?itemName=${this.publisher}.${this.name}`;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"iconUrl\", {\n        get: function () {\n            return this.galleryIconUrl || this.localIconUrl || this.defaultIconUrl;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"iconUrlFallback\", {\n        get: function () {\n            return this.galleryIconUrlFallback || this.localIconUrl || this.defaultIconUrl;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"localIconUrl\", {\n        get: function () {\n            if (this.local && this.local.manifest.icon) {\n                return resources.joinPath(this.local.location, this.local.manifest.icon).toString();\n            }\n            return null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"galleryIconUrl\", {\n        get: function () {\n            return this.gallery ? this.gallery.assets.icon.uri : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"galleryIconUrlFallback\", {\n        get: function () {\n            return this.gallery ? this.gallery.assets.icon.fallbackUri : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"defaultIconUrl\", {\n        get: function () {\n            if (this.type === extensions_2.ExtensionType.System && this.local) {\n                if (this.local.manifest && this.local.manifest.contributes) {\n                    if (Array.isArray(this.local.manifest.contributes.themes) && this.local.manifest.contributes.themes.length) {\n                        return require.toUrl('../electron-browser/media/theme-icon.png');\n                    }\n                    if (Array.isArray(this.local.manifest.contributes.grammars) && this.local.manifest.contributes.grammars.length) {\n                        return require.toUrl('../electron-browser/media/language-icon.svg');\n                    }\n                }\n            }\n            return require.toUrl('../electron-browser/media/defaultIcon.png');\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"repository\", {\n        get: function () {\n            return this.gallery && this.gallery.assets.repository ? this.gallery.assets.repository.uri : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"licenseUrl\", {\n        get: function () {\n            return this.gallery && this.gallery.assets.license ? this.gallery.assets.license.uri : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"state\", {\n        get: function () {\n            return this.stateProvider(this);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"installCount\", {\n        get: function () {\n            return this.gallery ? this.gallery.installCount : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"rating\", {\n        get: function () {\n            return this.gallery ? this.gallery.rating : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"ratingCount\", {\n        get: function () {\n            return this.gallery ? this.gallery.ratingCount : undefined;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"outdated\", {\n        get: function () {\n            return !!this.gallery && this.type === extensions_2.ExtensionType.User && semver.gt(this.latestVersion, this.version);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"telemetryData\", {\n        get: function () {\n            var _a = this, local = _a.local, gallery = _a.gallery;\n            if (gallery) {\n                return extensionManagementUtil_1.getGalleryExtensionTelemetryData(gallery);\n            }\n            else {\n                return extensionManagementUtil_1.getLocalExtensionTelemetryData(local);\n            }\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"preview\", {\n        get: function () {\n            return this.gallery ? this.gallery.preview : false;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Extension.prototype.isGalleryOutdated = function () {\n        return this.local && this.gallery ? semver.gt(this.local.manifest.version, this.gallery.version) : false;\n    };\n    Extension.prototype.getManifest = function (token) {\n        if (this.gallery && !this.isGalleryOutdated()) {\n            if (this.gallery.assets.manifest) {\n                return this.galleryService.getManifest(this.gallery, token);\n            }\n            this.logService.error(nls.localize('Manifest is not found', \"Manifest is not found\"), this.identifier.id);\n            return Promise.resolve(null);\n        }\n        return Promise.resolve(this.local.manifest);\n    };\n    Extension.prototype.hasReadme = function () {\n        if (this.gallery && !this.isGalleryOutdated() && this.gallery.assets.readme) {\n            return true;\n        }\n        if (this.local && this.local.readmeUrl) {\n            return true;\n        }\n        return this.type === extensions_2.ExtensionType.System;\n    };\n    Extension.prototype.getReadme = function (token) {\n        if (this.gallery && !this.isGalleryOutdated()) {\n            if (this.gallery.assets.readme) {\n                return this.galleryService.getReadme(this.gallery, token);\n            }\n            this.telemetryService.publicLog('extensions:NotFoundReadMe', this.telemetryData);\n        }\n        if (this.local && this.local.readmeUrl) {\n            return this.fileService.resolveContent(this.local.readmeUrl, { encoding: 'utf8' }).then(function (content) { return content.value; });\n        }\n        if (this.type === extensions_2.ExtensionType.System) {\n            return Promise.resolve(\"# \" + (this.displayName || this.name) + \"\\n**Notice:** This extension is bundled with Visual Studio Code. It can be disabled but not uninstalled.\\n## Features\\n\" + this.description + \"\\n\");\n        }\n        return Promise.reject(new Error('not available'));\n    };\n    Extension.prototype.hasChangelog = function () {\n        if (this.gallery && this.gallery.assets.changelog && !this.isGalleryOutdated()) {\n            return true;\n        }\n        if (this.local && this.local.changelogUrl) {\n            return true;\n        }\n        return this.type === extensions_2.ExtensionType.System;\n    };\n    Extension.prototype.getChangelog = function (token) {\n        if (this.gallery && this.gallery.assets.changelog && !this.isGalleryOutdated()) {\n            return this.galleryService.getChangelog(this.gallery, token);\n        }\n        var changelogUrl = this.local && this.local.changelogUrl;\n        if (!changelogUrl) {\n            if (this.type === extensions_2.ExtensionType.System) {\n                return Promise.resolve('Please check the [VS Code Release Notes](command:update.showCurrentReleaseNotes) for changes to the built-in extensions.');\n            }\n            return Promise.reject(new Error('not available'));\n        }\n        return this.fileService.resolveContent(changelogUrl, { encoding: 'utf8' }).then(function (content) { return content.value; });\n    };\n    Object.defineProperty(Extension.prototype, \"dependencies\", {\n        get: function () {\n            var _a = this, local = _a.local, gallery = _a.gallery;\n            if (gallery && !this.isGalleryOutdated()) {\n                return gallery.properties.dependencies || [];\n            }\n            if (local && local.manifest.extensionDependencies) {\n                return local.manifest.extensionDependencies;\n            }\n            return [];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Extension.prototype, \"extensionPack\", {\n        get: function () {\n            var _a = this, local = _a.local, gallery = _a.gallery;\n            if (gallery && !this.isGalleryOutdated()) {\n                return gallery.properties.extensionPack || [];\n            }\n            if (local && local.manifest.extensionPack) {\n                return local.manifest.extensionPack;\n            }\n            return [];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Extension;\n}());\nvar ExtensionDependencies = /** @class */ (function () {\n    function ExtensionDependencies(_extension, _identifier, _map, _dependent) {\n        if (_dependent === void 0) { _dependent = null; }\n        this._extension = _extension;\n        this._identifier = _identifier;\n        this._map = _map;\n        this._dependent = _dependent;\n        this._hasDependencies = null;\n    }\n    Object.defineProperty(ExtensionDependencies.prototype, \"hasDependencies\", {\n        get: function () {\n            if (this._hasDependencies === null) {\n                this._hasDependencies = this.computeHasDependencies();\n            }\n            return this._hasDependencies;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtensionDependencies.prototype, \"extension\", {\n        get: function () {\n            return this._extension;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtensionDependencies.prototype, \"identifier\", {\n        get: function () {\n            return this._identifier;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtensionDependencies.prototype, \"dependent\", {\n        get: function () {\n            return this._dependent;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtensionDependencies.prototype, \"dependencies\", {\n        get: function () {\n            var _this = this;\n            if (!this.hasDependencies) {\n                return [];\n            }\n            return this._extension.dependencies.map(function (id) { return new ExtensionDependencies(_this._map.get(id), id, _this._map, _this); });\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtensionDependencies.prototype.computeHasDependencies = function () {\n        if (this._extension && this._extension.dependencies.length > 0) {\n            var dependent = this._dependent;\n            while (dependent !== null) {\n                if (dependent.identifier === this.identifier) {\n                    return false;\n                }\n                dependent = dependent.dependent;\n            }\n            return true;\n        }\n        return false;\n    };\n    return ExtensionDependencies;\n}());\nvar ExtensionsWorkbenchService = /** @class */ (function () {\n    function ExtensionsWorkbenchService(instantiationService, editorService, extensionService, galleryService, configurationService, telemetryService, notificationService, urlService, extensionEnablementService, windowService, logService, progressService, extensionManagementServerService, storageService, fileService) {\n        var _this = this;\n        this.instantiationService = instantiationService;\n        this.editorService = editorService;\n        this.extensionService = extensionService;\n        this.galleryService = galleryService;\n        this.configurationService = configurationService;\n        this.telemetryService = telemetryService;\n        this.notificationService = notificationService;\n        this.extensionEnablementService = extensionEnablementService;\n        this.windowService = windowService;\n        this.logService = logService;\n        this.progressService = progressService;\n        this.extensionManagementServerService = extensionManagementServerService;\n        this.storageService = storageService;\n        this.fileService = fileService;\n        this.installing = [];\n        this.uninstalling = [];\n        this.installed = [];\n        this.disposables = [];\n        this._onChange = new event_1.Emitter();\n        this.stateProvider = function (ext) { return _this.getExtensionState(ext); };\n        extensionService.onInstallExtension(this.onInstallExtension, this, this.disposables);\n        extensionService.onDidInstallExtension(this.onDidInstallExtension, this, this.disposables);\n        extensionService.onUninstallExtension(this.onUninstallExtension, this, this.disposables);\n        extensionService.onDidUninstallExtension(this.onDidUninstallExtension, this, this.disposables);\n        extensionEnablementService.onEnablementChanged(this.onEnablementChanged, this, this.disposables);\n        this.syncDelayer = new async_1.ThrottledDelayer(ExtensionsWorkbenchService.SyncPeriod);\n        this.autoUpdateDelayer = new async_1.ThrottledDelayer(1000);\n        urlService.registerHandler(this);\n        this.configurationService.onDidChangeConfiguration(function (e) {\n            if (e.affectsConfiguration(extensions_1.AutoUpdateConfigurationKey)) {\n                if (_this.isAutoUpdateEnabled()) {\n                    _this.checkForUpdates();\n                }\n            }\n            if (e.affectsConfiguration(extensions_1.AutoCheckUpdatesConfigurationKey)) {\n                if (_this.isAutoCheckUpdatesEnabled()) {\n                    _this.checkForUpdates();\n                }\n            }\n        }, this, this.disposables);\n        this.queryLocal().then(function () {\n            _this.resetIgnoreAutoUpdateExtensions();\n            _this.eventuallySyncWithGallery(true);\n        });\n    }\n    Object.defineProperty(ExtensionsWorkbenchService.prototype, \"onChange\", {\n        get: function () { return this._onChange.event; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtensionsWorkbenchService.prototype, \"local\", {\n        get: function () {\n            var _this = this;\n            var installing = this.installing\n                .filter(function (e) { return !_this.installed.some(function (installed) { return extensionManagementUtil_1.areSameExtensions(installed.identifier, e.identifier); }); })\n                .map(function (e) { return e; });\n            return this.installed.concat(installing);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtensionsWorkbenchService.prototype.queryLocal = function () {\n        var _this = this;\n        return this.extensionService.getInstalled()\n            .then(function (installed) {\n            if (_this.extensionManagementServerService.remoteExtensionManagementServer) {\n                installed = installed.filter(function (installed) { return _this.belongsToWindow(installed); });\n            }\n            var installedById = arrays_1.index(_this.installed, function (e) { return e.identifier.id; });\n            _this.installed = installed.map(function (local) {\n                var extension = installedById[local.identifier.id] || new Extension(_this.galleryService, _this.stateProvider, local, undefined, _this.telemetryService, _this.logService, _this.fileService);\n                extension.enablementState = _this.extensionEnablementService.getEnablementState(local);\n                return extension;\n            });\n            _this._onChange.fire(undefined);\n            return _this.local;\n        });\n    };\n    ExtensionsWorkbenchService.prototype.queryGallery = function (arg1, arg2) {\n        var _this = this;\n        var options = cancellation_1.CancellationToken.isCancellationToken(arg1) ? {} : arg1;\n        var token = cancellation_1.CancellationToken.isCancellationToken(arg1) ? arg1 : arg2;\n        return this.extensionService.getExtensionsReport()\n            .then(function (report) {\n            var maliciousSet = extensionManagementUtil_1.getMaliciousExtensionsSet(report);\n            return _this.galleryService.query(options, token)\n                .then(function (result) { return paging_1.mapPager(result, function (gallery) { return _this.fromGallery(gallery, maliciousSet); }); })\n                .then(undefined, function (err) {\n                if (/No extension gallery service configured/.test(err.message)) {\n                    return Promise.resolve(paging_1.singlePagePager([]));\n                }\n                return Promise.reject(err);\n            });\n        });\n    };\n    ExtensionsWorkbenchService.prototype.loadDependencies = function (extension, token) {\n        var _this = this;\n        if (!extension.dependencies.length) {\n            return Promise.resolve(null);\n        }\n        return this.extensionService.getExtensionsReport()\n            .then(function (report) {\n            var maliciousSet = extensionManagementUtil_1.getMaliciousExtensionsSet(report);\n            return _this.galleryService.loadAllDependencies(extension.dependencies.map(function (id) { return ({ id: id }); }), token)\n                .then(function (galleryExtensions) {\n                var extensions = _this.local.concat(galleryExtensions.map(function (galleryExtension) { return _this.fromGallery(galleryExtension, maliciousSet); }));\n                var map = new Map();\n                for (var _i = 0, extensions_3 = extensions; _i < extensions_3.length; _i++) {\n                    var extension_1 = extensions_3[_i];\n                    map.set(extension_1.identifier.id, extension_1);\n                }\n                return new ExtensionDependencies(extension, extension.identifier.id, map);\n            });\n        });\n    };\n    ExtensionsWorkbenchService.prototype.open = function (extension, sideByside) {\n        if (sideByside === void 0) { sideByside = false; }\n        return Promise.resolve(this.editorService.openEditor(this.instantiationService.createInstance(extensionsInput_1.ExtensionsInput, extension), undefined, sideByside ? editorService_1.SIDE_GROUP : editorService_1.ACTIVE_GROUP));\n    };\n    ExtensionsWorkbenchService.prototype.belongsToWindow = function (extension) {\n        if (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n            return true;\n        }\n        var extensionManagementServer = this.extensionManagementServerService.getExtensionManagementServer(extension.location);\n        if (extensionsUtil_1.isUIExtension(extension.manifest, this.configurationService)) {\n            if (this.extensionManagementServerService.localExtensionManagementServer === extensionManagementServer) {\n                return true;\n            }\n        }\n        else {\n            if (this.extensionManagementServerService.remoteExtensionManagementServer === extensionManagementServer) {\n                return true;\n            }\n        }\n        return false;\n    };\n    ExtensionsWorkbenchService.prototype.fromGallery = function (gallery, maliciousExtensionSet) {\n        var _this = this;\n        var result = this.getInstalledExtensionMatchingGallery(gallery);\n        if (result) {\n            // Loading the compatible version only there is an engine property\n            // Otherwise falling back to old way so that we will not make many roundtrips\n            if (gallery.properties.engine) {\n                this.galleryService.getCompatibleExtension(gallery)\n                    .then(function (compatible) { return compatible ? _this.syncLocalWithGalleryExtension(result, compatible) : null; });\n            }\n            else {\n                this.syncLocalWithGalleryExtension(result, gallery);\n            }\n        }\n        else {\n            result = new Extension(this.galleryService, this.stateProvider, undefined, gallery, this.telemetryService, this.logService, this.fileService);\n        }\n        if (maliciousExtensionSet.has(result.identifier.id)) {\n            result.isMalicious = true;\n        }\n        return result;\n    };\n    ExtensionsWorkbenchService.prototype.getInstalledExtensionMatchingGallery = function (gallery) {\n        for (var _i = 0, _a = this.installed; _i < _a.length; _i++) {\n            var installed = _a[_i];\n            if (installed.uuid) { // Installed from Gallery\n                if (installed.uuid === gallery.identifier.uuid) {\n                    return installed;\n                }\n            }\n            else {\n                if (extensionManagementUtil_1.areSameExtensions(installed.identifier, gallery.identifier)) { // Installed from other sources\n                    return installed;\n                }\n            }\n        }\n        return null;\n    };\n    ExtensionsWorkbenchService.prototype.syncLocalWithGalleryExtension = function (extension, gallery) {\n        var _this = this;\n        // Sync the local extension with gallery extension if local extension doesnot has metadata\n        if (extension.local) {\n            (extension.local.metadata ? Promise.resolve(extension.local) : this.extensionService.updateMetadata(extension.local, { id: gallery.identifier.uuid, publisherDisplayName: gallery.publisherDisplayName, publisherId: gallery.publisherId }))\n                .then(function (local) {\n                extension.local = local;\n                extension.gallery = gallery;\n                _this._onChange.fire(extension);\n                _this.eventuallyAutoUpdateExtensions();\n            });\n        }\n        else {\n            this._onChange.fire(extension);\n        }\n    };\n    ExtensionsWorkbenchService.prototype.checkForUpdates = function () {\n        var _this = this;\n        return Promise.resolve(this.syncDelayer.trigger(function () { return _this.syncWithGallery(); }, 0));\n    };\n    ExtensionsWorkbenchService.prototype.isAutoUpdateEnabled = function () {\n        return this.configurationService.getValue(extensions_1.AutoUpdateConfigurationKey);\n    };\n    ExtensionsWorkbenchService.prototype.isAutoCheckUpdatesEnabled = function () {\n        return this.configurationService.getValue(extensions_1.AutoCheckUpdatesConfigurationKey);\n    };\n    ExtensionsWorkbenchService.prototype.eventuallySyncWithGallery = function (immediate) {\n        var _this = this;\n        if (immediate === void 0) { immediate = false; }\n        var shouldSync = this.isAutoUpdateEnabled() || this.isAutoCheckUpdatesEnabled();\n        var loop = function () { return (shouldSync ? _this.syncWithGallery() : Promise.resolve(undefined)).then(function () { return _this.eventuallySyncWithGallery(); }); };\n        var delay = immediate ? 0 : ExtensionsWorkbenchService.SyncPeriod;\n        this.syncDelayer.trigger(loop, delay)\n            .then(undefined, function (err) { return null; });\n    };\n    ExtensionsWorkbenchService.prototype.syncWithGallery = function () {\n        var ids = [], names = [];\n        for (var _i = 0, _a = this.installed; _i < _a.length; _i++) {\n            var installed = _a[_i];\n            if (installed.type === extensions_2.ExtensionType.User) {\n                if (installed.uuid) {\n                    ids.push(installed.uuid);\n                }\n                else {\n                    names.push(installed.identifier.id);\n                }\n            }\n        }\n        var promises = [];\n        if (ids.length) {\n            promises.push(this.queryGallery({ ids: ids, pageSize: ids.length }, cancellation_1.CancellationToken.None));\n        }\n        if (names.length) {\n            promises.push(this.queryGallery({ names: names, pageSize: names.length }, cancellation_1.CancellationToken.None));\n        }\n        return Promise.all(promises).then(function () { return undefined; });\n    };\n    ExtensionsWorkbenchService.prototype.eventuallyAutoUpdateExtensions = function () {\n        var _this = this;\n        this.autoUpdateDelayer.trigger(function () { return _this.autoUpdateExtensions(); })\n            .then(undefined, function (err) { return null; });\n    };\n    ExtensionsWorkbenchService.prototype.autoUpdateExtensions = function () {\n        var _this = this;\n        if (!this.isAutoUpdateEnabled()) {\n            return Promise.resolve();\n        }\n        var toUpdate = this.local.filter(function (e) {\n            return e.outdated && e.state !== extensions_1.ExtensionState.Installing\n                && e.local && !_this.isAutoUpdateIgnored(new extensions_2.ExtensionIdentifierWithVersion(e.identifier, e.version));\n        });\n        return Promise.all(toUpdate.map(function (e) { return _this.install(e); }));\n    };\n    ExtensionsWorkbenchService.prototype.canInstall = function (extension) {\n        if (!(extension instanceof Extension)) {\n            return false;\n        }\n        if (extension.isMalicious) {\n            return false;\n        }\n        return !!extension.gallery;\n    };\n    ExtensionsWorkbenchService.prototype.install = function (extension) {\n        var _this = this;\n        if (typeof extension === 'string') {\n            return this.installWithProgress(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                var extensionIdentifier;\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, this.extensionService.install(uri_1.URI.file(extension))];\n                        case 1:\n                            extensionIdentifier = _a.sent();\n                            this.checkAndEnableDisabledDependencies(extensionIdentifier);\n                            return [2 /*return*/, this.local.filter(function (local) { return extensionManagementUtil_1.areSameExtensions(local.identifier, extensionIdentifier); })[0]];\n                    }\n                });\n            }); });\n        }\n        if (extension.isMalicious) {\n            return Promise.reject(new Error(nls.localize('malicious', \"This extension is reported to be problematic.\")));\n        }\n        var gallery = extension.gallery;\n        if (!gallery) {\n            return Promise.reject(new Error('Missing gallery'));\n        }\n        return this.installWithProgress(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.extensionService.installFromGallery(gallery)];\n                    case 1:\n                        _a.sent();\n                        this.checkAndEnableDisabledDependencies(gallery.identifier);\n                        return [2 /*return*/, this.local.filter(function (local) { return extensionManagementUtil_1.areSameExtensions(local.identifier, gallery.identifier); })[0]];\n                }\n            });\n        }); }, gallery.displayName);\n    };\n    ExtensionsWorkbenchService.prototype.setEnablement = function (extensions, enablementState) {\n        extensions = Array.isArray(extensions) ? extensions : [extensions];\n        return this.promptAndSetEnablement(extensions, enablementState);\n    };\n    ExtensionsWorkbenchService.prototype.uninstall = function (extension) {\n        var _this = this;\n        var ext = extension.local ? extension : this.installed.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, extension.identifier); })[0];\n        var toUninstall = ext && ext.local ? ext.local : null;\n        if (!toUninstall) {\n            return Promise.reject(new Error('Missing local'));\n        }\n        this.logService.info(\"Requested uninstalling the extension \" + extension.identifier.id + \" from window \" + this.windowService.getCurrentWindowId());\n        return this.progressService.withProgress({\n            location: progress_1.ProgressLocation.Extensions,\n            title: nls.localize('uninstallingExtension', 'Uninstalling extension....'),\n            source: \"\" + toUninstall.identifier.id\n        }, function () { return _this.extensionService.uninstall(toUninstall).then(function () { return undefined; }); });\n    };\n    ExtensionsWorkbenchService.prototype.installVersion = function (extension, version) {\n        var _this = this;\n        if (!(extension instanceof Extension)) {\n            return Promise.resolve(extension);\n        }\n        if (!extension.gallery) {\n            return Promise.reject(new Error('Missing gallery'));\n        }\n        return this.galleryService.getCompatibleExtension(extension.gallery.identifier, version)\n            .then(function (gallery) {\n            if (!gallery) {\n                return Promise.reject(new Error(nls.localize('incompatible', \"Unable to install extension '{0}' with version '{1}' as it is not compatible with VS Code.\", extension.gallery.identifier.id, version)));\n            }\n            return _this.installWithProgress(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                return tslib_1.__generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, this.extensionService.installFromGallery(gallery)];\n                        case 1:\n                            _a.sent();\n                            if (extension.latestVersion !== version) {\n                                this.ignoreAutoUpdate(new extensions_2.ExtensionIdentifierWithVersion(gallery.identifier, version));\n                            }\n                            return [2 /*return*/, this.local.filter(function (local) { return extensionManagementUtil_1.areSameExtensions(local.identifier, gallery.identifier); })[0]];\n                    }\n                });\n            }); }, gallery.displayName);\n        });\n    };\n    ExtensionsWorkbenchService.prototype.reinstall = function (extension) {\n        var _this = this;\n        var ext = extension.local ? extension : this.installed.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, extension.identifier); })[0];\n        var toReinstall = ext && ext.local ? ext.local : null;\n        if (!toReinstall) {\n            return Promise.reject(new Error('Missing local'));\n        }\n        return this.progressService.withProgress({\n            location: progress_1.ProgressLocation.Extensions,\n            source: \"\" + toReinstall.identifier.id\n        }, function () { return _this.extensionService.reinstallFromGallery(toReinstall).then(function () { return _this.local.filter(function (local) { return extensionManagementUtil_1.areSameExtensions(local.identifier, extension.identifier); })[0]; }); });\n    };\n    ExtensionsWorkbenchService.prototype.installWithProgress = function (installTask, extensionName) {\n        var title = extensionName ? nls.localize('installing named extension', \"Installing '{0}' extension....\", extensionName) : nls.localize('installing extension', 'Installing extension....');\n        return this.progressService.withProgress({\n            location: progress_1.ProgressLocation.Extensions,\n            title: title\n        }, function () { return installTask(); });\n    };\n    ExtensionsWorkbenchService.prototype.checkAndEnableDisabledDependencies = function (extensionIdentifier) {\n        var extension = this.local.filter(function (e) { return (e.local || e.gallery) && extensionManagementUtil_1.areSameExtensions(extensionIdentifier, e.identifier); })[0];\n        if (extension) {\n            var disabledDepencies = this.getExtensionsRecursively([extension], this.local, extensionManagement_1.EnablementState.Enabled, { dependencies: true, pack: false });\n            if (disabledDepencies.length) {\n                return this.setEnablement(disabledDepencies, extensionManagement_1.EnablementState.Enabled);\n            }\n        }\n        return Promise.resolve();\n    };\n    ExtensionsWorkbenchService.prototype.promptAndSetEnablement = function (extensions, enablementState) {\n        var enable = enablementState === extensionManagement_1.EnablementState.Enabled || enablementState === extensionManagement_1.EnablementState.WorkspaceEnabled;\n        if (enable) {\n            var allDependenciesAndPackedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: true, pack: true });\n            return this.checkAndSetEnablement(extensions, allDependenciesAndPackedExtensions, enablementState);\n        }\n        else {\n            var packedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: false, pack: true });\n            if (packedExtensions.length) {\n                return this.checkAndSetEnablement(extensions, packedExtensions, enablementState);\n            }\n            return this.checkAndSetEnablement(extensions, [], enablementState);\n        }\n    };\n    ExtensionsWorkbenchService.prototype.checkAndSetEnablement = function (extensions, otherExtensions, enablementState) {\n        var allExtensions = extensions.concat(otherExtensions);\n        var enable = enablementState === extensionManagement_1.EnablementState.Enabled || enablementState === extensionManagement_1.EnablementState.WorkspaceEnabled;\n        if (!enable) {\n            for (var _i = 0, extensions_4 = extensions; _i < extensions_4.length; _i++) {\n                var extension = extensions_4[_i];\n                var dependents = this.getDependentsAfterDisablement(extension, allExtensions, this.local);\n                if (dependents.length) {\n                    return Promise.reject(new Error(this.getDependentsErrorMessage(extension, allExtensions, dependents)));\n                }\n            }\n        }\n        return this.doSetEnablement(allExtensions, enablementState);\n    };\n    ExtensionsWorkbenchService.prototype.getExtensionsRecursively = function (extensions, installed, enablementState, options, checked) {\n        if (checked === void 0) { checked = []; }\n        var toCheck = extensions.filter(function (e) { return checked.indexOf(e) === -1; });\n        if (toCheck.length) {\n            for (var _i = 0, toCheck_1 = toCheck; _i < toCheck_1.length; _i++) {\n                var extension = toCheck_1[_i];\n                checked.push(extension);\n            }\n            var extensionsToDisable = installed.filter(function (i) {\n                if (checked.indexOf(i) !== -1) {\n                    return false;\n                }\n                if (i.enablementState === enablementState) {\n                    return false;\n                }\n                var enable = enablementState === extensionManagement_1.EnablementState.Enabled || enablementState === extensionManagement_1.EnablementState.WorkspaceEnabled;\n                return (enable || i.type === extensions_2.ExtensionType.User) // Include all Extensions for enablement and only user extensions for disablement\n                    && (options.dependencies || options.pack)\n                    && extensions.some(function (extension) {\n                        return (options.dependencies && extension.dependencies.some(function (id) { return extensionManagementUtil_1.areSameExtensions({ id: id }, i.identifier); }))\n                            || (options.pack && extension.extensionPack.some(function (id) { return extensionManagementUtil_1.areSameExtensions({ id: id }, i.identifier); }));\n                    });\n            });\n            if (extensionsToDisable.length) {\n                extensionsToDisable.push.apply(extensionsToDisable, this.getExtensionsRecursively(extensionsToDisable, installed, enablementState, options, checked));\n            }\n            return extensionsToDisable;\n        }\n        return [];\n    };\n    ExtensionsWorkbenchService.prototype.getDependentsAfterDisablement = function (extension, extensionsToDisable, installed) {\n        return installed.filter(function (i) {\n            if (i.dependencies.length === 0) {\n                return false;\n            }\n            if (i === extension) {\n                return false;\n            }\n            if (i.enablementState === extensionManagement_1.EnablementState.WorkspaceDisabled || i.enablementState === extensionManagement_1.EnablementState.Disabled) {\n                return false;\n            }\n            if (extensionsToDisable.indexOf(i) !== -1) {\n                return false;\n            }\n            return i.dependencies.some(function (dep) { return [extension].concat(extensionsToDisable).some(function (d) { return extensionManagementUtil_1.areSameExtensions(d.identifier, { id: dep }); }); });\n        });\n    };\n    ExtensionsWorkbenchService.prototype.getDependentsErrorMessage = function (extension, allDisabledExtensions, dependents) {\n        var _loop_1 = function (e) {\n            var dependentsOfTheExtension = dependents.filter(function (d) { return d.dependencies.some(function (id) { return extensionManagementUtil_1.areSameExtensions({ id: id }, e.identifier); }); });\n            if (dependentsOfTheExtension.length) {\n                return { value: this_1.getErrorMessageForDisablingAnExtensionWithDependents(e, dependentsOfTheExtension) };\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, _a = [extension].concat(allDisabledExtensions); _i < _a.length; _i++) {\n            var e = _a[_i];\n            var state_1 = _loop_1(e);\n            if (typeof state_1 === \"object\")\n                return state_1.value;\n        }\n        return '';\n    };\n    ExtensionsWorkbenchService.prototype.getErrorMessageForDisablingAnExtensionWithDependents = function (extension, dependents) {\n        if (dependents.length === 1) {\n            return nls.localize('singleDependentError', \"Cannot disable extension '{0}'. Extension '{1}' depends on this.\", extension.displayName, dependents[0].displayName);\n        }\n        if (dependents.length === 2) {\n            return nls.localize('twoDependentsError', \"Cannot disable extension '{0}'. Extensions '{1}' and '{2}' depend on this.\", extension.displayName, dependents[0].displayName, dependents[1].displayName);\n        }\n        return nls.localize('multipleDependentsError', \"Cannot disable extension '{0}'. Extensions '{1}', '{2}' and others depend on this.\", extension.displayName, dependents[0].displayName, dependents[1].displayName);\n    };\n    ExtensionsWorkbenchService.prototype.doSetEnablement = function (extensions, enablementState) {\n        return tslib_1.__awaiter(this, void 0, Promise, function () {\n            var changed, i;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.extensionEnablementService.setEnablement(extensions.map(function (e) { return e.local; }), enablementState)];\n                    case 1:\n                        changed = _a.sent();\n                        for (i = 0; i < changed.length; i++) {\n                            if (changed[i]) {\n                                /* __GDPR__\n                                \"extension:enable\" : {\n                                    \"${include}\": [\n                                        \"${GalleryExtensionTelemetryData}\"\n                                    ]\n                                }\n                                */\n                                /* __GDPR__\n                                \"extension:disable\" : {\n                                    \"${include}\": [\n                                        \"${GalleryExtensionTelemetryData}\"\n                                    ]\n                                }\n                                */\n                                this.telemetryService.publicLog(enablementState === extensionManagement_1.EnablementState.Enabled || enablementState === extensionManagement_1.EnablementState.WorkspaceEnabled ? 'extension:enable' : 'extension:disable', extensions[i].telemetryData);\n                            }\n                        }\n                        return [2 /*return*/, changed];\n                }\n            });\n        });\n    };\n    Object.defineProperty(ExtensionsWorkbenchService.prototype, \"allowedBadgeProviders\", {\n        get: function () {\n            if (!this._extensionAllowedBadgeProviders) {\n                this._extensionAllowedBadgeProviders = (product_1.default.extensionAllowedBadgeProviders || []).map(function (s) { return s.toLowerCase(); });\n            }\n            return this._extensionAllowedBadgeProviders;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtensionsWorkbenchService.prototype.onInstallExtension = function (event) {\n        var gallery = event.gallery;\n        if (!gallery) {\n            return;\n        }\n        var extension = this.installed.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, gallery.identifier); })[0];\n        if (!extension) {\n            extension = new Extension(this.galleryService, this.stateProvider, undefined, gallery, this.telemetryService, this.logService, this.fileService);\n        }\n        this.installing.push(extension);\n        this._onChange.fire(extension);\n    };\n    ExtensionsWorkbenchService.prototype.onDidInstallExtension = function (event) {\n        var local = event.local, zipPath = event.zipPath, error = event.error, gallery = event.gallery;\n        var installingExtension = gallery ? this.installing.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, gallery.identifier); })[0] : null;\n        this.installing = installingExtension ? this.installing.filter(function (e) { return e !== installingExtension; }) : this.installing;\n        if (local && !this.belongsToWindow(local)) {\n            return;\n        }\n        var extension = installingExtension ? installingExtension : zipPath ? new Extension(this.galleryService, this.stateProvider, local, undefined, this.telemetryService, this.logService, this.fileService) : undefined;\n        if (extension) {\n            if (local) {\n                var installed = this.installed.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, extension.identifier); })[0];\n                if (installed) {\n                    extension = installed;\n                }\n                else {\n                    this.installed.push(extension);\n                }\n                extension.local = local;\n                extension.gallery = gallery;\n            }\n        }\n        this._onChange.fire(error ? undefined : extension);\n    };\n    ExtensionsWorkbenchService.prototype.onUninstallExtension = function (identifier) {\n        var extension = this.installed.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); })[0];\n        if (!extension) {\n            return;\n        }\n        var uninstalling = this.uninstalling.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); })[0] || extension;\n        this.uninstalling = [uninstalling].concat(this.uninstalling.filter(function (e) { return !extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); }));\n        this._onChange.fire(uninstalling);\n    };\n    ExtensionsWorkbenchService.prototype.onDidUninstallExtension = function (_a) {\n        var identifier = _a.identifier, error = _a.error;\n        if (!error) {\n            this.installed = this.installed.filter(function (e) { return !extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); });\n        }\n        var uninstalling = this.uninstalling.filter(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); })[0];\n        this.uninstalling = this.uninstalling.filter(function (e) { return !extensionManagementUtil_1.areSameExtensions(e.identifier, identifier); });\n        if (!uninstalling) {\n            return;\n        }\n        this._onChange.fire(uninstalling);\n    };\n    ExtensionsWorkbenchService.prototype.onEnablementChanged = function (platformExtensions) {\n        var extensions = this.local.filter(function (e) { return platformExtensions.some(function (p) { return extensionManagementUtil_1.areSameExtensions(e.identifier, p.identifier); }); });\n        for (var _i = 0, extensions_5 = extensions; _i < extensions_5.length; _i++) {\n            var extension = extensions_5[_i];\n            if (extension.local) {\n                var enablementState = this.extensionEnablementService.getEnablementState(extension.local);\n                if (enablementState !== extension.enablementState) {\n                    extension.enablementState = enablementState;\n                    this._onChange.fire(extension);\n                }\n            }\n        }\n    };\n    ExtensionsWorkbenchService.prototype.getExtensionState = function (extension) {\n        if (extension.gallery && this.installing.some(function (e) { return !!e.gallery && extensionManagementUtil_1.areSameExtensions(e.gallery.identifier, extension.gallery.identifier); })) {\n            return extensions_1.ExtensionState.Installing;\n        }\n        if (this.uninstalling.some(function (e) { return extensionManagementUtil_1.areSameExtensions(e.identifier, extension.identifier); })) {\n            return extensions_1.ExtensionState.Uninstalling;\n        }\n        var local = this.installed.filter(function (e) { return e === extension || (e.gallery && extension.gallery && extensionManagementUtil_1.areSameExtensions(e.gallery.identifier, extension.gallery.identifier)); })[0];\n        return local ? extensions_1.ExtensionState.Installed : extensions_1.ExtensionState.Uninstalled;\n    };\n    ExtensionsWorkbenchService.prototype.onError = function (err) {\n        if (errors_1.isPromiseCanceledError(err)) {\n            return;\n        }\n        var message = err && err.message || '';\n        if (/getaddrinfo ENOTFOUND|getaddrinfo ENOENT|connect EACCES|connect ECONNREFUSED/.test(message)) {\n            return;\n        }\n        this.notificationService.error(err);\n    };\n    ExtensionsWorkbenchService.prototype.handleURL = function (uri) {\n        if (!/^extension/.test(uri.path)) {\n            return Promise.resolve(false);\n        }\n        this.onOpenExtensionUrl(uri);\n        return Promise.resolve(true);\n    };\n    ExtensionsWorkbenchService.prototype.onOpenExtensionUrl = function (uri) {\n        var _this = this;\n        var match = /^extension\\/([^/]+)$/.exec(uri.path);\n        if (!match) {\n            return;\n        }\n        var extensionId = match[1];\n        this.queryLocal().then(function (local) {\n            var extension = local.filter(function (local) { return extensionManagementUtil_1.areSameExtensions(local.identifier, { id: extensionId }); })[0];\n            if (extension) {\n                return _this.windowService.focusWindow()\n                    .then(function () { return _this.open(extension); });\n            }\n            return _this.queryGallery({ names: [extensionId], source: 'uri' }, cancellation_1.CancellationToken.None).then(function (result) {\n                if (result.total < 1) {\n                    return Promise.resolve(null);\n                }\n                var extension = result.firstPage[0];\n                return _this.windowService.focusWindow().then(function () {\n                    return _this.open(extension).then(function () {\n                        _this.notificationService.prompt(severity_1.default.Info, nls.localize('installConfirmation', \"Would you like to install the '{0}' extension?\", extension.displayName, extension.publisher), [{\n                                label: nls.localize('install', \"Install\"),\n                                run: function () { return _this.install(extension).then(undefined, function (error) { return _this.onError(error); }); }\n                            }], { sticky: true });\n                    });\n                });\n            });\n        }).then(undefined, function (error) { return _this.onError(error); });\n    };\n    Object.defineProperty(ExtensionsWorkbenchService.prototype, \"ignoredAutoUpdateExtensions\", {\n        get: function () {\n            if (!this._ignoredAutoUpdateExtensions) {\n                this._ignoredAutoUpdateExtensions = JSON.parse(this.storageService.get('extensions.ignoredAutoUpdateExtension', storage_1.StorageScope.GLOBAL, '[]') || '[]');\n            }\n            return this._ignoredAutoUpdateExtensions;\n        },\n        set: function (extensionIds) {\n            this._ignoredAutoUpdateExtensions = arrays_1.distinct(extensionIds.map(function (id) { return id.toLowerCase(); }));\n            this.storageService.store('extensions.ignoredAutoUpdateExtension', JSON.stringify(this._ignoredAutoUpdateExtensions), storage_1.StorageScope.GLOBAL);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtensionsWorkbenchService.prototype.ignoreAutoUpdate = function (identifierWithVersion) {\n        if (!this.isAutoUpdateIgnored(identifierWithVersion)) {\n            this.ignoredAutoUpdateExtensions = this.ignoredAutoUpdateExtensions.concat([identifierWithVersion.key()]);\n        }\n    };\n    ExtensionsWorkbenchService.prototype.isAutoUpdateIgnored = function (identifierWithVersion) {\n        return this.ignoredAutoUpdateExtensions.indexOf(identifierWithVersion.key()) !== -1;\n    };\n    ExtensionsWorkbenchService.prototype.resetIgnoreAutoUpdateExtensions = function () {\n        var _this = this;\n        this.ignoredAutoUpdateExtensions = this.ignoredAutoUpdateExtensions.filter(function (extensionId) { return _this.local.some(function (local) { return !!local.local && new extensions_2.ExtensionIdentifierWithVersion(local.identifier, local.version).key() === extensionId; }); });\n    };\n    ExtensionsWorkbenchService.prototype.dispose = function () {\n        this.syncDelayer.cancel();\n        this.disposables = lifecycle_1.dispose(this.disposables);\n    };\n    ExtensionsWorkbenchService.SyncPeriod = 1000 * 60 * 60 * 12; // 12 hours\n    ExtensionsWorkbenchService = tslib_1.__decorate([\n        tslib_1.__param(0, instantiation_1.IInstantiationService),\n        tslib_1.__param(1, editorService_1.IEditorService),\n        tslib_1.__param(2, extensionManagement_1.IExtensionManagementService),\n        tslib_1.__param(3, extensionManagement_1.IExtensionGalleryService),\n        tslib_1.__param(4, configuration_1.IConfigurationService),\n        tslib_1.__param(5, telemetry_1.ITelemetryService),\n        tslib_1.__param(6, notification_1.INotificationService),\n        tslib_1.__param(7, url_1.IURLService),\n        tslib_1.__param(8, extensionManagement_1.IExtensionEnablementService),\n        tslib_1.__param(9, windows_1.IWindowService),\n        tslib_1.__param(10, log_1.ILogService),\n        tslib_1.__param(11, progress_1.IProgressService2),\n        tslib_1.__param(12, extensionManagement_1.IExtensionManagementServerService),\n        tslib_1.__param(13, storage_1.IStorageService),\n        tslib_1.__param(14, files_1.IFileService)\n    ], ExtensionsWorkbenchService);\n    return ExtensionsWorkbenchService;\n}());\nexports.ExtensionsWorkbenchService = ExtensionsWorkbenchService;\n",{"version":3,"file":"/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/extensions/node/extensionsWorkbenchService.ts","sourceRoot":"","sources":["/home/coding/workspace/lib/vscode/src/vs/workbench/contrib/extensions/node/extensionsWorkbenchService.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from 'vs/nls';\nimport * as semver from 'semver';\nimport { Event, Emitter } from 'vs/base/common/event';\nimport { index, distinct } from 'vs/base/common/arrays';\nimport { ThrottledDelayer } from 'vs/base/common/async';\nimport { isPromiseCanceledError } from 'vs/base/common/errors';\nimport { IDisposable, dispose } from 'vs/base/common/lifecycle';\nimport { IPager, mapPager, singlePagePager } from 'vs/base/common/paging';\nimport { ITelemetryService } from 'vs/platform/telemetry/common/telemetry';\nimport {\n\tIExtensionManagementService, IExtensionGalleryService, ILocalExtension, IGalleryExtension, IQueryOptions,\n\tInstallExtensionEvent, DidInstallExtensionEvent, DidUninstallExtensionEvent, IExtensionEnablementService, IExtensionIdentifier, EnablementState, IExtensionManagementServerService\n} from 'vs/platform/extensionManagement/common/extensionManagement';\nimport { getGalleryExtensionTelemetryData, getLocalExtensionTelemetryData, areSameExtensions, getMaliciousExtensionsSet } from 'vs/platform/extensionManagement/common/extensionManagementUtil';\nimport { IInstantiationService } from 'vs/platform/instantiation/common/instantiation';\nimport { IConfigurationService } from 'vs/platform/configuration/common/configuration';\nimport { IWindowService } from 'vs/platform/windows/common/windows';\nimport Severity from 'vs/base/common/severity';\nimport { URI } from 'vs/base/common/uri';\nimport { IExtension, IExtensionDependencies, ExtensionState, IExtensionsWorkbenchService, AutoUpdateConfigurationKey, AutoCheckUpdatesConfigurationKey } from 'vs/workbench/contrib/extensions/common/extensions';\nimport { IEditorService, SIDE_GROUP, ACTIVE_GROUP } from 'vs/workbench/services/editor/common/editorService';\nimport { IURLService, IURLHandler } from 'vs/platform/url/common/url';\nimport { ExtensionsInput } from 'vs/workbench/contrib/extensions/common/extensionsInput';\nimport product from 'vs/platform/product/node/product';\nimport { ILogService } from 'vs/platform/log/common/log';\nimport { IProgressService2, ProgressLocation } from 'vs/platform/progress/common/progress';\nimport { INotificationService } from 'vs/platform/notification/common/notification';\nimport * as resources from 'vs/base/common/resources';\nimport { CancellationToken } from 'vs/base/common/cancellation';\nimport { IStorageService, StorageScope } from 'vs/platform/storage/common/storage';\nimport { IFileService } from 'vs/platform/files/common/files';\nimport { IExtensionManifest, ExtensionType, ExtensionIdentifierWithVersion, IExtension as IPlatformExtension } from 'vs/platform/extensions/common/extensions';\nimport { isUIExtension } from 'vs/workbench/services/extensions/node/extensionsUtil';\n\ninterface IExtensionStateProvider<T> {\n\t(extension: Extension): T;\n}\n\nclass Extension implements IExtension {\n\n\tpublic enablementState: EnablementState = EnablementState.Enabled;\n\n\tconstructor(\n\t\tprivate galleryService: IExtensionGalleryService,\n\t\tprivate stateProvider: IExtensionStateProvider<ExtensionState>,\n\t\tpublic local: ILocalExtension | undefined,\n\t\tpublic gallery: IGalleryExtension | undefined,\n\t\tprivate telemetryService: ITelemetryService,\n\t\tprivate logService: ILogService,\n\t\tprivate fileService: IFileService\n\t) { }\n\n\tget type(): ExtensionType | undefined {\n\t\treturn this.local ? this.local.type : undefined;\n\t}\n\n\tget name(): string {\n\t\treturn this.gallery ? this.gallery.name : this.local!.manifest.name;\n\t}\n\n\tget displayName(): string {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.displayName || this.gallery.name;\n\t\t}\n\n\t\treturn this.local!.manifest.displayName || this.local!.manifest.name;\n\t}\n\n\tget identifier(): IExtensionIdentifier {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.identifier;\n\t\t}\n\t\treturn this.local!.identifier;\n\t}\n\n\tget uuid(): string | undefined {\n\t\treturn this.gallery ? this.gallery.identifier.uuid : this.local!.identifier.uuid;\n\t}\n\n\tget publisher(): string {\n\t\treturn this.gallery ? this.gallery.publisher : this.local!.manifest.publisher;\n\t}\n\n\tget publisherDisplayName(): string {\n\t\tif (this.gallery) {\n\t\t\treturn this.gallery.publisherDisplayName || this.gallery.publisher;\n\t\t}\n\n\t\tif (this.local!.metadata && this.local!.metadata.publisherDisplayName) {\n\t\t\treturn this.local!.metadata.publisherDisplayName;\n\t\t}\n\n\t\treturn this.local!.manifest.publisher;\n\t}\n\n\tget version(): string {\n\t\treturn this.local ? this.local.manifest.version : this.latestVersion;\n\t}\n\n\tget latestVersion(): string {\n\t\treturn this.gallery ? this.gallery.version : this.local!.manifest.version;\n\t}\n\n\tget description(): string {\n\t\treturn this.gallery ? this.gallery.description : this.local!.manifest.description || '';\n\t}\n\n\tget url(): string | undefined {\n\t\tif (!product.extensionsGallery || !this.gallery) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn undefined; // `${product.extensionsGallery.itemUrl}?itemName=${this.publisher}.${this.name}`;\n\t}\n\n\tget iconUrl(): string {\n\t\treturn this.galleryIconUrl || this.localIconUrl || this.defaultIconUrl;\n\t}\n\n\tget iconUrlFallback(): string {\n\t\treturn this.galleryIconUrlFallback || this.localIconUrl || this.defaultIconUrl;\n\t}\n\n\tprivate get localIconUrl(): string | null {\n\t\tif (this.local && this.local.manifest.icon) {\n\t\t\treturn resources.joinPath(this.local.location, this.local.manifest.icon).toString();\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate get galleryIconUrl(): string | null {\n\t\treturn this.gallery ? this.gallery.assets.icon.uri : null;\n\t}\n\n\tprivate get galleryIconUrlFallback(): string | null {\n\t\treturn this.gallery ? this.gallery.assets.icon.fallbackUri : null;\n\t}\n\n\tprivate get defaultIconUrl(): string {\n\t\tif (this.type === ExtensionType.System && this.local) {\n\t\t\tif (this.local.manifest && this.local.manifest.contributes) {\n\t\t\t\tif (Array.isArray(this.local.manifest.contributes.themes) && this.local.manifest.contributes.themes.length) {\n\t\t\t\t\treturn require.toUrl('../electron-browser/media/theme-icon.png');\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(this.local.manifest.contributes.grammars) && this.local.manifest.contributes.grammars.length) {\n\t\t\t\t\treturn require.toUrl('../electron-browser/media/language-icon.svg');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn require.toUrl('../electron-browser/media/defaultIcon.png');\n\t}\n\n\tget repository(): string | undefined {\n\t\treturn this.gallery && this.gallery.assets.repository ? this.gallery.assets.repository.uri : undefined;\n\t}\n\n\tget licenseUrl(): string | undefined {\n\t\treturn this.gallery && this.gallery.assets.license ? this.gallery.assets.license.uri : undefined;\n\t}\n\n\tget state(): ExtensionState {\n\t\treturn this.stateProvider(this);\n\t}\n\n\tpublic isMalicious: boolean = false;\n\n\tget installCount(): number | undefined {\n\t\treturn this.gallery ? this.gallery.installCount : undefined;\n\t}\n\n\tget rating(): number | undefined {\n\t\treturn this.gallery ? this.gallery.rating : undefined;\n\t}\n\n\tget ratingCount(): number | undefined {\n\t\treturn this.gallery ? this.gallery.ratingCount : undefined;\n\t}\n\n\tget outdated(): boolean {\n\t\treturn !!this.gallery && this.type === ExtensionType.User && semver.gt(this.latestVersion, this.version);\n\t}\n\n\tget telemetryData(): any {\n\t\tconst { local, gallery } = this;\n\n\t\tif (gallery) {\n\t\t\treturn getGalleryExtensionTelemetryData(gallery);\n\t\t} else {\n\t\t\treturn getLocalExtensionTelemetryData(local!);\n\t\t}\n\t}\n\n\tget preview(): boolean {\n\t\treturn this.gallery ? this.gallery.preview : false;\n\t}\n\n\tprivate isGalleryOutdated(): boolean {\n\t\treturn this.local && this.gallery ? semver.gt(this.local.manifest.version, this.gallery.version) : false;\n\t}\n\n\tgetManifest(token: CancellationToken): Promise<IExtensionManifest | null> {\n\t\tif (this.gallery && !this.isGalleryOutdated()) {\n\t\t\tif (this.gallery.assets.manifest) {\n\t\t\t\treturn this.galleryService.getManifest(this.gallery, token);\n\t\t\t}\n\t\t\tthis.logService.error(nls.localize('Manifest is not found', \"Manifest is not found\"), this.identifier.id);\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\treturn Promise.resolve(this.local!.manifest);\n\t}\n\n\thasReadme(): boolean {\n\t\tif (this.gallery && !this.isGalleryOutdated() && this.gallery.assets.readme) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.local && this.local.readmeUrl) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.type === ExtensionType.System;\n\t}\n\n\tgetReadme(token: CancellationToken): Promise<string> {\n\t\tif (this.gallery && !this.isGalleryOutdated()) {\n\t\t\tif (this.gallery.assets.readme) {\n\t\t\t\treturn this.galleryService.getReadme(this.gallery, token);\n\t\t\t}\n\t\t\tthis.telemetryService.publicLog('extensions:NotFoundReadMe', this.telemetryData);\n\t\t}\n\n\t\tif (this.local && this.local.readmeUrl) {\n\t\t\treturn this.fileService.resolveContent(this.local.readmeUrl, { encoding: 'utf8' }).then(content => content.value);\n\t\t}\n\n\t\tif (this.type === ExtensionType.System) {\n\t\t\treturn Promise.resolve(`# ${this.displayName || this.name}\n**Notice:** This extension is bundled with Visual Studio Code. It can be disabled but not uninstalled.\n## Features\n${this.description}\n`);\n\t\t}\n\n\t\treturn Promise.reject(new Error('not available'));\n\t}\n\n\thasChangelog(): boolean {\n\t\tif (this.gallery && this.gallery.assets.changelog && !this.isGalleryOutdated()) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.local && this.local.changelogUrl) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.type === ExtensionType.System;\n\t}\n\n\tgetChangelog(token: CancellationToken): Promise<string> {\n\t\tif (this.gallery && this.gallery.assets.changelog && !this.isGalleryOutdated()) {\n\t\t\treturn this.galleryService.getChangelog(this.gallery, token);\n\t\t}\n\n\t\tconst changelogUrl = this.local && this.local.changelogUrl;\n\n\t\tif (!changelogUrl) {\n\t\t\tif (this.type === ExtensionType.System) {\n\t\t\t\treturn Promise.resolve('Please check the [VS Code Release Notes](command:update.showCurrentReleaseNotes) for changes to the built-in extensions.');\n\t\t\t}\n\n\t\t\treturn Promise.reject(new Error('not available'));\n\t\t}\n\n\t\treturn this.fileService.resolveContent(changelogUrl, { encoding: 'utf8' }).then(content => content.value);\n\t}\n\n\tget dependencies(): string[] {\n\t\tconst { local, gallery } = this;\n\t\tif (gallery && !this.isGalleryOutdated()) {\n\t\t\treturn gallery.properties.dependencies || [];\n\t\t}\n\t\tif (local && local.manifest.extensionDependencies) {\n\t\t\treturn local.manifest.extensionDependencies;\n\t\t}\n\t\treturn [];\n\t}\n\n\tget extensionPack(): string[] {\n\t\tconst { local, gallery } = this;\n\t\tif (gallery && !this.isGalleryOutdated()) {\n\t\t\treturn gallery.properties.extensionPack || [];\n\t\t}\n\t\tif (local && local.manifest.extensionPack) {\n\t\t\treturn local.manifest.extensionPack;\n\t\t}\n\t\treturn [];\n\t}\n}\n\nclass ExtensionDependencies implements IExtensionDependencies {\n\n\tprivate _hasDependencies: boolean | null = null;\n\n\tconstructor(private _extension: IExtension, private _identifier: string, private _map: Map<string, IExtension>, private _dependent: IExtensionDependencies | null = null) { }\n\n\tget hasDependencies(): boolean {\n\t\tif (this._hasDependencies === null) {\n\t\t\tthis._hasDependencies = this.computeHasDependencies();\n\t\t}\n\t\treturn this._hasDependencies;\n\t}\n\n\tget extension(): IExtension {\n\t\treturn this._extension;\n\t}\n\n\tget identifier(): string {\n\t\treturn this._identifier;\n\t}\n\n\tget dependent(): IExtensionDependencies | null {\n\t\treturn this._dependent;\n\t}\n\n\tget dependencies(): IExtensionDependencies[] {\n\t\tif (!this.hasDependencies) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this._extension.dependencies.map(id => new ExtensionDependencies(this._map.get(id)!, id, this._map, this));\n\t}\n\n\tprivate computeHasDependencies(): boolean {\n\t\tif (this._extension && this._extension.dependencies.length > 0) {\n\t\t\tlet dependent = this._dependent;\n\t\t\twhile (dependent !== null) {\n\t\t\t\tif (dependent.identifier === this.identifier) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tdependent = dependent.dependent;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n}\n\nexport class ExtensionsWorkbenchService implements IExtensionsWorkbenchService, IURLHandler {\n\n\tprivate static readonly SyncPeriod = 1000 * 60 * 60 * 12; // 12 hours\n\t_serviceBrand: any;\n\tprivate stateProvider: IExtensionStateProvider<ExtensionState>;\n\tprivate installing: Extension[] = [];\n\tprivate uninstalling: Extension[] = [];\n\tprivate installed: Extension[] = [];\n\tprivate syncDelayer: ThrottledDelayer<void>;\n\tprivate autoUpdateDelayer: ThrottledDelayer<void>;\n\tprivate disposables: IDisposable[] = [];\n\n\tprivate readonly _onChange: Emitter<IExtension | undefined> = new Emitter<IExtension | undefined>();\n\tget onChange(): Event<IExtension | undefined> { return this._onChange.event; }\n\n\tprivate _extensionAllowedBadgeProviders: string[];\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IExtensionManagementService private readonly extensionService: IExtensionManagementService,\n\t\t@IExtensionGalleryService private readonly galleryService: IExtensionGalleryService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IURLService urlService: IURLService,\n\t\t@IExtensionEnablementService private readonly extensionEnablementService: IExtensionEnablementService,\n\t\t@IWindowService private readonly windowService: IWindowService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IProgressService2 private readonly progressService: IProgressService2,\n\t\t@IExtensionManagementServerService private readonly extensionManagementServerService: IExtensionManagementServerService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IFileService private readonly fileService: IFileService\n\t) {\n\t\tthis.stateProvider = ext => this.getExtensionState(ext);\n\n\t\textensionService.onInstallExtension(this.onInstallExtension, this, this.disposables);\n\t\textensionService.onDidInstallExtension(this.onDidInstallExtension, this, this.disposables);\n\t\textensionService.onUninstallExtension(this.onUninstallExtension, this, this.disposables);\n\t\textensionService.onDidUninstallExtension(this.onDidUninstallExtension, this, this.disposables);\n\t\textensionEnablementService.onEnablementChanged(this.onEnablementChanged, this, this.disposables);\n\n\t\tthis.syncDelayer = new ThrottledDelayer<void>(ExtensionsWorkbenchService.SyncPeriod);\n\t\tthis.autoUpdateDelayer = new ThrottledDelayer<void>(1000);\n\n\t\turlService.registerHandler(this);\n\n\t\tthis.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AutoUpdateConfigurationKey)) {\n\t\t\t\tif (this.isAutoUpdateEnabled()) {\n\t\t\t\t\tthis.checkForUpdates();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (e.affectsConfiguration(AutoCheckUpdatesConfigurationKey)) {\n\t\t\t\tif (this.isAutoCheckUpdatesEnabled()) {\n\t\t\t\t\tthis.checkForUpdates();\n\t\t\t\t}\n\t\t\t}\n\t\t}, this, this.disposables);\n\n\t\tthis.queryLocal().then(() => {\n\t\t\tthis.resetIgnoreAutoUpdateExtensions();\n\t\t\tthis.eventuallySyncWithGallery(true);\n\t\t});\n\t}\n\n\tget local(): IExtension[] {\n\t\tconst installing = this.installing\n\t\t\t.filter(e => !this.installed.some(installed => areSameExtensions(installed.identifier, e.identifier)))\n\t\t\t.map(e => e);\n\n\t\treturn [...this.installed, ...installing];\n\t}\n\n\tqueryLocal(): Promise<IExtension[]> {\n\t\treturn this.extensionService.getInstalled()\n\t\t\t.then(installed => {\n\t\t\t\tif (this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\t\t\tinstalled = installed.filter(installed => this.belongsToWindow(installed));\n\t\t\t\t}\n\t\t\t\tconst installedById = index(this.installed, e => e.identifier.id);\n\t\t\t\tthis.installed = installed.map(local => {\n\t\t\t\t\tconst extension = installedById[local.identifier.id] || new Extension(this.galleryService, this.stateProvider, local, undefined, this.telemetryService, this.logService, this.fileService);\n\t\t\t\t\textension.enablementState = this.extensionEnablementService.getEnablementState(local);\n\t\t\t\t\treturn extension;\n\t\t\t\t});\n\n\t\t\t\tthis._onChange.fire(undefined);\n\t\t\t\treturn this.local;\n\t\t\t});\n\t}\n\n\tqueryGallery(token: CancellationToken): Promise<IPager<IExtension>>;\n\tqueryGallery(options: IQueryOptions, token: CancellationToken): Promise<IPager<IExtension>>;\n\tqueryGallery(arg1: any, arg2?: any): Promise<IPager<IExtension>> {\n\t\tconst options: IQueryOptions = CancellationToken.isCancellationToken(arg1) ? {} : arg1;\n\t\tconst token: CancellationToken = CancellationToken.isCancellationToken(arg1) ? arg1 : arg2;\n\t\treturn this.extensionService.getExtensionsReport()\n\t\t\t.then(report => {\n\t\t\t\tconst maliciousSet = getMaliciousExtensionsSet(report);\n\n\t\t\t\treturn this.galleryService.query(options, token)\n\t\t\t\t\t.then(result => mapPager(result, gallery => this.fromGallery(gallery, maliciousSet)))\n\t\t\t\t\t.then(undefined, err => {\n\t\t\t\t\t\tif (/No extension gallery service configured/.test(err.message)) {\n\t\t\t\t\t\t\treturn Promise.resolve(singlePagePager([]));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Promise.reject<IPager<IExtension>>(err);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tloadDependencies(extension: IExtension, token: CancellationToken): Promise<IExtensionDependencies | null> {\n\t\tif (!extension.dependencies.length) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\treturn this.extensionService.getExtensionsReport()\n\t\t\t.then(report => {\n\t\t\t\tconst maliciousSet = getMaliciousExtensionsSet(report);\n\n\t\t\t\treturn this.galleryService.loadAllDependencies((<Extension>extension).dependencies.map(id => ({ id })), token)\n\t\t\t\t\t.then(galleryExtensions => {\n\t\t\t\t\t\tconst extensions: IExtension[] = [...this.local, ...galleryExtensions.map(galleryExtension => this.fromGallery(galleryExtension, maliciousSet))];\n\t\t\t\t\t\tconst map = new Map<string, IExtension>();\n\t\t\t\t\t\tfor (const extension of extensions) {\n\t\t\t\t\t\t\tmap.set(extension.identifier.id, extension);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn new ExtensionDependencies(extension, extension.identifier.id, map);\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\topen(extension: IExtension, sideByside: boolean = false): Promise<any> {\n\t\treturn Promise.resolve(this.editorService.openEditor(this.instantiationService.createInstance(ExtensionsInput, extension), undefined, sideByside ? SIDE_GROUP : ACTIVE_GROUP));\n\t}\n\n\tprivate belongsToWindow(extension: ILocalExtension): boolean {\n\t\tif (!this.extensionManagementServerService.remoteExtensionManagementServer) {\n\t\t\treturn true;\n\t\t}\n\t\tconst extensionManagementServer = this.extensionManagementServerService.getExtensionManagementServer(extension.location);\n\t\tif (isUIExtension(extension.manifest, this.configurationService)) {\n\t\t\tif (this.extensionManagementServerService.localExtensionManagementServer === extensionManagementServer) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.extensionManagementServerService.remoteExtensionManagementServer === extensionManagementServer) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate fromGallery(gallery: IGalleryExtension, maliciousExtensionSet: Set<string>): Extension {\n\t\tlet result = this.getInstalledExtensionMatchingGallery(gallery);\n\n\t\tif (result) {\n\t\t\t// Loading the compatible version only there is an engine property\n\t\t\t// Otherwise falling back to old way so that we will not make many roundtrips\n\t\t\tif (gallery.properties.engine) {\n\t\t\t\tthis.galleryService.getCompatibleExtension(gallery)\n\t\t\t\t\t.then(compatible => compatible ? this.syncLocalWithGalleryExtension(result!, compatible) : null);\n\t\t\t} else {\n\t\t\t\tthis.syncLocalWithGalleryExtension(result, gallery);\n\t\t\t}\n\t\t} else {\n\t\t\tresult = new Extension(this.galleryService, this.stateProvider, undefined, gallery, this.telemetryService, this.logService, this.fileService);\n\t\t}\n\n\t\tif (maliciousExtensionSet.has(result.identifier.id)) {\n\t\t\tresult.isMalicious = true;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate getInstalledExtensionMatchingGallery(gallery: IGalleryExtension): Extension | null {\n\t\tfor (const installed of this.installed) {\n\t\t\tif (installed.uuid) { // Installed from Gallery\n\t\t\t\tif (installed.uuid === gallery.identifier.uuid) {\n\t\t\t\t\treturn installed;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (areSameExtensions(installed.identifier, gallery.identifier)) { // Installed from other sources\n\t\t\t\t\treturn installed;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate syncLocalWithGalleryExtension(extension: Extension, gallery: IGalleryExtension) {\n\t\t// Sync the local extension with gallery extension if local extension doesnot has metadata\n\t\tif (extension.local) {\n\t\t\t(extension.local.metadata ? Promise.resolve(extension.local) : this.extensionService.updateMetadata(extension.local, { id: gallery.identifier.uuid, publisherDisplayName: gallery.publisherDisplayName, publisherId: gallery.publisherId }))\n\t\t\t\t.then(local => {\n\t\t\t\t\textension.local = local;\n\t\t\t\t\textension.gallery = gallery;\n\t\t\t\t\tthis._onChange.fire(extension);\n\t\t\t\t\tthis.eventuallyAutoUpdateExtensions();\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis._onChange.fire(extension);\n\t\t}\n\t}\n\n\tcheckForUpdates(): Promise<void> {\n\t\treturn Promise.resolve(this.syncDelayer.trigger(() => this.syncWithGallery(), 0));\n\t}\n\n\tprivate isAutoUpdateEnabled(): boolean {\n\t\treturn this.configurationService.getValue(AutoUpdateConfigurationKey);\n\t}\n\n\tprivate isAutoCheckUpdatesEnabled(): boolean {\n\t\treturn this.configurationService.getValue(AutoCheckUpdatesConfigurationKey);\n\t}\n\n\tprivate eventuallySyncWithGallery(immediate = false): void {\n\t\tconst shouldSync = this.isAutoUpdateEnabled() || this.isAutoCheckUpdatesEnabled();\n\t\tconst loop = () => (shouldSync ? this.syncWithGallery() : Promise.resolve(undefined)).then(() => this.eventuallySyncWithGallery());\n\t\tconst delay = immediate ? 0 : ExtensionsWorkbenchService.SyncPeriod;\n\n\t\tthis.syncDelayer.trigger(loop, delay)\n\t\t\t.then(undefined, err => null);\n\t}\n\n\tprivate syncWithGallery(): Promise<void> {\n\t\tconst ids: string[] = [], names: string[] = [];\n\t\tfor (const installed of this.installed) {\n\t\t\tif (installed.type === ExtensionType.User) {\n\t\t\t\tif (installed.uuid) {\n\t\t\t\t\tids.push(installed.uuid);\n\t\t\t\t} else {\n\t\t\t\t\tnames.push(installed.identifier.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst promises: Promise<IPager<IExtension>>[] = [];\n\t\tif (ids.length) {\n\t\t\tpromises.push(this.queryGallery({ ids, pageSize: ids.length }, CancellationToken.None));\n\t\t}\n\t\tif (names.length) {\n\t\t\tpromises.push(this.queryGallery({ names, pageSize: names.length }, CancellationToken.None));\n\t\t}\n\n\t\treturn Promise.all(promises).then(() => undefined);\n\t}\n\n\tprivate eventuallyAutoUpdateExtensions(): void {\n\t\tthis.autoUpdateDelayer.trigger(() => this.autoUpdateExtensions())\n\t\t\t.then(undefined, err => null);\n\t}\n\n\tprivate autoUpdateExtensions(): Promise<any> {\n\t\tif (!this.isAutoUpdateEnabled()) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst toUpdate = this.local.filter(e =>\n\t\t\te.outdated && e.state !== ExtensionState.Installing\n\t\t\t&& e.local && !this.isAutoUpdateIgnored(new ExtensionIdentifierWithVersion(e.identifier, e.version)));\n\t\treturn Promise.all(toUpdate.map(e => this.install(e)));\n\t}\n\n\tcanInstall(extension: IExtension): boolean {\n\t\tif (!(extension instanceof Extension)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (extension.isMalicious) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!(extension as Extension).gallery;\n\t}\n\n\tinstall(extension: string | IExtension): Promise<IExtension> {\n\t\tif (typeof extension === 'string') {\n\t\t\treturn this.installWithProgress(async () => {\n\t\t\t\tconst extensionIdentifier = await this.extensionService.install(URI.file(extension));\n\t\t\t\tthis.checkAndEnableDisabledDependencies(extensionIdentifier);\n\t\t\t\treturn this.local.filter(local => areSameExtensions(local.identifier, extensionIdentifier))[0];\n\t\t\t});\n\t\t}\n\n\t\tif (extension.isMalicious) {\n\t\t\treturn Promise.reject(new Error(nls.localize('malicious', \"This extension is reported to be problematic.\")));\n\t\t}\n\n\t\tconst gallery = extension.gallery;\n\n\t\tif (!gallery) {\n\t\t\treturn Promise.reject(new Error('Missing gallery'));\n\t\t}\n\n\t\treturn this.installWithProgress(async () => {\n\t\t\tawait this.extensionService.installFromGallery(gallery);\n\t\t\tthis.checkAndEnableDisabledDependencies(gallery.identifier);\n\t\t\treturn this.local.filter(local => areSameExtensions(local.identifier, gallery.identifier))[0];\n\t\t}, gallery.displayName);\n\t}\n\n\tsetEnablement(extensions: IExtension | IExtension[], enablementState: EnablementState): Promise<void> {\n\t\textensions = Array.isArray(extensions) ? extensions : [extensions];\n\t\treturn this.promptAndSetEnablement(extensions, enablementState);\n\t}\n\n\tuninstall(extension: IExtension): Promise<void> {\n\t\tconst ext = extension.local ? extension : this.installed.filter(e => areSameExtensions(e.identifier, extension.identifier))[0];\n\t\tconst toUninstall: ILocalExtension | null = ext && ext.local ? ext.local : null;\n\n\t\tif (!toUninstall) {\n\t\t\treturn Promise.reject(new Error('Missing local'));\n\t\t}\n\n\t\tthis.logService.info(`Requested uninstalling the extension ${extension.identifier.id} from window ${this.windowService.getCurrentWindowId()}`);\n\t\treturn this.progressService.withProgress({\n\t\t\tlocation: ProgressLocation.Extensions,\n\t\t\ttitle: nls.localize('uninstallingExtension', 'Uninstalling extension....'),\n\t\t\tsource: `${toUninstall.identifier.id}`\n\t\t}, () => this.extensionService.uninstall(toUninstall).then(() => undefined));\n\t}\n\n\tinstallVersion(extension: IExtension, version: string): Promise<IExtension> {\n\t\tif (!(extension instanceof Extension)) {\n\t\t\treturn Promise.resolve(extension);\n\t\t}\n\n\t\tif (!extension.gallery) {\n\t\t\treturn Promise.reject(new Error('Missing gallery'));\n\t\t}\n\n\t\treturn this.galleryService.getCompatibleExtension(extension.gallery.identifier, version)\n\t\t\t.then(gallery => {\n\t\t\t\tif (!gallery) {\n\t\t\t\t\treturn Promise.reject(new Error(nls.localize('incompatible', \"Unable to install extension '{0}' with version '{1}' as it is not compatible with VS Code.\", extension.gallery!.identifier.id, version)));\n\t\t\t\t}\n\t\t\t\treturn this.installWithProgress(async () => {\n\t\t\t\t\tawait this.extensionService.installFromGallery(gallery);\n\t\t\t\t\tif (extension.latestVersion !== version) {\n\t\t\t\t\t\tthis.ignoreAutoUpdate(new ExtensionIdentifierWithVersion(gallery.identifier, version));\n\t\t\t\t\t}\n\t\t\t\t\treturn this.local.filter(local => areSameExtensions(local.identifier, gallery.identifier))[0];\n\t\t\t\t}\n\t\t\t\t\t, gallery.displayName);\n\t\t\t});\n\t}\n\n\treinstall(extension: IExtension): Promise<IExtension> {\n\t\tconst ext = extension.local ? extension : this.installed.filter(e => areSameExtensions(e.identifier, extension.identifier))[0];\n\t\tconst toReinstall: ILocalExtension | null = ext && ext.local ? ext.local : null;\n\n\t\tif (!toReinstall) {\n\t\t\treturn Promise.reject(new Error('Missing local'));\n\t\t}\n\n\t\treturn this.progressService.withProgress({\n\t\t\tlocation: ProgressLocation.Extensions,\n\t\t\tsource: `${toReinstall.identifier.id}`\n\t\t}, () => this.extensionService.reinstallFromGallery(toReinstall).then(() => this.local.filter(local => areSameExtensions(local.identifier, extension.identifier))[0]));\n\t}\n\n\tprivate installWithProgress<T>(installTask: () => Promise<T>, extensionName?: string): Promise<T> {\n\t\tconst title = extensionName ? nls.localize('installing named extension', \"Installing '{0}' extension....\", extensionName) : nls.localize('installing extension', 'Installing extension....');\n\t\treturn this.progressService.withProgress({\n\t\t\tlocation: ProgressLocation.Extensions,\n\t\t\ttitle\n\t\t}, () => installTask());\n\t}\n\n\tprivate checkAndEnableDisabledDependencies(extensionIdentifier: IExtensionIdentifier): Promise<void> {\n\t\tconst extension = this.local.filter(e => (e.local || e.gallery) && areSameExtensions(extensionIdentifier, e.identifier))[0];\n\t\tif (extension) {\n\t\t\tconst disabledDepencies = this.getExtensionsRecursively([extension], this.local, EnablementState.Enabled, { dependencies: true, pack: false });\n\t\t\tif (disabledDepencies.length) {\n\t\t\t\treturn this.setEnablement(disabledDepencies, EnablementState.Enabled);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n\n\tprivate promptAndSetEnablement(extensions: IExtension[], enablementState: EnablementState): Promise<any> {\n\t\tconst enable = enablementState === EnablementState.Enabled || enablementState === EnablementState.WorkspaceEnabled;\n\t\tif (enable) {\n\t\t\tconst allDependenciesAndPackedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: true, pack: true });\n\t\t\treturn this.checkAndSetEnablement(extensions, allDependenciesAndPackedExtensions, enablementState);\n\t\t} else {\n\t\t\tconst packedExtensions = this.getExtensionsRecursively(extensions, this.local, enablementState, { dependencies: false, pack: true });\n\t\t\tif (packedExtensions.length) {\n\t\t\t\treturn this.checkAndSetEnablement(extensions, packedExtensions, enablementState);\n\t\t\t}\n\t\t\treturn this.checkAndSetEnablement(extensions, [], enablementState);\n\t\t}\n\t}\n\n\tprivate checkAndSetEnablement(extensions: IExtension[], otherExtensions: IExtension[], enablementState: EnablementState): Promise<any> {\n\t\tconst allExtensions = [...extensions, ...otherExtensions];\n\t\tconst enable = enablementState === EnablementState.Enabled || enablementState === EnablementState.WorkspaceEnabled;\n\t\tif (!enable) {\n\t\t\tfor (const extension of extensions) {\n\t\t\t\tlet dependents = this.getDependentsAfterDisablement(extension, allExtensions, this.local);\n\t\t\t\tif (dependents.length) {\n\t\t\t\t\treturn Promise.reject(new Error(this.getDependentsErrorMessage(extension, allExtensions, dependents)));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.doSetEnablement(allExtensions, enablementState);\n\t}\n\n\tprivate getExtensionsRecursively(extensions: IExtension[], installed: IExtension[], enablementState: EnablementState, options: { dependencies: boolean, pack: boolean }, checked: IExtension[] = []): IExtension[] {\n\t\tconst toCheck = extensions.filter(e => checked.indexOf(e) === -1);\n\t\tif (toCheck.length) {\n\t\t\tfor (const extension of toCheck) {\n\t\t\t\tchecked.push(extension);\n\t\t\t}\n\t\t\tconst extensionsToDisable = installed.filter(i => {\n\t\t\t\tif (checked.indexOf(i) !== -1) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif (i.enablementState === enablementState) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst enable = enablementState === EnablementState.Enabled || enablementState === EnablementState.WorkspaceEnabled;\n\t\t\t\treturn (enable || i.type === ExtensionType.User) // Include all Extensions for enablement and only user extensions for disablement\n\t\t\t\t\t&& (options.dependencies || options.pack)\n\t\t\t\t\t&& extensions.some(extension =>\n\t\t\t\t\t\t(options.dependencies && extension.dependencies.some(id => areSameExtensions({ id }, i.identifier)))\n\t\t\t\t\t\t|| (options.pack && extension.extensionPack.some(id => areSameExtensions({ id }, i.identifier)))\n\t\t\t\t\t);\n\t\t\t});\n\t\t\tif (extensionsToDisable.length) {\n\t\t\t\textensionsToDisable.push(...this.getExtensionsRecursively(extensionsToDisable, installed, enablementState, options, checked));\n\t\t\t}\n\t\t\treturn extensionsToDisable;\n\t\t}\n\t\treturn [];\n\t}\n\n\tprivate getDependentsAfterDisablement(extension: IExtension, extensionsToDisable: IExtension[], installed: IExtension[]): IExtension[] {\n\t\treturn installed.filter(i => {\n\t\t\tif (i.dependencies.length === 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (i === extension) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (i.enablementState === EnablementState.WorkspaceDisabled || i.enablementState === EnablementState.Disabled) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (extensionsToDisable.indexOf(i) !== -1) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn i.dependencies.some(dep => [extension, ...extensionsToDisable].some(d => areSameExtensions(d.identifier, { id: dep })));\n\t\t});\n\t}\n\n\tprivate getDependentsErrorMessage(extension: IExtension, allDisabledExtensions: IExtension[], dependents: IExtension[]): string {\n\t\tfor (const e of [extension, ...allDisabledExtensions]) {\n\t\t\tlet dependentsOfTheExtension = dependents.filter(d => d.dependencies.some(id => areSameExtensions({ id }, e.identifier)));\n\t\t\tif (dependentsOfTheExtension.length) {\n\t\t\t\treturn this.getErrorMessageForDisablingAnExtensionWithDependents(e, dependentsOfTheExtension);\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\n\tprivate getErrorMessageForDisablingAnExtensionWithDependents(extension: IExtension, dependents: IExtension[]): string {\n\t\tif (dependents.length === 1) {\n\t\t\treturn nls.localize('singleDependentError', \"Cannot disable extension '{0}'. Extension '{1}' depends on this.\", extension.displayName, dependents[0].displayName);\n\t\t}\n\t\tif (dependents.length === 2) {\n\t\t\treturn nls.localize('twoDependentsError', \"Cannot disable extension '{0}'. Extensions '{1}' and '{2}' depend on this.\",\n\t\t\t\textension.displayName, dependents[0].displayName, dependents[1].displayName);\n\t\t}\n\t\treturn nls.localize('multipleDependentsError', \"Cannot disable extension '{0}'. Extensions '{1}', '{2}' and others depend on this.\",\n\t\t\textension.displayName, dependents[0].displayName, dependents[1].displayName);\n\t}\n\n\tprivate async doSetEnablement(extensions: IExtension[], enablementState: EnablementState): Promise<boolean[]> {\n\t\tconst changed = await this.extensionEnablementService.setEnablement(extensions.map(e => e.local!), enablementState);\n\t\tfor (let i = 0; i < changed.length; i++) {\n\t\t\tif (changed[i]) {\n\t\t\t\t/* __GDPR__\n\t\t\t\t\"extension:enable\" : {\n\t\t\t\t\t\"${include}\": [\n\t\t\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\t/* __GDPR__\n\t\t\t\t\"extension:disable\" : {\n\t\t\t\t\t\"${include}\": [\n\t\t\t\t\t\t\"${GalleryExtensionTelemetryData}\"\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\t*/\n\t\t\t\tthis.telemetryService.publicLog(enablementState === EnablementState.Enabled || enablementState === EnablementState.WorkspaceEnabled ? 'extension:enable' : 'extension:disable', extensions[i].telemetryData);\n\t\t\t}\n\t\t}\n\t\treturn changed;\n\t}\n\n\tget allowedBadgeProviders(): string[] {\n\t\tif (!this._extensionAllowedBadgeProviders) {\n\t\t\tthis._extensionAllowedBadgeProviders = (product.extensionAllowedBadgeProviders || []).map(s => s.toLowerCase());\n\t\t}\n\t\treturn this._extensionAllowedBadgeProviders;\n\t}\n\n\tprivate onInstallExtension(event: InstallExtensionEvent): void {\n\t\tconst { gallery } = event;\n\n\t\tif (!gallery) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet extension = this.installed.filter(e => areSameExtensions(e.identifier, gallery.identifier))[0];\n\n\t\tif (!extension) {\n\t\t\textension = new Extension(this.galleryService, this.stateProvider, undefined, gallery, this.telemetryService, this.logService, this.fileService);\n\t\t}\n\n\t\tthis.installing.push(extension);\n\n\t\tthis._onChange.fire(extension);\n\t}\n\n\tprivate onDidInstallExtension(event: DidInstallExtensionEvent): void {\n\t\tconst { local, zipPath, error, gallery } = event;\n\t\tconst installingExtension = gallery ? this.installing.filter(e => areSameExtensions(e.identifier, gallery.identifier))[0] : null;\n\t\tthis.installing = installingExtension ? this.installing.filter(e => e !== installingExtension) : this.installing;\n\n\t\tif (local && !this.belongsToWindow(local)) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet extension: Extension | undefined = installingExtension ? installingExtension : zipPath ? new Extension(this.galleryService, this.stateProvider, local, undefined, this.telemetryService, this.logService, this.fileService) : undefined;\n\t\tif (extension) {\n\t\t\tif (local) {\n\t\t\t\tconst installed = this.installed.filter(e => areSameExtensions(e.identifier, extension!.identifier))[0];\n\t\t\t\tif (installed) {\n\t\t\t\t\textension = installed;\n\t\t\t\t} else {\n\t\t\t\t\tthis.installed.push(extension);\n\t\t\t\t}\n\t\t\t\textension.local = local;\n\t\t\t\textension.gallery = gallery;\n\t\t\t}\n\t\t}\n\t\tthis._onChange.fire(error ? undefined : extension);\n\t}\n\n\tprivate onUninstallExtension(identifier: IExtensionIdentifier): void {\n\t\tconst extension = this.installed.filter(e => areSameExtensions(e.identifier, identifier))[0];\n\t\tif (!extension) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst uninstalling = this.uninstalling.filter(e => areSameExtensions(e.identifier, identifier))[0] || extension;\n\t\tthis.uninstalling = [uninstalling, ...this.uninstalling.filter(e => !areSameExtensions(e.identifier, identifier))];\n\n\t\tthis._onChange.fire(uninstalling);\n\t}\n\n\tprivate onDidUninstallExtension({ identifier, error }: DidUninstallExtensionEvent): void {\n\t\tif (!error) {\n\t\t\tthis.installed = this.installed.filter(e => !areSameExtensions(e.identifier, identifier));\n\t\t}\n\n\t\tconst uninstalling = this.uninstalling.filter(e => areSameExtensions(e.identifier, identifier))[0];\n\t\tthis.uninstalling = this.uninstalling.filter(e => !areSameExtensions(e.identifier, identifier));\n\t\tif (!uninstalling) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._onChange.fire(uninstalling);\n\t}\n\n\tprivate onEnablementChanged(platformExtensions: IPlatformExtension[]) {\n\t\tconst extensions = this.local.filter(e => platformExtensions.some(p => areSameExtensions(e.identifier, p.identifier)));\n\t\tfor (const extension of extensions) {\n\t\t\tif (extension.local) {\n\t\t\t\tconst enablementState = this.extensionEnablementService.getEnablementState(extension.local);\n\t\t\t\tif (enablementState !== extension.enablementState) {\n\t\t\t\t\textension.enablementState = enablementState;\n\t\t\t\t\tthis._onChange.fire(extension);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate getExtensionState(extension: Extension): ExtensionState {\n\t\tif (extension.gallery && this.installing.some(e => !!e.gallery && areSameExtensions(e.gallery.identifier, extension.gallery!.identifier))) {\n\t\t\treturn ExtensionState.Installing;\n\t\t}\n\n\t\tif (this.uninstalling.some(e => areSameExtensions(e.identifier, extension.identifier))) {\n\t\t\treturn ExtensionState.Uninstalling;\n\t\t}\n\n\t\tconst local = this.installed.filter(e => e === extension || (e.gallery && extension.gallery && areSameExtensions(e.gallery.identifier, extension.gallery.identifier)))[0];\n\t\treturn local ? ExtensionState.Installed : ExtensionState.Uninstalled;\n\t}\n\n\tprivate onError(err: any): void {\n\t\tif (isPromiseCanceledError(err)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = err && err.message || '';\n\n\t\tif (/getaddrinfo ENOTFOUND|getaddrinfo ENOENT|connect EACCES|connect ECONNREFUSED/.test(message)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.notificationService.error(err);\n\t}\n\n\thandleURL(uri: URI): Promise<boolean> {\n\t\tif (!/^extension/.test(uri.path)) {\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.onOpenExtensionUrl(uri);\n\t\treturn Promise.resolve(true);\n\t}\n\n\tprivate onOpenExtensionUrl(uri: URI): void {\n\t\tconst match = /^extension\\/([^/]+)$/.exec(uri.path);\n\n\t\tif (!match) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst extensionId = match[1];\n\n\t\tthis.queryLocal().then(local => {\n\t\t\tconst extension = local.filter(local => areSameExtensions(local.identifier, { id: extensionId }))[0];\n\n\t\t\tif (extension) {\n\t\t\t\treturn this.windowService.focusWindow()\n\t\t\t\t\t.then(() => this.open(extension));\n\t\t\t}\n\n\t\t\treturn this.queryGallery({ names: [extensionId], source: 'uri' }, CancellationToken.None).then(result => {\n\t\t\t\tif (result.total < 1) {\n\t\t\t\t\treturn Promise.resolve(null);\n\t\t\t\t}\n\n\t\t\t\tconst extension = result.firstPage[0];\n\n\t\t\t\treturn this.windowService.focusWindow().then(() => {\n\t\t\t\t\treturn this.open(extension).then(() => {\n\t\t\t\t\t\tthis.notificationService.prompt(\n\t\t\t\t\t\t\tSeverity.Info,\n\t\t\t\t\t\t\tnls.localize('installConfirmation', \"Would you like to install the '{0}' extension?\", extension.displayName, extension.publisher),\n\t\t\t\t\t\t\t[{\n\t\t\t\t\t\t\t\tlabel: nls.localize('install', \"Install\"),\n\t\t\t\t\t\t\t\trun: () => this.install(extension).then(undefined, error => this.onError(error))\n\t\t\t\t\t\t\t}],\n\t\t\t\t\t\t\t{ sticky: true }\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(undefined, error => this.onError(error));\n\t}\n\n\n\tprivate _ignoredAutoUpdateExtensions: string[];\n\tprivate get ignoredAutoUpdateExtensions(): string[] {\n\t\tif (!this._ignoredAutoUpdateExtensions) {\n\t\t\tthis._ignoredAutoUpdateExtensions = JSON.parse(this.storageService.get('extensions.ignoredAutoUpdateExtension', StorageScope.GLOBAL, '[]') || '[]');\n\t\t}\n\t\treturn this._ignoredAutoUpdateExtensions;\n\t}\n\n\tprivate set ignoredAutoUpdateExtensions(extensionIds: string[]) {\n\t\tthis._ignoredAutoUpdateExtensions = distinct(extensionIds.map(id => id.toLowerCase()));\n\t\tthis.storageService.store('extensions.ignoredAutoUpdateExtension', JSON.stringify(this._ignoredAutoUpdateExtensions), StorageScope.GLOBAL);\n\t}\n\n\tprivate ignoreAutoUpdate(identifierWithVersion: ExtensionIdentifierWithVersion): void {\n\t\tif (!this.isAutoUpdateIgnored(identifierWithVersion)) {\n\t\t\tthis.ignoredAutoUpdateExtensions = [...this.ignoredAutoUpdateExtensions, identifierWithVersion.key()];\n\t\t}\n\t}\n\n\tprivate isAutoUpdateIgnored(identifierWithVersion: ExtensionIdentifierWithVersion): boolean {\n\t\treturn this.ignoredAutoUpdateExtensions.indexOf(identifierWithVersion.key()) !== -1;\n\t}\n\n\tprivate resetIgnoreAutoUpdateExtensions(): void {\n\t\tthis.ignoredAutoUpdateExtensions = this.ignoredAutoUpdateExtensions.filter(extensionId => this.local.some(local => !!local.local && new ExtensionIdentifierWithVersion(local.identifier, local.version).key() === extensionId));\n\t}\n\n\tdispose(): void {\n\t\tthis.syncDelayer.cancel();\n\t\tthis.disposables = dispose(this.disposables);\n\t}\n}\n"]}]}